________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\3rdparty\libconfig\grammar.c
/* A Bison parser, made by GNU Bison 3.0.4.  */
/* Bison implementation for Yacc-like parsers in C
//www.gnu.org/licenses/>.  */
/* As a special exception, you may create a larger work that contains
/* C LALR(1) parser skeleton written by Richard Stallman, by
/* All symbols defined below should begin with yy or YY, to avoid
/* Identify Bison output.  */
/* Bison version.  */
/* Skeleton name.  */
/* Pure parsers.  */
/* Push parsers.  */
/* Pull parsers.  */
/* Substitute the variable and function names.  */
/* Copy the first part of user declarations.  */
/* yacc.c:339  */
/* prevent warnings about redefined malloc/free in generated code: */
/* these delcarations are provided to suppress compiler warnings */
/* yacc.c:339  */
/* Enabling verbose error messages.  */
/* In a future release of Bison, this section will be replaced
/* Debug traces.  */
/* Token type.  */
/* Tokens.  */
/* Value type.  */
/* yacc.c:355  */
/* yacc.c:355  */
/* !YY_LIBCONFIG_YY_GRAMMAR_H_INCLUDED  */
/* Copy the second part of user declarations.  */
/* yacc.c:358  */
/* INFRINGES ON USER NAME SPACE */
/* INFRINGES ON USER NAME SPACE */
/* empty */
/* Suppress unused-variable warnings by "using" E.  */
/* empty */
/* Suppress an incorrect diagnostic about yylval being uninitialized.  */
/* Nothing. */
/* The parser invokes alloca or malloc; define the necessary symbols.  */
/* INFRINGES ON USER NAME SPACE */
/* INFRINGES ON USER NAME SPACE */
/* INFRINGES ON USER NAME SPACE */
/* Use EXIT_SUCCESS as a witness for stdlib.h.  */
/* Pacify GCC's 'empty if-body' warning.  */
/* empty */; } while (0)
/* The OS might guarantee only one guard page at the bottom of the stack,
/* reasonable circa 2006 */
/* INFRINGES ON USER NAME SPACE */
/* INFRINGES ON USER NAME SPACE */
/* INFRINGES ON USER NAME SPACE */
/* ! defined yyoverflow || YYERROR_VERBOSE */
/* A type that is properly aligned for any stack member.  */
/* The size of the maximum gap between one aligned stack and the next.  */
/* The size of an array large to enough to hold all stacks, each with
/* Relocate STACK from its old location to the new one.  The
/* Copy COUNT objects from SRC to DST.  The source and destination do
/* !YYCOPY_NEEDED */
/* YYFINAL -- State number of the termination state.  */
/* YYLAST -- Last index in YYTABLE.  */
/* YYNTOKENS -- Number of terminals.  */
/* YYNNTS -- Number of nonterminals.  */
/* YYNRULES -- Number of rules.  */
/* YYNSTATES -- Number of states.  */
/* YYTRANSLATE[YYX] -- Symbol number corresponding to YYX as returned
/* YYTRANSLATE[TOKEN-NUM] -- Symbol number corresponding to TOKEN-NUM
/* YYRLINE[YYN] -- Source line where rule number YYN was defined.  */
/* YYTNAME[SYMBOL-NUM] -- String name of the symbol SYMBOL-NUM.
/* YYTOKNUM[NUM] -- (External) token number corresponding to the
/* YYPACT[STATE-NUM] -- Index in YYTABLE of the portion describing
/* YYDEFACT[STATE-NUM] -- Default reduction number in state STATE-NUM.
/* YYPGOTO[NTERM-NUM].  */
/* YYDEFGOTO[NTERM-NUM].  */
/* YYTABLE[YYPACT[STATE-NUM]] -- What to do in state STATE-NUM.  If
/* YYSTOS[STATE-NUM] -- The (internal number of the) accessing
/* YYR1[YYN] -- Symbol number of symbol that rule YYN derives.  */
/* YYR2[YYN] -- Number of symbols on the right hand side of rule YYN.  */
/* Error token number */
/* Enable debugging if requested.  */
/* INFRINGES ON USER NAME SPACE */
/* This macro is provided for backward compatibility. */
/*----------------------------------------.
/*--------------------------------.
/*------------------------------------------------------------------.
/*------------------------------------------------.
/* The symbols being reduced.  */
/* Nonzero means print parse trace.  It is left uninitialized so that
/* !YYDEBUG */
/* !YYDEBUG */
/* YYINITDEPTH -- initial size of the parser's stacks.  */
/* YYMAXDEPTH -- maximum size the stacks can grow to (effective only
/* Return the length of YYSTR.  */
/* Copy YYSRC to YYDEST, returning the address of the terminating '\0' in
/* Copy to YYRES the contents of YYSTR after stripping away unnecessary
/* Fall through.  */
/* Copy into *YYMSG, which is of size *YYMSG_ALLOC, an error message
/* Internationalized format string. */
/* Arguments of yyformat. */
/* Number of reported tokens (one for the "unexpected", one per
/* There are many possibilities here to consider:
/* Start YYX at -YYN if negative to avoid negative indexes in
/* Stay within bounds of both yycheck and yytname.  */
/* Avoid sprintf, as that infringes on the user's name space.
/* YYERROR_VERBOSE */
/*-----------------------------------------------.
/*----------.
/* The lookahead symbol.  */
/* The semantic value of the lookahead symbol.  */
/* Default value used for initialization, for pacifying older GCCs
/* Number of syntax errors so far.  */
/* Number of tokens to shift before error messages enabled.  */
/* The stacks and their tools:
/* The state stack.  */
/* The semantic value stack.  */
/* Lookahead token as an internal (translated) token number.  */
/* The variables used to return semantic value and location from the
/* Buffer for error messages, and its allocated size.  */
/* The number of symbols on the RHS of the reduced rule.
/* Cause a token to be read.  */
/*------------------------------------------------------------.
/* In all cases, when you get here, the value and location stacks
/* Get the current used size of the three stacks, in elements.  */
/* Give user a chance to reallocate the stack.  Use copies of
/* Each stack pointer address is followed by the size of the
/* no yyoverflow */
/* Extend the stack our own way.  */
/* no yyoverflow */
/*-----------.
/* Do appropriate processing given the current state.  Read a
/* First try to decide what to do without reference to lookahead token.  */
/* Not known => get a lookahead token if don't already have one.  */
/* YYCHAR is either YYEMPTY or YYEOF or a valid lookahead symbol.  */
/* If the proper action on seeing token YYTOKEN is to reduce or to
/* Count tokens shifted since error; after three, turn off error
/* Shift the lookahead token.  */
/* Discard the shifted token.  */
/*-----------------------------------------------------------.
/*-----------------------------.
/* yyn is the number of a rule to reduce with.  */
/* If YYLEN is nonzero, implement the default value of the action:
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* yacc.c:1661  */
/* User semantic actions sometimes alter yychar, and that requires
/* Now 'shift' the result of the reduction.  Determine what state
/*--------------------------------------.
/* Make sure we have latest lookahead translation.  See comments at
/* If not already recovering from an error, report this error.  */
/* If just tried and failed to reuse lookahead token after an
/* Return failure if at end of input.  */
/* Else will try to reuse lookahead token after shifting the error
/*---------------------------------------------------.
/* Pacify compilers like GCC when the user code never invokes
/*CONSTCOND*/ 0)
/* Do not reclaim the symbols of the rule whose action triggered
/*-------------------------------------------------------------.
/* Each real token shifted decrements this.  */
/* Pop the current state because it cannot handle the error token.  */
/* Shift the error token.  */
/*-------------------------------------.
/*-----------------------------------.
/*-------------------------------------------------.
/* Fall through.  */
/* Make sure we have latest lookahead translation.  See comments at
/* Do not reclaim the symbols of the rule whose action triggered
/* yacc.c:1906  */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\3rdparty\libconfig\libconfig.c
/* ----------------------------------------------------------------------------
//www.gnu.org/licenses/>.
/* zeroed */
/* ------------------------------------------------------------------------- */
/* WIN32 || WIN64 */
/* LIBCONFIG_STATIC */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* locale overriding is pretty pointless (Hercules doesn't make use of the area that uses locale functionality),
//#warning "No way to modify calling thread's locale!"
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* locale overriding is pretty pointless (Hercules doesn't make use of the area that uses locale functionality),
//#warning "No way to modify calling thread's locale!"
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* boolean */
/* int */
/* 64-bit int */
/* float */
/* check for exponent */
/* no exponent */
/* no decimal point */
/* has decimal point */
/* string */
/* list */
/* array */
/* group */
/* this shouldn't happen, but handle it gracefully... */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* possibly realloc smaller? */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* if the array is empty, then it has no type yet */
/* if it's a list, any type is allowed */
/* otherwise the first element added determines the type of the array */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* Reinitialize the config */
/* read from string */
/* Unwind the include stack, freeing the buffers and closing the files. */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
// On some operating systems, fopen() succeeds on a directory.
// Only proceed if this is not a directory.
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* fall through */ }
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* fall through */ }
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* fall through */ }
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* fall through */
/* ------------------------------------------------------------------------- */
/* fall through */
/* ------------------------------------------------------------------------- */
/* fall through */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
//github.com/HerculesWS/Hercules/pull/136#discussion_r6363319
/* https://github.com/HerculesWS/Hercules/pull/136#discussion_r6363319
/* already exists */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\3rdparty\libconfig\scanctx.c
/* ----------------------------------------------------------------------------
//www.gnu.org/licenses/>.
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* already in list */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* stack underflow */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\3rdparty\libconfig\scanner.c
/* A lexical scanner generated by flex */
/* First, we deal with  platform-specific or compiler-specific issues. */
/* begin standard C headers. */
/* end standard C headers. */
/* flex integer type definitions */
/* C99 systems have <inttypes.h>. Non-C99 systems may or may not. */
/* C99 says to define __STDC_LIMIT_MACROS before including stdint.h,
/* Limits of integral types. */
/* ! C99 */
/* ! FLEXINT_H */
/* TODO: this is always defined, so inline it */
/* Returned upon end-of-file. */
/* Promotes a possibly negative, possibly signed char to an
/* An opaque pointer. */
/* For convenience, these vars (plus the bison vars far below)
/* Enter a start condition.  This macro really ought to take a parameter,
/* Translate the current start state into a value that can be later handed
/* Action number for EOF rule of a given start state. */
/* Special action meaning "start processing a new file". */
/* Size of default input buffer. */
/* On IA-64, the buffer size is 16k, not 8k.
/* __ia64__ */
/* The state buf must be large enough to hold one state per character in the main buffer.
/* Note: We specifically omit the test for yy_rule_can_match_eol because it requires
/* Return all but the first "n" matched characters back to the input stream. */
/* Undo effects of setting up yytext. */ \
/* set up yytext again */ \
/* input buffer */
/* current position in input buffer */
/* Size of input buffer in bytes, not including room for EOB
/* Number of characters read into yy_ch_buf, not including EOB
/* Whether we "own" the buffer - i.e., we know we created it,
/* Whether this is an "interactive" input source; if so, and
/* Whether we're considered to be at the beginning of a line.
/**< The line count. */
/**< The column count. */
/* Whether to try to fill the input buffer when we reach the
/* When an EOF's been seen but there's still some text to process
/* !YY_STRUCT_YY_BUFFER_STATE */
/* We provide macros for accessing buffer states in case in the
/* Same as previous macro, but useful when we know that the buffer stack is not
/*CONSTCOND*/1)
/* Done after the current pattern has been matched and before the
/* This struct is not used in this scanner,
/* Table of booleans, true if rule could match eol. */
/* The intent behind this definition is that it'll catch
/* -*- mode: C -*- */
/* --------------------------------------------------------------------------
//www.gnu.org/licenses/>.
// Suppress generation of useless input() function
/* MinGW's strtoull() seems to be broken; it only returns the lower
/* ! __MINGW32__ */
/* __MINGW32__ */
/* Holds the entire state of the reentrant scanner. */
/* User-defined. Not touched by flex. */
/* The rest are the same as the globals declared in the non-reentrant scanner. */
/**< index of top of stack. */
/**< capacity of stack. */
/**< Stack as an array. */
/* end struct yyguts_t */
/* This must go here because YYSTYPE and YYLTYPE are included
/* Accessor methods to globals.
/* Macros after this point can all be overridden by user definitions in
/* Amount of stuff to slurp up with each read. */
/* On IA-64, the buffer size is 16k, not 8k */
/* __ia64__ */
/* Copy whatever the last rule matched to the standard output. */
/* This used to be an fputs(), but since the string might contain NUL's,
/* Gets input and stuffs it into "buf".  number of characters read, or YY_NULL,
/* No semi-colon after return; correct usage is to write "yyterminate();" -
/* Number of entries by which start-condition stack grows. */
/* Report a fatal error. */
/* end tables serialization structures and prototypes */
/* Default declaration of generated scanner - a define so the user can
/* !YY_DECL */
/* Code executed at the beginning of each rule, after yytext and yyleng
/* Code executed at the end of each rule. */
/*LINTED*/break;
/** The main scanner function which does all the work.
/* first start state */
/*CONSTCOND*/1 )		/* loops until end-of-file is reached */
/* Support of yytext. */
/* yy_bp points to the position in yy_ch_buf of the start of
/* This label is used only to access EOF actions. */
/* beginning of action switch */
/* must back up */
/* undo the effects of YY_DO_BEFORE_ACTION */
/* ignore */ }
/* rule 4 can match eol */
/* ignore */ }
/* rule 6 can match eol */
/* rule 17 can match eol */
/* rule 20 can match eol */
/* rule 24 can match eol */
/* ignore */ }
/* ignore */ }
/* undo effects of setting up yytext */
/* set up yytext again */
/* ignore */ }
/* Amount of text matched not including the EOB char. */
/* Undo the effects of YY_DO_BEFORE_ACTION. */
/* We're scanning a new file or input source.  It's
/* Note that here we test for yy_c_buf_p "<=" to the position
/* This was really a NUL. */
/* Okay, we're now positioned to make the NUL
/* Consume the NUL. */
/* Note: because we've taken care in
/* end of action switch */
/* end of scanning one token */
/* end of user's declarations */
/* end of libconfig_yylex */
/* yy_get_next_buffer - try to read in a new buffer
/* Don't try to fill the buffer, so this is an EOF. */
/* We matched a single character, the EOB, so
/* We matched some text prior to the EOB, first
/* Try to read more data. */
/* First move last chars to start of buffer. */
/* don't do the read, it's not guaranteed to return an EOF,
/* Not enough room in the buffer - grow it. */
/* just a shorter name for the current buffer */
/* Include room in for 2 EOB chars. */
/* Can't grow it, we don't own it. */
/* Read in more data. */
/* Extend the array by 50%, plus the number we really need. */
/* yy_get_previous_state - get the state just before the EOB char was reached */
/* yy_try_NUL_trans - try to make a transition on the NUL character
/* This var may be unused depending upon options. */
/* yy_c_buf_p now points to the character we want to return.
/* This was really a NUL. */
/* need more input */
/* This happens because yy_g_n_b()
/* Reset buffer status. */
/*FALLTHROUGH*/
/* cast for 8-bit char's */
/* preserve yytext */
/* ifndef YY_NO_INPUT */
/** Immediately switch to a different input stream.
// Fixes compiler warning -Wnull-dereference on gcc-6 and -O3
/** Switch to a different input buffer.
/* TODO. We should be able to replace this entire function body
/* Flush out information for old buffer. */
/* We don't actually know whether we did this switch during
/** Allocate and initialize an input buffer state.
/* yy_ch_buf has to be 2 characters longer than the size given because
/** Destroy the buffer.
/* Not sure if we should pop here. */
/* Initializes or reinitializes a buffer.
/* If b is the current buffer, then libconfig_yy_init_buffer was _probably_
/** Discard all buffered characters. On the next scan, YY_INPUT will be called.
/* We always need two end-of-buffer characters.  The first causes
/** Pushes the new state onto the stack. The new state becomes
/* This block is copied from libconfig_yy_switch_to_buffer. */
/* Flush out information for old buffer. */
/* Only push if top exists. Otherwise, replace top. */
/* copied from libconfig_yy_switch_to_buffer. */
/** Removes and deletes the top of the stack, if present.
/* Allocates the stack if it does not exist.
/* First allocation is just for 2 elements, since we don't know if this
/* After all that talk, this was set to 1 anyways... */
/* Increase the buffer to prepare for a possible push. */
/* arbitrary grow size */;
/* zero only the new slots.*/
/** Setup the input buffer state to scan directly from a user-specified character buffer.
/* They forgot to leave room for the EOB's. */
/* "- 2" to take care of EOB's */
/** Setup the input buffer state to scan a string. The next call to libconfig_yylex() will
/** Setup the input buffer state to scan the given bytes. The next call to libconfig_yylex() will
/* Get memory for full buffer, including space for trailing EOB's. */
/* It's okay to grow etc. this buffer, and we should throw it
/* Redefine yyless() so it works in section 3 code. */
/* Undo effects of setting up yytext. */ \
/* Accessor  methods (get/set functions) to struct members. */
/** Get the user-defined data for this scanner.
/** Get the current line number.
/** Get the current column number.
/** Get the input stream.
/** Get the output stream.
/** Get the length of the current token.
/** Get the current token.
/** Set the user-defined data. This data is never touched by the scanner.
/** Set the current line number.
/* lineno is only valid if an input buffer exists. */
/** Set the current column.
/* column is only valid if an input buffer exists. */
/** Set the input stream. This does not discard the current
/* Accessor methods for yylval and yylloc */
/* User-visible API */
/* libconfig_yylex_init is special because it creates the scanner itself, so it is
/* By setting to 0xAA, we expose bugs in yy_init_globals. Leave at 0x00 for releases. */
/* libconfig_yylex_init_extra has the same functionality as libconfig_yylex_init, but follows the
/* By setting to 0xAA, we expose bugs in
/* Initialization is the same as for the non-reentrant scanner.
/* Defined in main.c */
/* For future reference: Set errno on error, since we are called by
/* libconfig_yylex_destroy is for both reentrant and non-reentrant scanners. */
/* Pop the buffer stack, destroying each element. */
/* Destroy the stack itself. */
/* Destroy the start condition stack. */
/* Reset the globals. This is important in a non-reentrant scanner so the next time
/* Destroy the main struct (reentrant only). */
/*
/* The cast to (char *) in the following accommodates both
/* see libconfig_yyrealloc() for (char *) cast */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\3rdparty\libconfig\strbuf.c
/* ----------------------------------------------------------------------------
//www.gnu.org/licenses/>.
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* add 1 for NUL */
/* ------------------------------------------------------------------------- */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\3rdparty\mt19937ar\mt19937ar.c
/* 
//www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/emt.html
/* Period parameters */  
/* constant vector a */
/* most significant w-r bits */
/* least significant r bits */
/* the array for the state vector  */
/* mti==N+1 means mt[N] is not initialized */
/* initializes mt[N] with a seed */
/* See Knuth TAOCP Vol2. 3rd Ed. P.106 for multiplier. */
/* In the previous versions, MSBs of the seed affect   */
/* only MSBs of the array mt[].                        */
/* 2002/01/09 modified by Makoto Matsumoto             */
/* for >32 bit machines */
/* initialize by an array with array-length */
/* init_key is the array for initializing keys */
/* key_length is its length */
/* slight change for C++, 2004/2/26 */
/* non linear */
/* for WORDSIZE > 32 machines */
/* non linear */
/* for WORDSIZE > 32 machines */
/* MSB is 1; assuring non-zero initial array */ 
/* generates a random number on [0,0xffffffff]-interval */
/* mag01[x] = x * MATRIX_A  for x=0,1 */
/* generate N words at one time */
/* if init_genrand() has not been called, */
/* a default initial seed is used */
/* Tempering */
/* generates a random number on [0,0x7fffffff]-interval */
/* generates a random number on [0,1]-real-interval */
/* divided by 2^32-1 */ 
/* generates a random number on [0,1)-real-interval */
/* divided by 2^32 */
/* generates a random number on (0,1)-real-interval */
/* divided by 2^32 */
/* generates a random number on [0,1) with 53-bit resolution*/
/* These real versions are due to Isaku Wada, 2002/01/09 added */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\3rdparty\mt19937ar\mtTest.c
/* 
//www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/emt.html
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\char.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// CONSOLE_INPUT
// stat()
// private declarations
// MAIL SYSTEM
// Auctions System
///< Whether to allow character creation.
// Allow or not identical name for characters but with a different case by [Yor]
// Option to know which letters/symbols are authorized in the name of a character (0: all, 1: only those in char_name_letters, 2: all EXCEPT those in char_name_letters) by [Yor]
// Name to use when the requested name cannot be determined
//The following characters are trimmed regardless because they cause confusion and problems on the servers. [Skotlex]
// list of letters/symbols allowed (or not) in a character name. by [Yor]
///< From which level you can delete character [Lupus]
///< Verify if char is in guild/party or char and reacts as Aegis does (disallow deletion), @see chr->delete2_req.
// whether or not the player can be renamed while in party/guild
/// Start items for new characters
//Custom limits for the fame lists. [Skotlex]
// Char-server-side stored fame lists [DracoRPG]
// Initial position (it's possible to set it in conf file)
//-----------------------------------------------------
// Auth database
//-----------------------------------------------------
// int account_id -> struct char_auth_node*
//-----------------------------------------------------
// Online User Database
//-----------------------------------------------------
/**
// Prevent this value from going negative.
//Update DB
//Check to see for online conflicts
// 2: Already connected to server
//Update state data
//Get rid of disconnect timer
//Set char online in guild cache. If char is in memory, use the guild id on it, otherwise seek it.
//Notify login server
/* Character Achievements */
//We don't free yet to avoid aCalloc/aFree spamming during char change. [Skotlex]
// Prevent this value from going negative.
//FIXME? Why Kevin free'd the online information when the char was effectively in the map-server?
//Remove char if 1- Set all offline, or 2- character is no longer connected to char-server.
/**
//In some map server that we aren't connected to.
/**
//Kick out any connected characters, and set them offline as appropriate.
// 1: Server closed
// fail
//Tell login-server to also mark all our characters as offline.
//Set all players to 'OFFLINE'
/**
//For displaying save information. [Skotlex]
//If there are any errors while saving, "cp" will not be updated at the end.
//map inventory data
//map cart data
//Save status
// FIXME: platform-dependent size
//Values that will seldom change (to speed up saving)
/* Mercenary Owner */
//memo points
//`memo` (`memo_id`,`char_id`,`map`,`x`,`y`)
//insert here.
//skills
//`skill` (`char_id`, `id`, `lv`)
//insert here.
/* other flags do not need to be saved */
//Save friends
// hotkeys
// not the first hotkey
/**
// temp storage variable
// Initialize the array.
/**
// temp item storage variable
/**
// Item found.
// Mark the item as matched.
// If the amount has changed, set for replacement with current item properties.
// Doesn't exist in the table, set for deletion.
/**
/**
/**
// Unused
// sd is not available, there isn't much we can do. Just return and print a warning.
//=====================================================================================================
// Loads the basic character rooster for the given account. Returns total buffer used.
// read char data
//=====================================================================================================
// read char data
// For quick selection of data when displaying the char menu
//read memo data
//`memo` (`memo_id`,`char_id`,`map`,`x`,`y`)
/* read inventory [Smokexyz/Hercules] */
/* read cart [Smokexyz/Hercules] */
//read skill
//`skill` (`char_id`, `id`, `lv`)
//read friends
//`friends` (`char_id`, `friend_account`, `friend_id`)
//read hotkeys
//`hotkey` (`char_id`, `hotkey`, `type`, `itemskill_id`, `skill_lvl`
/* Mercenary Owner DataBase */
/* default */
//`account_data` (`account_id`,`bank_vault`,`base_exp`,`base_drop`,`base_death`)
//ok. all data load successfully!
/* load options into proper vars */
//==========================================================================================================
//the 'set offline' part is now in check_login_conn ...
//if the server connects to loginserver
//it will dc all off players
//and send the loginserver the new state....
// Force all users offline in sql when starting char-server
// (useful when servers crashes and don't clean the database)
/* [Ind/Hercules] - special thanks to Yommy for providing the packet structure/data */
// Only the short data is needed.
/* moving char to occupied slot */
/* update both at once */
/* slot is free. */
/* update count */
//-----------------------------------
// Function to change character's names
//-----------------------------------
// Not ready for rename
// Only the short data is needed.
// Try rename not own char
// MSG_FAILED_RENAME_BELONGS_TO_GUILD
// MSG_FAILED_RENAME_BELONGS_TO_PARTY
// check if the char exist
// Change character's name into guild_db.
// log change
/**
/**
// check length of character name
// empty character name
/**
// check content of character name
// control chars in name
// check for reserved names
// nick reserved for internal server messages
// Check Authorized letters/symbols in the name of the character
// only letters/symbols in char_name_letters are authorized
// letters/symbols in char_name_letters are forbidden
/**
// Char Creation Denied
//check other inputs
// slots
// stats
// individual stat values
// pairs
// invalid slot
// invalid input
// check char slot
/* character account limit exceeded */
// Insert the new char entry to the database
//No, stop the procedure!
//Insert the new char entry to the database
//No, stop the procedure!
//Retrieve the newly auto-generated char id
// Validation success, log result
//Give the char the default items
// Non-stackable items should have their own entries (issue: 7279)
/*----------------------------------------------------------------------------------------------------------*/
/* Divorce Players */
/*----------------------------------------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------------------------------------*/
/* Delete char - davidsiaw */
/*----------------------------------------------------------------------------------------------------------*/
/* Returns 0 if successful
//Name needs be escaped.
//check for config char del condition [Lupus]
// TODO: Move this out to packet processing (0x68/0x1fb).
/* Divorce [Wizputer] */
/* De-addopt [Zephyrus] */
// Char is Baby
// Baby
//Make the character leave the party [Skotlex]
/* delete char's pet */
//Delete the hatched pet if you have one...
//Delete all pets that are stored in eggs (inventory + cart)
/* remove homunculus */
/* remove elemental */
/* remove mercenary data */
/* delete char's friends list */
/* delete char from other's friend list */
//NOTE: Won't this cause problems for people who are already online? [Skotlex]
/* delete hotkeys */
/* delete inventory */
/* delete cart inventory */
/* delete memo areas */
/* delete character registry */
/* delete skills */
/* delete mails (only received) */
/* status changes */
/* delete character */
/* No need as we used inter_guild->leave [Skotlex]
// Leave your guild.
//---------------------------------------------------------------------
// This function return the number of online players in all map-servers
//---------------------------------------------------------------------
// Writes char data to the buffer in the format used by the client.
// Used in packets 0x6b (chars info) and 0x6d (new char info)
// Returns the size
// probably opt1
// probably opt2
// p->speed;
//When the weapon is sent and your option is riding, the client crashes on login!?
// FIXME[Haru]: is OPTION_HANBOK intended to be part of this list? And if it is, should the list also include other OPTION_ costumes?
//2011-11-16 wants 136, ask gravity.
// change slot feature (0 = disabled, otherwise enabled)
// (0 = disabled, otherwise displays "Add-Ons" sidebar)
// sex - (0 = female, 1 = male, 99 = logindefined)
/* Made Possible by Yommy~! <3 */
// send empty packet if chars count is 3, for trigger final code in client
/* Sends character ban list */
/* Made Possible by Yommy~! <3 */
/* reset -- client keeps this information even if you logout so we need to clear */
/* also update on mysql */
//----------------------------------------
// [Ind/Hercules] notify client about charselect window data
//----------------------------------------
// also probably supported client 2013-02-15aRagexe but not 2013-02-15bRagexe [4144]
// unused bytes
//----------------------------------------
// Function to send characters to a player
//----------------------------------------
// offset
// Max slots.
// Available slots. (aka PremiumStartSlot)
// Premium slots. AKA any existent chars past sd->char_slots but within MAX_CHARS will show a 'Premium Service' in red
// unknown bytes
// packet len
// Failsafe, avoild querys and fix EXP bug dividing with lower level chars
//Failsafe, and avoid querys where there is no sense to keep executing if any of the inputs are 0
//----------------------------------------------------------------------
// Force disconnection of an online player (with account value) by [Yor]
//----------------------------------------------------------------------
// disconnect player if online on char-server
// check if character is not online already. [Skotlex]
//Character already online. KICK KICK KICK
// 2: Already connected to server
//There's already a connection from this account that hasn't picked a char yet.
// mark session as 'authed'
// set char online on charserver
// continues when account data is received...
// sends a ping packet to login server (will receive pong 0x2718)
// Invalid username/password
// IP not allowed
// 0 - rejected from server
//
// ok
/* restrictions apply */
/* the client will already deny this request, this check is to avoid someone bypassing. */
// auth failed
// find the authenticated session with this account id
/* cap to maximum */
/* no value aka 0 in sql */
/* cap to maximum */
// continued from chr->auth_ok...
// refuse connection (over populated)
// send characters to player
/**
// job modification
// If there is a guild, update the guild_member data [Skotlex]
// This should _never_ happen
// get characters
// disconnect player if online on char-server
// notify all mapservers about this change
//Receive account_reg2 registry, forward to map servers.
// disconnect player if online on char-server
// account is already marked as online!
//Kick it from the map server it is on.
// 2: Already connected to server
// Manual kick from char server.
// still moving to the map-server
// reject auth attempts from map-server
//Update login ip, too.
//Update ip.
// notify login server about the change
// only process data from the login-server
/* we've reached stall time */
/* we can't wait any longer */
/* we haven't sent ping out yet */
// acknowledgment of connect-to-loginserver request
// acknowledgment of account authentication request
// account data
// login-server alive packet
// changesex reply
// reply to an account_reg2 registry request
// State change of account/ban notification (from login-server)
// Login server request to kick a character out. [Skotlex]
// ip address update signal from login server
// Failed accinfo lookup to forward to mapserver
// Successful accinfo lookup to forward to mapserver
/**
/* count */
/**
/**
/* won't be higher; the column size is 32 */
/* won't be higher; the column size is 254 */
/* prepare next */
// Empty ranking lists
// Build Blacksmith ranking list
// char_id
// fame
// name
// Build Alchemist ranking list
// char_id
// fame
// name
// Build Taekwon ranking list
// char_id
// fame
// name
// Send map-servers the fame ranking lists
// add blacksmith's block length
// add alchemist's block length
// add total packet length
//Loads a character's name and stores it in the buffer given (must be NAME_LENGTH in size) and not NULL
//Returns 1 on found, 0 on not found (buffer is filled with Unknown char name)
// Transmitting maps information to the other map-servers
// Transmitting the maps of the other map-servers to the new map-server
// send name for wisp to player
//Send fame list.
//Clear the data once loaded.
//no sc (needs a response)
//TODO: When data mismatches memory, update guild/party online/offline states.
//Set all chars from this server as 'unknown'
// 2: Already connected to server
//If any chars remain in -2, they will be cleaned in the cleanup timer.
//Save ack only needed on final save.
//Check account only if this ain't final save. Final-save goes through because of the char-map reconnect
//This may be valid on char-server reconnection, when re-sending characters that already logged off.
//Flag, set character offline after saving. [Skotlex]
// 0 - not ok
// 1 - ok
// create temporary auth entry
//node->sex = 0;
/* sounds troublesome. */
//node->expiration_time = 0; // unlimited/unknown time by default (not display in map-server)
//node->gmlevel = 0;
//Set char to "@ char select" in online db [Kevin]
//Set login1 to 0.
//Locate mapserver by ip and port.
//Char should just had been saved before this packet, so this should be safe. [Skotlex]
//Really shouldn't happen.
//Send the map server the auth of this player.
//Update the "last map" as this is where the player must be spawned on the new map server.
// create temporary auth entry
// FIXME (this thing isn't really supported we could as well purge it instead of fixing)
//Update server where char is.
//Reply with an ack.
//Reply with nak
// don't send request if no login-server
// 0x2722 <account_id>.L <actual_e-mail>.40B <new_e-mail>.40B
// new ban
// add to existing ban
// condition applies; send to all map-servers to disconnect the player
// disconnect player if online on char-server
/* handled by char server, so no redirection */
/**
// get character data
// disconnect player if online on char-server
// notify all mapservers about this change
// 0-login-server request done, 1-player not found, 2-gm level too low, 3-login-server offline
// account_id of who ask (-1 if server itself made this request)
// name of the target character
// type of operation: 1-block, 2-ban, 3-unblock, 4-unban, 5 changesex, 6 charban, 7 charunban
// 1-player not found
// 1-player not found
// 3-login-server offline
//FIXME: need to move this check to login server [ultramage]
// 2-gm level too low
// 0
/* handled by char server, so no redirection */
// send answer if a player ask, not if the server ask
// Don't send answer for changesex
// position of the player
// where the player should be
// not on list and not enough fame to get on it
// same position
// move in the list
// new ranker - not in the list
// already in the list
// move to the end of the list
/* clear; ensure no left overs e.g. permanent */
// FIXME: will wrap to negative after "19-Jan-2038, 03:14:07 AM GMT"
//Really shouldn't happen.
/*&&
// auth ok
// only use the auth once and mark user online
// auth failed
// not a map server
// Receiving map names list from the map-server
//Packet command is now used for sc_data request. [Skotlex]
//set MAP user count
//set MAP users
// Receive character data from map-server for saving
// req char selection
// request "change map server"
// Remove RFIFOL(fd,6) (friend_id) from RFIFOL(fd,2) (char_id) friend list [Ind]
// char name request
// Map server send information to change an email of an account -> login-server
// Request from map-server to change an account's or character's status (accounts will just be forwarded to login server)
// Update and send fame ranking list
// Divorce chars
// Receive rates [Wizputer]
// Character disconnected set online 0 [Wizputer]
// Reset all chars to offline [Wizputer]
// Character set online [Wizputer]
// Build and send fame ranking lists [DracoRPG]
//Request to save status change data. [Skotlex]
// map-server alive packet
// auth request from map-server
// ip address update
/* individual sc data insertion/update  */
/* individual sc data delete */
// inter server - packet
// processed
// need more packet
// no inter server packet. no char server packet -> disconnect
// switch
// while
// Searches for the mapserver that has a given map (and optionally ip/port, if not -1).
// If found, returns the server's index in the 'server' array (otherwise returns -1).
// Initialization process (currently only initialization inter_mapif)
/**
/// Answers to deletion request (HC_DELETE_CHAR3_RESERVED)
/// @param result
/// 0 (0x718): An unknown error has occurred.
/// 1: none/success
/// 3 (0x719): A database error occurred.
/// 4 (0x71a): To delete a character you must withdraw from the guild.
/// 5 (0x71b): To delete a character you must withdraw from the party.
/// Any (0x718): An unknown error has occurred.
// HC: <0828>.W <char id>.L <Msg:0-5>.L <deleteDate>.L
/// @param result
/// 0 (0x718): An unknown error has occurred.
/// 1: none/success
/// 2 (0x71c): Due to system settings can not be deleted.
/// 3 (0x719): A database error occurred.
/// 4 (0x71d): Deleting not yet possible time.
/// 5 (0x71e): Date of birth do not match.
/// Any (0x718): An unknown error has occurred.
// HC: <082a>.W <char id>.L <Msg:0-5>.L
/// @param result
/// 1 (0x718): none/success, (if char id not in deletion process): An unknown error has occurred.
/// 2 (0x719): A database error occurred.
/// Any (0x718): An unknown error has occurred.
// HC: <082c>.W <char id>.L <Msg:1-2>.L
// CH: <0827>.W <char id>.L
// character not found
// 3: A database error occurred
// 3: A database error occurred
// character already queued for deletion
// 0: An unknown error occurred
// This check is imposed by Aegis to avoid dead entries in databases
// _it is not needed_ as we clear data properly
// see issue: 7338
// 3: A database error occurred
// 4: To delete a character you must withdraw from the guild
// 5: To delete a character you must withdraw from the party
// success
// 3: A database error occurred
// 1: success
// CH: <0829>.W <char id>.L <birth date:YYMMDD>.6B
// construct "YY-MM-DD"
// character not found
// 3: A database error occurred
// data error
// 3: A database error occurred
// not queued or delay not yet passed
// 4: Deleting not yet possible time
// +2 to cut off the century
// birth date is wrong
// 5: Date of birth do not match
// character level config restriction
// 2: Due to system settings can not be deleted
// success
// 3: A database error occurred
// refresh character list cache
// 1: success
// CH: <082b>.W <char id>.L
// character not found
// 2: A database error occurred
// there is no need to check, whether or not the character was
// queued for deletion, as the client prints an error message by
// itself, if it was not the case (@see chr->delete2_cancel_ack)
// 2: A database error occurred
// 1: success
//Received again auth packet for already authenticated account?? Discard it.
//TODO: Perhaps log this as a hack attempt?
//TODO: and perhaps send back a reply?
// not authed yet
// send back account_id
// search authentication
/*&&
// authentication found (coming from map server)
/* restrictions apply */
/* the client will already deny this request, this check is to avoid someone bypassing. */
// authentication not found (coming from login server)
// don't send request if no login-server
// if no login-server, we must refuse connection
// [!] LE byte order here [!]
/* we can't send empty (otherwise the list will pop up) */
// hack check
/* not available, tell it to wait (client wont close; char select will respawn).
//Not found?? May be forged packet.
// rejected from server
/* client doesn't let it get to this point if you're banned, so its a forged packet */
// rejected from server
/* set char as online prior to loading its data so 3rd party applications will realize the sql data is not reliable */
/* failed? set it back offline */
/* failed to load something. REJECT! */
// rejected from server
/* jump off this boat */
//Have to switch over to the DB instance otherwise data won't propagate [Kevin]
// FIXME: Why are we re-escaping the name if it was already escaped in rename/make_new_char? [Panikon]
// searching map server
// if map is not found, we check major cities
//First check that there's actually a map server online.
// 1 = Server closed
// 1 = Server closed
//Send NEW auth packet [Kevin]
//FIXME: is this case even possible? [ultramage]
// 1 = Server closed
//Send player to map
// create temporary auth entry
/* Others I found [Ind] */
/* 0x02 = Symbols in Character Names are forbidden */
/* 0x03 = You are not eligible to open the Character Slot. */
/* 0x0B = This service is only available for premium users. */
/* 0x0C = Character name is invalid. */
// 'Charname already exists'
// 'Char creation denied'
// 'You are underaged'
// 'You are not eligible to open the Character Slot.'
// 'Symbols in Character Names are forbidden'
// send to player
//turn character creation on/off [Kevin]
// Char Creation Denied
//'Charname already exists' (-1), 'Char creation denied' (-2) and 'You are underaged' (-3)
// retrieve data
//Only the short data is needed.
// add new entry to the chars list
// the char_id of the new char
// flag:
// 0 = Incorrect Email address
// hack check
// Check if e-mail is correct
/* emails don't match */
/* it's not the default email */
/* sent email isn't the default */
//Fail
// check if this char exists
// Such a character does not exist in the account
// remove char from list and compact it
/* Delete character */
//can't delete the char
//either SQL error or can't delete by some CONFIG conditions
//del fail
/* Char successfully deleted.*/
// flag:
// 0 - ok
// 3 - error
// Failure
// Success
/* we enforce it elsewhere, go 0 */
/* for some stupid reason it requires the char data again (gravity -_-) */
// disconnect any player if no login-server.
// already authed client
//If it is not in any server, send it offline. [Skotlex]
//For use in packets that depend on an sd being present [Skotlex]
// request to connect
// 0065 <account id>.L <login id1>.L <login id2>.L <???>.W <sex>.B
// char select
// create new char
// S 0a39 <name>.24B <slot>.B <hair color>.W <hair style>.W <starting job class ID>.W <Unknown>.(W or 2 B's)??? <sex>.B
// S 0970 <name>.24B <slot>.B <hair color>.W <hair style>.W
// S 0067 <name>.24B <str>.B <agi>.B <vit>.B <int>.B <dex>.B <luk>.B <slot>.B <hair color>.W <hair style>.W
// delete char
// 2004-04-19aSakexe+ langtype 12 char deletion packet
// client keep-alive packet (every 12 seconds)
// R 0187 <account ID>.l
// char rename request
// R 08fc <char ID>.l <new name>.24B
// char rename request
// R 028d <account ID>.l <char ID>.l <new name>.24B
//Confirm change name.
// 0x28f <char_id>.L
// 0: Successful
// 1: This character's name has already been changed. You cannot change a character's name more than once.
// 2: User information is not correct.
// 3: You have failed to change this character's name.
// 4: Another user is using this character name, so please select another one.
// captcha code request (not implemented)
// R 07e5 <?>.w <aid>.l
// captcha code check (not implemented)
// R 07e7 <len>.w <aid>.l <code>.b10 <?>.b14
// deletion timer request
// deletion accept request
// deletion cancel request
// login as map-server
// avoid processing of follow-up packets here
// checks the entered pin
// request for PIN window
// pincode change request
// activate PIN system and set first PIN
/* 0x8d4 <from>.W <to>.W <unused>.W (2+2+2+2) */
// unknown packet received
// only send an update when needed
// send number of user to login server
/**
// send account list to login server
//Try again later. [Skotlex]
//------------------------------------------------
//Invoked 15 seconds after mapif->disconnectplayer in case the map server doesn't
//replies/disconnect the player we tried to kick. [Skotlex]
//------------------------------------------------
//Mark it offline due to timeout.
/**
//Character still connected
//Unknown server.. set them offline
//Free data from players that have not been online for a while.
/**
// Error message is already shown by libconfig->load_file
// import should overwrite any previous configuration, so it should be called last
/**
// Not all registries are read by char-server
/**
/**
/**
// Error message is already shown by libconfig->load_file
// import should overwrite any previous configuration, so it should be called last
/**
// char_configuration/server_name
// char_configuration/wisp_server_name
// wisp_server_name should _always_ be equal or bigger than 4 characters!
// TODO: This length should be a #define (i.e. MIN_NAME_LENGTH)
// char_configuration/guild_exp_rate
/**
// Login information
// Login-server and character-server information
/**
/**
// only bother if its actually enabled
/**
/**
/**
/**
/**
// Without knowing if the item is stackable or not we can't add it!
/**
// start_point / start_point_pre
/**
// While normally true/false makes sense, we may accept any int16 here (it's passed as is to the client)
/**
//------------------------------
// Function called when the server
// has received a crash signal.
//------------------------------
/// Called when a terminate signal is received.
// TODO proper shutdown procedure; wait for acks?, kick all characters, ... [FlavoJS]
/**
/**
/**
/**
/**
//Read map indexes
// TODO: Remove this when no longer needed.
// inter server configuration
//Read fame lists.
// periodically update the overall user count on all mapservers + login server
// Timer to clear (chr->online_char_db)
// Online Data timers (checking if char still connected)
//Cleaning the tables for NULL entries @ startup [Sirius]
//Chardb clean
//guilddb clean
//guildmemberdb clean
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\geoip.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// for stat/lstat/fstat - [Dekamaster/Ultimate GM Tool]
/* [Dekamaster/Nightroad] */
/* [Dekamaster/Nightroad] */
/* WHY NOT A DBMAP: There are millions of entries in GeoIP and it has its own algorithm to go quickly through them, a DBMap wouldn't be efficient */
/* Take the right-hand branch */
/* Take the left-hand branch */
/**
/**
//dev.maxmind.com/geoip/legacy/geolite/
// Search database type
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\HPMchar.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// HPMDataCheck comes after all the other includes
/**
// No supported types at the moment.
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\inter.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
//Feature by irmin.
// recv. packet list
// 3000-
// 3010- Account Storage, Achievements [Smokexyz]
// 3020- Party
// 3030-
// 3040- Clan System(3044-3045)
// 3050-  Auction System [Zephyrus], Item Bound [Mhalicot]
// 3060-  Quest system [Kevin] [Inkfish]
// 3070-  Mercenary packets [Zephyrus], Elemental packets [pakpil]
// 3080-
// 3090-  Homunculus packets [albator], RoDEX packets
//  messages 550 ~ 699 are job names
/**
/*==========================================
/* from pc.c due to @accinfo. any ideas to replace this crap are more than welcome. */
// 550
// 551
// 552
// 553
// 554
// 555
// 556
// 557
// 558
// 559
// 560
// 561
// 562
// 563
// 564
// 565
// 566
// 567
// 568
// 569
// 570
// 571
// 572
// 573
// 574
// 575
// 576
// 577
// 578
// 579
// 580
// 581
// 582
// 583
// 584
// 585
// 586
// 587
// 588
// 589
// 590
// 591
// 592
// 593
// 594
// 595
// 596
// 597
// 598
// 599
// 600
// 601
// 602
// 603
// 604
// 605
// 606
// 607
// 608
// 609
// 610
// 611
// 612
// 613
// 614
// 622
// 623
// 624
// 625
// 626
// 627
// 628
// 629
// 630
// 656
// 657
// 658
// 659
// 660
// 661
// 631
// 632
// 633
// 634
// 635
// 636
// 637
// 662
// 663
// 664
// 665
// 666
// 667
// 668
// 638
// 639
// 640
// 641
// 642
// 643
// 644
// 645
// 646
// 647
// 648
// 649
// 650
// 651
// 652
// 653
// 654
// "Unknown Job"
/**
/* yes we start at 1 */
/**
/* [Dekamaster/Nightroad] */
// is string
//we found a perfect match
// more than one, listing... [Dekamaster/Nightroad]
/* it will only get here if we have a single match */
/* and we will send packet with account id to login server asking for account info */
// check if we have a valid fd
// enable this if you really know what you doing.
/* password is only received if your gm level is greater than the one you're searching for */
/**
/* to login server we go! */
/* global account reg */
/* local account reg */
/* char reg */
// Load account_reg from sql (type=2)
//char reg
//account reg
//account2 reg
/* 0x2 = length, set prior to being sent */
/* var type (only set when all vars have been sent, regardless of type) */
/* is string type */
/* count */
/**
/* won't be higher; the column size is 32 */
/* won't be higher; the column size is 254 */
/* prepare follow up */
/* 0x2 = length, set prior to being sent */
/* var type (only set when all vars have been sent, regardless of type) */
/* is string type */
/* count */
/* mark & go. */
//char reg
//account reg
// This is already checked above.
//account2 reg
// 0
/* 0x2 = length, set prior to being sent */
/* var type (only set when all vars have been sent, regardless of type) */
/* is int type */
/* count */
/**
/* won't be higher; the column size is 32 */
/* prepare follow up */
/* 0x2 = length, set prior to being sent */
/* var type (only set when all vars have been sent, regardless of type) */
/* is int type */
/* count */
/* mark as complete & go. */
/**
/**
/**
// import should overwrite any previous configuration, so it should be called last
/**
// escaped str
/**
// FIXME
// initialize
//DB connection initialized
// finalize
//--------------------------------------------------------
/// Returns the length of the next complete packet to process,
/// or 0 if no complete packet exists in the queue.
///
/// @param length The minimum allowed length, or -1 for dynamic lookup
// variable-length packet
// Check is valid packet entry
// Check packet length
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\int_achievement.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/**
// Destroy the buffer.
// Destroy the buffer.
/* Sync with inter-db acheivements. */
/**
// char_achievements (`char_id`, `ach_id`, `completed_at`, `rewarded_at`, `obj_0`, `obj_2`, ...`obj_9`)
/* Objectives */
/* Add Entry */
/**
/**
// Initialize the loaded db storage.
// used as a comparand against map-server achievement data before saving.
/**
/**
/**
/**
/* */
/* */
/* */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\int_auction.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// You have won the auction
/* Card Slots */
/* Item Options */
// 10 seconds to process ended auctions
/*==========================================
// int auction_id -> struct auction_data*
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\int_clan.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// DBPATH
/**
// Kick Inactive members
/**
// Count members
// Communication from the map server
// - Can analyzed only one by one packet
// Data packet length that you set to inter.c
//- Shouldn't do checking and packet length, RFIFOSKIP is done by the caller
// Must Return
//  1 : ok
//  0 : error
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\int_elemental.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/**
/**
/*==========================================
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\int_guild.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// DBPATH
// LSB = 0 => Alliance, LSB = 1 => Opposition
//To know in which guild we were.
//0: Have not reached last guild. 1: Reached last guild, ready for save. 2: Some guild saved, don't do further saving.
//Save the first guild in the list.
//Save next guild in the list.
//Some guild saved.
// Nothing to save, guild is ready for removal.
//Reached the end of the guild db without saving.
//Reset guild saved, return to beginning.
//Calculate the time slot for the next save.
// Save guild into sql
// Table guild (GS_BASIC_MASK)
// GS_EMBLEM `emblem_len`,`emblem_id`,`emblem_data`
// GS_CONNECT `connect_member`,`average_lv`
// GS_MES `mes1`,`mes2`
// GS_LEVEL `guild_lv`,`max_member`,`exp`,`next_exp`,`skill_point`
// GS_BASIC `name`,`master`,`char_id`
// GS_MEMBER `guild_member` (`guild_id`,`account_id`,`char_id`,`hair`,`hair_color`,`gender`,`class`,`lv`,`exp`,`exp_payper`,`online`,`position`,`name`)
// GS_POSITION `guild_position` (`guild_id`,`position`,`name`,`mode`,`exp_mode`)
// GS_ALLIANCE `guild_alliance` (`guild_id`,`opposition`,`alliance_id`,`name`)
// GS_EXPULSION `guild_expulsion` (`guild_id`,`account_id`,`name`,`mes`)
// GS_SKILL `guild_skill` (`guild_id`,`id`,`lv`)
// temporary storage for str conversion. They must be twice the size of the
// original string to ensure no overflows will occur. [Skotlex]
// Insert a new guild the guild
// Create a new guild
//Failed to create guild!
// If we need an update on an existing guild or more update on the new guild
// Convert emblem_data to hex
//TODO: why not use binary directly? [ultramage]
//last condition using add_coma setting
// 0
// Update only needed players
//Since nothing references guild member table as foreign keys, it's safe to use REPLACE INTO
//printf("- Insert guild %d to guild_position\n",g->guild_id);
// Delete current alliances
// NOTE: no need to do it on both sides since both guilds in memory had
// their info changed, not to mention this would also mess up oppositions!
// [Skotlex]
//if( SQL_ERROR == SQL->Query(inter->sql_handle, "DELETE FROM `%s` WHERE `guild_id`='%d' OR `alliance_id`='%d'", guild_alliance_db, g->guild_id, g->guild_id) )
//printf("- Insert guild %d to guild_alliance\n",g->guild_id);
//printf("- Insert guild %d to guild_expulsion\n",g->guild_id);
//printf("- Insert guild %d to guild_skill\n",g->guild_id);
// Read guild from sql
// Guild does not exists.
// Fix reduction of MAX_GUILD [PoW]
// convert emblem data from hexadecimal to binary
//TODO: why not store it in the db as binary directly? [ultramage]
// load guild member info
// Fix reduction of MAX_GUILDPOSITION [PoW]
// 2036-12-31
//printf("- Read guild_position %d from sql \n",guild_id);
// invalid position
//printf("- Read guild_alliance %d from sql \n",guild_id);
//printf("- Read guild_expulsion %d from sql \n",guild_id);
//printf("- Read guild_skill %d from sql \n",guild_id);
//Skill IDs must always be initialized. [Skotlex]
// invalid guild skill
//Add to cache
//But set it to be removed, in case it is not needed for long.
// `guild_castle` (`castle_id`, `guild_id`, `economy`, `defense`, `triggerE`, `triggerD`, `nextTime`, `payTime`, `createTime`, `visibleC`, `visibleG0`, `visibleG1`, `visibleG2`, `visibleG3`, `visibleG4`, `visibleG5`, `visibleG6`, `visibleG7`)
// Read guild_castle from SQL
// Read exp_guild.txt
//Get guild_id from the database
//No guild...
//Member has logged in before saving, tell saver not to delete
//Set member online
//Get guild_id from the database
//No guild...
//Character has a guild, set character offline and check if they were the only member online
//Guild not found?
//Set member offline
// Remove guild from memory if no players online
// Initialize guild sql
//Initialize the guild cache
//Read exp file
/**
// Get guild_id by its name. Returns 0 if not found, -1 on error.
//Lookup guilds with the same name
// Check if guild is empty
// not empty
//Let the calling function handle the guild removal in case they need
//to do something else with it before freeing the data. [Skotlex]
// Save guild current values
// Consume guild exp and increase guild level
// nextexp would be 0 if g->guild_lv was >= MAX_GUILDLEVEL
// Save next exp step
// Set the max number of members, Guild Extension skill - currently adds 6 to max per skill lv.
// Compute the guild average level level
// Check if guild stats has change
// Check Authorized letters/symbols in the name of the character
// only letters/symbols in char_name_letters are authorized
// letters/symbols in char_name_letters are forbidden
// Set default positions
// Initialize guild property
//Request to create guild.
// Create the guild
//Failed to Create guild....
//Add to cache
// Add member to guild
// 1: Failed to add
// Find an empty slot
// 0: success
//Send members if it was not invoked.
// 1: Failed to add
// Delete member from guild
// Unknown guild, just update the player
// mapif->guild_withdraw(guild_id,account_id,char_id,flag,g->member[i].name,mes);
// Find the member
//TODO
// Write expulsion reason
// Find an empty slot
// Expulsion list is full, flush the oldest one
// Save the expulsion entry
//Update member info.
// Change member info
// Could speed up by manipulating only guild_member
// this check should always succeed...
//Update guild member data
// BreakGuild
// Delete guild from sql
//printf("- Delete guild %d from guild\n",guild_id);
//printf("- Update guild %d of char\n",guild_id);
//Remove the guild from memory. [Skotlex]
/**
// Modification of the guild
// Could make some improvement in speed, because only change guild_member
// Search the member
// Not Found
// Compute gained exp
// Update guild exp
//Save new data.
//Save new data.
//Save new data.
//Save new data.
//Save new data.
// Change a position desc
// Could make some improvement in speed, because only change guild_position
// Change guild_position
// Guild Skill UP
// Change guild & guild_skill
//Manual deletion of an alliance when partnering guild does not exists. [Skotlex]
// Alliance modification
// Could speed up
//Requested to remove an alliance with a not found guild.
//Try to do a manual removal of said guild.
// Remove alliance/opposition, in case of alliance, remove on both side
// Add alliance, in case of alliance, add on both side
// Search an empty slot
// Set alliance type
// Send on all map the new alliance/opposition
// Mark the two guild to be saved
// Change guild message
//Change mes of guild
//Change guild
// Find member (name)
//Character not found??
// Switch current and old GM
// Switch positions
//Position 0: guild Master.
//Save main data and member data.
// Communication from the map server
// - Can analyzed only one by one packet
// Data packet length that you set to inter.c
//- Shouldn't do checking and packet length, RFIFOSKIP is done by the caller
// Must Return
//  1 : ok
//  0 : error
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\int_homun.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/**
/**
// Load an homunculus
//No homunculus found.
// Load Homunculus Skill
// id
// invalid skill id
// lv
// Check Authorized letters/symbols in the name of the homun
// only letters/symbols in char_name_letters are authorized
// letters/symbols in char_name_letters are forbidden
/*==========================================
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\int_mail.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// I keep the `status` < 3 just in case someone forget to apply the sqlfix
/* Card Slots */
/* Item Options */
/// Stores a single message in the database.
/// Returns the message's ID if successful (or 0 if it fails).
// build message save query
// prepare and execute query
/// Retrieves a single message from the database.
/// Returns true if the operation succeeds (or false if it fails).
// Initialize data
/* Card Slots */
/* Item Options */
/*==========================================
/*==========================================
// No Attachment
// swap sender and receiver
// set reply message title
// Try to find the Dest Char by Name
// Cannot send mail to char in the same account
/*==========================================
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\int_mercenary.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/**
/**
/*==========================================
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\int_party.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
//Updates party's level range and unsets even share if broken.
/**
//Calculates the state of a party.
//Check party size
// FIXME[Haru]: What if the occupied positions aren't the first three? It can happen if some party members leave. This is the reason why family sharing some times stops working until you recreate your party
//Child should be able to share with either of their parents  [RoM]
//first slot is the child?
//Check Family State.
//max/min levels.
/* In families, the kid is not counted towards exp share rules. */
//Set off even share.
// Save party to mysql
// 'party' ('party_id','name','exp','item','leader_id','leader_char')
// escaped party name
// Break the party
// we'll skip name-checking and just reset everyone with the same party id [celest]
//Remove from memory
// Create party
// Update party info.
// Update leader
// Add one party member.
// Remove one party member.
// Read party from mysql
//Load from memory
// Load members
//Add party to memory.
//init state
//memory alloc
// Enable if you want to do a party_db cleanup (remove parties with no members) on startup.[Skotlex]
// 0
// Search for the party according to its name
// Returns whether this party can keep having exp share or not.
// Is there any member in the party?
// If there is no member, then break the party
// Create Party
// Check Authorized letters/symbols in the name of the character
// only letters/symbols in char_name_letters are authorized
/* client-special-char */
// letters/symbols in char_name_letters are forbidden
//New party.
//Add party to db
// Add a player to party request
// Party full
// Check family state. And also accept either of their Parents. [RoM]
//Check even share range.
//Family state broken.
//Party setting change request
//Filter out invalid values.
//Request leave party
// Party does not exists?
//Member not found?
//Family state broken.
// When member goes to other map or levels up.
// Even share check situations: Family state (always breaks)
// character logging on/off is max/min level (update level range)
// or character logging on/off has a different level (update level range using new level)
//Send online/offline update.
//There is no need to send level update to map servers
//since they do nothing with it.
//Request party dissolution
// Communication from the map server
//-Analysis that only one packet
// Data packet length is set to inter.c that you
// Do NOT go and check the packet length, RFIFOSKIP is done by the caller
// Return :
//  0 : error
//  1 : ok
// Get party_id from the database
//Eh? No party?
//No party...
//Set member online
// Get guild_id from the database
//Eh? No party?
//No party...
//Character has a party, set character offline and check if they were the only member online
//Set member offline
//Parties don't have any data that needs be saved at this point... so just remove it from memory.
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\int_pet.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/**
//`pet` (`pet_id`, `class`,`name`,`account_id`,`char_id`,`level`,`egg_id`,`equip`,`intimate`,`hungry`,`rename_flag`,`incubate`)
// escaped pet name
// New pet.
// Update pet.
//`pet` (`pet_id`, `class`,`name`,`account_id`,`char_id`,`level`,`egg_id`,`equip`,`intimate`,`hungry`,`rename_flag`,`incubate`, `autofeed`)
//----------------------------------------------
//memory alloc
//----------------------------------
//------------------------------------------------------
//Signal NEW pet.
//Failed...
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\int_quest.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/**
// Stop on the first error
// Sanity check, should never happen
// Should never happen. Compact array
/**
/**
/**
// Update existing quests
// Only states and counts are changeable.
// Compact array
// Add new quests
// Quests not in new_qd but in old_qd are to be erased.
/**
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\int_rodex.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// Loads new mails of this char_id/account_id
// Read mails
// NPC Message Type isn't supported in old clients
// Checks if user has non-read mails
// is_read is required in this line because of the OR in next condition
/// Checks player name and retrieves some data
// Try to find the Dest Char by Name
/// Stores a single message in the database.
/// Returns the message's ID if successful (or 0 if it fails).
// Should we use statement here? [KIRIEZ]
/*==========================================
// Read
// Get Zeny
// Get Items
// Delete Mail
// Sender Read
/*==========================================
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\int_storage.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// GP_BOUND_ITEMS
// StringBuf
/// Save storage data to sql
/**
// Does not exist, so set for deletion.
/**
/**
// Item is not a new entry, so lets continue.
// Store the remaining items.
/// Load storage data to mem
// storage {`account_id`/`id`/`nameid`/`amount`/`equip`/`identify`/`refine`/`attribute`/`card0`/`card1`/`card2`/`card3`}
/* Card Slots */
/* Item Options */
/// Save guild_storage data to sql
// guild doesn't exist
/// Load guild_storage data to mem
//clean up memory
// storage {`guild_id`/`id`/`nameid`/`amount`/`equip`/`identify`/`refine`/`attribute`/`card0`/`card1`/`card2`/`card3`}
/* Card Slots */
/* Item Options */
//---------------------------------------------------------
// storage data initialize
// storage data finalize
// q?f[^?
//------------------------------------------------
//Guild bound items pull for offline characters [Akinari]
//Revised by [Mhalicot]
//------------------------------------------------
/* Card Slots */
/* Item Options */
//No items found - No need to continue
//First we delete the character's items
// Only the items that are also stored in `char` `equip`
// Removes any view id that was set by an item that was removed
/* Verifies equip bitmasks (see item.equip) and handles the sql statement */ \
// Equips can be at more than one slot at the same time
//Now let's update the guild storage with those deleted items
/// TODO/FIXME:
/// This approach is basically the same as the one from chr->memitemdata_to_sql, but
/// the latter compares current database values and this is not needed in this case
/// maybe sometime separate chr->memitemdata_to_sql into different methods in order to use
/// call that function here as well [Panikon]
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\loginif.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/// Resets all the data.
// TODO kick everyone out and reset everything or wait for connect and try to reacquire locks [FlavioJS]
/// Checks the conditions for the server to stop.
/// Releases the cookie when all characters are saved.
/// If all the conditions are met, it stops the core loop.
/// Called when the connection to Login Server is disconnected.
/// Called when all the connection steps are completed.
//Send online accounts to login server.
// if no map-server already connected, display a message...
// establish char-login connection if not present
// send a list of all online account IDs to login server
//Sync online accounts every hour
// new account status
// ask login-server to authenticate an account
//only display (New) if they want to [Kevin]
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\mapif.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// GP_BOUND_ITEMS
// send to all map-servers to disconnect the player
// 0: change of status, 1: ban
// status or final date of a banishment
/// Initializes a server structure.
//memset(&chr->server[id], 0, sizeof(server[id]));
/// Destroys a server structure.
/// Resets all the data related to a server.
//Notify other map servers that this one is gone. [Skotlex]
//Tag relevant chars as 'in disconnected' server.
/// Called when the connection to a Map Server is disconnected.
// send number of players to all map-servers
// Counting Pages of Total Results (5 Results per Page)
// First Result of This Page
// This is not the requested Page
// Found Results
// Bid Number is Incorrect
// You cannot end the auction
// An auction with at least one bidder cannot be canceled
// The auction has been canceled
// Bid Number is Incorrect
// You cannot end the auction
// You cannot end the auction
// Send Money to Seller
// Send Item to Buyer
// You have won the auction
// You have ended the auction
// To Return Zeny
// You have failed to bid in the auction
// You cannot place more than 5 bids at a time
// Send Money back to the previous Buyer
// You have failed to win the auction
// Automatic won the auction
// You have successfully bid in the auction
// You have won the auction
// You have successfully bid in the auction
// Guild not found
// Send guild info
// ACK member add
// ACK member leave
// Send short member's info
// Send guild broken
// Send basic info
// Send member info
// ACK guild skill up
// ACK guild alliance
// Send a guild position desc
// Send the guild notice
// Send emblem data
// Guild creation request
// Report to client
// Return guild info to client
//We use this because on start-up the info of castle-owned guilds is required. [Skotlex]
// Failed to load info
// Add member to guild
// Delete member from guild
// Change member info
// BreakGuild
/**
// Information is already sent in mapif->guild_info
//mapif->guild_basicinfochanged(guild_id,type,data,len);
// Modification of the guild
// Change a position desc
// Guild Skill UP
// Alliance modification
// Change guild message
//Flag 1 = success
// success
// not found.
// 1:success, 0:failure
//FIXME: dumping the whole structure like this is unsafe [ultramage]
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
// notify sender
// notify recipient
// Create a party whether or not
//Party information not found
//Digest party information
//Whether or not additional party members
// Party setting change notification
//Withdrawal notification party
//Party map update notification
//Dissolution party notification
//printf("int_party: broken %d\n",party_id);
// Create Party
// Party information request
// Add a player to party request
//Party setting change request
//Request leave party
// When member goes to other map or levels up.
//Request party dissolution
//here process pet save request.
/**
// Send ack
/**
/* RoDEX */
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*------------------------------------------
// guild exists
//1 open storage, 0 don't open
// guild does not exist
/**
/**
/**
/**
/* the value is not being used, drop? */
//Finally reload storage and tell map we're done
// If character is logged in char, disconnect
// GP_BOUND_ITEMS
/* tell map server the operation is over and it can unlock the storage */
// Account registry transfer to map-server
//NOTE: writing to RFIFO
// 0
// Send the requested account_reg
//Request to kick char from a certain map server. [Skotlex]
// Save account_reg into sql (type=2)
/* int */
/* str */
// Request the value of all registries.
//Load Char Registry
// 3: char reg
//Load Account Registry
// 2: account reg
//Ask Login Server for Account2 values.
// Check Authorized letters/symbols in the name
// only letters/symbols in char_name_letters are authorized
// letters/symbols in char_name_letters are forbidden
//TODO: type holds the type of object to rename.
//If it were a player, it needs to have the guild information and db information
//updated here, because changing it on the map won't make it be saved [Skotlex]
//name allowed.
// Clan System
// Achievement System
/**
/* Read received information from map-server. */
/* Load and send achievements to map */
/**
/* Ensure data exists */
/* Load storage for char-server. */
/* Send Achievements to map server. */
/**
/* Send to the map server. */
/**
/**
/* Get loaded achievements. */
/* Save current achievements. */
/* RoDEX */
/* Clan System */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\char\pincode.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// Ask player to change pincode to be able to connect
// User hasn't changed his PIN code for a long time
// Ask user for his PIN code
// No PIN code has been set yet
/**
/**
/**
// 0 = pin is correct
// 1 = ask for pin - client sends 0x8b8
// 2 = create new pin - client sends 0x8ba
// 3 = pin must be changed - client 0x8be
// 4 = create new pin ?? - client sends 0x8ba
// 5 = client shows msgstr(1896)
// 6 = client shows msgstr(1897) Unable to use your KSSN number
// 7 = char select window shows a button - client sends 0x8c5
// 8 = pincode was incorrect
// 0 = pin is correct
// 1 = ask for pin - client sends 0x8b8
// 2 = create new pin - client sends 0x8ba
// 3 = pin must be changed - client 0x8be
// 4 = create new pin ?? - client sends 0x8ba
// 5 = client shows msgstr(1896)
// 6 = client shows msgstr(1897) Unable to use your KSSN number
// 7 = char select window shows a button - client sends 0x8c5
// 8 = pincode was incorrect
// [4144] pincode_loginstate2 can replace pincode_loginstate,
// but kro using pincode_loginstate2 only for send wrong pin error or locked after 3 pins wrong
/**
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\conf.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// nullpo_retv
// ShowError
// safestrncpy
// exists
/* interface source */
/**
/**
/**
//
// Functions to copy settings from libconfig/contrib
//
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* those are custom and are from src/common/conf.c */
/* Functions to get different types */
/* Functions to lookup different types */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\console.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// CONSOLE_INPUT, MAX_CONSOLE_INPUT
// Console close event handling
/* _kbhit() */
/*======================================
//herc.ws/board/                           "CL_CLL""CL_NORMAL"\n");
/**
// ! WIN32
// WIN32
/*======================================
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
// Ignore empty commands
/* we leave room for the \0 :P */
/* clear, we skip the new line */
/* new line~! we leave it for the next cycle */
/* loopx */
/* did we get something? */
/* drop */
/* wait for thread to close */
/* start listening in 1s; re-try every 0.5s */
/* CONSOLE_INPUT */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\core.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// Console close event handling
/*
//www.tldp.org/HOWTO/Security-HOWTO/local-security.html
//www.gentoo.org/doc/en/security/security-handbook.xml?style=printable&part=1&chap=1#doc_chap4
//wiki.centos.org/TipsAndTricks/BecomingRoot
//fedoraproject.org/wiki/Configuring_Sudo
//help.ubuntu.com/community/RootSudo
//www.freebsdwiki.net/index.php/Root
//#define I_AM_AWARE_OF_THE_RISK_AND_STILL_WANT_TO_RUN_HERCULES_AS_ROOT
// And don't complain to us if the XYZ plugin you installed wiped your hard disk, or worse.
// Note: This feature is deprecated, and should not be used.
// Added by Gabuzomeu
//
// This is an implementation of signal() using sigaction() for portability.
// (sigaction() is POSIX; signal() is not.)  Taken from Stevens' _Advanced
// Programming in the UNIX Environment_.
//
// windows don't have SIGPIPE
/* SunOS */
/*======================================
// auto-shutdown
/*======================================
// auto-shutdown
// Pass the signal to the system's default handler
// ignore and allow it to set errno to EFBIG
//run_flag = 0; // should we quit?
//ShowInfo ("Broken pipe found... closing socket\n"); // set to eof in socket.c
// does nothing here
// need unhandled exceptions to debug on Windows
/**
// BUILDBOT
// Don't allow noninteractive execution regardless.
// BUILDBOT
// BUILDBOT
// not I_AM_AWARE_OF_THE_RISK_AND_STILL_WANT_TO_RUN_HERCULES_AS_ROOT
//#define I_AM_AWARE_OF_THE_RISK_AND_STILL_WANT_TO_RUN_HERCULES_AS_ROOT\"\n", __FILE__);
// I_AM_AWARE_OF_THE_RISK_AND_STILL_WANT_TO_RUN_HERCULES_AS_ROOT
// not _WIN32
// Note: grfio is lazily loaded. grfio->init() and grfio->final() are not automatically called.
/**
/**
/**
/**
//herc.ws/\n");
//irc.rizon.net/#Hercules\n");
/**
/**
// All arguments must begin with '-'
// silence information and status messages
// Already incremented above
/**
/*======================================
// initialize program arguments
// needed for Show* in display_title() [FlavioJS]
// Initialization messages (after buying us some time to suppress them if needed)
/* timer first */
// Main runtime cycle
//sysinfo->final(); Called by iMalloc->final()
// Should be after iMalloc->final()
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\db.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/*****************************************************************************\
//www.cs.mcgill.ca/~cs251/OldCourses/1997/topic18/}
/*****************************************************************************
/**
//#define DB_ENABLE_STATS
/**
/**
/**
// Tree structure
// Node data
// Other
/**
/**
// Database interface
// File and line of allocation
// Lock system
// Other
/**
// Iterator interface
/**
// Node alloc/free
// Database creating/destruction counters
// Function usage counters
/* !defined(DB_ENABLE_STATS) */
/* !defined(DB_ENABLE_STATS) */
/* [Ind/Hercules] */
/*****************************************************************************\
/**
// put the left of y at the right of node
// link y and node's parent
// node was root
// node was at the left
// node was at the right
// put node at the left of y
/**
// put the right of y at the left of node
// link y and node's parent
// node was root
// node was at the right
// node was at the left
// put node at the right of y
/**
// Restore the RED-BLACK properties
// If node's parent is a left, y is node's right 'uncle'
// case 1
// change the colors and move up the tree
// case 2
// move up and rotate
// case 3
// If node's parent is a right, y is node's left 'uncle'
// case 1
// change the colors and move up the tree
// case 2
// move up and rotate
// case 3
// the root can and should always be black
/**
// Select where to change the tree
// no left
// no right
// both exist, go to the leftmost node of the right sub-tree
// Remove the node from the tree
// both child existed
// put the left of 'node' in the left of 'y'
// 'y' is not the direct child of 'node'
// put 'x' in the old position of 'y'
// put the right of 'node' in 'y'
// 'y' is a direct child of 'node'
// link 'y' and the parent of 'node'
// 'node' was the root
// 'node' was at the left
// 'node' was at the right
// switch colors
// one child did not exist
// put x in node's position
// link x and node's parent
// node was the root
// node was at the left
// node was at the right
// Restore the RED-BLACK properties
/**
// Not a pointer
/**
/**
/**
// Make sure we have a key until the node is freed
// No more space, expand free_list
// = db->free_max*4 +3
/**
// copy the last item to where the removed one was
/**
/**
// Not last lock
/*****************************************************************************\
/**
//not used
/**
//not used
/**
/**
/**
//not used
/**
//not used
/**
//not used
/**
//not used
/**
/**
/**
//not used
/**
//not used
/**
//not used
/**
//not used
// FIXME: Ensure this is the right db type.
/**
//not used
/**
// FIXME: Ensure this is the right db type.
/*****************************************************************************\
/**
// position before the first entry
// get next entry
/**
// position after the last entry
// get previous entry
/**
// get first node
// Iterate in the order: left tree, current node, right tree
// prepare initial node of this hash
// next hash
// next node
// continue in the right subtree
// get leftmost node
// continue to the next parent (recursive)
// next hash
// found next entry
// not found
/**
// get last node
// Iterate in the order: right tree, current node, left tree
// prepare initial node of this hash
// next hash
// next node
// continue in the left subtree
// get rightmost node
// continue to the next parent (recursive)
// next hash
// found previous entry
// not found
/**
/**
/**
// unlock the database
// free iterator
/**
/* Interface of the iterator **/
/* Initial state (before the first entry) */
/* Lock the database */
/**
// nullpo candidate
// nullpo candidate
// cache hit
/**
// nullpo candidate
// nullpo candidate
// cache hit
/**
// nullpo candidate
// nullpo candidate
// Match in the order: current node, left tree, right tree
/**
// nullpo candidate
/**
// nullpo candidate
// nullpo candidate
// nullpo candidate
// cache hit
// Create node if necessary
// hash entry is empty
// put at the left
// put at the right
// two consecutive RED nodes, must rebalance
// put key and data in the node
/**
// nullpo candidate
/**
// nullpo candidate
// nullpo candidate
// nullpo candidate
// nullpo candidate
// search for an equal node
// equal entry, replace
// allocate a new node if necessary
// hash entry is empty
// put at the left
// put at the right
// two consecutive RED nodes, must rebalance
// put key and data in the node
/**
// nullpo candidate
// nullpo candidate
// nullpo candidate
/**
// nullpo candidate
// nullpo candidate
// Apply func in the order: current node, left node, right node
/**
// nullpo candidate
/**
// nullpo candidate
// Apply the func and delete in the order: left tree, right tree, current node
/**
// nullpo candidate
/**
// nullpo candidate
/* DB_ENABLE_STATS */
/**
// nullpo candidate
/**
// nullpo candidate
/**
// nullpo candidate - TODO what should this return?
/**
// nullpo candidate - TODO what should this return?
/*****************************************************************************\
/**
// Numeric database, do nothing with the keys
// String databases, no fix required
/**
/**
/**
// Release data, what about the key?
// Release both key and data
// Only release data
// Only release key
// Release nothing
/**
/**
/* DB_ENABLE_STATS */
/* Interface of the database */
/* File and line of allocation */
/* Lock system */
/* Other */
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/* DB_ENABLE_STATS */
// Link DB System - jAthena
// first node
// link nodes
//Moving the head in order to improve processing efficiency
//Moving the head in order to improve processing efficiency
//Insert because it can not find
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\des.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/** @file
/// Bitmask for accessing individual bits of a byte.
/**
/**
/**
// original
// optimized
// ..0 vutsr
// ..srqpo n
// ..o nmlkj
// ..kjihg f
// ..g fedcb
// ..cba98 7
// ..8 76543
// ..43210 v
/**
/**
/**
/// @copydoc des_interface::decrypt_block()
/// @copydoc des_interface::decrypt()
/**
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\ers.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/*****************************************************************************\
// CREATE, RECREATE, aMalloc, aFree
// ShowMessage, ShowError, ShowFatalError, CL_BOLD, CL_NORMAL
// Allocated object size, including ers_list size
// Number of ers_instances referencing this
// Reuse linked list
// Memory blocks array
// Max number of blocks
// Free objects count
// Used blocks count
// Objects in-use count
// Default = ERS_BLOCK_ENTRIES, can be adjusted for performance for individual cache sizes.
// Misc options, some options are shared from the instance
// Linked list
// Interface to ERS
// Name, used for debugging purposes
// Misc options
// Our cache
// Count of objects in use, used for detecting memory leaks
/* for data analysis [Ind/Hercules] */
// Array containing a pointer for all ers_cache structures
/**
// If it's aligned to 1-byte boundaries, no need to bother.
/**
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\grfio.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/** @file
/// File entry table struct.
///< compressed size
///< original size
///< position of entry in grf
///< index of next filelist entry with same hash (-1: end of entry chain)
///< file name
///< if the file was cloned, contains name of original file
///< read grf file select
///< entry is a file
///< encryption mode 0 (header DES + periodic DES/shuffle)
///< encryption mode 1 (header DES only)
//gentry ... > 0  : data read from a grf file (gentry_table[gentry-1])
//gentry ... 0    : data read from a local file (data directory)
//gentry ... < 0  : entry "-(gentry)" is marked for a local file check
//                  - if local file exists, gentry will be set to 0 (thus using the local file)
//                  - if local file doesn't exist, sign is inverted (thus using the original file inside a grf)
//                  (NOTE: this case is only used once (during startup) and only if GRFIO_LOCAL is enabled)
//                  (NOTE: probably meant to be used to override grf contents by files in the data directory)
//#define GRFIO_LOCAL
// stores info about every loaded file
// stores grf file names
// the path to the data directory
// little endian char array to uint conversion
/**
/* this is not used anywhere, is it ok to delete?  */
// 0
/**
// first 20 blocks are all des-encrypted
// the rest is plaintext, done.
/**
// first 20 blocks are all des-encrypted
// after that only one of every 'dcycle' blocks is des-encrypted
// and one of every 'scycle' plaintext blocks is shuffled (starting from the 0th but skipping the 0th)
// so decrypt/de-shuffle periodically
// 0, adjusted to fit the ++j step
// decrypt block
// de-shuffle block
// plaintext, do nothing.
/**
// fully encrypted
// compute number of digits of the entry length
// choose size of gap between two encrypted blocks
// digits:  0  1  2  3  4  5  6  7  8  9 ...
//  cycle:  1  1  1  4  5 14 15 22 23 24 ...
// header encrypted
/* else plaintext */
/* Zlib Subroutines */
/// @copydoc grfio_interface::crc32()
/// @copydoc grfio_interface::decode_zip
/// @copydoc grfio_interface::encode_zip
/* [Ind/Hercules] */
/* [Ind/Hercules] */
/* File List Subroutines */
/// File list hash table
/**
/**
/**
/// @copydoc grfio_interface::find_file()
/**
// Make clang's static analyzer shut up about a possible NULL pointer in &filelist[filelist_entrys]
// __clang_analyzer__
// number increment of file lists `
/**
/// Shrinks the file list array if too long.
/* GRF I/O Subroutines */
/**
// normalize path
/// @copydoc grfio_interface::reads()
// LocalFileCheck
// +1 for resnametable zero-termination
// local file checked
// Archive[GRF] File Read
// +1 for resnametable zero-termination
// file
// directory?
/**
/**
/**
// 1:not found error
// 2:file format error
// 2:file format error
// ****** Grf version 01xx ******
// 2:file format error
// Get an entry
// 5: file name too long
// As Flag for making it a negative number carrying out the first time LocalFileCheck
// With no first time LocalFileCheck
// ****** Grf version 02xx ******
// Read Size
// Extend Size
// Get a Read Size
// Get a Extend Size
// Decode function
// Get an entry
// 5: file name too long
// file
// As Flag for making it a negative number carrying out the first time LocalFileCheck
// With no first time LocalFileCheck
// ****** Grf Other version ******
// Unnecessary area release of filelist
// 0:no error
/**
// we only need the maps' GAT and RSW files
// alias for GRF resource
// alias for local resource
/**
// read resnametable from data directory and return if successful
// we're done here!
// read resnametable from loaded GRF's, only if it cannot be loaded from the data directory
/**
// The number increment of gentry_table entries
/// @copydoc grfio_interface::final()
/// @copydoc grfio_interface::init()
// hash table initialization
// skip comments
// skip unrecognized lines
// Entry table reading
// GRF file
// Data directory
// Unnecessary area release of filelist
// Resource check
/// Interface base initialization.
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\HPM.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// CONSOLE_INPUT
/**
/**
/**
/**
/**
/**
/**
/* core-handled */
/**
/* woo it failed! */
/* duplicate check */
/* hplugin_data_entry is always same size, probably better to use the ERS (with reasonable chunk size e.g. 10/25/50) */
/* input */
/**
/* woo it failed! */
/**
/* woo it failed! */
// Erase and compact
// when it's removed we delete it regardless of autofree
/* TODO: add ability for tracking using pID for the upcoming runtime load/unload support. */
/* search if target is a known hook point within 'common' */
/* if not check if a sub-hooking list is available (from the server) and run it by */
/* track? */
/**
/**
// TODO: Remove the HPM->DataCheck != NULL check once login and char support is complete
/* id */
/* core */
// CONSOLE_INPUT
/* server specific */
/**
/* TODO: for manual packet unload */
/* - Go through known packets and unlink any belonging to the plugin being removed */
/**
/**
// FIXME hardcoded name
/* yes its ugly, its temporary and will be gone as soon as the new inter-server.conf is set */
//must load it first
// The purpose of this is type-checking 'func' at compile time.
// Already loaded, skip
/**
/**
/**
/**
/* we handle this memory outside of the server's memory manager because we need it to exist after the memory manager goes down */
/**
/**
/**
// FIXME: Remove this when support to int's as value is added
// FIXME: Remove this when support to int's as value is added
// Unsupported type
/**
// Unsupported type
// FIXME: Remove this when support to int's as value is added
/**
/**
/**
/* not double lookup; exists sets cache to found data */
/**
/**
/* this memory is handled outside of the server's memory manager and
/* HPM->fnames is cleared after the memory manager goes down */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\mapindex.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/* mapindex.c interface source */
/// Retrieves the map name from 'string' (removing .gat extension if present).
/// Result gets placed either into 'buf' or in a static local buffer.
// strip .gat extension
/// Retrieves the map name from 'string' (adding .gat extension if not already present).
/// Result gets placed either into 'buf' or in a static local buffer.
// add .gat extension
/// Adds a map to the specified index
/// Returns 1 if successful, 0 otherwise
// dummy empty string so that the callee doesn't crash
/**
// mapindex_configuration/file_path
/**
// Error message is already shown by libconfig->load_file
//Server can't really run without this file.
//Map with no ID given, auto-assign
/* Fall through */
//Map with ID given
/* TODO: place it in inter-server.conf? */
/* */
/* */
/* */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\md5calc.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/** @file
/// Global variable
/// String Table
//0
//4
//8
//12
//16
//20
//24
//28
//32
//36
//40
//44
//48
//52
//56
//60
/// The left is made to rotate x [ n-bit ]. This is diverted as it is from RFC.
// The function used for other calculation
//create X It is since it is required.
//512bit 64byte
//Save A as AA, B as BB, C as CC, and and D as DD (saving of A, B, C, and D)
//It is a large region variable reluctantly because of calculation of a round. . . for Round1...4
//Copy block(padding_message) i into X
// 8byte*4 -> 32byte conversion
// A function called Decode as used in the field of RFC
//Round 1
//Round 2
//Round 3
//Round 4
// Then perform the following additions. (let's add)
//The clearance of confidential information
/// @copydoc md5_interface::binary()
//var
/*8bit*/
//Extended message   512bit 64byte
// The position of string in the present scanning notes is held.
/*32bit*/
//The bit length of string is held.
//The number of bytes which is used by 1-3 and which remained
//Message digest   128bit 4byte
//The message digest in accordance with RFC (reference)
//prog
//Step 3.Initialize MD Buffer (although it is the initialization; step 3 of A, B, C, and D -- unavoidable -- a head)
//Step 1.Append Padding Bits (extension of a mark bit)
//1-1
// The position of the present character sequence is set.
//1-2  Repeat calculation until length becomes less than 64 bytes.
//1-3
//The number of bytes which remained is computed.
// A message is copied to an extended bit sequence.
//It buries by 0 until it becomes extended bit length.
//The next of a message is 1.
//1-4
//If 56 bytes or more (less than 64 bytes) of remainder becomes, it will calculate by extending to 64 bytes.
//56 bytes is newly fill uped with 0.
//Step 2.Append Length (the information on length is added)
//From the byte chief to bit length (32 bytes of low rank)
//32 bytes of low rank is set.
//When bit length cannot be expressed in 32 bytes of low rank, it is a beam raising to a higher rank.
//In this case, it is good for a higher rank at 0.
//Step 4.Process Message in 16-Word Blocks (calculation of MD5)
//Step 5.Output (output)
/// @copydoc md5_interface::string()
/// @copydoc md5_interface::salt();
/**
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\memmgr.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
////////////// Memory Libraries //////////////////
// ShowMessage("%s:%d: in func %s: aMalloc %d\n",file,line,func,size);
// ShowMessage("%s:%d: in func %s: aCalloc %d %d\n",file,line,func,num,size);
// ShowMessage("%s:%d: in func %s: aRealloc %p %d\n",file,line,func,p,size);
// ShowMessage("%s:%d: in func %s: aReallocz %p %ld\n",file,line,func,p,size);
// ShowMessage("%s:%d: in func %s: aStrdup %p\n",file,line,func,p);
/**
// ShowMessage("%s:%d: in func %s: aFree %p\n",file,line,func,p);
//p = NULL;
// USE_MEMMGR
/* USE_MEMMGR */
/*
/* Alignment of the block */
/* Amount of data entering a block */
/* The size of the block: 16*128 + 64*576 = 40KB */
/* The number of blocks to be allocated at a time. */
/* block */
///< Then the allocated area
///< The previous area not filled
///< The next area not filled
///< The size of the unit
///< The hash of the unit
///< The number of units
///< The number of used units
///< The number of unused units
///< The maximum value of units used
/* Data for areas that do not use the memory be turned */
// If it exceeds the block length hash I do not
/* To ensure the area that exceeds the length of the block, using malloc () to */
/* At that time, the distinction by assigning NULL to unit_head.block */
/* When a block of the same size is not ensured, to ensure a new */
// there are no more free space that
// Since I ran out of the unit, removed from the list unfill
// Size reduction - return> as it is (negligence)
// Size Large
/* a mrealloc_ clone with the difference it 'z'eroes the newly created memory */
// Size reduction - return> as it is (negligence)
// Size Large
/**
/* area that is directly secured by malloc () */
// set freed memory to 0xfd
/* Release unit */
/* Release of the block */
// add to unfill list
/* Allocating blocks */
/* Space for the block has already been secured */
/* Newly allocated space for the block */
/* First ensure */
/* Linking the block */
// I do not add the link p [0], so we will use
// Add to unfill
/* LOG_MEMMGR */
/// Returns true if the memory location is active.
/// Active means it is allocated and points to a usable part.
///
/// @param ptr Pointer to the memory
/// @return true if the memory is active
// never valid
// search small blocks
// found memory block
// memory block is being used and ptr points to a sub-unit
// memory unit is allocated, check if ptr points to the usable part
// search large blocks
// found memory block, check if ptr points to the usable part
/* LOG_MEMMGR */
// Cache VCS info before we free() it
/* LOG_MEMMGR */
// get block pointer and free it [celest]
/* LOG_MEMMGR */
/* LOG_MEMMGR */
/* [Ind/Hercules] */
/**
/* LOG_MEMMGR */
/**
/* LOG_MEMMGR */
/* USE_MEMMGR */
/*======================================
/// Tests the memory for errors and memory leaks.
/// Returns true if a pointer is valid.
/// The check is best-effort, false positives are possible.
/**
// http://dmalloc.com/docs/latest/online/dmalloc_19.html
// don't garbage collect, only report inaccessible memory that was not deallocated
// Athena's built-in Memory Manager
/* not using memory manager huhum o.o perhaps we could still do something about */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\mutex.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// for WIN32
/** @file
/* Mutex */
/// @copydoc mutex_interface::create()
/// @copydoc mutex_interface::destroy()
/// @copydoc mutex_interface::lock()
/// @copydoc mutex_interface::trylock()
/// @copydoc mutex_interface::unlock()
/* Conditional variable */
/// @copydoc mutex_interface::cond_create()
/// @copydoc mutex_interface::cond_destroy()
/// @copydoc mutex_interface::cond_wait()
// we can release the mutex (m) here, cause win's
// manual reset events maintain state when used with
// SetEvent()
// Broadcast called!
// we are the last waiter that has to be notified, or to stop waiting
// so we have to do a manual reset
/// @copydoc mutex_interface::cond_signal()
// 0
/// @copydoc mutex_interface::cond_broadcast()
// 0
/**
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\nullpo.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// HAVE_EXECINFO
/**
// HAVE_EXECINFO
// HAVE_EXECINFO
/**
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\packets.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// CONSOLE_INPUT, MAX_CONSOLE_INPUT
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\random.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// for WIN32
// gettick
// init_genrand, genrand_int32, genrand_res53
/** @file
/// @copydoc rnd_interface::init()
// HAVE_GETPID
// HAVE_GETTID
// Also initialize the stdlib rng, just in case it's used somewhere.
/// @copydoc rnd_interface::final()
/// @copydoc rnd_interface::seed()
/// @copydoc rnd_interface::random()
/// @copydoc rnd_interface::roll()
/// @copydoc rnd_interface::value()
/// @copydoc rnd_interface::uniform()
// divided by 2^32
/// @copydoc rnd_interface::uniform53()
/// Interface base initialization.
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\showmsg.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
//[Ind] - For SERVER_TYPE
// StringBuf
// atexit
// not WIN32
// WIN32
///////////////////////////////////////////////////////////////////////////////
/// static/dynamic buffer for the messages
// never put less that what's required for the debug message
//define NEWBUF
/* static buffer */ \
/* dynamic buffer */ \
//define BUFVPRINTF
//define FREEBUF
///////////////////////////////////////////////////////////////////////////////
// XXX adapted from eApp (comments are left untouched) [flaviojs]
///////////////////////////////////////////////////////////////////////////////
//  ANSI compatible printf with control sequence parser for windows
//  fast hack, handle with care, not everything implemented
//
// \033[#;...;#m - Set Graphics Rendition (SGR)
//
//  printf("\x1b[1;31;40m"); // Bright red on black
//  printf("\x1b[3;33;45m"); // Blinking yellow on magenta (blink not implemented)
//  printf("\x1b[1;30;47m"); // Bright black (grey) on dim white
//
//  Style           Foreground      Background
//  1st Digit       2nd Digit       3rd Digit      RGB
//  0 - Reset       30 - Black      40 - Black     000
//  1 - FG Bright   31 - Red        41 - Red       100
//  2 - Unknown     32 - Green      42 - Green     010
//  3 - Blink       33 - Yellow     43 - Yellow    110
//  4 - Underline   34 - Blue       44 - Blue      001
//  5 - BG Bright   35 - Magenta    45 - Magenta   101
//  6 - Unknown     36 - Cyan       46 - Cyan      011
//  7 - Reverse     37 - White      47 - White     111
//  8 - Concealed (invisible)
//
// \033[#A - Cursor Up (CUU)
//    Moves the cursor up by the specified number of lines without changing columns.
//    If the cursor is already on the top line, this sequence is ignored. \e[A is equivalent to \e[1A.
//
// \033[#B - Cursor Down (CUD)
//    Moves the cursor down by the specified number of lines without changing columns.
//    If the cursor is already on the bottom line, this sequence is ignored. \e[B is equivalent to \e[1B.
//
// \033[#C - Cursor Forward (CUF)
//    Moves the cursor forward by the specified number of columns without changing lines.
//    If the cursor is already in the rightmost column, this sequence is ignored. \e[C is equivalent to \e[1C.
//
// \033[#D - Cursor Backward (CUB)
//    Moves the cursor back by the specified number of columns without changing lines.
//    If the cursor is already in the leftmost column, this sequence is ignored. \e[D is equivalent to \e[1D.
//
// \033[#E - Cursor Next Line (CNL)
//    Moves the cursor down the indicated # of rows, to column 1. \e[E is equivalent to \e[1E.
//
// \033[#F - Cursor Preceding Line (CPL)
//    Moves the cursor up the indicated # of rows, to column 1. \e[F is equivalent to \e[1F.
//
// \033[#G - Cursor Horizontal Absolute (CHA)
//    Moves the cursor to indicated column in current row. \e[G is equivalent to \e[1G.
//
// \033[#;#H - Cursor Position (CUP)
//    Moves the cursor to the specified position. The first # specifies the line number,
//    the second # specifies the column. If you do not specify a position, the cursor moves to the home position:
//    the upper-left corner of the screen (line 1, column 1).
//
// \033[#;#f - Horizontal & Vertical Position
//    (same as \033[#;#H)
//
// \033[s - Save Cursor Position (SCP)
//    The current cursor position is saved.
//
// \033[u - Restore cursor position (RCP)
//    Restores the cursor position saved with the (SCP) sequence \033[s.
//    (addition, restore to 0,0 if nothing was saved before)
//
// \033[#J - Erase Display (ED)
//    Clears the screen and moves to the home position
//    \033[0J - Clears the screen from cursor to end of display. The cursor position is unchanged. (default)
//    \033[1J - Clears the screen from start to cursor. The cursor position is unchanged.
//    \033[2J - Clears the screen and moves the cursor to the home position (line 1, column 1).
//
// \033[#K - Erase Line (EL)
//    Clears the current line from the cursor position
//    \033[0K - Clears all characters from the cursor position to the end of the line (including the character at the cursor position). The cursor position is unchanged. (default)
//    \033[1K - Clears all characters from start of line to the cursor position. (including the character at the cursor position). The cursor position is unchanged.
//    \033[2K - Clears all characters of the whole line. The cursor position is unchanged.
/*
///////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////
/* XXX Two streams are being used. Disabled to avoid inconsistency [flaviojs]
/////////////////////////////////////////////////////////////////
// temporary buffer
// Print everything to the buffer
// start with processing
// find the escape character
// write up to the escape
// write the escape char (whatever purpose it has)
//and start searching again
// from here, we will skip the '\033['
// we break at the first unprocessible position
// assuming regular text is starting there
// initialize
// skip escape and bracket
// add number to number array, only accept 2digits, shift out the rest
// so // \033[123456789m will become \033[89m
// and next character
// delimiter
// go to next array position
// array is full, so we 'forget' the first value
// and next number
// \033[#;...;#m - Set Graphics Rendition (SGR)
// upper nibble 0
// reset
// set foreground intensity
// set background intensity
// reverse colors (just xor them)
//case '2': // not existing
//case '3': // blinking (not implemented)
//case '4': // underline (not implemented)
//case '6': // not existing
//case '8': // concealed (not implemented)
//case '9': // not existing
// off
// set foreground intensity off
// set background intensity off
// reverse colors (just xor them)
// foreground
// set white for 37, 38 and 39
// lowest bit set = red
// second bit set = green
// third bit set = blue
// background
// set white for 47, 48 and 49
// lowest bit set = red
// second bit set = green
// third bit set = blue
// set the attributes
// \033[#J - Erase Display (ED)
// \033[0J - Clears the screen from cursor to end of display. The cursor position is unchanged.
// \033[1J - Clears the screen from start to cursor. The cursor position is unchanged.
// \033[2J - Clears the screen and moves the cursor to the home position (line 1, column 1).
// chars from start up to and including cursor
// Number of chars on screen.
/* 0 and default */
// number of chars from cursor to end
// \033[K  : clear line from actual position to end of the line
// \033[0K - Clears all characters from the cursor position to the end of the line.
// \033[1K - Clears all characters from start of line to the cursor position.
// \033[2K - Clears all characters of the whole line.
//warning C4204
/* 0 and default */
// how many spaces until line is full
// \033[#;#H - Cursor Position (CUP)
// \033[#;#f - Horizontal & Vertical Position
// The first # specifies the line number, the second # specifies the column.
// The default for both is 1
// \033[s - Save Cursor Position (SCP)
/* XXX Two streams are being used. Disabled to avoid inconsistency [flaviojs]
// \033[u - Restore cursor position (RCP)
/* XXX Two streams are being used. Disabled to avoid inconsistency [flaviojs]
// \033[#A - Cursor Up (CUU)
// Moves the cursor UP # number of lines
// \033[#B - Cursor Down (CUD)
// Moves the cursor DOWN # number of lines
// \033[#C - Cursor Forward (CUF)
// Moves the cursor RIGHT # number of columns
// \033[#D - Cursor Backward (CUB)
// Moves the cursor LEFT # number of columns
// \033[#E - Cursor Next Line (CNL)
// Moves the cursor down the indicated # of rows, to column 1
// \033[#F - Cursor Preceding Line (CPL)
// Moves the cursor up the indicated # of rows, to column 1.
// \033[#G - Cursor Horizontal Absolute (CHA)
// Moves the cursor to indicated column in current row.
// not implemented, just skip
// no number nor valid sequencer
// something is fishy, we break and give the current char free
// skip the sequencer and search again
// end while
// write the rest of the buffer
// not _WIN32
//vprintf_without_ansiformats
// temporary buffer
// Print everything to the buffer
// start with processing
// find the escape character
// write up to the escape
// write the escape char (whatever purpose it has)
//and start searching again
// from here, we will skip the '\033['
// we break at the first unprocessible position
// assuming regular text is starting there
// skip escape and bracket
// and next character
// delimiter
// and next number
// \033[#;...;#m - Set Graphics Rendition (SGR)
// set the attributes
// \033[#J - Erase Display (ED)
// \033[K  : clear line from actual position to end of the line
// \033[#;#H - Cursor Position (CUP)
// \033[#;#f - Horizontal & Vertical Position
// \033[s - Save Cursor Position (SCP)
// \033[u - Restore cursor position (RCP)
// \033[#A - Cursor Up (CUU)
// Moves the cursor UP # number of lines
// \033[#B - Cursor Down (CUD)
// Moves the cursor DOWN # number of lines
// \033[#C - Cursor Forward (CUF)
// Moves the cursor RIGHT # number of columns
// \033[#D - Cursor Backward (CUB)
// Moves the cursor LEFT # number of columns
// \033[#E - Cursor Next Line (CNL)
// Moves the cursor down the indicated # of rows, to column 1
// \033[#F - Cursor Preceding Line (CPL)
// Moves the cursor up the indicated # of rows, to column 1.
// \033[#G - Cursor Horizontal Absolute (CHA)
// Moves the cursor to indicated column in current row.
// not implemented, just skip
// no number nor valid sequencer
// something is fishy, we break and give the current char free
// skip the sequencer and search again
// end while
// write the rest of the buffer
// not _WIN32
//[Ind]
//Do not print it.
//Display time format. [Skotlex]
// direct printf replacement
//Bright Green (To inform about good things)
//Bright Violet (For dumping out anything related with SQL) <- Actually, this is mostly used for SQL errors with the database, as successes can as well just be anything else... [Skotlex]
//Bright White (Variable information)
//Bright White (Less than a warning)
//Bright Yellow
//Bright Cyan, important stuff!
//Bright Red  (Regular errors)
//Bright Red (Fatal errors, abort(); if possible)
//Send Errors to StdErr [Skotlex]
// to prevent empty string passed messages
// Unused
// Unused
// direct printf replacement
// BUILDBOT
// BUILDBOT
///////////////////////////////////////////////////////////////////////////////
/// behavioral parameter.
/// when redirecting output:
/// if true prints escape sequences
/// if false removes the escape sequences
//Specifies how silent the console is.
//[Ind] msg error logging
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\socket.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// SHOW_SERVER_STATS
// SOCKET_EPOLL
// WIN32
// defined __linux__ || defined __linux
// defined __linux__ || defined __linux
// SIOCGIFCONF on Solaris, maybe others? [Shinomori]
// SIOCGIFCONF
// FIONBIO on Solaris [FlavioJS]
// FIONBIO
// HAVE_SETRLIMIT
// WIN32
/**
// Add a fd to the shortlist so that it'll be recognized as a fd that needs
// sending done on it.
// Do pending network sends (and eof handling) from the shortlist.
// SEND_SHORTLIST
/////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////
// windows portability layer
// global array of sockets (emulating linux)
// fd is the position in the array
/// Returns the socket associated with the target fd.
///
/// @param fd Target fd.
/// @return Socket
/// Returns the first fd associated with the socket.
/// Returns -1 if the socket is not found.
///
/// @param s Socket
/// @return Fd or -1
// search for the socket
// found the socket
// not found
/// Inserts the socket into the global array of sockets.
/// Returns a new fd associated with the socket.
/// If there are too many sockets it closes the socket, sets an error and
//  returns -1 instead.
/// Since fd 0 is reserved, it returns values in the range [1,FD_SETSIZE[.
///
/// @param s Socket
/// @return New fd or -1
// find an empty position
// empty position
// too many sockets
// accept connection
// error
// create socket
// error
// strerror does not handle socket codes
/////////////////////////////////////////////////////////////////////
// defined(WIN32)
/////////////////////////////////////////////////////////////////////
// nix portability layer
/////////////////////////////////////////////////////////////////////
// defined(WIN32)
/////////////////////////////////////////////////////////////////////
// MSG_NOSIGNAL
// Select based Event Dispatcher:
// SOCKET_EPOLL
// Epoll based Event Dispatcher:
// SOCKET_EPOLL
// Maximum packet size in bytes, which the client is able to handle.
// Larger packets cause a buffer overflow and stack corruption.
// PACKETVER >= 20131223
// PACKETVER >= 20131223
// Data I/O statistics
// SHOW_SERVER_STATS
// initial recv buffer size (this will also be the max. size)
// biggest known packet: S 0153 <len>.w <emblem data>.?B -> 24x24 256 color .bmp (0153 + len.w + 1618/1654/1756 bytes)
// initial send buffer size (will be resized as needed)
// Maximum size of pending data in the write fifo. (for non-server connections)
// The connection is closed if it goes over the limit.
// we only support FD_SETSIZE sockets, limit the array to that
// how many fd's are in the shortlist
// to know if specific fd's are already in the shortlist
// SEND_SHORTLIST
/*======================================
/*======================================
// FIONBIO Use with a nonzero argp parameter to enable the nonblocking mode of socket s.
// The argp parameter is zero if nonblocking is to be disabled.
/**
// not WIN32
// WIN32
// Note: We cast the fourth argument to (char *) because, while in UNIX
// it takes a const void *, in Windows it takes a const char *.
// set SO_REAUSEADDR to true, unix only. on windows this option causes
// the previous owner of the socket to give up, which is not desirable
// in most cases, neither compatible with unix.
// SO_REUSEPORT
// WIN32
// Set the socket into no-delay mode; otherwise packets get delayed for up to 200ms, likely creating server-side lag.
// The RO protocol is mainly single-packet request/response, plus the FIFO model already does packet grouping anyway.
// https://msdn.microsoft.com/en-us/library/windows/desktop/ms740476(v=vs.85).aspx
// not WIN32
// WIN32
// force the socket into no-wait, graceful-close mode (should be the default, but better make sure)
//(http://msdn.microsoft.com/library/default.asp?url=/library/en-us/winsock/winsock/closesocket_2.asp)
// SO_DONTLINGER
// Do not care
// TCP_THIN_LINEAR_TIMEOUTS
// TCP_THIN_DUPACK
/*======================================
// Add this socket to the shortlist for eof handling.
// SEND_SHORTLIST
//An exception has occurred
//ShowDebug("recv_to_fifo: %s, closing connection #%d\n", error_msg(), fd);
//Normal connection end.
// SHOW_SERVER_STATS
// nothing to send
//An exception has occurred
//ShowDebug("send_from_fifo: %s, ending connection #%d\n", error_msg(), fd);
// SHOW_SERVER_STATS
//Clear the send queue as we can't send anymore. [Skotlex]
// some data could not be transferred?
// shift unsent data to the beginning of the queue
// SHOW_SERVER_STATS
/// Best effort - there's no warranty that the data will be sent.
/*======================================
// reserved
// socket number too big
// Select Based Event Dispatcher
// SOCKET_EPOLL
// Epoll based Event Dispatcher
// SOCKET_EPOLL
// reserved
// socket number too big
// Select Based Event Dispatcher
// SOCKET_EPOLL
// Epoll based Event Dispatcher
// SOCKET_EPOLL
// just listens
// disable timeouts on this socket
// reserved
// socket number too big
//Now the socket can be made non-blocking. [Skotlex]
// Select Based Event Dispatcher
// SOCKET_EPOLL
// Epoll based Event Dispatcher
// SOCKET_EPOLL
// SHOW_SERVER_STATS
// might not happen
// grow rule; grow in multiples of WFIFO_SIZE
// shrink rule, shrink by 2 when only a quarter of the fifo is used, don't shrink below nominal size.
// no change
/// advance the RFIFO cursor (marking 'len' bytes as processed)
// SHOW_SERVER_STATS
/// advance the WFIFO cursor (marking 'len' bytes for sending)
// we have written len bytes to the buffer already before calling WFIFOSET
// actually there was a buffer overflow already
// no other chance, make a better fifo model
// dynamic packets allow up to UINT16_MAX bytes (<packet_id>.W <packet_len>.W ...)
// all known fixed-size packets are within this limit, so use the same limit
// abuses the fact, that the code that did WFIFOHEAD(fd,0), already wrote
// the packet type into memory, even if it could have overwritten vital data
// this can happen when a new packet was added on map-server, but packet len table was not updated
// see declaration of socket_max_client_packet for details
// SHOW_SERVER_STATS
//If the interserver has 200% of its normal size full, flush the data.
// always keep a WFIFO_SIZE reserve in the buffer
// For inter-server connections, let the reserve be 1/4th of the link size.
// readjust the buffer to include the chosen reserve
// SEND_SHORTLIST
// SOCKET_EPOLL
// PRESEND Timers are executed before do_sendrecv and can send packets and/or set sessions to eof.
// Send remaining data and process client-side disconnects here.
// SEND_SHORTLIST
// SEND_SHORTLIST
// Select based Event Dispatcher:
// can timeout until the next tick
// interrupted by a signal, just loop and try again
// SOCKET_EPOLL
// Epoll based Event Dispatcher
// interrupted by a signal, just loop and try again
// SOCKET_EPOLL
// on windows, enumerating all members of the fd_set is way faster if we access the internals
// epoll based selection
// Got Error on this connection
// data wainting
// defined(SOCKET_EPOLL)
// otherwise assume that the fd_set is a bit-array and enumerate it in a standard way
// defined(SOCKET_EPOLL)
// POSTSEND Send remaining data and handle eof sessions.
// SEND_SHORTLIST
//func_send can't free a session, this is safe.
//Finally, even if there is no data to parse, connections signaled eof should be closed, so we call parse_func [Skotlex]
//This should close the session immediately.
// SEND_SHORTLIST
// parse input data on each socket
/* server is special */
/* only update if necessary otherwise it'd resend the ping unnecessarily */
// after parse, check client's RFIFO size to know if there is an invalid packet (too big and not parsed)
// _WIN32
// _WIN32
// SHOW_SERVER_STATS
// IP rules and DDoS protection
/// Verifies if the IP can connect. (with debug info)
/// @see connect_check_()
/// Verifies if the IP can connect.
///  0      : Connection Rejected
///  1 or 2 : Connection Accepted
// Search the allow list
// Search the deny list
// Decide connection status
//  0 : Reject
//  1 : Accept
//  2 : Unconditional Accept (accepts even if flagged as DDoS)
// Reject
// Unconditional Accept
// Accept
// Unconditional Accept
// Reject
// Accept
// Unconditional Accept
// Reject
// Inspect connection history
//IP found
// flagged as DDoS
// connection within ddos_interval
// DDoS attack detected
// not within ddos_interval, clear data
// IP not found, add to history
/// Timer function.
/// Deletes old connection history records.
// Remove connection history
/// Parses the ip address and mask and puts it into acc.
/// Returns 1 is successful, 0 otherwise.
// not an ip + standard mask
// not an ip + bit mask
// not an ip
// invalid ip
// invalid standard mask
// invalid bit mask
// standard mask
// bit mask
// just this ip
/**
/**
/**
/**
/* a minimum is required in order to refrain from killing itself */
// minimum that seems to be useful
// SOCKET_EPOLL
// import should overwrite any previous configuration, so it should be called last
// sockt->session[0]
// SOCKET_EPOLL
/// Closes a socket.
// invalid
// Try to send what's left (although it might not succeed since it's a nonblocking socket)
// Select based Event Dispatcher
// this needs to be done before closing the socket
// SOCKET_EPOLL
// Epoll based Event Dispatcher
// removing the socket from epoll when it's being closed is not required but recommended
// SOCKET_EPOLL
// Disallow further reads/writes
// We don't really care if these closing functions return an error, we are just shutting down and not reusing this socket.
/// Retrieve local ips in host byte order.
/// Uses loopback is no address is found.
// XXX This should look up the local IP addresses in the registry
// instead of calling gethostbyname. However, the way IP addresses
// are stored in the registry is annoyingly complex, so I'll leave
// this as T.B.D. [Meruru]
// not WIN32
// The ioctl call will fail with Invalid Argument if there are more
// interfaces than will fit in the buffer
// not AIX or APPLE
//not AIX or APPLE
// not W32
// Use loopback if no ips are found
// Start up windows networking
// NOTE: getrlimit and setrlimit have bogus behavior in cygwin.
//       "Number of fds is virtually unlimited in cygwin" (sys/param.h)
// set socket limit to FD_SETSIZE
// failed, try setting the maximum too (permission to change system limits is required)
// failed
// set to maximum allowed
// report limit
// defined(HAVE_SETRLIMIT) && !defined(CYGWIN)
// Get initial local ips
// Select based Event Dispatcher:
// SOCKET_EPOLL
// Epoll based Event Dispatcher:
// 2.6.8 or newer ignores the expected socket amount argument
// SOCKET_EPOLL
// defined(SEND_SHORTLIST)
// initialize last send-receive tick
// sockt->session[0] is now currently used for disconnected sessions of the map server, and as such,
// should hold enough buffer (it is a vacuum so to speak) as it is never flushed. [Skotlex]
// Delete old connection history every 5 minutes
// Resolves hostname into a numeric ip.
/**
// Converts a dot-formatted ip string into a numeric ip.
// Reorders bytes from network to little endian (Windows).
// Necessary for sending port numbers to the RO client until Gravity notices that they forgot ntohs() calls.
/* [Ind/Hercules] - socket_datasync */
/* short is not enough for some */
/* force the other to go wrong too so both are taken down */
/* shut down */
// Add a fd to the shortlist so that it'll be recognized as a fd that needs
// sending or eof handling.
// out of range
// already in the list
// set the bit
// Add to the end of the shortlist array.
// Do pending network sends and eof handling from the shortlist.
// Remove fd from shortlist, move the last fd to the current position
// unset fd
// If this session still exists, perform send operations on it and
// check for the eof state.
// Send data
// If it's been marked as eof, call the parse func on it so that
// the socket will be immediately closed.
// If the session still exists, is not eof and has things left to
// be sent from it we'll re-add it to the shortlist.
// SEND_SHORTLIST
/**
/**
// If an address is trusted, it's automatically also allowed.
/**
/**
/**
// BUILDBOT
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\sql.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// Needed before mysql.h
// strtoul
/// Sql handle
// Column length receiver.
// Takes care of the possible size mismatch between uint32 and unsigned long.
/// Sql statement
///////////////////////////////////////////////////////////////////////////////
// Sql Handle
///////////////////////////////////////////////////////////////////////////////
/// Allocates and initializes a new Sql handle.
/// Establishes a connection.
/*unix_socket*/, 0/*clientflag*/) )
/// Retrieves the timeout of the connection.
/// Retrieves the name of the columns of a table into out_buf, with the separator after each name.
/// Changes the encoding of the connection.
/// Pings the connection.
/// Wrapper function for Sql_Ping.
///
/// @private
/// Establishes keepalive (periodic ping) on the connection.
///
/// @return the keepalive timer id, or INVALID_TIMER
/// @private
// set a default value first
// 8 hours
// request the timeout value from the mysql server
// establish keepalive
// 30-second reserve
//add_timer_func_list(Sql_P_KeepaliveTimer, "Sql_P_KeepaliveTimer");
/// Escapes a string.
/// Escapes a string.
/// Executes a query.
/// Executes a query.
/// Executes a query.
/// Returns the number of the AUTO_INCREMENT column of the last INSERT/UPDATE query.
/// Returns the number of columns in each row of the result.
/// Returns the number of rows in the result.
/// Fetches the next row.
/// Gets the data of a column.
// out of range - ignore
/// Frees the result of the query.
/// Shows debug information (last query).
/// Frees a Sql handle returned by Sql_Malloc.
///////////////////////////////////////////////////////////////////////////////
// Prepared Statements
///////////////////////////////////////////////////////////////////////////////
/// Returns the mysql integer type for the target size.
///
/// @private
/// Binds a parameter/result.
///
/// @private
// FIXME length = ? [FlavioJS]
// fixed size
// platform dependent size
// floating point
// other
/// Prints debug information about a field (type and length).
///
/// @private
/// Reports debug information about a truncated column.
///
/// @private
/// Allocates and initializes a new SqlStmt handle.
/// Prepares the statement.
/// Prepares the statement.
/// Prepares the statement.
/// Returns the number of parameters in the prepared statement.
/// Binds a parameter to a buffer.
// initialize the bindings
// out of range - ignore
/*
/// Executes the prepared statement.
// store all the data
/// Returns the number of the AUTO_INCREMENT column of the last INSERT/UPDATE statement.
/// Returns the number of columns in each row of the result.
/// Binds the result of a column to a buffer.
// null-terminator
// initialize the bindings
// out of range - ignore
/// Returns the number of rows in the result.
/// Fetches the next row.
// bind columns
// error binding columns
// fetch row
// check for errors
// find truncated column
// report truncated column
// propagate column lengths and clear unused parts of string/enum/blob buffers
// clear unused part of the string/enum buffer (and null-terminate)
// clear unused part of the blob buffer
/// Frees the result of the statement execution.
/// Shows debug information (with statement).
/// Frees a SqlStmt returned by SqlStmt_Malloc.
/* receives mysql error codes during runtime (not on first-time-connects) */
/* Can't connect to MySQL (this error only happens here when failing to reconnect) */
/**
// import should overwrite any previous configuration, so it should be called last
// FIXME: Hardcoded path
// "yyyy-mm-dd--hh-mm" (17) + ".sql" (4) + 1
/* index fp */
/* return silently, build has no mysql connection */
// "sql-files/upgrades/" (19) + "yyyy-mm-dd--hh-mm" (17) + ".sql" (4) + 1
// "1360186680" (10) + 1
/* upgrade fp */
//" comments */
/* skip \n, \r and "//" comments */
/* woo. skip the # */
// "sql-files/upgrades/" (19) + "yyyy-mm-dd--hh-mm" (17) + ".sql" (4) + 1
// "1360186680" (10) + 1
/* index fp */
/* woo. skip the # */
// FIXME: Hardcoded path
/* SqlStmt defaults [Susu] */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\strlib.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// escapes a string in-place (' -> \' , \ -> \\ , % -> _)
//copy from here
//copy string to temporary
// escapes a string into a provided buffer
//copy from here
//WARNING: Target string pt should be able to hold strlen(spt)*2, as each time
//a escape character is found, the target's final length increases! [Skotlex]
//Return an empty string [Skotlex]
// escapes exactly 'size' bytes of a string into a provided buffer
//copy from here
// copy size is 0 ~ (j-1)
// Function to suppress control characters in a string.
// Removes characters identified by ISSPACE from the start and end of the string
// NOTE: make sure the string is not const!!
// get start position
// get end position
// trim
// empty string
// move string with null-terminator
// Converts one or more consecutive occurrences of the delimiters into a single space
// and removes such occurrences from the beginning and end of string
// NOTE: make sure the string is not const!!
// trim start of string
// replace trim characters with a single space
// copy non trim characters
// skip trim characters
//stristr: Case insensitive version of strstr, code taken from
//http://www.daniweb.com/code/snippet313.html, Dave Sinkula
//
// matched starting char -- loop through remaining chars
// matched all of 'needle' to null termination
// return the start of the match
// TODO: Verify whether this implementation is still necessary for NetBSD 5.x
// and possibly some Solaris versions.
/* Find the length of STRING, but scan at most MAXLEN characters.
//----------------------------------------------------
// E-mail check: return 0 (not correct) or 1 (valid).
//----------------------------------------------------
// athena limits
// part of RFC limits (official reference of e-mail description)
// all correct
//--------------------------------------------------
// Return numerical value of a switch configuration
// on/off, yes/no, true/false, number
//--------------------------------------------------
// || (len == 3 && strcmpi(str, "oui") == 0) // Uncomment and edit to add your own localized versions
// || (len == 3 && strcmpi(str, "non") == 0) // Uncomment and edit to add your own localized versions
/// strncpy that always null-terminates the string
/// @remark this function will read at most `n` - 1 bytes from `src` (from 0 to `n` - 2)
/* null-terminate string */
/* null-pad remaining bytes */
/// doesn't crash on null pointer
/// Works like snprintf, but always null-terminates the buffer.
/// Returns the size of the string (without null-terminator)
/// or -1 if the buffer is too small.
///
/// @param buf Target buffer
/// @param sz Size of the buffer (including null-terminator)
/// @param fmt Format string
/// @param ... Format arguments
/// @return The size of the string or -1 if the buffer is too small
// overflow
// always null-terminate
/// Returns the line of the target position in the string.
/// Lines start at 1.
// found target line
// skip newline
/// Produces the hexadecimal representation of the given input.
/// The output buffer must be at least count*2+1 in size.
/// Returns true on success, false on failure.
///
/// @param output Output string
/// @param input Binary input buffer
/// @param count Number of bytes to convert
/////////////////////////////////////////////////////////////////////
/// Parses a single field in a delim-separated string.
/// The delimiter after the field is skipped.
///
/// @param svstate Parse state
/// @return 1 if a field was parsed, 0 if already done, -1 on error.
// error
// check opt
// error
// error
// nothing to parse
// record start of field and start parsing it
// skip field character
// normal character
// skip escape sequence (validates it too)
// '\\'
// hex escape
// 'x'
// hex digit
// octal escape
// octal digit
// octal digit
// octal digit
// supported escape character
// record end of field and stop
// nothing else
// delim
// skip line terminator
// CRLF
// CR or LF
/// Parses a delim-separated string.
/// Starts parsing at startoff and fills the pos array with position pairs.
/// out_pos[0] and out_pos[1] are the start and end of line.
/// Other position pairs are the start and end of fields.
/// Returns the number of fields found or -1 if an error occurs.
///
/// out_pos can be NULL.
/// If a line terminator is found, the end position is placed there.
/// out_pos[2] and out_pos[3] for the first field, out_pos[4] and out_pos[5]
/// for the seconds field and so on.
/// Unfilled positions are set to -1.
///
/// @param str String to parse
/// @param len Length of the string
/// @param startoff Where to start parsing
/// @param delim Field delimiter
/// @param out_pos Array of resulting positions
/// @param npos Size of the pos array
/// @param opt Options that determine the parsing behavior
/// @return Number of fields found in the string or -1 if an error occurred
// initialize
// parse
// error
/// Splits a delim-separated string.
/// WARNING: this function modifies the input string
/// Starts splitting at startoff and fills the out_fields array.
/// out_fields[0] is the start of the next line.
/// Other entries are the start of fields (null-terminated).
/// Returns the number of fields found or -1 if an error occurs.
///
/// out_fields can be NULL.
/// Fields that don't fit in out_fields are not null-terminated.
/// Extra entries in out_fields are filled with the end of the last field (empty string).
///
/// @param str String to parse
/// @param len Length of the string
/// @param startoff Where to start parsing
/// @param delim Field delimiter
/// @param out_fields Array of resulting fields
/// @param nfields Size of the field array
/// @param opt Options that determine the parsing behavior
/// @return Number of fields found in the string or -1 if an error occurred
// nothing to do
// next line
// error
// fields
// split field
// next field
// get more fields
// remaining fields
/// Escapes src to out_dest according to the format of the C compiler.
/// Returns the length of the escaped string.
/// out_dest should be len*4+1 in size.
///
/// @param out_dest Destination buffer
/// @param src Source string
/// @param len Length of the source string
/// @param escapes Extra characters to be escaped
/// @return Length of the escaped string
// nothing to do
// nothing to escape
// octal 0
// carriage return
// line feed
// escape character
// escape
// to octal
/// Unescapes src to out_dest according to the format of the C compiler.
/// Returns the length of the unescaped string.
/// out_dest should be len+1 in size and can be the same buffer as src.
///
/// @param out_dest Destination buffer
/// @param src Source string
/// @param len Length of the source string
/// @return Length of the escaped string
// 0x0?
// 0x1?
// 0x2?
// 0x3?
// 0x4?
// 0x5?
// 0x6?
// 0x7?
// 0x8?
// 0x9?
// 0xA?
// 0xB?
// 0xC?
// 0xD?
// 0xE?
// 0xF?
// '\\'
// hex escape sequence
// 'x'
// hex digit
// octal escape sequence (255=0377)
// '0', '1', '2' or '3'
// octal digit
// octal digit
// other escape sequence
// escaped character
// normal character
/// Skips a C escape sequence (starting with '\\').
// hexadecimal
// octal
/// Opens and parses a file containing delim-separated columns, feeding them to the specified callback function row by row.
/// Tracks the progress of the operation (current line number, number of successfully processed rows).
/// Returns 'true' if it was able to process the specified file, or 'false' if it could not be read.
///
/// @param directory Directory
/// @param filename File to process
/// @param delim Field delimiter
/// @param mincols Minimum number of columns of a valid row
/// @param maxcols Maximum number of columns of a valid row
/// @param parseproc User-supplied row processing function
/// @return true on success, false if file could not be opened
// buffer for fields ([0] is reserved)
// open file
// allocate enough memory for the maximum requested amount of columns plus the reserved one
// process rows one by one
//") ) != NULL) {
// strip comments
//TODO: strip trailing whitespace
// not enough columns
// too many columns
// parse this row
// invalid row contents
// success!
/////////////////////////////////////////////////////////////////////
// StringBuf - dynamic string
//
// @author MouseJstr (original)
/// Allocates a StringBuf
/// Initializes a previously allocated StringBuf
/// Appends the result of printf to the StringBuf
/// Appends the result of vprintf to the StringBuf
/* Try to print in the allocated space. */
/* If that worked, return the length. */
/* Else try again with more space. */
// twice the old size
/// Appends the contents of another StringBuf to the StringBuf
// Appends str to the StringBuf
// not enough space, expand the buffer (minimum expansion = 1024)
// Returns the length of the data in the Stringbuf
/// Returns the data in the StringBuf
/// Clears the contents of the StringBuf
/// Destroys the StringBuf
// Frees a StringBuf returned by StringBuf_Malloc
/* connect */
/* link~u! */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\sysinfo.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/**
//herc.ws
// fopen
// atoi
// time constants
/// Private interface fields
/// sysinfo.c interface source
/**
//msdn.microsoft.com/en-us/library/windows/desktop/ms724358%28v=vs.85%29.aspx
///< An unknown product
///< Ultimate
///< Home Basic
///< Home Premium
///< Enterprise
///< Home Basic N
///< Business
///< Server Standard
///< Server Datacenter (full installation)
///< Windows Small Business Server
///< Server Enterprise (full installation)
///< Starter
///< Server Datacenter (core installation)
///< Server Enterprise (core installation)
///< Server Standard (core installation)
///< Server Enterprise for Itanium-based Systems
///< Business N
///< Web Server (full installation)
///< HPC Edition
///< Windows Storage Server 2008 R2 Essentials
///< Storage Server Express
///< Storage Server Standard
///< Storage Server Workgroup
///< Storage Server Enterprise
///< Windows Server 2008 for Windows Essential Server Solutions
///< Small Business Server Premium
///< Home Premium N
///< Enterprise N
///< Ultimate N
///< Web Server (core installation)
///< Windows Essential Business Server Management Server
///< Windows Essential Business Server Security Server
///< Windows Essential Business Server Messaging Server
///< Server Foundation
///< Windows Home Server 2011
///< Windows Server 2008 without Hyper-V for Windows Essential Server Solutions
///< Server Standard without Hyper-V
///< Server Datacenter without Hyper-V (full installation)
///< Server Enterprise without Hyper-V (full installation)
///< Server Datacenter without Hyper-V (core installation)
///< Server Standard without Hyper-V (core installation)
///< Server Enterprise without Hyper-V (core installation)
///< Microsoft Hyper-V Server
///< Storage Server Express (core installation)
///< Storage Server Standard (core installation)
///< Storage Server Workgroup (core installation)
///< Storage Server Enterprise (core installation)
///< Starter N
///< Professional
///< Professional N
///< Windows Small Business Server 2011 Essentials
///< Server For SB Solutions
///< Server Solutions Premium
///< Server Solutions Premium (core installation)
///< Server For SB Solutions EM
///< Server For SB Solutions EM
///< Windows MultiPoint Server
///< Windows Essential Server Solution Management
///< Windows Essential Server Solution Additional
///< Windows Essential Server Solution Management SVC
///< Windows Essential Server Solution Additional SVC
///< Small Business Server Premium (core installation)
///< Server Hyper Core V
///< Not supported
///< Not supported
///< Not supported
///< Not supported
///< Not supported
///< Not supported
///< Server Enterprise (evaluation installation)
///< Windows MultiPoint Server Standard (full installation)
///< Windows MultiPoint Server Premium (full installation)
///< Server Standard (evaluation installation)
///< Server Datacenter (evaluation installation)
///< Enterprise N (evaluation installation)
///< Storage Server Workgroup (evaluation installation)
///< Storage Server Standard (evaluation installation)
///< Windows 8 N
///< Windows 8 China
///< Windows 8 Single Language
///< Windows 8
///< Professional with Media Center
/**
//msdn.microsoft.com/en-us/library/windows/desktop/ms724385%28v=vs.85%29.aspx
///< Obtains the build number if the system is Windows Server 2003 R2; otherwise, 0.
/**
//msdn.microsoft.com/en-us/library/windows/desktop/ms724833%28v=vs.85%29.aspx
///< Windows Server 2003, Web Edition is installed.
///< Windows Storage Server 2003 R2 or Windows Storage Server 2003 is installed.
///< Windows Server 2003, Compute Cluster Edition is installed.
///< Windows Home Server is installed.
// not WIN32
// UNIX. Use build-time cached values
// WIN32
// Compiler detection <http://sourceforge.net/p/predef/wiki/Compilers/>
// < 1300 || >= 2000
// end compiler detection
/**
// Only include SVN support if detected it, or we're on MSVC
// subversion 1.7 uses a sqlite3 database
// FIXME this is hackish at best...
// - ignores database file structure
// - assumes the data in NODES.dav_cache column ends with "!svn/ver/<revision>/<path>)"
// - since it's a cache column, the data might not even exist
//not sure how to handle branches, so I'll leave this overridable define until a better solution comes up
// SVNNODEPATH
// there should exist only 1 entry like this
// read file to buffer
// parse buffer
// postfix mismatch
// skip digits
// prefix mismatch
// done
/**
// Only include Git support if we detected it, or we're on MSVC
/// Windows-specific runtime detection functions.
/**
/*
// Windows NT Family
// Between XP and 8.1
// Between Vista and 8.1
// If it's 2, it can be Windows 8, or any newer version (8.1 at the time of writing this) -- see above for the reason.
// XP x64 and Server 2003
// Test for the server type.
// XP
// 2000
// Include service pack (if any) and build number.
/**
//msdn.microsoft.com/en-us/library/windows/desktop/ms724958(v=vs.85).aspx
// Call GetNativeSystemInfo if supported or GetSystemInfo otherwise.
/**
/**
/**
// x64
// x32
// ARM
// Itanium
/**
// Try Git, then SVN
// WIN32
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
// Try Git, then SVN
/**
/**
// Must be called after setting vcstype
/**
// Only need to be free'd in win32, they're #defined elsewhere
/**
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\thread.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// sysinfo->getpagesize()
// When Compiling using MSC (on win32..) we know we have support in any case!
/** @file
/// The maximum amount of threads.
// Subystem Code
/// @copydoc thread_interface::init()
// now lets init thread id 0, which represents the main thread
/// @copydoc thread_interface::final()
// Unterminated Threads Left?
// Shouldn't happen ... Kill 'em all!
/**
// Preserve handle->myID and handle->hThread, set everything else to its default value
// on Posix Thread platforms
// Update myID @ TLS to right id.
// When using posix threads
// the threads inherits the Signal mask from the thread which spawned
// this thread
// so we've to block everything we don't care about.
// API Level
/// @copydoc thread_interface::create()
/*8MB*/, THREADPRIO_NORMAL);
/// @copydoc thread_interface::create_opt()
// given stacksize aligned to systems pagesize?
// Get a free Thread Slot.
/// @copydoc thread_interface::destroy()
// We have to join it, otherwise pthread wont re-cycle its internal resources assoc. with this thread.
// Tell our manager to release resources ;)
// entry point set, so its used!
// .. so no tls means we have to search the thread by its api-handle ..
/// @copydoc thread_interface::get_tid()
/// @copydoc thread_interface::wait()
// Hint:
// no thread data cleanup routine call here!
// its managed by the callProxy itself..
/// @copydoc thread_interface::prio_set()
//@TODO
/// @copydoc thread_interface::prio_get()
/// @copydoc thread_interface::yield()
/// Interface base initialization.
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\timer.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// GetTickCount()
// struct timeval, gettimeofday()
// If the server can't handle processing thousands of monsters
// or many connected clients, please increase TIMER_MIN_INTERVAL.
// timers (array)
// free timers (array)
/// Comparator for the timer heap. (minimum tick at top)
/// Returns negative if tid1's tick is smaller, positive if tid2's tick is smaller, 0 if equal.
///
/// @param tid1 First timer
/// @param tid2 Second timer
/// @return negative if tid1 is top, positive if tid2 is top, 0 if equal
// timer heap (binary heap of tid's)
// server startup time
/*----------------------------
/// Sets the name of a timer function.
// check suspicious cases
/// Returns the name of the timer function.
/*----------------------------
//1000 MS
/**
// Windows: GetTickCount/GetTickCount64: Return the number of
//   milliseconds that have elapsed since the system was started.
// TODO: GetTickCount/GetTickCount64 has a resolution of only 10~15ms.
//       Ai4rei recommends that we replace it with either performance
//       counters or multimedia timers if we want it to be more accurate.
//       I'm leaving this for a future follow-up patch.
// GetTickCount64 is only available in Windows Vista / Windows Server
//   2008 or newer. Since we still support older versions, this runtime
//   check is required in order not to crash.
// http://msdn.microsoft.com/en-us/library/windows/desktop/ms724411%28v=vs.85%29.aspx
// 32-bit fall back. Note: This will wrap around every ~49 days since system startup!!!
// RDTSC: Returns the number of CPU cycles since reset. Unreliable if
//   the CPU frequency is variable.
// Monotonic clock: Implementation-defined.
//   Clock that cannot be set and represents monotonic time since some
//   unspecified starting point.  This clock is not affected by
//   discontinuous jumps in the system time (e.g., if the system
//   administrator manually changes the  clock),  but  is  affected by
//   the  incremental adjustments performed by adjtime(3) and NTP.
// int64 cast to avoid overflows on platforms where time_t is 32 bit
// Fall back, regular clock: Number of milliseconds since epoch.
//   The time returned by gettimeofday() is affected by discontinuous
//   jumps in the system time (e.g., if the system  administrator
//   manually  changes  the system time).  If you need a monotonically
//   increasing clock, see clock_gettime(2).
// int64 cast to avoid overflows on platforms where time_t is 32 bit
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
// tick is cached for TICK_CACHE calls
//////////////////////////////
//////////////////////////////
// tick doesn't get cached
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
/*======================================
/// Adds a timer to the timer_heap
/*==========================
/// Returns a free timer id.
// select a free timer
// check available space
// possible timer_data null pointer
// expand timer array
/// Starts a new timer that is deleted once it expires (single-use).
/// Returns the timer's id.
/// Starts a new timer that automatically restarts itself (infinite loop until manually removed).
/// Returns the timer's id, or INVALID_TIMER if it fails.
/// Retrieves internal timer data
/// Marks a timer specified by 'id' for immediate deletion once it expires.
/// Param 'func' is used for debug/verification purposes.
/// Returns 0 on success, < 0 on failure.
/// Adjusts a timer's expiration time.
/// Returns the new tick value, or -1 if it fails.
/**
// search timer position
// add 1ms to avoid the error value -1
// nothing to do, already in proper position
// pop and push adjusted timer
/**
// return value
// process all timers one by one
// top element in heap (smallest tick)
// no more expired timers to process
// remove timer
// timer was delayed for more than 1 second, use current tick instead
// in the case the function didn't change anything...
// copy next pointer
// free structures
/*=====================================
/* funcs */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\common\utils.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/* F_OK */
// floor()
// cache purposes [Ind/Hercules]
/// Dumps given buffer into file pointed to by a handle.
/// Dumps given buffer on the console.
// just make sure the char*path is not const
//EOS
// just make sure the char*path is not const
//EOS
///< pointer to the scanned directory.
///< pointer to one directory entry.
///< used by stat().
// open the directory for reading
// scan the directory, traversing each sub-directory
// matching the pattern for each file name.
// skip the "." and ".." entries.
// check if the pattern matches.
// check if it is a directory.
// is this a directory?
// decent recursively
//end while
/*************************************
// Converts an int16 from current machine order to little-endian
// Converts an int32 from current machine order to little-endian
// Reads an uint16 in little-endian from the buffer
// Reads an uint32 in little-endian from the buffer
// Reads an int32 in little-endian from the buffer
// Reads a float (32 bits) from the buffer
/// calculates the value of A / B, in percent (rounded down)
/// calculates the value of A / B, in percent (rounded down)
/**
// Give up some precision to prevent overflows
/**
//-----------------------------------------------------
// custom timestamp formatting (from eApp)
//-----------------------------------------------------
/* [Ind/Hercules] Caching */
/* 1-byte key to ensure our method is the latest, we can modify to ensure the method matches */
// skip first 20, might wanna store something else later
/* transit to fread, shields vs warn_unused_result */
/* transit to fwrite, shields vs warn_unused_result */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\login\account.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// CONSOLE_INPUT
/// global defines
/// public constructor
// set up the vtable
// initialize to default values
// Sql settings
// other settings
/* ------------------------------------------------------------------------- */
/// establishes database connection
/// disconnects from database
/// Gets a property from this database.
/* TODO:
// not found
// not found
// not found
// 0
/**
// Error message is already shown by libconfig->load_file
// TODO: Proper import mechanism for this file
/**
// FIXME: Why do we need both codepage and default_codepage?
/// create a new account entry
/// If acc->account_id is -1, the account id will be auto-generated,
/// and its value will be written to acc->account_id if everything succeeds.
// decide on the account id to assign
// caller specifies it manually
// ask the database
// zero value is prohibited
// absolute maximum
// insert the data into the database
/// delete an existing account entry + its regs
/// update an existing account with the provided new data (both account and regs)
/// retrieve data from db and store it in the provided data structure
/// retrieve data from db and store it in the provided data structure
// get the list of account IDs for this user ID
// serious problem - duplicate account
// no such entry
/// Returns a new forward iterator.
// set up the vtable
// fill data
/// Destroys this iterator, releasing all allocated memory (including itself).
/// Fetches the next account in the database.
// get next account ID
// get account data
// retrieve login entry for the specified account
// no such entry
// try
// insert into account table
// update account table
// if we got this far, everything was successful
// finally
/* int */
/* str */
/* 0x2 = length, set prior to being sent */
/* var type (only set when all vars have been sent, regardless of type) */
/* is string type */
/* count */
/**
/* won't be higher; the column size is 32 */
/* won't be higher; the column size is 254 */
/* prepare follow up */
/* 0x2 = length, set prior to being sent */
/* var type (only set when all vars have been sent, regardless of type) */
/* is string type */
/* count */
/* mark & go. */
/* 0x2 = length, set prior to being sent */
/* var type (only set when all vars have been sent, regardless of type) */
/* is int type */
/* count */
/**
/* won't be higher; the column size is 32 */
/* prepare follow up */
/* 0x2 = length, set prior to being sent */
/* var type (only set when all vars have been sent, regardless of type) */
/* is int type */
/* count */
/* mark as complete & go. */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\login\HPMlogin.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// HPMDataCheck comes after all the other includes
/**
// No supported types at the moment
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\login\ipban.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// initialize
// ipban disabled
// establish connections
// set up periodic cleanup of connection history and active bans
// make sure it gets cleaned up on login-server start regardless of interval-based cleanups
// finalize
// ipban disabled
// release data
// always clean up on login-server stop
// close connections
/**
// Error message is already shown by libconfig->read_file
// import should overwrite any previous configuration, so it should be called last
/**
/**
/**
// settings can only be changed before init
// check ip against active bans list
// ipban disabled
// close connection because we can't verify their connectivity.
// log failed attempt
// ipban disabled
// how many times failed account? in one ip.
// if over the limit, add a temporary ban entry
// remove expired bans
// ipban disabled
// Sql settings
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\login\lclif.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/** @file
/// @copydoc lclif_interface::connection_error()
/// @copydoc lclif_interface_private::parse_CA_CONNECT_INFO_CHANGED()
/// @copydoc lclif_interface_private::parse_CA_EXE_HASHCHECK()
/// @copydoc lclif_interface_private::parse_CA_LOGIN()
/// @copydoc lclif_interface_private::parse_CA_LOGIN2()
/// @copydoc lclif_interface_private::parse_CA_LOGIN3()
/* unused */
/* sd->clientinfo = packet->clientinfo; */
/// @copydoc lclif_interface_private::parse_CA_LOGIN4()
/* unused */
/* safestrncpy(sd->mac_address, packet->mac_address, sizeof(sd->mac_address)); */
/// @copydoc lclif_interface_private::parse_CA_LOGIN_PCBANG()
/* unused */
/* safestrncpy(sd->ip, packet->ip, sizeof(sd->ip)); */
/* safestrncpy(sd->mac_address, packet->mac_address, sizeof(sd->mac_address)); */
/// @copydoc lclif_interface_private::parse_CA_LOGIN_HAN()
/* unused */
/* safestrncpy(sd->ip, packet->ip, sizeof(sd->ip)); */
/* safestrncpy(sd->mac_address, packet->mac_address, sizeof(sd->mac_address)); */
/* sd->ishan = packet->is_han_game_user; */
/// @copydoc lclif_interface_private::parse_CA_SSO_LOGIN_REQ()
// Variable-length field, don't copy more than necessary
/// @copydoc lclif_interface_private::parse_CA_LOGIN_OTP()
//const struct PACKET_CA_LOGIN_OTP *packet = RP2PTR(fd);
/// @copydoc lclif_interface_private::parse_CA_ACK_MOBILE_OTP()
// TODO: parsing packet data
/// @copydoc lclif_interface_private::parse_CA_OTP_CODE()
// TODO: parsing packet data
/// @copydoc lclif_interface_private::parse_CA_REQ_HASH()
/// @copydoc lclif_interface_private::parse_CA_CHARSERVERCONNECT()
/// @copydoc lclif_interface::server_list()
// Allocate the packet
// Not used anymore
// Not used anymore
// [!] LE byte order here [!]
/// @copydoc lclif_interface::auth_failed()
/// @copydoc lclif_interface::login_error()
/// @copydoc lclif_interface::coding_key()
/// @copydoc lclif_interface::parse()
// Perform ip-ban check
// 3 = Rejected from Server
// create a session for this new connection
/// @copydoc lclif_interface_private::parse_sub()
// Packet not completed yet
//This Packet is defined for length purpose ? should never be sent from client ?
//Max Variable Packet length is signed int16 size
//Packet incomplete
//Something is wrong, close connection.
//Packet incomplete again.
/// @copydoc lclif_interface::packet()
/// @copydoc lclif_interface::parse_packet()
/// @copydoc lclif_interface_private::packetdb_loaddb()
//Explict case, we will save character login packet in position 0 which is unused and not valid by normal
/// @copydoc lclif_interface::init()
/// @copydoc lclif_interface::final()
/// Interface base initialization.
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\login\login.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// stat()
/** @file
// account database
//-----------------------------------------------------
// Auth database
//-----------------------------------------------------
/**
/**
//Char server disconnected.
/**
//Unknown server.. set them offline
//--------------------------------------------------------------------
// Packet send to all char-servers, except one (wos: without our self)
//--------------------------------------------------------------------
/// Initializes a server structure.
/// Destroys a server structure.
/// Resets all the data related to a server.
//Set all chars from this char server to offline.
/// Called when the connection to Char Server is disconnected.
//-----------------------------------------------------
// periodic ip address synchronization
//-----------------------------------------------------
//-----------------------------------------------------
// encrypted/unencrypted password check (from eApp)
//-----------------------------------------------------
// password mode set to PWENC_ENCRYPT  -> md5(md5key, refpass) enable with <passwordencrypt></passwordencrypt>
// password mode set to PWENC_ENCRYPT2 -> md5(refpass, md5key) enable with <passwordencrypt2></passwordencrypt2>
/**
// ok
// auth failed
//uint32 ip_ = ntohl(RFIFOL(fd,15));
/*&&
// found
//ShowStatus("Char-server '%s': authentication of the account %d accepted (ip: %s).\n", login->dbs->server[id].name, account_id, ip);
// send ack
// each auth entry can only be used once
// authentication not found
// how many users on world? (update)
// Save
// Save
// 0: change of state, 1: ban
// status or final date of a banishment
// Save
// notify other servers
// 0: change of status, 1: ban
// status or final date of a banishment
// new ban
// add to existing ban
// Save
//Change gender
// Save
// announce to other servers
//Set all chars from this char-server offline first
// FIXME: Do we really want to log this with the same code as successful logins?
//--------------------------------
// Packet parsing for char-servers
//--------------------------------
// not a char server
// request from char-server to authenticate an account
// request from char server to change e-email from default "a@a.com"
// request account data
// ping request from charserver
// Map server send information to change an email of an account via char-server
// 0x2722 <account_id>.L <actual_e-mail>.40B <new_e-mail>.40B
// Receiving an account state update request from a map-server (relayed via char-server)
// Receiving of map-server via char-server a ban request
// Change of sex (sex is reversed)
// We receive account_reg2 from a char-server, and we send them to other map-servers.
// Receiving of map-server via char-server an unban request
// Set account_id to online [Wizputer]
// Set account_id to offline [Wizputer]
// Receive list of all online accounts. [Skotlex]
//Request account_reg2 for a character.
// WAN IP update from char-server
//Request to set all offline.
//Change PIN Code for a account
// PIN Code was entered wrong too often
// Accinfo request forwarded by charserver on mapserver's account
// switch
// while
//-------------------------------------
// Make new account
//-------------------------------------
// registration counter
//Account Registration Flood Protection by [Kevin]
// check for invalid inputs
// 0 = Unregistered ID
// check if the account doesn't exist already
// 1 = Incorrect Password
// assigned by account db
// Update the registration check.
//-----------------------------------------------------
// Check/authentication of a connection
//-----------------------------------------------------
// TODO: Map result values to an enum (or at least document them)
// DNS Blacklist check
//Client Version check
// Account creation with _M/_F
// valid user and password lengths
// unencoded password
// _M/_F suffix
// remove the _M/_F suffix
// Failed to make account. [Skotlex].
/** a empty password is fine, a userid is not. **/
// 0 = Unregistered ID
// 0 = Unregistered ID
// 1 = Incorrect Password
// 6 = Your are Prohibited to log in until %s
// Allowed to login without hash
// Correct hash
// update session data
// update account data
// account OK
// players can only login while running
// 01 = server closed
// 01 = server closed
// 01 = server closed
// account is already marked as online!
// Request char servers to kick this account out. [Skotlex]
// 08 = Server still recognizes your last login
// client has authed but did not access char-server yet
// wipe previous session
// if no char-server, don't send void list of servers, just disconnect the player with proper message
// 01 = server closed
// create temporary auth entry
// mark client as 'online'
// schedule deletion of this node
// 0 = Unregistered ID
// 1 = Incorrect Password
// 2 = This ID is expired
// 3 = Rejected from Server
// 4 = You have been blocked by the GM Team
// 5 = Your Game's EXE file is not the latest version
// 6 = Your are Prohibited to log in until %s
// 7 = Server is jammed due to over populated
// 8 = No more accounts may be connected from this company
// 9 = MSI_REFUSE_BAN_BY_DBA
// 10 = MSI_REFUSE_EMAIL_NOT_CONFIRMED
// 11 = MSI_REFUSE_BAN_BY_GM
// 12 = MSI_REFUSE_TEMP_BAN_FOR_DBWORK
// 13 = MSI_REFUSE_SELF_LOCK
// 14 = MSI_REFUSE_NOT_PERMITTED_GROUP
// 15 = MSI_REFUSE_NOT_PERMITTED_GROUP
// 99 = This ID has been totally erased
// 100 = Login information remains at %s
// 101 = Account has been locked for a hacking investigation. Please contact the GM Team for more information
// 102 = This account has been temporarily prohibited from login due to a bug-related investigation
// 103 = This character is being deleted. Login is temporarily unavailable for the time being
// 104 = This character is being deleted. Login is temporarily unavailable for the time being
// FIXME: result can be 100, conflicting with the value 100 we use for successful login...
// log failed password attempt
// send "rejected from server"
// send ok response with fake token
// + "token" string
// normal login
// PACKETVER_MAIN_NUM >= 20171213 || PACKETVER_RE_NUM >= 20171213 || PACKETVER_ZERO_NUM >= 20171123
// PACKETVER_MAIN_NUM >= 20170621 || PACKETVER_RE_NUM >= 20170621 || defined(PACKETVER_ZERO)
// PACKETVER_MAIN_NUM >= 20170621 || PACKETVER_RE_NUM >= 20170621 || defined(PACKETVER_ZERO)
// CA_CHARSERVERCONNECT
// hack to skip version check
// send connection success
/**
// In minutes
/**
// only bother if its actually enabled
/**
/**
/**
/**
// There's no need to parse if it's disabled or if there's no list
// login->config->client_hash_nodes is initialized before calling this function
/**
/**
/**
// There's no need to parse if it's disabled
/**
/**
/**
/**
// Error message is already shown by libconfig->load_file
// Only inter-server
// import should overwrite any previous configuration, so it should be called last
/**
//--------------------------------------
// Function called at exit of the server
//--------------------------------------
// destroy account engine
// destroyed in account_engine
//------------------------------
// Function called when the server
// has received a crash signal.
//------------------------------
/// Called when a terminate signal is received.
// TODO proper shutdown procedure; kick all characters, wait for acks, ...  [FlavioJS]
/**
/**
/**
/**
//------------------------------
// Login server initialization
//------------------------------
// initialize engine (to accept config settings)
// read login-server configuration
// TODO: Remove this when no longer needed.
// initialize logging
// initialize static and dynamic ipban system
// Online user database init
// Interserver auth init
// set default parser as lclif->parse function
// every 10 minutes cleanup online account db.
// add timer to detect ip address change and perform update
// Account database init
// server port open & binding
// CONSOLE_INPUT
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\login\loginlog.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// exit
// Returns the number of failed login attempts by the ip in the last minutes.
// how many times failed account? in one ip.
/*=============================================
// TODO: add an enum of rcode values
/**
/**
/**
// Error message is already shown by libconfig->load_file
// Sql settings
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\achievement.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/**
/**
/* Lookup for achievement entry */
/**
/**
/**
// ignore the call if the achievement is completed.
// Check and increment the objective count.
// Check if the Achievement is complete.
// update client.
/**
/**
/* Item Id */
/* Weapon Level */
/* Status Types */
/* Achievement Id */
/* Monster Id */
/* Item Type */
/* Job Ids */
/**
/* Loop through all achievements of the type, checking for possible matches. */
// Check if objective criteria matches.
// Ensure availability of the achievement.
// Criteria passed, check if not completed and update progress.
/**
// Ensure availability of the achievement.
// Check if not completed and update progress.
/**
/**
/**
/* */
/* */
/* Job class */
/* Job Type */
/**
/* */
/* */
/**
/**
/* Stat and Job class */
/* Stat and Job Type */
/**
/**
/**
/**
/**
/**
/**
/**
// achievement should not trigger if refine is 0
/* Universal */
/* Total */
/* By Weapon Level */
// cleanup
/* By NameId */
// cleanup
/**
// cleanup
/* Item Buy Value*/
/* Item Type */
// cleanup
/**
/**
/**
/**
/**
/**
/* Browse through the session's achievement list and gather their values. */
/* Sanity check for nonull pointers. */
/**
// TODO: kro send items by rodex
//Check if it's stackable.
/**
/* Buff */
// Add Title
// send update.
/* Give Items */
/**
// report error.
// Rank counter;
// break if elements are not in order or rank doesn't exist.
/**
/**
// initialize the buffered objective jobid vector.
/* Ensure size and allocation */
/* push buffer */
/**
/**
/**
/**
/**
/**
// Search Objective 1..MAX
/* Description */
/* Criteria */
/* MobId */
/* ItemId */
/* StatusType */
/* ItemType */
/* WeaponLevel */
/* Achievement */
/**
/* JobId */
/* Goal */
// 1 count by default.
/* Ensure size and allocation */
/* Push buffer */
// Break if not in order, to comply with the client's objective order.
/**
// Initialize the buffer objective vector.
// Assess total objectives.
// end of "Objectives"
/**
/* Ensure size and allocation */
/* push buffer */
/**
/**
/**
/**
/* Items */
/* Buff/Bonus Script Code */
/* Title Id */
// @TODO Check Title ID against title DB!
/**
// plugins do their own thing.
/**
// report error.
/* Achievement ID */
/* Achievement Name */
/* Achievement Type*/
/* Objectives */
/* Rewards */
/* Achievement Points */
/* Additional Fields */
/* Allocate memory for data. */
/* Place in the database. */
/* Put achievement key in categories. */
/* Qualify for duplicate Id checks */
// end of achievement_db parsing.
/* Destroy the buffer */
/**
/* DB Initialization */
/* Read LibConfig Files */
/**
// Free the script
/**
/**
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\atcommand.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// AUTOLOOTITEM_SIZE, AUTOTRADE_PERSISTENCY, MAX_SUGGESTIONS, MOB_FLEE(), MOB_HIT(), RENEWAL, RENEWAL_DROP, RENEWAL_EXP
// groupid2name
// MAX_CARTS
// @commands (script-based)
// for backwards compatibility
//-----------------------------------------------------------
// Return the message string of the specified number by [Yor]
//-----------------------------------------------------------
/**
/* this could easily become consecutive memory like get_str() and save the malloc overhead for over 1k calls [Ind] */
/*==========================================
/**
/*==========================================
// read message type as hex number (without the 0x)
// Usage:
// @send len <packet hex number>
// @send <packet hex number> {<value>}*
// Value: <type=B(default),W,L><number> or S<length>"<string>"
//define PARSE_ERROR
//define CHECK_EOS
/* non-space */\
/* space */\
//define SKIP_VALUE
//define GET_VALUE
// unknown packet - ERROR
// Unknown packet: 0x%x
// show packet length
// Packet 0x%x length: %d
// dynamic packet
// maximum length
// parse packet contents
// default (byte)
// byte
// word (2 bytes)
// long word (4 bytes)
// string - escapes are valid
// get string length - num <= 0 means not fixed length (default)
// find start of string
// Not a string:
// parse string
// Bell
// Backspace
// Horizontal tab
// Line feed
// Vertical tab
// Form feed
// Carriage return
// Escape
// Hexadecimal
// Not a hexadecimal digit:
// Octal
// 1st octal digit
// 2nd octal digit
// 3rd octal digit
//for
// ignore extra characters
// terminate the string
// fill the rest with 0's
// unknown
// Unknown type of value in:
// send dynamic packet
// send static packet
// Invalid packet
// Sent packet 0x%x (%d)
/*==========================================
// Please enter a map (usage: @warp/@rura/@mapmove <mapname> <x> <y>).
// m < 0 means on different server or that map is disabled! [Kevin]
// Map not found.
// You already are at your destination!
//This is to prevent the pc->setpos call from printing an error.
//Invalid cell, use random spot.
// You are not authorized to warp to this map.
// You are not authorized to warp from your current map.
// Map not found.
// Warped.
/*==========================================
// Please enter a player name (usage: @where <char name>).
// Character not found.
/*==========================================
// Please enter a player name (usage: @jumpto/@warpto/@goto <char name/ID>).
// You are not authorized to warp from your current map.
// "You cannot use this command when dead."
// Character not found.
// You are not authorized to warp to this map.
// You already are at your destination!
// Jumped to %s
/*==========================================
// You are not authorized to warp from your current map.
// "You cannot use this command when dead."
//This is to prevent the pc->setpos call from printing an error.
//Invalid cell, use random spot.
// You already are at your destination!
// Jumped to %d %d
/*==========================================
/**
// you can look only lower or same level
// search with no case sensitive
// "Name: %s "
// Player title, if exists
// "(%s) "
// "| Lv:%d/%d | Job: %s"
// "(CID:%d/AID:%d) "
// "Name: %s "
// Player title, if exists
// "(%s) "
// "| Location: %s %d %d"
// "Name: %s "
// Player title, if exists
// "(%s) "
// " | Party: '%s'"
// " | Guild: '%s'"
/** for whatever reason clif->message crashes with some patterns, see bugreport:8186 **/
// No player found.
// 1 player found.
// %d players found.
// No player found in map '%s'.
// 1 player found in map '%s'.
// %d players found in map '%s'.
/*==========================================
// search with no case sensitive
// Name: %s (GM)
// Name: %s (GM:%d) | Location: %s %d %d
// BLvl: %d | Job: %s (Lvl: %d)
// Party: '%s' | Guild: '%s'
// None.
// No GM found.
// 1 GM found.
// %d GMs found.
/*==========================================
// Your save point has been changed.
/*==========================================
// You are not authorized to warp to your save map.
// You are not authorized to warp from your current map.
// Warping to save point..
/*==========================================
// Please enter a speed value (usage: @speed <%d-%d>).
// Set lock when set to non-default speed.
// Speed changed.
//Speed returned to normal.
/*==========================================
// mapflag nostorage already defined? can't open :c
// You currently cannot open your storage.
//Already open.
// You have already opened your storage. Close it first.
// Storage opened.
/*==========================================
// You are not in a guild.
// You have already opened your storage. Close it first.
// You have already opened your guild storage. Close it first.
// mapflag nogstorage already defined? can't open :c
// You currently cannot open your storage. (there is no other messages...)
// Your guild's storage has already been opened by another member, try again later.
// Guild storage opened.
/*==========================================
// failed to match the parameters so inform the user of the options
// attempt to find the setting information for this command
// notify the user of the requirement to enter an option
// Please enter at least one option.
// send the help text associated with this command
// Options changed.
/*==========================================
// Invisible: Off
// increment the number of pvp players on the map
// register the player for ranking calculations
//bugreport:2266
// Invisible: On
// decrement the number of pvp players on the map
// unregister the player for ranking
/*==========================================
// No message, just show the list
// Numeric job ID
// Job name
// Normal Jobs
// High Jobs, Babies and Third
// Deny direct transformation into dummy jobs
/* WHY DO WE LIST THEM THEN? */
//"You can not change to this job by command."
// You are unable to change your job.
// Your job has been changed.
/*==========================================
// A pity! You've died.
// Character killed.
/*==========================================
// "You're not dead."
// You've been revived! It's a miracle!
/*==========================================
// Please enter a message (usage: @kami <message>).
// Please enter color and message (usage: @kamic <color> <message>).
// Invalid color.
/*==========================================
// [Valaris] thanks to fov
// some overflow checks
// HP and SP have already been recovered.
// HP, SP recovered.
// HP and SP are already with the good value.
// HP, SP recovered.
// HP or/and SP modified.
//Opposing signs.
// HP or/and SP modified.
/*==========================================
// Please enter an item name or ID (usage: @itembound <item name/ID> <quantity> <bound_type>).
// Please enter an item name or ID (usage: @item <item name/ID> <quantity>).
// Invalid item ID or name.
// Invalid bound type
/* no restrictions */
//You can't add a party bound item to a character without party!
//You can't add a guild bound item to a character without guild!
//Check if it's stackable.
// Cannot create bounded pet eggs or pet armors.
// if not pet egg
// Item created.
/*==========================================
// Please enter all parameters (usage: @itembound2 <item name/ID> <quantity>
//   <identify_flag> <refine> <attribute> <card1> <card2> <card3> <card4> <bound_type>).
// Please enter all parameters (usage: @item2 <item name/ID> <quantity>
//   <identify_flag> <refine> <attribute> <card1> <card2> <card3> <card4>).
// Invalid bound type
// Cannot create bounded pet eggs or pet armors.
// Item created.
// Invalid item ID or name.
/*==========================================
// All of your items have been removed.
/*==========================================
// Please enter a level adjustment (usage: @lvup/@blevel/@baselvlup <number of levels>).
// check for max level by Valaris
// Base level can't go any higher.
// End Addition
// fix positive overflow
// Base level raised.
// Base level can't go any lower.
// Base level lowered.
// achievements
// Trigger OnPCBaseLvUpEvent
/*==========================================
// Please enter a level adjustment (usage: @joblvup/@jlevel/@joblvlup <number of levels>).
// Job level can't go any higher.
// fix positive overflow
// Job level raised.
// Job level can't go any lower.
// fix negative overflow
//Reset skills since we need to subtract more points.
// Job level lowered.
// Trigger OnPCJobLvUpEvent
/*==========================================
// If no command_name specified, display help for @help.
// "%s is Unknown Command"
// There is no help for %c%s.
// Help for command %c%s:
// Display aliases
// Available aliases:
// Display help contents
/**
/*==========================================
// PvP is already Off.
// PvP: Off.
/*==========================================
// PvP is already On.
// display pvp circle and rank
// PvP: On.
/*==========================================
// GvG is already Off.
// GvG: Off.
/*==========================================
// GvG is already On.
// GvG: On.
/*==========================================
// CvC is already Off.
// CvC: Off.
/*==========================================
// CvC is already On.
// CvC: On.
/*==========================================
// Please enter at least one value (usage: @model <hair ID: %d-%d> <hair color: %d-%d> <clothes color: %d-%d>).
// Appearance changed.
// An invalid number was specified.
/*==========================================
// This job has no alternate body styles.
// Appearence changed.
// An invalid number was specified.
/*==========================================
// Please enter a clothes color (usage: @dye/@ccolor <clothes color: %d-%d>).
// Appearance changed.
// An invalid number was specified.
/*==========================================
// Please enter a hair style (usage: @hairstyle/@hstyle <hair ID: %d-%d>).
// Appearance changed.
// An invalid number was specified.
/*==========================================
// Please enter a hair color (usage: @haircolor/@hcolor <hair color: %d-%d>).
// Appearance changed.
// An invalid number was specified.
// usage info
// handle special zones:
// nothing to do
// zone not found
// changed successfully
/*==========================================
// Initialized to INT_MAX instead of -1 to avoid conflicts with those who map [-3:-1] to @memo locations.
///< Minimum string length to match
//  0 = Prontera
//  1 = Morroc
//  2 = Geffen
//  3 = Payon
//  4 = Alberta
//  5 = Izlude (Renewal)
//  5 = Izlude
//  6 = Aldebaran
//  7 = Lutie
//  8 = Comodo
//  9 = Juno
// 10 = Amatsu
// 11 = Kunlun
// 12 = Umbala
// 13 = Niflheim
// 14 = Luoyang
// 15 = Training Grounds
// 16 = Prison
// 17 = Jawaii
// 18 = Ayothaya
// 19 = Einbroch
// 20 = Lighthalzen
// 21 = Einbech
// 22 = Hugel
// 23 = Rachel
// 24 = Veins
// 25 = Moscovia
// 26 = Midgard Camp
// 27 = Manuk
// 28 = Splendide
// 29 = Brasilis
// 30 = El Dicastes
// 31 = Mora
// 32 = Dewata
// 33 = Malangdo Island
// 34 = Malaya Port
// 35 = Eclage
// no value matched so send the list of locations
// attempt to find the text help string
// Invalid location number, or name.
// send the text to the client
// Numeric entry
// Match maps on the list
// Alternate spellings
// Correct town name for 'morocc'
// Correct town name for 'xmas'
// Correct town name for 'yuno'
// Original town name for 'gonryun'
// Original town name for 'louyang'
// Easy to remember alternatives to 'new_1-1'
// Easy to remember alternatives to 'sec_pri'
// Original town name for 'rachel'
// Warped.
// Map not found.
// Invalid location number or name.
/*==========================================
// Please specify a display name or monster name/id.
//All data can be left as it is.
//Here, it is possible name was not given and we are using monster for it.
//Blank mob's name.
//All data can be left as it is.
//As before, name may be already filled.
// Give a display name and monster name/id please.
// check name first (to avoid possible name beginning by a number)
// Invalid monster ID or name.
// If value of atcommand_spawn_quantity_limit directive is greater than or equal to 1 and quantity of monsters is greater than value of the directive
// calculation of an odd number (+ 4 area around)
// All monster summoned!
// %d monster(s) summoned!
// Invalid monster ID or name.
/*==========================================
//Do not touch WoE mobs!
// All monsters killed!
/*==========================================
// Please enter a position and an amount (usage: @refine <equip position> <+/- amount>).
// %d: Refine All Equip (Shadow)
// %d: Refine All Equip (Costume)
// %d: Refine All Equip (General)
// %d: Headgear (Low)
// Hand (Right)
// %d: Garment
// Accessory (Left)
// %d: Body Armor
// Hand (Left)
// %d: Shoes
// Accessory (Right)
// %d: Headgear (Top)
// %d: Headgear (Mid)
// %d: Costume Headgear (Top)
// %d: Costume Headgear (Mid)
// %d: Costume Headgear (Low)
// %d: Costume Garment
// %d: Shadow Armor
// %d: Shadow Weapon
// %d: Shadow Shield
// %d: Shadow Shoes
// %d: Shadow Accessory (Right)
// %d: Shadow Accessory (Left)
/* can't equip ammo */
// No item has been refined.
// 1 item has been refined.
// %d items have been refined.
/*==========================================
// Please enter at least one item name/ID (usage: @produce <equip name/ID> <element> <# of very's>).
//This item is not an equipment.
// The item (%d: '%s') is not equipable.
/*==========================================
// "Your current memo positions are:"
// %d - void
// Please enter a valid position (usage: @memo <memo_position:%d-%d>).
/*==========================================
/*==========================================
// Please enter a status type/flag (usage: @displaystatus <status type> <flag> <tick> {<val1> {<val2> {<val3>}}}).
/*==========================================
// Please enter a number (usage: @stpoint <number of points>).
// Number of status points changed.
// Unable to decrease the number/value.
// Unable to increase the number/value.
/*==========================================
// Please enter a number (usage: @skpoint <number of points>).
// Number of skill points changed.
// Unable to decrease the number/value.
// Unable to increase the number/value.
/*==========================================
// Please enter an amount (usage: @zeny <amount>).
// Unable to increase the number/value.
// Unable to decrease the number/value.
//ret != 0 means cmd failure
/*==========================================
//we don't use direct initialization because it isn't part of the c standard.
// Please enter a valid value (usage: @str/@agi/@vit/@int/@dex/@luk <+/-adjustment>).
// normally impossible...
// Please enter a valid value (usage: @str/@agi/@vit/@int/@dex/@luk <+/-adjustment>).
// Stat changed.
// Achievements [Smokexyz/Hercules]
// Unable to decrease the number/value.
// Unable to increase the number/value.
/*==========================================
//we don't use direct initialization because it isn't part of the c standard.
// if at least 1 stat modified
// All stats changed!
// You cannot decrease that stat anymore.
// You cannot increase that stat anymore.
/*==========================================
// Please enter a valid level (usage: @guildlvup/@guildlvlup <# of levels>).
// You're not in a guild.
// By enabling this, only the guild leader can use this command
// You're not the master of your guild.
// 0
// fix positive overflow
// fix negative overflow
// Guild level changed.
// Guild level change failed.
/*==========================================
// Please enter a monster/egg name/ID (usage: @makeegg <pet>).
// for egg name
// for monster name
// The monster/egg name/id doesn't exist.
/*==========================================
// You already have a pet.
/*==========================================
// Please enter a valid value (usage: @petfriendly <0-1000>).
// Sorry, but you have no pet.
// An invalid number was specified.
// Pet intimacy is already at maximum.
// Pet intimacy changed.
/*==========================================
// Please enter a valid number (usage: @pethungry <0-100>).
// Sorry, but you have no pet.
// An invalid number was specified.
// Pet hunger is already at maximum.
// Pet hunger changed.
/*==========================================
// Sorry, but you have no pet.
// You can already rename your pet.
// You can now rename your pet.
/*==========================================
// Please enter a player name (usage: @recall <char name/ID>).
// Character not found.
// Your GM level doesn't authorize you to preform this action on the specified player.
// You are not authorized to warp someone to this map.
// You are not authorized to warp this player from their map.
// %s recalled!
/*==========================================
// Please enter a player name (usage: @block <char name>).
// Character name sent to char-server to ask it.
/*==========================================
// Please enter ban time and a player name (usage: @ban <time> <char name>).
// Invalid time for ban command.
/**
// You are not allowed to reduce the length of a ban.
// Character name sent to char-server to ask it.
/*==========================================
// Please enter a player name (usage: @unblock <char name>).
// send answer to login server via char-server
// Character name sent to char-server to ask it.
/*==========================================
// Please enter a player name (usage: @unban <char name>).
// send answer to login server via char-server
// Character name sent to char-server to ask it.
/*==========================================
// Night mode is already enabled.
/*==========================================
// Day mode is already enabled.
/*==========================================
// The holy messenger has given judgment.
// Judgment was made.
/*==========================================
// The holy messenger has given judgment.
// Judgment was made.
/*==========================================
// Mercy has been shown.
/*==========================================
// Mercy has been granted.
/*==========================================
// Mercy has been granted.
/*==========================================
// Please enter a player name (usage: @kick <char name/ID>).
// Character not found.
// Your GM level don't authorize you to do this action on this player.
/*==========================================
// you can kick only lower or same gm level
// All players have been kicked!
/*==========================================
// all skills
// 0 skill points
// update
// All skills have been added to your skill tree.
/*==========================================
// also send a list of skills applicable to this command
// attempt to find the text corresponding to this command
// send the error message as always
// Please enter a quest skill number.
// send the skill ID list associated with this command
// This skill number doesn't exist.
// This skill number doesn't exist or isn't a quest skill.
// You already have this quest skill.
// You have learned the skill.
/*==========================================
// also send a list of skills applicable to this command
// attempt to find the text corresponding to this command
// send the error message as always
// Please enter a quest skill number.
// send the skill ID list associated with this command
// This skill number doesn't exist.
// This skill number doesn't exist or isn't a quest skill.
// You don't have this quest skill.
// You have forgotten the skill.
/*==========================================
// Please enter an amount (usage: @spiritball <number: 0-%d>).
// no message, player can look the difference
/*==========================================
// Please enter a party name (usage: @party <party_name>).
/*==========================================
// Please enter a guild name (usage: @guild <guild_name>).
// Check if the player has a guild
// Search the guild
// Check if guild was found
// Check if player is guild master
// Break guild
// Check if anything went wrong
// Guild was broken
// Something went wrong
// Not guild master
// You need to be a Guild Master to use this command.
// Guild was not found. HOW?
// You are not in a guild.
// Player does not have a guild
// You are not in a guild.
/*==========================================
// War of Emperium is currently in progress.
// War of Emperium has been initiated.
/*==========================================
// "War of Emperium SE is currently in progress."
// "War of Emperium SE has been initiated."
/*==========================================
// War of Emperium is currently not in progress.
// War of Emperium has been ended.
/*==========================================
// "War of Emperium SE is currently not in progress."
// "War of Emperium SE has been ended."
/*==========================================
/*==========================================
// Please enter part of an item name (usage: @idsearch <part_of_item_name>).
// Search results for '%s' (name: id):
// %s: %d
// %d results found.
/*==========================================
// You are not authorized to warp someone to your current map.
// Don't waste time warping the character to the same place.
//Wake them up
// All characters recalled!
// Because you are not authorized to warp from some maps, %d player(s) have not been recalled.
/*==========================================
// Please enter a guild name/ID (usage: @guildrecall <guild_name/ID>).
// You are not authorized to warp someone to your current map.
// name first to avoid error when name begin with a number
// Incorrect name/ID, or no one from the guild is online.
// Skip GMs greater than you...             or chars already on the cell
// All online characters of the %s guild have been recalled to your position.
// Because you are not authorized to warp from some maps, %d player(s) have not been recalled.
/*==========================================
// Please enter a party name/ID (usage: @partyrecall <party_name/ID>).
// You are not authorized to warp someone to your current map.
// name first to avoid error when name begin with a number
// Incorrect name or ID, or no one from the party is online.
// Skip GMs greater than you...             or chars already on the cell
// All online characters of the %s party have been recalled to your position.
// Because you are not authorized to warp from some maps, %d player(s) have not been recalled.
/*==========================================
// Item database has been reloaded.
/*==========================================
// Monster database has been reloaded.
/*==========================================
// Skill database has been reloaded.
/*==========================================
// Error reading groups.conf, reload failed.
// Error reading atcommand.conf, reload failed.
/*==========================================
// Exp or Drop rates changed.
//Needed as well so rate changes take effect.
/*==========================================
/*==========================================
/*==========================================
//atcommand_broadcast( fd, sd, "@broadcast", "Server is reloading scripts..." );
//atcommand_broadcast( fd, sd, "@broadcast", "You will feel a bit of lag at this point !" );
// reload config files seeking for npcs
// Scripts have been reloaded.
/*==========================================
// Please enter at least one valid list number (usage: @mapinfo <0-3> <map>).
// Map not found.
//This one shouldn't fail since the previous seek did not.
// ------ Map Info ------
// count chats (for initial message)
// Map: %s (Zone:%s) | Players: %d | NPCs: %d | Chats: %d | Vendings: %d
// ------ Map Flags ------
// Town Map
// Autotrade Enabled
// Autotrade Disabled
// Battlegrounds ON
// CvC ON
// PvP Flags:
// Pvp ON |
// NoGuild |
// NoParty |
// NightmareDrop |
// NoCalcRank |
// GvG Flags:
// GvG ON |
// GvG Dungeon |
// GvG Castle |
// NoParty |
// Teleport Flags:
// NoTeleport |
// Monster NoTeleport |
// NoWarp |
// NoWarpTo |
// NoReturn |
// NoMemo |
// No Exp Penalty: %s | No Zeny Penalty: %s
// On / Off
// No Save (Return to last Save Point)
// No Save, Save Point: %s,Random
// No Save, Save Point: %s,%d,%d
// Weather Flags:
// Snow |
// Fog |
// Sakura |
// Clouds |
// Clouds2 |
// Fireworks |
// Leaves |
// Displays Night |
// Other Flags:
// NoBranch |
// NoTrade |
// NoVending |
// NoDrop |
// NoSkill |
// NoIcewall |
// AllowKS |
// Reset |
// Other Flags:
// NoCommand |
// NoBaseEXP |
// NoJobEXP |
// NoMobLoot |
// NoMVPLoot |
// PartyLock |
// GuildLock |
// NoAutoloot |
// NoViewID |
// PrivateAirshipStartable |
// PrivateAirshipEndable |
// Do nothing. It's list 0, no additional display.
// ----- Players in Map -----
// Player '%s' (session #%d) | Location: %d,%d
// ----- NPCs in Map -----
// North
// North West
// West
// South West
// South
// South East
// East
// North East
// North
// Unknown
// NPC %d: %s | Direction: %s | Sprite: %d | Location: %d %d
// NPC %d: %s::%s | Direction: %s | Sprite: %d | Location: %d %d
// ----- Chats in Map -----
// Chat: %s | Player: %s | Location: %d %d
//    Users: %d/%d | Password: %s | Public: %s
// Yes / No
// normally impossible to arrive here
// Please enter at least one valid list number (usage: @mapinfo <0-3> <map>).
/*==========================================
// Cannot mount while in disguise.
// You are already mounting something else
// You need %s to mount!
// You have mounted your Dragon.
// You have released your Dragon.
// You need %s to mount!
// You have mounted your Warg.
// You have released your Warg.
// You have mounted your Mado Gear.
// You have released your Mado Gear.
// if actually no peco
// You need %s to mount!
// You have mounted a Peco Peco.
//Dismount
// You have released your Peco Peco.
// Your class can't mount!
/*==========================================
// The mapserver has spy command support disabled.
// Please enter a guild name/ID (usage: @guildspy <guild_name/ID>).
// name first to avoid error when name begin with a number
// No longer spying on the %s guild.
// Spying on the %s guild.
// Incorrect name/ID, or no one from the specified guild is online.
/*==========================================
// The mapserver has spy command support disabled.
// Please enter a party name/ID (usage: @partyspy <party_name/ID>).
// name first to avoid error when name begin with a number
// No longer spying on the %s party.
// Spying on the %s party.
// Incorrect name/ID, or no one from the specified party is online.
/*==========================================
// All items have been repaired.
// No item need to be repaired.
/*==========================================
// Please enter a player name (usage: @nuke <char name>).
// you can kill only lower or same GM level
// Player has been nuked!
// Your GM level don't authorize you to do this action on this player.
// Character not found.
/*==========================================
// Please enter a NPC name (usage: @tonpc <NPC_name>).
// Warped.
// This NPC doesn't exist.
/*==========================================
// Please enter a NPC name (usage: @enablenpc <NPC_name>).
// Npc Enabled.
// This NPC doesn't exist.
/*==========================================
// Please enter a NPC name (usage: @hidenpc <NPC_name>).
// This NPC doesn't exist.
// Npc Disabled.
// Please enter a script file name (usage: @loadnpc <file name>).
// check if script file exists
// add to list of script sources and run it
// Please enter a NPC name (usage: @npcoff <NPC_name>).
// This NPC doesn't exist.
// Npc Disabled.
/// Unload existing NPC within the NPC file and reload it.
/// Usage: @reloadnpc npc/sample_npc.txt
// Usage: @unloadnpcfile <file name>
// File unloaded. Be aware that mapflags and monsters spawned directly are not removed.
// check if script file exists
// add to list of script sources and run it
// File not found.
/*==========================================
// %d day
// %d days
// %d hour
// %d hours
// %d minute
// %d minutes
// and %d second
// and %d seconds
/*==========================================
// variable for number of seconds (used with time() function)
// variable for time in structure ->tm_mday, ->tm_sec, ...
// get time in seconds since 1/1/1970
// convert seconds in structure
// like sprintf, but only for date/time (Sunday, November 02 2003 15:12:52)
// Server time (normal time): %A, %B %d %Y %X.
// Game time: The game is actually in daylight for %s.
// Game time: After, the game will be in night for %s.
// Game time: After, the game will be in night for %s.
// Game time: The game is actually in night for %s.
// Game time: After, the game will be in daylight for %s.
// Game time: After, the game will be in daylight for %s.
// Game time: A day cycle has a normal duration of %s.
// Game time: The game is in permanent daylight.
// Game time: The game is in permanent night.
//Added by Coltaro
//We're using this function here instead of using time_t so that it only counts player's jail time when he/she's online (and since the idea is to reduce the amount of minutes one by one in status->change_timer...).
//Well, using time_t could still work but for some reason that looks like more coding x_x
//12*30*24*60 = 518400
//30*24*60 = 43200
//24*60 = 1440
/*==========================================
// Please enter a player name (usage: @jail <char_name>).
// Character not found.
// you can jail only lower or same GM
// Your GM level don't authorize you to do this action on this player.
// Player warped in jails.
//Jail Locations
//Duration of INT_MAX to specify infinity.
// You have been jailed by a GM.
// Player warped in jails.
/*==========================================
// Please enter a player name (usage: @unjail/@discharge <char_name>).
// Character not found.
// you can jail only lower or same GM
// Your GM level don't authorize you to do this action on this player.
// This player is not in jails.
//Reset jail time to 1 sec.
// A GM has discharged you from jail.
// Player unjailed.
//Usage: @jailfor <time> <character name>
// Invalid time for jail command.
// Character not found.
// Your GM level don't authorize you to do this action on this player.
//In minutes
// Invalid time for jail command.
//Added by Coltaro
//Update the player's jail time
// GM has discharge you.
// Player unjailed
//%s in jail for %d years, %d months, %d days, %d hours and %d minutes
//This player is now in jail for %d years, %d months, %d days, %d hours and %d minutes
//Jail locations, add more as you wish.
//Jail #1
//Default Jail
//jailtime = 0: Time was reset to 0. Wait 1 second to warp player out (since it's done in status->change_timer).
//By Coltaro
// You are not in jail.
// You have been jailed indefinitely.
// Was not jailed with @jailfor (maybe @jail? or warped there? or got recalled?)
// You have been jailed for an unknown amount of time.
//Get remaining jail time
// You will remain in jail for %d years, %d months, %d days, %d hours and %d minutes
/*==========================================
// Please enter a Monster/NPC name/ID (usage: @disguise <name/ID>).
//Acquired an ID
//Invalid id for either mobs or npcs.
//Acquired a Name
// Invalid Monster/NPC name/ID specified.
// Character cannot be disguised while mounted.
// Character cannot be disguised while in monster form.
// Disguise applied.
/*==========================================
// Please enter a Monster/NPC name/ID (usage: @disguiseall <name/ID>).
// check name first (to avoid possible name begining by a number)
//if mob or npc...
// Monster/NPC name/id not found.
// Disguise applied.
/*==========================================
// Please enter a mob name/ID and guild name/ID (usage: @disguiseguild <mob name/ID>, <guild name/ID>).
// Monster/NPC name/id hasn't been found.
// Incorrect name/ID, or no one from the guild is online.
// Disguise applied.
/*==========================================
// Disguise removed.
// You're not disguised.
/*==========================================
// Disguise removed.
/*==========================================
// Please enter guild name/ID (usage: @undisguiseguild <guild name/ID>).
// Incorrect name/ID, or no one from the guild is online.
// Disguise removed.
/*==========================================
// Base Level: %d (%.3f%%) | Job Level: %d (%.3f%%)
/*==========================================
// Please enter a message (usage: @broadcast <message>).
/*==========================================
// Please enter a message (usage: @localbroadcast <message>).
/*==========================================
// Please enter two e-mail addresses (usage: @email <current@email> <new@email>).
// Invalid e-mail. If your email hasn't been set, use a@a.com.
// Invalid new email. Please enter a real e-mail address.
// New email must be a real e-mail address.
// New e-mail must be different from the current e-mail address.
// Information sended to login-server via char-server.
/*==========================================
// Please enter an effect number (usage: @effect <effect number>).
// Your effect has changed.
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
// Usage: @npcmove <X> <Y> <npc_name>
// This NPC doesn't exist.
// NPC is not in this map.
//Not on a map.
// NPC moved.
/*==========================================
// Usage: @addwarp <mapname> <X> <Y> <npc name>
// Unknown map '%s'.
// New warp NPC '%s' created.
/*==========================================
// Follow mode OFF.
// Character not found.
// Follow mode OFF.
// Follow mode ON.
/*==========================================
// %d items are dropped (%d skipped)!
/*==========================================
//Open storage.
// You currently cannot open your storage.
// "Storage has not been loaded yet"
// All items stored.
// "Storage has not been loaded yet"
// we skip the already deleted items.
// Your storage was cleaned.
// Doesn't have opened @gstorage yet, so we skip the deletion since *shouldn't* have any item there.
// Lock @gstorage: do not allow any item to be retrieved or stored from any guild member
// Cleaning done, release lock
// Your guild storage was cleaned.
// You do not have a cart to be cleaned.
// You can't clean a cart while vending!
// Your cart was cleaned.
/*==========================================
/* "skill " (6) + "%d:" (up to 5) + "%s" (up to 30) + " (%s)" (up to 33) */
// Please enter a skill name to look up (usage: @skillid <skill name>).
// skill %d: %s (%s)
// -- Displaying first %d partial matches
/* partials */
/*==========================================
// Usage: @useskill <skill ID> <skill level> <target>
//quick keyword
// Character not found.
// Your GM level don't authorized you to do this action on this player.
// (If used with @useskill, put the homunc as dest)
/*==========================================
// Usage: @displayskill <skill ID> {<skill level>}
/*==========================================
// Usage: @skilltree <skill ID> <target>
// Character not found.
// Player is using %s skill tree (%d basic points).
// The player cannot use that skill.
// Player requires level %d of skill %s.
// The player meets all the requirements for that skill.
// Hand a ring with partners name on it to this char
/*==========================================
// Usage: @marry <char name>
// They are married... wish them well.
//wedding effect and music [Lupus]
// Auto-give named rings (Aru)
// The two cannot wed because one is either a baby or already married.
/*==========================================
// '%s' is not married.
// '%s' and his/her partner are now divorced.
/*==========================================
// Usage: @changelook {<position>} <view id>
// Position: 1-Top 2-Middle 3-Bottom 4-Weapon 5-Shield 6-Shoes 7-Robe
// position not defined, use HEAD_TOP as default
// swap
/*==========================================
// Autotrade is not allowed in this map.
// You cannot autotrade when dead.
//check if player is vending or buying
// "You should have a shop open in order to use @autotrade."
/* currently standalone is not supporting buyingstores, so we rely on the previous method */
/** state will enter pre-save, we use it to rule out some criterias **/
/* we fail to not cause it to proceed on is_atcommand */
/*==========================================
// You need to be a Guild Master to use this command.
// You cannot change guild leaders in this map.
// Usage: @changegm <guild_member_name>
// Target character must be online and be a guild member.
/*==========================================
// Usage: @changeleader <party_member_name>
/*==========================================
//Shouldn't happen
// Usage: @partyoption <pickup share: yes/no> <item distribution: yes/no>
// TODO: Add documentation for these values
//Change item share type.
/*==========================================
// autoloot command without value
// Autolooting items with drop rates of %0.02f%% and below.
// Autoloot is now off.
/*==========================================
// 1=add, 2=remove, 3=help+list (default), 4=reset
// add or remove
// No items founds in the DB with Id or Name
// Item not found.
// You're already autolooting this item.
// Your autolootitem list is full. Remove some items first with @autolootid -<item name or ID>.
// Autoloot Activated
// Autolooting item: '%s'/'%s' {%d}
// You're currently not autolooting this item.
// Removed item: '%s'/'%s' {%d} from your autolootitem list.
// You can have %d items on your autolootitem list.
// To add an item to the list, use "@alootid +<item name or ID>". To remove an item, use "@alootid -<item name or ID>".
// "@alootid reset" will clear your autolootitem list.
// Your autolootitem list is empty.
// Items on your autolootitem list:
// Your autolootitem list has been reset.
/*==========================================
// 1=add, 2=remove, 3=help+list (default), 4=reset
// add or remove
// Item type not found.
// You're already autolooting this item type.
// Stores the type
// Autolooting item type: '%s'
// You're currently not autolooting this item type.
// Removed item type: '%s' from your autoloottype list.
// Invalid location number, or name.
// attempt to find the text help string
// send the text to the client
// Your autoloottype list is empty.
// Item types on your autoloottype list:
// Your autoloottype list has been reset.
/*==========================================
// Snow has stopped falling.
// It has started to snow.
/*==========================================
// Cherry tree leaves no longer fall.
// Cherry tree leaves have begun to fall.
/*==========================================
// The clouds has disappear.
// Clouds appear.
/*==========================================
// The alternative clouds disappear.
// Alternative clouds appear.
/*==========================================
// The fog has gone.
// Fog hangs over.
/*==========================================
// Leaves no longer fall.
// Fallen leaves fall.
/*==========================================
// Fireworks have ended.
// Fireworks have launched.
/*==========================================
// "Weather effects will disappear after teleporting or refreshing."
/*===============================================================
// Please enter a sound filename (usage: @sound <filename>).
/*==========================================
// Please enter a monster name (usage: @mobsearch <monster name>).
// Invalid mob ID %s!
// DEFAULT_MOB_JNAME
//strcpy(mob_name,mob->db(mob_id)->name); // DEFAULT_MOB_NAME
// Mob Search... %s %s
/*==========================================
// All dropped items have been cleaned up.
// All dropped items have been cleaned up.
/*==========================================
// Please enter the correct parameters (usage: @npctalk <npc name>, <message>).
// Please enter the correct parameters (usage: @npctalkc <color> <npc name>, <message>).
// This NPC doesn't exist
// discard extra name identifier if present
// Please enter a message (usage: @pettalk <message>).
// pet emotion processing
// randomize /dice
// not more than 1 per second
/// @users - displays the number of players present on each map (and percentage)
/// #users displays on the target user instead of self
// count users on each map
// invalid mapindex
// display results for each map
// empty
// display overall count
/*==========================================
// '%s' skill and stats points reseted!
/*==========================================
// Please enter a monster name (usage: @summon <monster name> {duration}).
// Invalid monster ID or name.
// All monster summoned!
/*==========================================
// Usage: @adjgroup <group_id>
// Specified group does not exist.
// Group changed successfully.
// Your group has changed.
/*==========================================
// Please enter a player name (usage: @trade <char name>).
// Character not found.
/*==========================================
// Usage: @setbattleflag <flag> <value>
// Unknown battle_config flag.
// Set battle_config as requested.
/*==========================================
// Please enter a player name (usage: @unmute <char name>).
// Character not found.
// Player is not muted.
// Player unmuted.
/*==========================================
/*==========================================
// to avoid any problem with equipment and invalid sex, equipment is unequipped.
// to avoid any problem with equipment and invalid sex, equipment is unequipped.
/*================================================
// Usage: @mute <time> <char name>
// Character not found.
// Your GM level don't authorize you to do this action on this player.
/*==========================================
/*==========================================
// There are no items to appraise.
/*==========================================
/*==========================================
// Please enter a monster name/ID (usage: @mobinfo <monster_name_or_monster_ID>).
// If monster identifier/name argument is a name
// Invalid monster ID or name.
// stats
// MVP Monster: '%s'/'%s'/'%s' (%d)
// Monster: '%s'/'%s'/'%s' (%d)
//  Lv:%d  HP:%d  Base EXP:%u  Job EXP:%u  HIT:%d  FLEE:%d
//  DEF:%d  MDEF:%d  STR:%d  AGI:%d  VIT:%d  INT:%d  DEX:%d  LUK:%d
//  ATK : %d~%d MATK : %d~%d Range : %d~%d~%d  Size : %s  Race : %s  Element : %s(Lv : %d)
//  ATK:%d~%d  Range:%d~%d~%d  Size:%s  Race: %s  Element: %s (Lv:%d)
// drops
//  Drops:
// This monster has no drops.
// mvp
//  MVP Bonus EXP:%u
//  MVP Items:
// This monster has no MVP prizes.
/*=========================================
// Please enter a mob name/id (usage: @showmobs <mob name/id>)
// Invalid mob name %s!
// Invalid mob id %s!
// If player group does not have access to boss mobs.
// Can't show boss mobs!
// DEFAULT_MOB_JNAME
//strcpy(mob_name,mob->db(mob_id)->name); // DEFAULT_MOB_NAME
// Mob Search... %s %s
// hide slaves and player summoned mobs
// hide mobs waiting for respawn
/*==========================================
// Please enter a level adjustment (usage: @homlevel <number of levels>).
// You do not have a homunculus.
// Homun reached its maximum level of '%d'
// Homun reached its maximum level of '%d'
/*==========================================
// You do not have a homunculus.
// Your homunculus doesn't evolve.
// You do not have a homunculus.
/*==========================================
// Please enter a homunculus ID (usage: @makehomun <homunculus id>).
// Invalid Homunculus ID.
/*==========================================
// You do not have a homunculus.
// Please enter a friendly value (usage: @homfriendly <friendly value [0-1000]>).
/*==========================================
// You do not have a homunculus.
// Please enter a hunger value (usage: @homhungry <hunger value [0-100]>).
/*==========================================
// You do not have a homunculus.
// Please enter a message (usage: @homtalk <message>).
/*==========================================
// You do not have a homunculus.
// Homunculus stats:
// HP: %d/%d - SP: %d/%d
// ATK: %d - MATK: %d~%d
// Hungry: %d - Intimacy: %u
// Stats: Str %d / Agi %d / Vit %d / Int %d / Dex %d / Luk %d
// You do not have a homunculus.
// Homunculus growth stats (Lv %d %s):
//Since the first increase is at level 2.
// Max HP: %d (%d~%d)
// Max SP: %d (%d~%d)
// Str: %d (%d~%d)
// Agi: %d (%d~%d)
// Vit: %d (%d~%d)
// Int: %d (%d~%d)
// Dex: %d (%d~%d)
// Luk: %d (%d~%d)
// nothing to do
// Homunculus stats altered.
//Print out the new stats
/*==========================================
// Please enter an item name/ID (usage: @ii/@iteminfo <item name/ID>).
// Invalid item ID or name.
// Displaying first %d out of %d matches
// Item: '%s'/'%s'[%d] (%d) Type: %s | Extra Effect: %s
// None / With script
// NPC Buy:%dz, Sell:%dz | Weight: %.1f
//  - Available in the shops only.
//  - Maximal monsters drop chance: %02.02f%%
//  - Monsters don't drop this item.
/*==========================================
// Please enter item name/ID (usage: @whodrops <item name/ID>).
// Invalid item ID or name.
// Displaying first %d out of %d matches
// Item: '%s'[%d]
//  - Item is not dropped by mobs.
//  - Common mobs with highest drop chance (only max %d are listed):
// Please enter a monster name/ID (usage: @whereis <monster_name_or_monster_ID>).
// If monster identifier/name argument is a name
// Invalid monster ID or name.
// %s spawns in:
// This monster does not spawn normally.
// Hercules %d-bit for %s
// %s revision '%s' (src) / '%s' (scripts)
/*==========================================
// As it is being used [ACMD(mutearea)] there's no need to be a bool, but if there's need to reuse it, it's better to be this way
// Please enter a time in minutes (usage: @mutearea/@stfu <time in minutes>).
// Experience rates: Base %.2fx / Job %.2fx
// Normal Drop Rates: Common %.2fx / Healing %.2fx / Usable %.2fx / Equipment %.2fx / Card %.2fx
// Boss Drop Rates: Common %.2fx / Healing %.2fx / Usable %.2fx / Equipment %.2fx / Card %.2fx
// Other Drop Rates: MvP %.2fx / Card-Based %.2fx / Treasure %.2fx
/*==========================================
// Please enter a message (usage: @me <message>).
// *%s %s*
/*==========================================
// Size change applied.
// Size change applied.
// Please enter guild name/ID (usage: @sizeguild <size> <guild name/ID>).
// Incorrect name/ID, or no one from the guild is online.
// Size change applied.
/*==========================================
// You are now immune to attacks.
// Returned to normal state.
/*==========================================
// Returned to real name.
// You must enter a name.
// Fake name must be at least two characters.
// Another packet should be sent so the client updates the name for sd
// Fake name enabled.
/*==========================================
// Enabled Mapflags in this map:
// Usage: "@mapflag monster_noteleport 1" (0=Off | 1=On)
// Type "@mapflag available" to list the available mapflags.
//lowercase
// Invalid flag name or flag.
// Usage: "@mapflag monster_noteleport 1" (0=Off | 1=On)
// Available Flags:
/*===================================
// Gained exp will not be shown.
// Gained exp is now shown.
// Gained zeny will not be shown.
// Gained zeny is now shown.
// Skill delay failures will not be shown.
// Skill delay failures are now shown.
/*==========================================
// "Duel: @invite without @duel."
// "Duel: Limit of players is reached."
// "Duel: Player not found."
// "Duel: Player already in duel."
// "Duel: You can't invite %s because he/she isn't in the same map."
// "Duel: Invitation has been sent."
// "Duel: @duel without @reject."
// "Duel: You can take part in duel only one time per %d minutes."
// "Duel: Invalid value."
// "Duel: Player already in duel."
// "Duel: Invitation has been sent."
// "Duel: Player not found."
// "Duel: @leave without @duel."
// "Duel: You left the duel."
// "Duel: You can take part in duel only one time per %d minutes."
// "Duel: @accept without invitation."
// "Duel: Limit of players is reached."
// "Duel: Invitation has been accepted."
// "Duel: @reject without invitation."
// "Duel: Invitation has been rejected."
/*===================================
// Please enter an amount.
// If this option is set, the message is already sent by pc function
// Unable to decrease the number/value.
// Unable to decrease the number/value.
// @points
// If this option is set, the message is already sent by pc function
// Unable to decrease the number/value.
// Unable to decrease the number/value.
// @clone/@slaveclone/@evilclone <playername> [Valaris]
// You must enter a player name or ID.
// Character not found.
// Cannot clone a player of higher GM level than yourself.
//"Unable to spawn slave clone."
// You've reached your slave clones limit.
// Evil Clone spawned. Clone spawned. Slave clone spawned.
// Unable to spawn evil clone. Unable to spawn clone. Unable to spawn slave clone.
/*=====================================
// Autorejecting is deactivated.
// Autorejecting is activated.
/*=====================================
// Usage: @request <petition/message to online GMs>.
// (@request): %s
// @request sent.
/*==========================================
// Reset 'Feeling' maps.
// Reset hatred targets [Wolfie]
// Reset 'Hatred' targets.
/*==========================================
/*==========================================
// [ K.S Protection Inactive ]
// Default is Party
// [ K.S Protection Active - Option: Party ]
// [ K.S Protection Active - Option: Self ]
// [ K.S Protection Active - Option: Guild ]
// Usage: @noks <self|party|guild>
/*==========================================
// [ Map K.S Protection Active ]
// [ Map K.S Protection Inactive ]
/*==========================================
// total slots occupied
// total items found
// ------ %s items list of '%s' ------
//  | equipped:
// garment,
// left accessory,
// body/armor,
// right hand,
// left hand,
// both hands,
// feet,
// right accessory,
// lower head,
// top head,
// lower/top head,
// mid head,
// lower/mid head,
// lower/mid/top head,
// remove final ', '
// pet egg
//  -> (pet egg, pet id: %u, named)
//  -> (pet egg, pet id: %u, unnamed)
// forged item
//  -> (crafted item, creator id: %u, star crumbs %d, element %d)
// created item
//  -> (produced item, creator id: %u)
// normal item
//  -> (card(s):
// No item found in this player's %s.
// %d item(s) found in %d %s slots.
//direct array initialization with variables is not standard C compliant.
// '%s' stats:
// Please enter an item name/ID, a quantity, and a player name (usage: #delitem <player> <item_name_or_ID> <quantity>).
// Invalid item ID or name.
// delete items
// delete pet
// notify target
// %d item(s) removed by a GM.
// notify source
// Character does not have the item.
// %d item(s) removed. Player had only %d on %d items.
// %d item(s) removed from the player.
/*==========================================
// Returning to normal font.
// Use @font <1-9> to change your message font.
// Use 0 or no parameter to return to normal font.
// Invalid font. Use a value from 0 to 9.
// Font changed.
// Already using this font.
/*==========================================
// "Available commands:"
// flush the text buffer if this command won't fit into it
// Last Line
// "%d commands found."
/*==========================================
/*==========================================
/* For new mounts */
// You are already mounting something else
// NOTICE: If you crash with mount your LUA is outdated.
// You have mounted.
// You have released your mount.
// Usage: @accinfo/@accountinfo <account_id/char name>
// You may search partial name by making use of '%' in the search, ex. "@accinfo %Mario%" lists all characters whose name contains "Mario".
//remove const type
/* [Ind] */
// Usage: @set <variable name> <value>
// Usage: ex. "@set PoringCharVar 50"
// Usage: ex. "@set PoringCharVarSTR$ Super Duper String"
// Usage: ex. "@set PoringCharVarSTR$" outputs its value, Super Duper String.
/* disabled variable types (they require a proper script state to function, so allowing them would crash the server) */
// NPC variables may not be used with @set.
// Instance variables may not be used with @set.
//Strip quotes.
/* we only set the var if there is an val, otherwise we only output the value */
// string variable
// global
// local
// empty string
// duplicate string
// integer variable
// global
// local
// %s value is now :%d
// %s value is now :%s
// %s is empty
// %s data type is not supported :%u
// Quest database has been reloaded.
// Usage: %s <permission_name>
// -- Permission List
// '%s' is not a known permission.
// -- Permission List
// User '%s' already possesses the '%s' permission.
// User '%s' doesn't possess the '%s' permission.
// -- User '%s' Permissions
// User '%s' permissions updated successfully. The changes are temporary.
// Usage: @unloadnpcfile <file name>
// File unloaded. Be aware that mapflags and monsters spawned directly are not removed.
// File not found.
// Unknown Cart (usage: %s <0-%d>).
// You do not possess a cart to be removed
/* @cart failed */
// Cart Added
/* [Ind/Hercules] */
// Unknown Channel (usage: %s <#channel_name>)
// Unknown Channel '%s' (usage: %s <#channel_name>)
// You're already in the '%s' channel
// '%s' Channel is password protected (usage: %s <#channel_name> <password>)
// You cannot join the '%s' channel because you've been banned from it
/* [Ind/Hercules] */
// %s failed.
// --- Available options:
// -- %s create <channel name> <channel password>
// - creates a new channel
// -- %s list
// - lists public channels
// -- %s list colors
// - lists colors available to select for custom channels
// -- %s setcolor <channel name> <color name>
// - changes <channel name> color to <color name>
// -- %s leave <channel name>
// - leaves <channel name>
// -- %s bindto <channel name>
// - binds global chat to <channel name>, making anything you type in global be sent to the channel
// -- %s unbind
// - unbinds your global chat from its attached channel (if bound)
// -- %s ban <channel name> <character name>
// - bans <character name> from <channel name> channel
// -- %s banlist <channel name>
// - lists all banned characters from <channel name> channel
// -- %s unban <channel name> <character name>
// - unbans <character name> from <channel name> channel
// -- %s unbanall <channel name>
// - unbans everyone from <channel name>
// -- %s setopt <channel name> <option name> <option value>
// - adds or removes <option name> with <option value> to <channel name> channel
/* [Ind/Hercules] */
// sub1 = channel name; sub2 = password; sub3 = unused
// Channel name must start with a '#'
// Channel length must be between 3 and %d
// Channel password may not contain spaces
// Channel '%s' is not available
// sub1 = list type; sub2 = unused; sub3 = unused
// -- Public Channels
// - #%s ( %d users )
// - #%s ( %d users )
// - #%s ( %d users )
// sub1 = channel name; sub2 = color; sub3 = unused
// Channel name must start with a '#'
// Channel '%s' is not available
// You're not the owner of channel '%s'
// Unknown color '%s'
// '%s' channel color updated to '%s'
// sub1 = channel name; sub2 = unused; sub3 = unused
// Channel name must start with a '#'
// You're not part of the '%s' channel
// Loop downward to avoid issues when channel->leave() compacts the array
// You've left the '%s' channel
// sub1 = channel name; sub2 = unused; sub3 = unused
// Channel name must start with a '#'
// You're not part of the '%s' channel
// Your global chat is now bound to the '%s' channel
// sub1 = unused; sub2 = unused; sub3 = unused
// Your global chat is not bound to any channel
// Your global chat is no longer bound to the '#%s' channel
// sub1 = channel name; sub2 = unused; sub3 = unused
///< player name
// Channel name must start with a '#'
// Channel '%s' is not available
// Player '%s' was not found
// Player '%s' was not found
// You're not the owner of channel '%s'
// Player '%s' is already banned from this channel
/*ret == HCS_STATUS_FAIL*/) {
// Ban failed, not possible to ban this user.
// Player '%s' has now been banned from '%s' channel
// sub1 = channel name; sub2 = unused; sub3 = unused
///< player name
// Channel name must start with a '#'
// Channel '%s' is not available
// Player '%s' was not found
// Player '%s' was not found
// You're not the owner of channel '%s'
// Player '%s' is not banned from this channel
// Player '%s' has now been unbanned from the '%s' channel
// sub1 = channel name; sub2 = unused; sub3 = unused
// Channel name must start with a '#'
// Channel '%s' is not available
// You're not the owner of channel '%s'
// Channel '%s' has no banned players
// Removed all bans from '%s' channel
// sub1 = channel name; sub2 = unused; sub3 = unused
// Channel name must start with a '#'
// Channel '%s' is not available
// You're not the owner of channel '%s'
// Channel '%s' has no banned players
// -- '%s' ban list
// - %s %s
// - %s (%d)
// sub1 = channel name; sub2 = option name; sub3 = value
// Channel name must start with a '#'
// Channel '%s' is not available
// You're not the owner of channel '%s'
// You need to input a option
// '%s' is not a known channel option
// -- Available options
// - '%s'
// For '%s' you need the amount of seconds (from 0 to 10)
// option '%s' is already enabled, if you'd like to disable it type '@channel setopt %s 0'
//option '%s' is now enabled for channel '%s'
// value '%d' for option '%s' is out of range (limit is 0-%d)
// option '%s' is now disabled for channel '%s'
// option '%s' is now enabled for channel '%s' with %d seconds
// option '%s' is already enabled, if you'd like to disable it type '@channel opt %s 0'
//option '%s' is now enabled for channel '%s'
// option '%s' is not enabled on channel '%s'
// option '%s' is now disabled for channel '%s'
/* debug only, delete after */
// Unknown color '%s'
//EFFECTTYPE_NORMAL
//EFFECTTYPE_CASH
/*==========================================
// Costume '%s' removed.
// - Available Costumes
//-- %s
// You're already with a '%s' costume, type '@costume' to remove it.
// '%s' is not a known costume
/* for debugging purposes (so users can easily provide us with debug info) */
/* should be trashed as soon as its no longer necessary */
/**
//reset
/**
/**
/**
/**
// show camera window or change camera parameters
// usage @camerainfo range rotation latitude
/**
/**
// + /hide
// + /recall
// + right click menu for GM "(name) force to quit"
// + /b and /nb
// + /lb and /nlb
/* char-specific ban time */
/* char-specific ban time */
// Should not happen if atcommand_base[] array is OK
/* @commands from plugins */
//caller will handle/display on false
/*==========================================
/// AtCommand suggestion
// Build the matches
// Merge full match and prefix match results
// Build the suggestion string
/**
// Reconstructed message
//sd for target
// false if it's a charcommand
// Shouldn't happen
// Block NOCHAT but do not display it as a normal message
// skip 10/11-langtype's codepage indicator, if detected
// Should display as a normal message
// Commands are disabled on maps flagged as 'nocommand'
// *pcblock script command
// #command
// @command
// Checks to see if #command has a name or a name + parameters.
// no command found. Display as normal message
/* if we can't use or doesn't exist: don't even display the command failed message */
// Charcommand failed (usage: %c<command> <char name> <parameters>).
// %s failed. Player not found.
//Clearing these to be used once more.
//check to see if any params exist within this command
// @commands (script based)
// Get atcommand binding
// Check if the binding isn't NULL and there is a NPC event, level of usage met, et cetera
/* log only if this command should be logged [Ind/Hercules] */
//Grab the command information and check for the proper GM level required to use it or if the command exists
// TODO: remove or replace with proper permission
// "%s is Unknown Command."
// You can't use commands while dead
/* already found the matching command, no need to keep checking -- just go on */
//Attempt to use the command
/* autotrade deletes caster, so we got nothing more to do here */
// %s failed.
// info->log cant be used here, because info can be freed [4144]
/* log only if this command should be logged [Ind/Hercules] */
/*==========================================
// Command symbols
// no control characters
// symbol of client commands
// symbol of party chat
// symbol of guild chat
// no control characters
// symbol of client commands
// symbol of party chat
// symbol of guild chat
// Command aliases
// Commands help
// We only check if all commands exist
/**
/**
// <commandname> : <bool> (only atcommand)
// <commandname> : [ <bool>, <bool> ] ([ atcommand, charcommand ])
/* if commands are added after group permissions are thrown in, they end up with no permissions */
/* so we restrict commands to be linked in during boot */
/**
//fills initial atcommand_db with known commands
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\battle.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// CELL_NOSTACK, CIRCULAR_AREA, CONSOLE_INPUT, HMAP_ZONE_DAMAGE_CAP_TYPE, OFFICIAL_WALKPATH, RENEWAL, RENEWAL_ASPD, RENEWAL_CAST, RENEWAL_DROP, RENEWAL_EDP, RENEWAL_EXP, RENEWAL_LVDMG, RE_LVL_DMOD(), RE_LVL_MDMOD(), RE_LVL_TMDMOD(), RE_SKILL_REDUCTION(), SCRIPT_CALLFUNC_CHECK, SECURE_NPCTIMEOUT
/**
/*==========================================
//Returns the id of the current targeted character of the passed bl. [Skotlex]
// Picks a random enemy of the given type (BL_PC, BL_CHAR, etc) within the range given. [Skotlex]
// Ignores Caster and a possible pre-target
// Is Enemy!...
// Pick a random enemy
//Check to see if you haven't teleported. [Skotlex]
// it was monster reflected damage, and the monster died, we pass the damage to the character as expected
// We have to separate here between reflect damage and others [icescope]
//Aegis places a damage-delay cap of 1 sec to non player attacks. [Skotlex]
/*==========================================
//since an atk can only have one type let's optimize this a bit
// free to move now
// double damage
//150%
//end tsc check
// [malufett]
//FIXME: Missing documentation for flag, flag2
// Temporary. [malufett]
/* fall through */
/**
// attacker side
// target side
/*==========================================
// TODO: Check whether these values are correct (the flag parameter seems to be passed through to other functions), and replace them with an enum.
/* 'battle_calc_base_damage' is used on renewal, 'battle_calc_base_damage2' otherwise. */
// FIXME: Missing documentation for flag2
// Property from mild wind bypasses it
//Mobs/Pets
//PCs
//Normal attacks
//Bows
//Weapon Damage calculation
//rodatazone says the range is 0~arrow_atk-1 for non crit
//SizeFix only for players
//Finally, add baseatk
//rodatazone says that Overrefined bonuses are part of baseatk
//Here we also apply the weapon_atk_rate bonus so it is correctly applied on left/right hands.
//Right hand
//SizeFix only for players
/*==========================================
// FIXME: type is undocumented
//This bonus doesn't work against players.
//damage += (skill_lv * 3);
// No break, fall through to Knuckles
/*==========================================
// specific skill masteries
//(Caster Current Weight x 10 / 8)
/* Fall through */
// sc considered as masteries
//else no bonus for large target
// 0
// RENEWAL
// general skill masteries
// div fix
//The finger offensive spheres on moment of attack do count. [Skotlex]
// Only Shield boomerang doesn't takes the Star Crumbs bonus.
/*+ unknown value*/)  / 100 /*+ unknown value*/;
// Adv Katar Mastery is does not applies to ASC_BREAKER, but other masteries DO apply >_>
// percentage factor masteries
//Star anger
//Star Anger
/*==========================================
// FIXME: flag is undocumented
//Cart Revolution applies the element fix once more with neutral element
//Additional 50*lv Neutral damage.
// Descriptions indicate this means adding a percent of a normal attack in another element. [Skotlex]
// RaceAddTolerance
// SubRangeAttackDamage or bLongAtkDef
/*==========================================
// FIXME: wflag is undocumented
// Target cards.
//It was discovered that ranged defense also counts vs magic! [Skotlex]
// Melee attack
// Target side
// BF_LONG (there's no other choice)
// misc damage reduction from equipment
// BF_LONG (there's no other choice)
/*==========================================
// TODO: Add an enum for flag
/* Take note in RE
//Don't use tstatus->def1 due to skill timer reductions.
// equip def(RE)
// status def(RE)
// equip def(RE)
// status def(RE)
// hidden from status window
// 5% per level
// Assume type 2
// Acid Terror ignores only armor defense. [Skotlex]
//Vitality reduction from rodatazone: http://rodatazone.simgaming.net/mechanics/substats.php#def
//Sd vit-eq
//[VIT*0.5] + rnd([VIT*0.3], max([VIT*0.3],[VIT^2/150]-1))
//This bonus already doesn't work vs players
// [orn]
//Mob-Pet vit-eq
//VIT + rnd(0,[VIT/20]^2-1)
/**
// it stops at -399
// in aegis it set to 1 but in our case it may lead to exploitation so limit it to 399
//return 1;
// status mdef(RE)
// equip mde(RE)
// status mdef(RE)
// equip mde(RE)
//mdef2-= mdef2* i/100;
/**
// it stops at -99
// in aegis it set to 1 but in our case it may lead to exploitation so limit it to 99
//return 1;
// Minstrel/Wanderer number check for chorus skills.
// Bonus remains 0 unless 3 or more Minstrel's/Wanderer's are in the party.
// Maximum effect possible from 7 or more Minstrel's/Wanderer's
// Effect bonus from additional Minstrel's/Wanderer's if not above the max possible
// FIXME: flag is undocumented
/**
//Does 5x damage include bonuses from other skills?
//200% MATK each hit
//20% MATK each hit
//target size must be small (0) for full damage.
//Full damage is dealt on small/medium targets
//Base damage is 40% + lv%
/* Fall through */
/**
/**
/**
// MATK [{( Skill Level + 4 ) x 100 ) + ( Caster's INT )} x ( Caster's Base Level / 100 )] %
// MATK [{( Skill Level x 100 ) + 200 } x ( Caster's Base Level / 100 )] %
// Shadow: MATK [{( Skill Level x 300 ) x ( Caster Base Level / 100 ) x 4/5 }] %
// Fire : MATK [{( Skill Level x 300 ) x ( Caster Base Level / 100 ) /5 }] %
// 7 x 7 cell
// 11 x 11 cell
// 15 x 15 cell
// 19 x 19 cell
// just limit it to 5
//MATK [{( Skill Level x 400 ) x ( Caster's Base Level / 120 )} + 2500 ] %
// [(Casters Base Level x 4) + (Shield MDEF x 100) + (Casters INT x 2)] %
// Magical Elemental Spirits Attack Skills
//500:600:700
//700:900
// +1% every 1% weight
//Max damage for non players.
//Overflow check. [Skotlex]
//You'd need something like 6K SP to reach this max, so should be fine for most purposes.
//We leave some room here in case skillratio gets further increased.
// Although not clear, it's being assumed that the 2x damage is only for the break neck ailment.
//Preserve damage ratio when max cart weight is changed.
//Tumble bonus
//Running bonus (TODO: What is the real bonus?)
// Spurt bonus
//Only works well against brute/demi-humans non bosses.
//+100% every 3 cells of distance
// ...but hard-limited to 300%.
//[orn]
//[orn]
/**
//ATK [{(Skill Level x 100) + 300} x Caster's Base Level / 120]% + ATK [(AGI x 2) + (Caster's Job Level x 4)]%
/**
/**
// ATK 300%
/**
// Medium
// Small
// Large
// Will deal 75% damage outside of 5x5 area.
// Prevents ATK damage from being done on LV 2 usage since LV 2 us MATK. [Rytech]
//ATK [{(Skill Level x 100) + (Caster AGI) + 150} x Caster Base Level / 100] %
//ATK [{(Skill Level x 80) + (Caster AGI)} x Caster Base Level / 100] %
// [(Skill Level x 150) x (Caster Base Level / 100) + (Caster INT x 3)] %
//[(Skill Level x 50) x (Caster Base Level / 100) + (Caster INT x 2)] %
// ATK [(Skill Level x 150 + 100) x Caster Base Level / 150] %
// ATK [((Caster consumed HP + SP) / 4) x Caster Base Level / 100] %
// ATK [((Caster consumed HP + SP) / 2) x Caster Base Level / 100] %
// ATK [(Skill Level x 150) + (1000 x Target current weight / Maximum weight) + (Target Base Level x 5) x (Caster Base Level / 150)] %
// ATK [(Skill Level x 100 + 500) x Caster Base Level / 100] %
// ATK [(Caster Base Level + Caster DEX) x Caster Base Level / 100] %
// ATK [{(Skill Level x 200) + Additional Damage} x Caster Base Level / 100] %
//Chorus bonus don't count the first 2 Minstrel's/Wanderer's and only increases when their's 3 or more. [Rytech]
// 1->100; 2->200; 3->400; 4->800; 5->1600
/* Fall through */
// Black Lump
// Hard Black Lump
// Extremely Hard Black Lump
//ATK [{( Striking Level x 50 ) + ( Varetyr Spear Skill Level x 50 )} x Caster Base Level / 100 ] %
// Physical Elemental Spirits Attack Skills
//Skill damage modifiers that stack linearly
//ATK [{Weapon Level * (Weapon Upgrade Level + 6) * 100} + (Weapon ATK) + (Weapon Weight)]%
// 20% chance to destroy the weapon.
/*==========================================
// need check src for null pointer?
//Special no damage states
//This skill bypass everything else.
//First, sc_*'s that reduce damage to 0.
// Gravitation and Pressure do damage without removing the effect
// If used against a player in White Imprison, the skill deals double damage.
// Those skills do damage and removes effect
/**
// {(Maelstrom Skill LevelxAbsorbed Skill Level)+(Caster's Job/5)}/2
// different delay depending on skill level [celest]
// If the target is too far away from the devotion caster, autoguard has no effect
// Autoguard will be disabled later on
// if player is target of devotion, show guard effect on the devotion caster rather than the target
// absorb damage
// There is a chance to be stunned when one shield is broken.
// Shield Down
// Next Shield
// All shields down
// attack blocked by Parrying
//Stand it to dodge.
//Kaupe blocks damage (skill or otherwise) from players, mobs, homuns, mercenaries.
//Shouldn't end until Breaker's non-weapon part connects.
//We make it work like Safety Wall, even though it only blocks 1 time.
// Still need confirm it.
//Both need to be consumed if they are active.
//Now damage increasing effects
// Lex Aeterna only doubles damage of regular attacks from mercenaries
//Shouldn't end until Breaker's non-weapon part connects.
// 1.5 times more damage while in Deep Sleep.
//Finally damage reductions....
// Assumptio doubles the def & mdef on RE mode, otherwise gives a reduction on the final damage. [Igniz]
//Receive 66% damage
//Receive 50% damage
// In pre-re Defender doesn't reduce damage from Acid Demonstration
//25% reduction
//75% reduction
//15% reduction to physical melee attacks
//50% reduction to physical ranged attacks
// Compressed code, fixed by map.h [Epoque]
//NPC_DEFENDER
//100% should be counted as the 80~99% interval
//Uses 20% SP intervals.
//SP Cost: 1% + 0.5% per every 20% SP
//Reduction: 6% + 6% every 20%
// 30% chance to reduce monster's ATK by 25% for 10 seconds.
/**
//Finally added to remove the status of immobile when aimedbolt is used. [Jobbie]
//Finally Kyrie because it may, or not, reduce damage to 0.
// custom value
//Probably not the most correct place, but it'll do here
//(since battle_drain is strictly for players currently)
//add a sphere
// Deadly infect attacked side
//SC effects from caster side.
// [Epoque]
// Oblivion Curse gives a 2nd success chance after the 1st one passes which is reducible. [Rytech]
/* no data claims these settings affect anything other than players */
// Take weapon's element
// Use enchantment's element
// Use random element
//case PA_PRESSURE: /* pressure also belongs to this list but it doesn't reach this area -- so don't worry about it */
/* pressure also belongs to this list but it doesn't reach this area -- so don't worry about it */
//Skills get a different reduction than non-skills. [Skotlex]
//Normal attacks get reductions based on range.
/*==========================================
// FIXME: flag is undocumented
// Crystal cannot receive skill damage on battlegrounds
/*==========================================
// FIXME: flag is undocumented
//No reductions to make.
//Skill immunity.
// [MouseJstr]
/*==========================================
/*==========================================
//Qty check should have been done in skill_check_condition
//Skill Range Criteria
//based on distance between src/target [Skotlex]
//based on used skill's range
//Apply the bonus blow count. [Skotlex]
//For quick div adjustment.
/*==========================================
// FIXME: mflag is undocumented
//Initial Values
//Amotion should be 0 for ground skills.
//Initialize variables that will be used afterwards
// pl=-1 : the skill takes the weapon's element
//Summoning 10 spiritcharm will endow your weapon
//Use status element
//Use random element
//Set miscellaneous data that needs be filled
//Skill Range Criteria
// Reverberation takes 1 damage
//No knockback
//No flinch animation.
//No need to do the math for plants
//reinitialize..
//MATK_RATE scales the damage. 100 = no change. 50 is halved, 200 is doubled, etc
//Adds dmg%. 100 = +100% (double) damage. 10 = +10% damage
//Adds an absolute value to damage. 100 = +100 damage
//Calc base damage according to skill
/**
//Undead check is on skill_castend_damageid code.
// there is no changed in success chance in renewal. [malufett]
/**
//Damage calculation from iRO wiki. [Jobbie]
/**
//Skill dmg modifiers.
// Divide MATK in case of multiple targets skill
// val4 = used bolt level, val2 = used spellfist level. [Rytech]
// ad mods, to make it work similar to regular hits [Xazax]
/* Fall through */
//Constant/misc additions from skills
/* redirect skill */
//Damage bonuses
//Ignore Defense?
//only applies when hit
// TODO: there is another factor that contribute with the damage and need to be formulated. [malufett]
//Apply the physical part of the skill's damage. [Skotlex]
/* post-calc modifiers */
// Physical damage.
//case HM_ERASER_CUTTER:
/*==========================================
// FIXME: mflag is undocumented
//DO NOT CONFUSE with md of mob_data!
//Some initial values
//Attack that takes weapon's element for misc attacks? Make it neutral [Skotlex]
//Use random element
//Skill Range Criteria
//Blitz-beat Damage.
//Autocasted Blitz.
//Div fix of Blitzbeat
//Falcon Assault Modifier
// [malufett]
// FIXME: What's the >> 32 supposed to do here? tmdef and tdef are both 16-bit...
/*
// updated the formula based on a Japanese formula found to be exact [Reddozen]
//crash fix
// Some monsters have totaldef higher than md.damage in some cases, leading to md.damage < 0
//Overflow prevention, will anyone whine if I cap it to a few billion?
//Not capped to INT_MAX to give some room for further damage increase.
//[orn]
//These two are not properties of the weapon based part.
//No flinch animation.
/**
/**
// Divide ATK among targets
//Temp for "hit or no hit"
//Default hitrate
//Default hitrate
// assume type 2: absolute reduction
//in Renewal hit bonus from Vultures Eye is not anymore shown in status window
/* redirect skill id */
/*==========================================
// FIXME: wflag is undocumented
// non-elemental
///< the attack Hit? (not a miss)
///< Critical hit
///< Ignore defense
///< Ignore defense (left weapon)
///< Pierces defense (Investigate/Ice Pick)
///< 1: Use def+def2/100, 2: Use def+def2/50
///< Infinite defense (plants)
///< Attack is arrow-based
///< Attack considers right hand (wd.damage)
///< Attack considers left hand (wd.damage2)
///< It's a weapon attack (consider VVS, and all that)
///< Total defense reduction
///< Has its own battle calc formula
//Initial flag
// Reverberation takes 1 damage
//Initial Values
//Amotion should be 0 for ground skills.
//Initial Flag
// Baphomet card's splash damage is counted as a skill. [Inkfish]
//This assumption simplifies the assignation later
//If flag, this is splash damage from Baphomet Card and it always hits.
//Skip checking as there are no status changes active.
//Skip checking as there are no status changes active.
//Set miscellaneous data that needs be filled regardless of hit/miss
//Since these do not consume ammo, they need to be explicitly set as arrow attacks.
//For NPC used skill.
//Always critical skill.
//When in banding, the number of hits is equal to the number of Royal Guards in banding.
/* Fall through */
//Range for normal attacks.
//Check for Lucky Dodge
//Take weapon's element
//Summoning 10 spiritcharm will endow your weapon.
//Weapon's element is "not elemental"
//Use enchantment's element
//Use random element
//element comes in flag.
//forced neutral for monsters
// Banding with 5 RGs: change atk element to Holy.
//skill is "not elemental"
//Skills ALWAYS use ONLY your right-hand weapon (tested on Aegis 10.2)
//Check for double attack.
//Will fail bare-handed
// Need confirmation
//Success chance is not added, the higher one is used [Skotlex]
// 3 % chance to attack 5 times.
// 6 % chance to attack 4 times.
// 9 % chance to attack 3 times.
// 12 % chance to attack 2 times.
//Check for critical
// Racial crit bonuses are affected by katar's crit bonus.
// if show_katar_crit_bonus is enabled, it already done the calculation in status.c
//The official equation is *2, but that only applies when sd's do critical.
//Therefore, we use the old value 3 on cases when an sd gets attacked by a mob
//Check for Perfect Hit
//SG_FUSION always hit [Komurka]
//def ignore [Komurka]
// Always hits the one exploding.
//Hit/Flee calculation
//Default hitrate
//Default hitrate
// asume type 2: absolute reduction
//Fogwall's hit penalty is only for normal ranged attacks.
//in Renewal hit bonus from Vultures Eye is not anymore shown in status window
//Hit skill modifiers
//It is proven that bonus is applied on final hitrate, not hit.
// Weaponry Research hidden bonus
/* will hit with the special */
//End hit/miss calculation
//No need to do the math for plants
//Skill dmg modifiers.
//Hitting attack
//Assuming that 99% of the cases we will not need to check for the flag.rh... we don't.
//ATK_RATE scales the damage. 100 = no change. 50 is halved, 200 is doubled, etc
//Adds dmg%. 100 = +100% (double) damage. 10 = +10% damage
//Adds an absolute value to damage. 100 = +100 damage
//Calc base damage according to skill
// temporary [malufett]
// [malufett]
// [malufett]
//80% of weight
//Skill modifier applies to weight only.
//Monsters have no weight and use ATK instead
//Add str bonus.
//Size-fix. Is this modified by weapon perfection?
//Small: 125%
//case SZ_MEDIUM: //Medium: 100%
//Large: 75%
//Else use Atk2
//[orn]
// for ex. shuriken must not be influenced by DEX
// Divide ATK among targets
//Add any bonuses that modify the base baseatk+watk (pre-skills)
// temporary it should be 'bonus.crit_atk_rate'
// exclude the player himself [Inkfish]
//End default case
//End switch(skill_id)
// [malufett]
//Else use Atk2
// [malufett/Hercules]
/* Fall through */
// [malufett]
//n_ele = true; // FIXME: This is has no effect if it's after GET_NORMAL_ATTACK (was this intended, or was it supposed to be put above?)
//Small: 115%
//Large: 85%
//Constant/misc additions from skills
//TK_RUN kick damage bonus.
// [(Target Size value + Skill Level - 1) x Caster STR] + [(Target current weight x Caster DEX / 120)]
//mobs
//Div fix.
//The following are applied on top of current damage and are stackable.
// Needs more info
//+25% dmg on woe/+100% dmg on nonwoe
/* redirect skill id */
// temporary it should be 'bonus.long_attack_atk_rate'
//Elemental/Racial adjustments
//Pass effect onto right hand if configured so. [Skotlex]
//Ignore Defense?
//Move effect to right hand. [Skotlex]
//Defense reduction
//Div fix.
// re-evaluate forced neutral skills
// Can't find any source about this one even in eagis
//Adds atk2 to the damage, should be influenced by number of hits and skill-ratio, but not mdef reductions. [Skotlex]
//Also divide the extra bonuses from atk2 based on the number in range [Kevin]
//Post skill/vit reduction damage increases
//SC skill damages
// +100 per hit in lv 5
//[( ( Skill Lv x 20 ) + 100 ) x ( casterBaseLevel / 150 )] + casterInt
// Triple Damage
//Refine bonus
// Counts refine bonus multiple times
//Set to min of 1
//Here ends flag.hit section, the rest of the function applies to both hitting and missing attacks
//Since the attack missed...
//Enough, rest is not needed.
// Offensive damage increment in renewal is done somewhere else
//Only Shield boomerang doesn't takes the Star Crumbs bonus.
//The finger offensive spheres on moment of attack do count. [Skotlex]
//Card Fix, sd side
//Refine bonus applies after cards and elements.
//Card Fix, tsd side
//if player on player then it was already measured above
//Plants receive 1 damage when hit
// In some cases, right hand no need to have a weapon to increase damage
//Do not return if you are supposed to deal greater damage to plants than 1. [Skotlex]
//Move lh damage to the rh
//Dual-wield
// Katars (offhand damage only applies to normal attacks, tested on Aegis 10.2)
//SG_FUSION hp penalty [Komurka]
//2% hp loss per hit
//There is a total damage value
// Don't reflect your own damage (Grand Cross)
//Reject Sword bugreport:4493 by Daegaladh
//Breaker's int-based damage (a misc attack?)
/*==========================================
//Miss/Absorbed
//Weapon attacks should go through to cause additional effects.
// Isn't it that additional effects don't apply if miss?
/*&& attack_type&(BF_MAGIC|BF_MISC)*/) // Isn't it that additional effects don't apply if miss?
// Some skills like Weaponry Research will cause damage even if attack is dodged
// HPVanishRate
// SPVanishRate
//Performs reflect damage (magic (maya) is performed over skill.c).
//ATK [{(Target HP / 100) x Skill Level} x Caster Base Level / 125] % + [Received damage x {1 + (Skill Level x 0.2)}]
// Maximum of 5000% ATK
// This is how official does
/* shouldn't this trigger skill->additional_effect? */
// Just put here to minimize redundancy
// Amplify damage.
// not normalized as intended.
/* is this right? rdamage as both left and right? */
/* gradual increase so the numbers don't clip in the client */
// Nullify reflecting ability of the conditions onwards
/* is this right? rdamage as both left and right? */
/* gradual increase so the numbers don't clip in the client */
/* yes block still applies, somehow gravity thinks it makes sense. */
// It should not be a basic attack if the target is under devotion
// It should not be out of range if the target is under devotion
/* is this right? rdamage as both left and right? */
/* gradual increase so the numbers don't clip in the client */
/* wont count towards total */
/* gradual increase so the numbers don't clip in the client */
/* is this right? rdamage as both left and right? */
/* gradual increase so the numbers don't clip in the client */
/* is this right? rdamage as both left and right? */
/* gradual increase so the numbers don't clip in the client */
/* long */
/* is this right? rdamage as both left and right? */
/* gradual increase so the numbers don't clip in the client */
// Tell analyzers/compilers that we want to += it even the value is currently unused (it'd be used if we added new checks)
/* something caused reflect */
/**
// Don't reflect your own damage
// Needs official info
//case RA_CLUSTERBOMB:
//case RA_FIRINGTRAP:
//case RA_ICEBOUNDTRAP:
//case GN_THORNS_TRAP:
//case KO_MAKIBISHI:
//First two iterations: Right hand
//First and Third iterations: race, other two boss/nonboss state
// HPVanishRate
// SPVanishRate
// Deals the same damage to targets in area. [pakpil]
//Ammo check by Ishizu-chan
/*==========================================
// FIXME: flag is undocumented
//Avoid sc checks when there's none to check for. [Skotlex]
//Remove the casting bar. [Skotlex]
//Display MISS.
//Target locked.
//Display MISS.
//Base Rate
/**
//Damage to self is always 9%
//Activate heal.
//Consume arrow.
// Activates it only from melee damage
// Just show damage in target.
//Max chance, no skill_lv reduction. [Skotlex]
/* && check_distance_bl(src, target, tstatus->rhw.range+1) Doesn't check range! o.O; */
//Poison React
//Returns the upmost level master starting with the given object
//Used for infinite loop check (master of yourself?)
/*==========================================
//map
//Initial state none
//Flag which marks whether to remove the BCT_ENEMY status if it's also friend/ally.
//t_bl/s_bl hold the 'master' of the attack, while src/target are the actual
//objects involved.
// Source => PC, Target => MOB
/* anything else goes */
// Checks on actual target
/* TODO a proper distinction should be established bugreport:8397 */
//Cannot be targeted yet.
//Targetable by players
//Only a few skills can target traps...
// it can only hit traps in pvp/gvg maps
//you can hit them without skills
//Excepting traps and icewall, you should not be able to target skills.
//Valid targets with no special checks here.
//All else not specified is an invalid target.
//end switch actual target
//Checks on target master
// Global immunity only to Attacks
// Characters with bad karma may fight amongst them
// Everything can kill it
// Disable guardians/emperiums owned by Guilds on non-woe times.
//other type doesn't have slave yet
//end switch master target
//Checks on actual src type
//Pet may not attack non-mobs.
//pet may not attack Guardians/Emperium
//Status changes that prevent traps from triggering
//mercenary may not attack Emperium
//end switch actual src
//Checks on source master
// Can kill anything
// Duel targets can ONLY be your enemy, nothing else.
//If you don't belong to a guild, can't target emperium.
//Natural enemy.
// Disable guardians/emperium owned by Guilds on non-woe times.
//Normal mobs
//Normal mobs with no ai are friends.
//However, all else are enemies.
//Natural enemy for AI mobs are normal mobs.
//Need some sort of default behavior for unhandled types.
//end switch on src master
//All actually stands for all attackable chars
//Why would someone use this? no clue.
//No need for further testing.
//Check rivalry settings.
// Prevent novice engagement on pk_mode (feature by Valaris)
//end map_flag_vs chk rivality
//Non pvp/gvg, check party/guild settings.
//end non pvp/gvg chk rivality
//If not an enemy, nor a guild, nor party, nor yourself, it's neutral.
//Alliance state takes precedence over enemy one.
/*==========================================
// Range for players' attacks and skills should always have a circular check. [Angezerus]
// No need for path checking.
// Avoid targeting objects beyond your range of sight.
//{ "mob_skill_use",                      &battle_config.mob_skill_use,                   1,      0,      1,              }, //Deprecated
// eAthena additions
// BattleGround Settings
/**
/**
/* if plugin-owned, succeed */
// not found
// added by [Skotlex]
//Skotlex
// added by [Yor]
// added by [Yor]
/* exact date (when it started) not known */
/**
// Error message is already shown by libconfig->load_file()
// Unsupported type
// import should overwrite any previous configuration, so it should be called last
/* initialize the interface */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\battleground.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// struct mob_data
/// Search a BG Team using bg_id
/// Deletes BG Team from db
/// Warps a Team
/// Player joins team
// No free slots
/* populate 'where i came from' */
/// Single Player leaves team
// Removes member from BG
// Server : %s has quit the game...
// Server : %s is leaving the battlefield...
// Server : %s has been afk-kicked from the battlefield...
/// Respawn after killed
// Respawn not handled by Core
// Warped
// Couldn't send message
/**
// xy update
// FIXME hardcoded name
/**
/* check if all are ready then cancel timer, and start game  */
/* reset queue */
/* TODO/FIXME? I *think* it should check what kind of queue the player used, then check if his party/guild
/* TODO: make this a arena-independent var? or just .@? */
/* guild/party already validated in can_queue */
/* TODO: maybe make this a per-arena setting, so users may make custom arenas like baby-only,whatever. */
// You are a deserter! Wait %u minute(s) before you can apply again
// You are a deserter! Wait %u seconds before you can apply again
// You can't reapply to this arena so fast. Apply to the different arena or wait %u minute(s)
// You can't reapply to this arena so fast. Apply to the different arena or wait %u seconds
// Can't apply: not enough members in your team/guild that have not entered the queue in individual mode, minimum is %d
// Can't apply: not enough members in your team/guild, minimum is %d
// Can't apply: not enough members in your team/party that have not entered the queue in individual mode, minimum is %d
// Can't apply: not enough members in your team/party, minimum is %d
/* already did */
/**
/* */
/* */
/* */
/* */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\buyingstore.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// struct s_buyingstore
// msg_txt
// battle_config.*
// clif-"buyingstore_*
// log_pick_pc, log_zeny
// struct map_session_data
// ARR_FIND
// nullpo_*
// ShowWarning
// RBUF*
// safestrncpy
/// Returns unique buying store id
// custom: mute limitation
// custom: no vending maps
// "You can't open a shop on this map"
// custom: no vending cells
// "You can't open a shop on this cell."
// canceled, or no items
// disabled or invalid input
// custom: GM is not allowed to buy (give zeny)
// Your GM level doesn't authorize you to perform this action.
// custom: mute limitation
// custom: no vending maps
// "You can't open a shop on this map"
// custom: no vending cells
// "You can't open a shop on this cell."
// check item list
// itemlist: <name id>.W <amount>.W <price>.L
// invalid input
// invalid price: unlike vending, items cannot be bought at 0 Zeny
// restrictions: allowed, no character-bound items and at least one must be owned
// too many items of same kind
// duplicate check. as the client does this too, only malicious intent should be caught here
// duplicate
// invalid item/amount/price
// not able to carry all wanted items without getting overweight (90%)
// success
// store actual amount of items
// invalidate data
// notify other players
// not allowed to sell
// custom: GM is not allowed to sell
// Your GM level doesn't authorize you to perform this action.
// not online or not buying
// out of view range
// success
// nothing to do
// not allowed to sell
// custom: GM is not allowed to sell
// Your GM level doesn't authorize you to perform this action.
// not online, not buying or not same store
// out of view range
// buyer lost zeny in the mean time? fix the limit
// check item list
// itemlist: <index>.W <name id>.W <amount>.W
// duplicate check. as the client does this too, only malicious intent should be caught here
// duplicate
// invalid input
// non-tradable item
// there is no such item or the buyer has already bought all of them
// buyer does not need that much of the item
// buyer does not have enough space for this item
// normally this is not supposed to happen, as the total weight is
// checked upon creation, but the buyer could have gained items
// buyer does not have enough zeny
// process item list
// itemlist: <index>.W <name id>.W <amount>.W
// move item
// pay up
// notify clients
// check whether or not there is still something to buy
// everything was bought
// zeny limit reached
// continue buying
// cannot continue buying
// remove auto-trader
/// Checks if an item is being bought in given player's buying store.
// not buying
// not found
/// Searches for all items in a buyingstore, that match given ids, price and possible cards.
/// @return Whether or not the search should be continued.
// not buying
// not found
// too low price
// too high price
// ignore cards, as there cannot be any
// TODO: add support for cards and options
// result set full
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\channel.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/**
/**
/**
/**
/**
/**
// Unban all
// Unban one
/**
/**
// "You cannot send a message to this channel for another %d seconds."
/**
// #%s '%s' joined
/* someone is cheating, we kindly disconnect the bastard */
/**
// You're now in the '#%s' channel for '%s'
// You're now in the '%s' channel
/**
/**
// #%s '%s' left
/**
// Loop downward to avoid unnecessary array compactions by channel_leave
/**
/**
/**
/**
// Loop downward to avoid issues when channel->leave() compacts the array
// FIXME hardcoded name
/*==========================================
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\chat.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// msg_sd(sd,)
// struct battle_config
// npc_event_do()
// ext_skill_unit_onplace()
/// Initializes a chatroom object (common functionality for both pc and npc chatrooms).
/// Returns a chatroom object on success, or NULL on failure.
/* Given the overhead and the numerous instances (npc allocated or otherwise) wouldn't it be beneficial to have it use ERS? [Ind] */
/*==========================================
//Prevent people abusing the chat system by creating multiple chats, as pointed out by End of Exam. [Skotlex]
// not chat, when you already have a store open
// You can't create chat rooms in this map
// "Can't create chat rooms in this area."
// 0 = success
// Achievements [Smokexyz/Hercules]
// 1 = Room limit exceeded
/*==========================================
// room full
// wrong password
// too low level
// too high level
// not enough zeny
// You have been kicked out of the room.
//To the person who newly joined the list of all
//Reports To the person who already in the chat
//Reported number of changes to the people around
//Event
/*==========================================
// Not found in the chatroom?
// Delete empty chatroom
// check if new location are CELL_CHKNOCHAT
// Set and announce new owner
//Adjust Chat location after owner has been changed.
// Owner changed
// refresh chatroom
/*==========================================
// name not found
// erase temporarily
// set new owner
// swap the old and new owners' positions
// set the new chatroom position
// and display again
/*==========================================
/*==========================================
// User not found
//gm kick protection [Valaris]
/*==========================================
/*==========================================
/*==========================================
/// Enables the event of the chat room.
/// At most, 127 users are needed to trigger the event.
/// Disables the event of the chat room
/// Kicks all the users from the chat room.
/*=====================================
/* funcs */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\chrif.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// AUTOTRADE_PERSISTENCY
//Used Packets:
//2af8: Outgoing, chrif_connect -> 'connect to charserver / auth @ charserver'
//2af9: Incoming, chrif_connectack -> 'answer of the 2af8 login(ok / fail)'
//2afa: Outgoing, chrif_sendmap -> 'sending our maps'
//2afb: Incoming, chrif_sendmapack -> 'Maps received successfully / or not ..'
//2afc: Outgoing, chrif_scdata_request -> request sc_data for pc->authok'ed char. <- new command reuses previous one.
//2afd: Incoming, chrif_authok -> 'client authentication ok'
//2afe: Outgoing, send_usercount_tochar -> 'sends player count of this map server to charserver'
//2aff: Outgoing, chrif_send_users_tochar -> 'sends all actual connected character ids to charserver'
//2b00: Incoming, map_setusers -> 'set the actual usercount? PACKET.2B COUNT.L.. ?' (not sure)
//2b01: Outgoing, chrif_save -> 'charsave of char XY account XY (complete struct)'
//2b02: Outgoing, chrif_charselectreq -> 'player returns from ingame to charserver to select another char.., this packets includes sessid etc' ? (not 100% sure)
//2b03: Incoming, clif_charselectok -> '' (i think its the packet after enterworld?) (not sure)
//2b04: Incoming, chrif_recvmap -> 'getting maps from charserver of other mapserver's'
//2b05: Outgoing, chrif_changemapserver -> 'Tell the charserver the mapchange / quest for ok...'
//2b06: Incoming, chrif_changemapserverack -> 'answer of 2b05, ok/fail, data: dunno^^'
//2b07: Outgoing, chrif_removefriend -> 'Tell charserver to remove friend_id from char_id friend list'
//2b08: Outgoing, chrif_searchcharid -> '...'
//2b09: Incoming, map_addchariddb -> 'Adds a name to the nick db'
//2b0a: Incoming/Outgoing, socket_datasync()
//2b0b: Outgoing, update charserv skillid2idx
//2b0c: Outgoing, chrif_changeemail -> 'change mail address ...'
//2b0d: Incoming, chrif_changedsex -> 'Change sex of acc XY' (or char)
//2b0e: Outgoing, chrif_char_ask_name -> 'Do some operations (change sex, ban / unban etc)'
//2b0f: Incoming, chrif_char_ask_name_answer -> 'answer of the 2b0e'
//2b10: Outgoing, chrif_updatefamelist -> 'Update the fame ranking lists and send them'
//2b11: Outgoing, chrif_divorce -> 'tell the charserver to do divorce'
//2b12: Incoming, chrif_divorceack -> 'divorce chars
//2b13: FREE
//2b14: Incoming, chrif_accountban -> 'not sure: kick the player with message XY'
//2b15: FREE
//2b16: Outgoing, chrif_ragsrvinfo -> 'sends base / job / drop rates ....'
//2b17: Outgoing, chrif_char_offline -> 'tell the charserver that the char is now offline'
//2b18: Outgoing, chrif_char_reset_offline -> 'set all players OFF!'
//2b19: Outgoing, chrif_char_online -> 'tell the charserver that the char .. is online'
//2b1a: Outgoing, chrif_buildfamelist -> 'Build the fame ranking lists and send them'
//2b1b: Incoming, chrif_recvfamelist -> 'Receive fame ranking lists'
//2b1c: Outgoing, chrif_save_scdata -> 'Send sc_data of player for saving.'
//2b1d: Incoming, chrif_load_scdata -> 'received sc_data of player for loading.'
//2b1e: Incoming, chrif_update_ip -> 'Request forwarded from char-server for interserver IP sync.' [Lance]
//2b1f: Incoming, chrif_disconnectplayer -> 'disconnects a player (aid X) with the message XY ... 0x81 ..' [Sirius]
//2b20: Incoming, chrif_removemap -> 'remove maps of a server (sample: its going offline)' [Sirius]
//2b21: Incoming, chrif_save_ack. Returned after a character has been "final saved" on the char-server. [Skotlex]
//2b22: Incoming, chrif_updatefamelist_ack. Updated one position in the fame list.
//2b23: Outgoing, chrif_keepalive. charserver ping.
//2b24: Incoming, chrif_keepalive_ack. charserver ping reply.
//2b25: Incoming, chrif_deadopt -> 'Removes baby from Father ID and Mother ID'
//2b26: Outgoing, chrif_authreq -> 'client authentication request'
//2b27: Incoming, chrif_authfail -> 'client authentication failed'
//This define should spare writing the check in every function. [Skotlex]
// Unused
/// Resets all the data.
// TODO kick everyone out and reset everything [FlavioJS]
// 0
/// Checks the conditions for the server to stop.
/// Releases the cookie when all characters are saved.
/// If all the conditions are met, it stops the core loop.
//Moves the sd character to the auth_db structure.
//Already exists?
//Data from logged on char.
//timestamp for node timeouts
//Disassociate player, and free it after saving ack returns. [Skotlex]
//fd info must not be lost for ST_MAPCHANGE as a final packet needs to be sent to the player.
// sets char-server's user id
// sets char-server's password
// security check, prints warning if using default password
// sets char-server's ip address
// sets char-server's port number
// says whether the char-server is connected or not
/*==========================================
// TODO: Flag enum
//Store player data which is quitting
//FIXME: SC are lost if there's no connection at save-time because of the way its related data is cleared immediately after this function. [Skotlex]
//Character is saved on reconnect.
//For data sync
//Force close it.
//Saving of registry values.
//Flag to tell char-server this character is quitting.
// connects to char-server (plaintext)
// sends maps to char-server
// Sending normal maps, not instances
// receive maps from some other map-server (relayed via char-server)
// remove specified maps (used when some other map-server disconnects)
// received after a character has been "final saved" on the char-server
// request to move a character between mapservers
//No other map servers are online!
/// map-server change request acknowledgment (positive or negative)
/// R 2b06 <account_id>.L <login_id1>.L <login_id2>.L <char_id>.L <map_index>.W <x>.W <y>.W <ip>.L <port>.W
// Disconnected from server
//Player has been saved already, remove him from memory. [Skotlex]
// Is this the best approach here?
/*==========================================
/**
//Since there is no way to request the char auth, make it fail.
//Re-send final save
//Re-send map-change request.
//too much lag/timeout is the closest explanation for this error.
// timeout
/// Called when all the connection steps are completed.
//If there are players online, send them to the char-server. [Skotlex]
//Auth db reconnect handling
//Re-save any storages that were modified in the disconnection time. [Skotlex]
//Re-save any guild castles that were modified in the disconnection time.
/*==========================================
/*==========================================
/*==========================================
/*==========================================
//Check if both servers agree on the struct's size
//Check if we don't already have player data in our server
//Causes problems if the currently connected player tries to quit or this data belongs to an already connected player which is trying to re-auth.
// should not happen
//character in logout phase, do not touch that data.
/*
//discard the older one and keep the new one.
// should not happen
//Auth Ok
//Auth Failed
//Set him offline, the char server likely has it set as online already.
// client authentication failed
/* HELLO WORLD. ip in RFIFOL 15 is not being used (but is available) */
// found a match
// Disconnected from server
/**
//Re-save attempt (->sd should never be null here).
//Refresh tick (avoid char-server load if connection is really bad)
//Clear data. any connected players should have timed out by now.
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/**
//"Disconnecting to perform change-sex request..."
/*==========================================
/* re-use previous msg_number */
//block|ban|unblock|unban|change the sex of
/*==========================================
//int sex = RFIFOL(fd,6); // Dead store. Uncomment if needed again.
// Path to activate this response:
// Map(start) (0x2b0e type 5) -> Char(0x2727) -> Login
// Login(0x2723) [ALL] -> Char (0x2b0d)[ALL] -> Map (HERE)
// OR
// Map(start) (0x2b03 type 8) -> Char
// Char(0x2b0d)[ALL] -> Map (HERE)
// Char will usually be "logged in" despite being forced to log-out in the beginning
// of this process, but there's no need to perform map-server specific response
// as everything should been changed through char-server [Panikon]
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/* player not online or unknown id, either way no error is necessary (since if you try to ban a offline char it still works) */
// change identify, because if player come back in char within the 5 seconds, he can change its characters
// 0: change of status
// status or final date of a banishment
// Message IDs (for search convenience): 412, 413, 414, 415, 416, 417, 418, 419, 420
// Your account has been totally erased.
//"Your account is not longer authorized."
// 1: ban
// status or final date of a banishment
//"Your account has been banished until "
// 2: change of status for character
// status or final date of a banishment
//"This character has been banned until  "
// forced to disconnect for the change
// Remove leftovers (e.g. autotrading) [Paradox924X]
//Disconnect the player out of the game, simple packet
//packet.w AID.L WHY.B 2+4+1 = 7byte
//No connection
//Remove it.
//Else we don't remove it because the char should have a timer to remove the player because it force-quit before,
//and we don't want them kicking their previous instance before the 10 secs penalty time passes. [Skotlex]
//server closed
//someone else logged in
//server overpopulated
//out of available time paid for
//forced to dc by gm
/*==========================================
//Blacksmith block size
//Alchemist block size
//Total packet length
/// fame ranking update confirmation
/// R 2b22 <table>.B <index>.B <value>.L
//parses the sc_data of the player and sends it to the char-server for saving. [Skotlex]
//Duration that is left before ending.
//Negative tick does not necessarily mean that sc has expired
//Nothing to save. | Everything was as successful as if there was something to save.
//Total packet size
//Retrieve and load sc_data for a player. [Skotlex]
//Player Account ID
//Player Char ID
//sc_count
/*==========================================
/*=========================================
/*=========================================
/*=========================================
/*=========================================
/// Called when the connection to Char Server is disconnected.
//Reset counter. We receive ALL maps from all map-servers on reconnect.
//Attempt to reconnect in a second. [Skotlex]
//Update chrif->ip
//No change
// pings the charserver ( since on-demand flag.ping was introduced, shouldn't this be dropped? only wasting traffic and processing [Ind])
/* reset ping state, we received a packet */
// really skill id
/*==========================================
// only process data from the char-server
/* we've reached stall time */
/* we can't wait any longer */
/* we haven't sent ping out yet */
// Passed on to the intif
// Treated in intif
// Didn't have enough data (len==-1)
// dynamic-length packet, second WORD holds the length
//ShowDebug("Received packet 0x%4x (%d bytes) from char-server (connection %d)\n", RFIFOW(fd,0), packet_len, fd);
//There's the slight chance we lost the connection during parse, in which case this would segfault if not checked [Skotlex]
/*==========================================
/*==========================================
//Attempt to connect later. [Skotlex]
/*==========================================
/**
/**
/**
/*==========================================
/*==========================================
// establish map-char connection if not present
// wipe stale data for timed-out client connection requests
// send the user count every 10 seconds, to hide the charserver's online counting problem
/*=====================================
// U - used, F - free
// 2af8-2aff: U->2af8, U->2af9, U->2afa, U->2afb, U->2afc, U->2afd, U->2afe, U->2aff
// 2b00-2b07: U->2b00, U->2b01, U->2b02, U->2b03, U->2b04, U->2b05, U->2b06, U->2b07
// 2b08-2b0f: U->2b08, U->2b09, U->2b0a, F->2b0b, U->2b0c, U->2b0d, U->2b0e, U->2b0f
// 2b10-2b17: U->2b10, U->2b11, U->2b12, F->2b13, U->2b14, F->2b15, U->2b16, U->2b17
// 2b18-2b1f: U->2b18, U->2b19, U->2b1a, U->2b1b, U->2b1c, U->2b1d, U->2b1e, U->2b1f
// 2b20-2b27: U->2b20, U->2b21, U->2b22, U->2b23, U->2b24, U->2b25, U->2b26, U->2b27
/* vars */
/* */
/* */
/* funcs */
// look like unused
//chrif->chardisconnect = chrif_chardisconnect;
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\clan.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/**
/**
/**
/**
/**
/**
/**
// Already joined a guild or clan
/**
// For invalid values we must reset it to 0 (no clan)
// This is a silent return because it will reset clan_id in case
// a custom clan that was removed and this is a remaining member
// Remove the status
// When first called from pc.c we don't need to do status_calc
/**
// Note: Even if the value is invalid (lower than zero)
// the function will fix the invalid value
/**
/**
// Only if it is online, because unit->free is called twice
/**
// Chat logging type 'C' / Clan Chat
/**
/**
/**
/**
//Perform the kick for offline members that didn't connect after a server restart
/**
/**
/**
// do nothing. plugins can do own work
// SI_BLANK
/**
// Char server will count members for us
// Validating Relations
/**
/**
// FIXME: hardcoded name
// On config file we set the time in hours but here we use in seconds
/**
// do nothing. plugins can do own work
/**
/**
/**
/**
/* */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\clif.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// ANTI_MAYAP_CHEAT, RENEWAL, SECURE_NPCTIMEOUT
// NEW_CARTS, char_achievements
/* re-usable */
// temporart buffer for send big packets
//#define DUMP_UNKNOWN_PACKET
//#define DUMP_INVALID_PACKET
//Converts item type in case of pet eggs.
// client-side: x0+=sx0*0.0625-0.5 and y0+=sy0*0.0625-0.5
// Currently unused
// 0
// currently unused
// 0
//To identify disguised characters.
/*==========================================
/*==========================================
// Unused function
/*==========================================
// 0
// Unused function
/*==========================================
// 0
/*==========================================
/*==========================================
//Don't send to disconnected clients.
/* 0x120 crashes the client when warping for this packetver range [Ind/Hercules], thanks to Judas! */
/* unless visible, hold it here */
// don't send to not move the pointer of the packet for next sessions in the loop
//WFIFOSET(fd,0);//## TODO is this ok?
//NO. It is not ok. There is the chance WFIFOSET actually sends the buffer data, and shifts elements around, which will corrupt the buffer.
/*==========================================
//All player clients.
//All players on the same map
//Otherwise source misses the packet.[Skotlex]
/* Fall through */
// Added check to see if session exists [PoW]
/* Fall through */
//Skip unnecessary parsing. [Skotlex]
//Invalid usage.
// New definitions for guilds [Valaris] - Cleaned up and reorganized by [Skotlex]
/* Fall through */
//Skip unnecessary parsing. [Skotlex]
/* Fall through */
/// Notifies the client, that it's connection attempt was accepted.
/// 0073 <start time>.L <position>.3B <x size>.B <y size>.B (ZC_ACCEPT_ENTER)
/// 02eb <start time>.L <position>.3B <x size>.B <y size>.B <font>.W (ZC_ACCEPT_ENTER2)
/* do the stupid client math */
/* not-used */
// Some clients smaller than 20160330 cant be tested [4144]
/// [4144] Packet not using error_code anymore. Works for fixed error only (MsgString: 9 - Rejected from Server)
/// Notifies the client, that it's connection attempt was refused (ZC_REFUSE_ENTER).
/// 0074 <error code>.B
/// error code:
///     0 = client type mismatch
///     1 = ID mismatch
///     2 = mobile - out of available time
///     3 = mobile - already logged in
///     4 = mobile - waiting state
/// Notifies the client of a ban or forced disconnect (SC_NOTIFY_BAN).
/// 0081 <error code>.B
/// error code:
///     0 = BAN_UNFAIR -> "disconnected from server" -> MsgStringTable[3]
///     1 = server closed -> MsgStringTable[4]
///     2 = ID already logged in -> MsgStringTable[5]
///     3 = timeout/too much lag -> MsgStringTable[241]
///     4 = server full -> MsgStringTable[264]
///     5 = underaged -> MsgStringTable[305]
///     8 = Server sill recognizes last connection -> MsgStringTable[441]
///     9 = too many connections from this ip -> MsgStringTable[529]
///     10 = out of available time paid for -> MsgStringTable[530]
///     11 = BAN_PAY_SUSPEND
///     12 = BAN_PAY_CHANGE
///     13 = BAN_PAY_WRONGIP
///     14 = BAN_PAY_PNGAMEROOM
///     15 = disconnected by a GM -> if( servicetype == taiwan ) MsgStringTable[579]
///     16 = BAN_JAPAN_REFUSE1
///     17 = BAN_JAPAN_REFUSE2
///     18 = BAN_INFORMATION_REMAINED_ANOTHER_ACCOUNT
///     100 = BAN_PC_IP_UNFAIR
///     101 = BAN_PC_IP_COUNT_ALL
///     102 = BAN_PC_IP_COUNT
///     103 = BAN_GRAVITY_MEM_AGREE
///     104 = BAN_GAME_MEM_AGREE
///     105 = BAN_HAN_VALID
///     106 = BAN_PC_IP_LIMIT_ACCESS
///     107 = BAN_OVER_CHARACTER_LIST
///     108 = BAN_IP_BLOCK
///     109 = BAN_INVALID_PWD_CNT
///     110 = BAN_NOT_ALLOWED_JOBCLASS
///     113 = access is restricted between the hours of midnight to 6:00am.
///     115 = You are in game connection ban period.
///     ? = disconnected -> MsgStringTable[3]
// TODO: type enum
//clif_authfail should only be invoked on players!
/// Notifies the client, whether it can disconnect and change servers (ZC_RESTART_ACK).
/// 00b3 <type>.B
/// type:
///     1 = disconnect, char-select
///     ? = nothing
/// Makes an item appear on the ground.
/// 009e <id>.L <name id>.W <identified>.B <x>.W <y>.W <subX>.B <subY>.B <amount>.W (ZC_ITEM_FALL_ENTRY)
/// 084b (ZC_ITEM_FALL_ENTRY4)
/* not sure date */
/// Makes an item disappear from the ground.
/// 00a1 <id>.L (ZC_ITEM_DISAPPEAR)
/// Makes a unit (char, npc, mob, homun) disappear to one client (ZC_NOTIFY_VANISH).
/// 0080 <id>.L <type>.B
/// type:
///     0 = out of sight
///     1 = died
///     2 = logged out
///     3 = teleport
///     4 = trickdead
/// Makes a unit (char, npc, mob, homun) disappear to all clients in area (ZC_NOTIFY_VANISH).
/// 0080 <id>.L <type>.B
/// type:
///     0 = out of sight
///     1 = died
///     2 = logged out
///     3 = teleport
///     4 = trickdead
/**
/// Used to make monsters with player-sprites disappear after dying
/// like normal monsters, because the client does not remove those
/// automatically.
/// Gets weapon view info from sd's inventory_data and points (*rhand,*lhand)
//To make the assignation of the level based on limits clearer/easier. [Skotlex]
// npcs and pets do not have level
/* for 'packetver < 20091103' 0x78 non-pc-looking unit handling */
// The hell, why flags work like this?
/*==========================================
// CCODE
// The hell, why flags work like this?
/* Might be earlier, this is when the named item bug began */
//PC_TYPE : NPC_MOB_TYPE
/* for 'packetver < 20091103' 0x7c non-pc-looking unit handling */
// The hell, why flags work like this?
// CCODE
// The hell, why flags work like this?
/* Might be earlier, this is when the named item bug began */
//PC_TYPE : NPC_MOB_TYPE
/*==========================================
// CCODE
/* Might be earlier, this is when the named item bug began */
//PC_TYPE : NPC_MOB_TYPE
/// Changes sprite of an NPC object (ZC_NPCSPRITE_CHANGE).
/// 01b0 <id>.L <type>.B <value>.L
/// type:
///     unused
// player classes yield missing sprites
/// Notifies the client of an object's spirits.
/// 01d0 <id>.L <amount>.W (ZC_SPIRITS)
/// 01e1 <id>.L <amount>.W (ZC_SPIRITS2)
/*==========================================
/*==========================================
/**
/**
// Doesn't need to be spawned, so everything is alright
// Hide NPC from maya purple card.
// Doesn't need to be spawned, so everything is alright
// tiny/big players [Valaris]
// tiny/big mobs [Valaris]
// needed to display pet equip properly
/// Sends information about owned homunculus to the client (ZC_PROPERTY_HOMUN). [orn]
/// 022e <name>.24B <modified>.B <level>.W <hunger>.W <intimacy>.W <equip id>.W <atk>.W <matk>.W <hit>.W <crit>.W <def>.W <mdef>.W <flee>.W <aspd>.W <hp>.W <max hp>.W <sp>.W <max sp>.W <exp>.L <max exp>.L <skill points>.W <atk range>.W
// Bit field, bit 0 : rename_flag (1 = already renamed), bit 1 : homunc vaporized (1 = true), bit 2 : homunc dead (1 = true)
// equip id
//crit is a +1 decimal value! Just display purpose.[Vicious]
// probably can works also for < 20141223, but in 3CeaM packet size defined only for 20150513
/// Notification about a change in homunuculus' state (ZC_CHANGESTATE_MER).
/// 0230 <type>.B <state>.B <id>.L <data>.L
/// type:
///     unused
/// state:
///     0 = pre-init
///     1 = intimacy
///     2 = hunger
///     3 = accessory?
///     ? = ignored
/// Prepares and sends homun related information [orn]
//[orn]
/// Result of request to feed a homun/merc (ZC_FEED_MER).
/// 022f <result>.B <name id>.W
/// result:
///     0 = failure
///     1 = success
/// Notifies the client, that it is walking (ZC_NOTIFY_PLAYERMOVE).
/// 0087 <walk start time>.L <walk data>.6B
//clif_movepc(sd);
// tiny/big players [Valaris]
// tiny/big mobs [Valaris]
// needed to display pet equip properly
/// Notifies clients in an area, that an other visible object is walking (ZC_NOTIFY_PLAYERMOVE).
/// 0086 <id>.L <walk data>.6B <walk start time>.L
/// Note: unit must not be self
//This performance check is needed to keep GM-hidden objects from being notified to bots.
// Hide NPC from maya purple card.
// Since we don't know how to update the speed of other objects,
// use the old walk packet to update the data.
/*==========================================
//Remove player from map server
//Should be a disconnected player.
/*==========================================
//Disassociate session from player (session is deleted after this function was called)
//And set a timer to make him quit later.
/// Notifies the client of a position change to coordinates on given map (ZC_NPCACK_MAPMOVE).
/// 0091 <map name>.16B <x>.W <y>.W
/// Notifies the client of a position change (on air ship) to coordinates on given map (ZC_AIRSHIP_MAPMOVE).
/// 0A4B <map name>.16B <x>.W <y>.W
// [4144] this packet is not used yet by kro, but it here
/// Notifies the client of a position change to coordinates on given map, which is on another map-server (ZC_NPCACK_SERVERMOVE).
/// 0092 <map name>.16B <x>.W <y>.W <ip>.L <port>.W
/// 0ac7 <map name>.16B <x>.W <y>.W <ip>.L <port>.W <dns host>.128B
// [!] LE byte order here [!]
/// Notifies the client of a position change (with air ship) to coordinates on given map, which is on another map-server (ZC_NPCACK_SERVERMOVE).
/// 0a4c <map name>.16B <x>.W <y>.W <ip>.L <port>.W
// [4144] this packet is not used yet by kro, but it here
// [!] LE byte order here [!]
//Aegis packets says fixpos, but it's unsure whether slide works better or not.
/// Visually moves(slides) a character to x,y. If the target cell
/// isn't walkable, the char doesn't move at all. If the char is
/// sitting it will stand up (ZC_STOPMOVE).
/// 0088 <id>.L <x>.W <y>.W
/// Displays the buy/sell dialog of an NPC shop (ZC_SELECT_DEALTYPE).
/// 00c4 <shop id>.L
/// Presents list of items, that can be bought in an NPC shop (ZC_PC_PURCHASE_ITEMLIST).
/// 00c6 <packet len>.W { <price>.L <discount price>.L <item type>.B <name id>.W }*
/// Presents list of items, that can be sold to an NPC shop (ZC_PC_SELL_ITEMLIST).
/// 00c7 <packet len>.W { <index>.W <price>.L <overcharge price>.L }*
// Cannot Sell Rental Items
// Don't allow sale of bound items
/// Displays an NPC dialog message (ZC_SAY_DIALOG).
/// 00b4 <packet len>.W <npc id>.L <message>.?B
/// Client behavior (dialog window):
/// - disable mouse targeting
/// - open the dialog window
/// - set npcid of dialog window (0 by default)
/// - if set to clear on next mes, clear contents
/// - append this text
// ! SCRIPT_MES_STRIP_LINEBREAK
// SCRIPT_MES_STRIP_LINEBREAK
/// Adds a 'next' button to an NPC dialog (ZC_WAIT_DIALOG).
/// 00b5 <npc id>.L
/// Client behavior (dialog window):
/// - disable mouse targeting
/// - open the dialog window
/// - add 'next' button
/// When 'next' is pressed:
/// - 00B9 <npcid of dialog window>.L
/// - set to clear on next mes
/// - remove 'next' button
/// Adds a 'close' button to an NPC dialog (ZC_CLOSE_DIALOG).
/// 00b6 <npc id>.L
/// Client behavior:
/// - if dialog window is open:
///   - remove 'next' button
///   - add 'close' button
/// - else:
///   - enable mouse targeting
///   - close the dialog window
///   - close the menu window
/// When 'close' is pressed:
/// - enable mouse targeting
/// - close the dialog window
/// - close the menu window
/// - 0146 <npcid of dialog window>.L
/*==========================================
// object type
/// Displays an NPC dialog menu (ZC_MENU_LIST).
/// 00b7 <packet len>.W <npc id>.L <menu items>.?B
/// Client behavior:
/// - disable mouse targeting
/// - close the menu window
/// - open the menu window
/// - add options to the menu (separated in the text by ":")
/// - set npcid of menu window
/// - if dialog window is open:
///   - remove 'next' button
/// When 'ok' is pressed:
/// - 00B8 <npcid of menu window>.L <selected option>.B
/// - close the menu window
/// When 'cancel' is pressed:
/// - 00B8 <npcid of menu window>.L <-1>.B
/// - enable mouse targeting
/// - close a bunch of windows...
/// WARNING: the 'cancel' button closes other windows besides the dialog window and the menu window.
///    Which suggests their have intertwined behavior. (probably the mouse targeting)
/// TODO investigate behavior of other windows [FlavioJS]
/// Displays an NPC dialog input box for numbers (ZC_OPEN_EDITDLG).
/// 0142 <npc id>.L
/// Client behavior (inputnum window):
/// - if npcid exists in the client:
///   - open the inputnum window
///   - set npcid of inputnum window
/// When 'ok' is pressed:
/// - if inputnum window has text:
///   - if npcid exists in the client:
///     - 0143 <npcid of inputnum window>.L <atoi(text)>.L
///   - close inputnum window
/// Displays an NPC dialog input box for numbers (ZC_OPEN_EDITDLGSTR).
/// 01d4 <npc id>.L
/// Client behavior (inputstr window):
/// - if npcid is 0 or npcid exists in the client:
///   - open the inputstr window
///   - set npcid of inputstr window
/// When 'ok' is pressed:
/// - if inputstr window has text and isn't an insult(manner.txt):
///   - if npcid is 0 or npcid exists in the client:
///     - 01d5 <packetlen>.W <npcid of inputstr window>.L <text>.?B
///   - close inputstr window
/// Marks a position on client's minimap (ZC_COMPASS).
/// 0144 <npc id>.L <type>.L <x>.L <y>.L <id>.B <color>.L
/// npc id:
///     is ignored in the client
/// type:
///     0 = display mark for 15 seconds
///     1 = display mark until dead or teleported
///     2 = remove mark
/// color:
///     0x00RRGGBB
/// Displays an illustration image.
/// 0145 <image name>.16B <type>.B (ZC_SHOW_IMAGE)
/// 01b3 <image name>.64B <type>.B (ZC_SHOW_IMAGE2)
/// type:
///     0 = bottom left corner
///     1 = bottom middle
///     2 = bottom right corner
///     3 = middle of screen, inside a movable window
///     4 = middle of screen, movable with a close button, chrome-less
///   255 = hide
/*==========================================
//Blank data
//pet eggs
//Pet renamed flag.
//Forged/created items
//Client only receives four cards.. so randomly send them a set of cards. [Skotlex]
//eg: 6 slots, possible i values: 0->3, 1->4, 2->5 => i = rnd()%3;
//Normal items.
/**
// Append the buffer with existing options first.
// OptIndex
// Value
// Param1
// Append the remaining buffer with no values;
/// Notifies the client, about a received inventory item or the result of a pick-up request.
/// 00a0 <index>.W <amount>.W <name id>.W <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W <equip location>.W <item type>.B <result>.B (ZC_ITEM_PICKUP_ACK)
/// 029a <index>.W <amount>.W <name id>.W <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W <equip location>.W <item type>.B <result>.B <expire time>.L (ZC_ITEM_PICKUP_ACK2)
/// 02d4 <index>.W <amount>.W <name id>.W <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W <equip location>.W <item type>.B <result>.B <expire time>.L <bindOnEquipType>.W (ZC_ITEM_PICKUP_ACK3)
/// 0990 <index>.W <amount>.W <name id>.W <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W <equip location>.L <item type>.B <result>.B <expire time>.L <bindOnEquipType>.W (ZC_ITEM_PICKUP_ACK_V5)
/// 0a0c <index>.W <amount>.W <name id>.W <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W <equip location>.L <item type>.B <result>.B <expire time>.L <bindOnEquipType>.W (ZC_ITEM_PICKUP_ACK_V6)
/// 0a37 <index>.W <amount>.W <name id>.W <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W <equip location>.L <item type>.B <result>.B <expire time>.L <bindOnEquipType>.W <favorite>.B <view id>.W (ZC_ITEM_PICKUP_ACK_V7)
//Sasuke-
/* why restrict the flag to non-stackable? because this is the only packet allows stackable to,
/// Notifies the client, that an inventory item was deleted or dropped (ZC_ITEM_THROW_ACK).
/// 00af <index>.W <amount>.W
/// Notifies the client, that an inventory item was deleted (ZC_DELETE_ITEM_FROM_BODY).
/// 07fa <delete type>.W <index>.W <amount>.W
/// delete type: @see enum delitem_reason
// Simplifies inventory/cart/storage packets by handling the packet section relevant to items. [Skotlex]
// Equip is >= 0 for equippable items (holds the equip-point, is 0 for pet
// armor/egg) -1 for stackable items, -2 for stackable items where arrows must send in the equip-point.
// look like unused, not adding checks
//Equippable item
//Stackable item.
//Non-stackable (Equippable)
//Stackable (Normal)
/* on 20120925 onwards this is a field on clif_item_equip/normal */
// [4144] for old packet version it send only equipment. this is bug?
//Required when items break/get-repaired. Only sends equippable item list.
//Non-stackable (Equippable)
/* on 20120925 onwards this is a field on clif_item_equip */
//Non-stackable (Equippable)
//Stackable (Normal)
// CZ_REQ_REMAINTIME
/// Removes cart (ZC_CARTOFF).
/// 012b
/// Client behavior:
/// Closes the cart storage and removes all it's items from memory.
/// The Num & Weight values of the cart are left untouched and the cart is NOT removed.
/// Guild XY locators (ZC_NOTIFY_POSITION_TO_GUILDM) [Valaris]
/// 01eb <account id>.L <x>.W <y>.W
/*==========================================
// Guild XY locators [Valaris]
/*==========================================
//To correctly display the %hp bar. [Skotlex]
/*==========================================
/// Notifies client of a character parameter change.
/// 00b0 <var id>.W <value>.L (ZC_PAR_CHANGE)
/// 00b1 <var id>.W <value>.L (ZC_LONGPAR_CHANGE)
/// 00be <status id>.W <value>.B (ZC_STATUS_CHANGE)
/// 0121 <current count>.W <max count>.W <current weight>.L <max weight>.L (ZC_NOTIFY_CARTITEM_COUNTINFO)
/// 013a <atk range>.W (ZC_ATTACK_RANGE)
/// 0141 <status id>.L <base status>.L <plus status>.L (ZC_COUPLESTATUS)
/// TODO: Extract individual packets.
// Invalid pointer fix, by sasuke [Kevin]
// 00b0
//Need to re-set as pc->updateweightstatus can alter the buffer. [Skotlex]
// Adding this back, I wonder if the client intercepts this - [Lance]
// On official servers, the HP displayed when dead is the HP that the character will have at respawn.
//negative check (in case you have something like Berserk active)
// [4144] possible send 64 bit value from PACKETVER_MAIN_NUM >= 20170906 || PACKETVER_RE_NUM >= 20170830 || defined(PACKETVER_ZERO)
// but kro sending 0xb1 packet only.
/**
/**
// Additional update packets that should be sent right after
/// Notifies client of a parameter change of an another player (ZC_PAR_CHANGE_USER).
/// 01ab <account id>.L <var id>.W <value>.L
/// Updates sprite/style properties of an object.
//temp hack to let Warp Portal change appearance
/* nothing to change look */
//Shoes? No packet uses this....
// unknown purpose
// prevent leaking the presence of GM-hidden objects
//Sends a change-base-look packet required for traps as they are triggered.
/// 00c3 <id>.L <type>.B <value>.B (ZC_SPRITE_CHANGE)
/// 01d7 <id>.L <type>.B <value>.L (ZC_SPRITE_CHANGE2)
//For the stupid cloth-dye bug. Resends the given view data to the area specified by bl.
/// Character status (ZC_STATUS).
/// 00bd <stpoint>.W <str>.B <need str>.B <agi>.B <need agi>.B <vit>.B <need vit>.B
///     <int>.B <need int>.B <dex>.B <need dex>.B <luk>.B <need luk>.B <atk>.W <atk2>.W
///     <matk min>.W <matk max>.W <def>.W <def2>.W <mdef>.W <mdef2>.W <hit>.W
///     <flee>.W <flee2>.W <crit>.W <aspd>.W <aspd2>.W
//Negative check for Frenzy'ed characters.
// aspd
// always 0 (plusASPD)
/// Marks an ammunition item in inventory as equipped (ZC_EQUIP_ARROW).
/// 013c <index>.W
//Item ID of the arrow
/// Ammunition action message (ZC_ACTION_FAILURE).
/// 013b <type>.W
/// type:
///     0 = MsgStringTable[242]="Please equip the proper ammunition first."
///     1 = MsgStringTable[243]="You can't Attack or use Skills because your Weight Limit has been exceeded."
///     2 = MsgStringTable[244]="You can't use Skills because Weight Limit has been exceeded."
///     3 = assassin, baby_assassin, assassin_cross => MsgStringTable[1040]="You have equipped throwing daggers."
///         gunslinger => MsgStringTable[1175]="Bullets have been equipped."
///         NOT ninja => MsgStringTable[245]="Ammunition has been equipped."
/// Presents a list of items, that can be processed by Arrow Crafting (ZC_MAKINGARROW_LIST).
/// 01ad <packet len>.W { <name id>.W }*
/// Notifies the client, about the result of an status change request (ZC_STATUS_CHANGE_ACK).
/// 00bc <status id>.W <result>.B <value>.B
/// status id:
///     SP_STR ~ SP_LUK
/// result:
///     0 = failure
///     1 = success
/// Notifies the client about the result of a request to equip an item (ZC_REQ_WEAR_EQUIP_ACK).
/// 00aa <index>.W <equip location>.W <result>.B
/// 00aa <index>.W <equip location>.W <view id>.W <result>.B (PACKETVER >= 20100629)
/// Notifies the client about the result of a request to take off an item (ZC_REQ_TAKEOFF_EQUIP_ACK).
/// 00ac <index>.W <equip location>.W <result>.B
/// Notifies clients in the area about an special/visual effect (ZC_NOTIFY_EFFECT).
/// 019b <id>.L <effect id>.L
/// effect id:
///     0 = base level up
///     1 = job level up
///     2 = refine failure
///     3 = refine success
///     4 = game over
///     5 = pharmacy success
///     6 = pharmacy failure
///     7 = base level up (super novice)
///     8 = job level up (super novice)
///     9 = base level up (taekwon)
/// Notifies clients in the area of a state change.
/// 0119 <id>.L <body state>.W <health state>.W <effect state>.W <pk mode>.B (ZC_STATE_CHANGE)
/// 0229 <id>.L <body state>.W <health state>.W <effect state>.L <pk mode>.B (ZC_STATE_CHANGE3)
//How can an option change if there's no sc?
/// Displays status change effects on NPCs/monsters (ZC_NPC_SHOWEFST_UPDATE).
/// 028a <id>.L <effect state>.L <level>.L <showEFST>.L
//How can an option change if there's no sc?
/// Notifies the client about the result of an item use request.
/// 00a8 <index>.W <amount>.W <result>.B (ZC_USE_ITEM_ACK)
/// 01c8 <index>.W <name id>.W <id>.L <amount>.W <result>.B (ZC_USE_ITEM_ACK2)
/// Inform client whether chatroom creation was successful or not (ZC_ACK_CREATE_CHATROOM).
/// 00d6 <flag>.B
/// flag:
///     0 = Room has been successfully created (opens chat room)
///     1 = Room limit exceeded
///     2 = Same room already exists
// TODO: Flag enum
/// Display a chat above the owner (ZC_ROOM_NEWENTRY).
/// 00d7 <packet len>.W <owner id>.L <char id>.L <limit>.W <users>.W <type>.B <title>.?B
/// type:
///     0 = private (password protected)
///     1 = public
///     2 = arena (npc waiting room)
///     3 = PK zone (non-clickable)
// not zero-terminated
/// Chatroom properties adjustment (ZC_CHANGE_CHATROOM).
/// 00df <packet len>.W <owner id>.L <chat id>.L <limit>.W <users>.W <type>.B <title>.?B
/// type:
///     0 = private (password protected)
///     1 = public
///     2 = arena (npc waiting room)
///     3 = PK zone (non-clickable)
// not zero-terminated
/// Removes the chatroom (ZC_DESTROY_ROOM).
/// 00d8 <chat id>.L
/// Displays messages regarding join chat failures (ZC_REFUSE_ENTER_ROOM).
/// 00da <result>.B
/// result:
///     0 = room full
///     1 = wrong password
///     2 = kicked
///     3 = success (no message)
///     4 = no enough zeny
///     5 = too low level
///     6 = too high level
///     7 = unsuitable job class
/// Notifies the client about entering a chatroom (ZC_ENTER_ROOM).
/// 00db <packet len>.W <chat id>.L { <role>.L <name>.24B }*
/// role:
///     0 = owner (menu)
///     1 = normal
/// Notifies clients in a chat about a new member (ZC_MEMBER_NEWENTRY).
/// 00dc <users>.W <name>.24B
/// Announce the new owner (ZC_ROLE_CHANGE).
/// 00e1 <role>.L <nick>.24B
/// role:
///     0 = owner (menu)
///     1 = normal
/// Notify about user leaving the chatroom (ZC_MEMBER_EXIT).
/// 00dd <users>.W <nick>.24B <flag>.B
/// flag:
///     0 = left
///     1 = kicked
/// Opens a trade request window from char 'name'.
/// 00e5 <nick>.24B (ZC_REQ_EXCHANGE_ITEM)
/// 01f4 <nick>.24B <charid>.L <baselvl>.W (ZC_REQ_EXCHANGE_ITEM2)
// PACKETVER >= 6
// PACKETVER >= 6
// PACKETVER < 6
/// Reply to a trade-request.
/// 00e7 <result>.B (ZC_ACK_EXCHANGE_ITEM)
/// 01f5 <result>.B <charid>.L <baselvl>.W (ZC_ACK_EXCHANGE_ITEM2)
/// result:
///     0 = Char is too far
///     1 = Character does not exist
///     2 = Trade failed
///     3 = Accept
///     4 = Cancel
///     5 = Busy
// PACKETVER >= 6
// PACKETVER >= 6
/// Notifies the client about an item from other player in current trade.
/// 00e9 <amount>.L <nameid>.W <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W (ZC_ADD_EXCHANGE_ITEM)
/// 080f <nameid>.W <item type>.B <amount>.L <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W (ZC_ADD_EXCHANGE_ITEM2)
//index fix
/// Notifies the client about the result of request to add an item to the current trade (ZC_ACK_ADD_EXCHANGE_ITEM).
/// 00ea <index>.W <result>.B
/// result:
///     0 = success
///     1 = overweight
///     2 = trade canceled
///     3 = amount is exceeded. message 0x792
///     4 = other amount is exceeded. message 0x793
/// Notifies the client about finishing one side of the current trade (ZC_CONCLUDE_EXCHANGE_ITEM).
/// 00ec <who>.B
/// who:
///     0 = self
///     1 = other player
/// Notifies the client about the trade being canceled (ZC_CANCEL_EXCHANGE_ITEM).
/// 00ee
/// Result of a trade (ZC_EXEC_EXCHANGE_ITEM).
/// 00f0 <result>.B
/// result:
///     0 = success
///     1 = failure
/// Resets the trade window on the send side (ZC_EXCHANGEITEM_UNDO).
/// 00f1
/// NOTE: Unknown purpose. Items are not removed until the window is
///       refreshed (ex. by putting another item in there).
/// unused
/// Updates storage total amount (ZC_NOTIFY_STOREITEM_COUNTINFO).
/// 00f2 <current count>.W <max count>.W
/// Notifies the client of an item being added to the storage.
/// 00f4 <index>.W <amount>.L <nameid>.W <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W (ZC_ADD_ITEM_TO_STORE)
/// 01c4 <index>.W <amount>.L <nameid>.W <type>.B <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W (ZC_ADD_ITEM_TO_STORE2)
// Storage item added
// index
// amount
// id
//type
//identify flag
// attribute
//refine
/// Notifies the client of an item being deleted from the storage (ZC_DELETE_ITEM_FROM_STORE).
/// 00f6 <index>.W <amount>.L
// Storage item removed
/// Closes storage (ZC_CLOSE_STORE).
/// 00f8
// Storage Closed
/*==========================================
//Party-mate, or hpdisp setting.
//BattleGround
// display link (sd - dstsd) to sd
// display links (dstsd - devotees) to sd
// display link (dstsd - crusader) to sd
// Hide NPC from maya purple card.
// tiny/big players [Valaris]
// Devotion Effects
// tiny/big mobs [Valaris]
// must show hp bar to all char who already hit the mob.
// needed to display pet equip properly
//Modifies the type of damage according to status changes [Skotlex]
//Aegis data specifies that: 4 endure against single hit sources, 9 against multi-hit.
/*==========================================
//Multi-hit skills mean higher delays.
//Return 1 to specify there should be no noticeable delay, but you should stop walking.
/// Sends a 'damage' packet (src performs action on dst)
/// 008a <src ID>.L <dst ID>.L <server tick>.L <src speed>.L <dst speed>.L <damage>.W <div>.W <type>.B <damage2>.W (ZC_NOTIFY_ACT)
/// 02e1 <src ID>.L <dst ID>.L <server tick>.L <src speed>.L <dst speed>.L <damage>.L <div>.W <type>.B <damage2>.L (ZC_NOTIFY_ACT2)
/// 08c8 <src ID>.L <dst ID>.L <server tick>.L <src speed>.L <dst speed>.L <damage>.L <IsSPDamage>.B <div>.W <type>.B <damage2>.L (ZC_NOTIFY_ACT2)
/// type: @see enum battle_dmg_type
///     for BDT_NORMAL: [ damage: total damage, div: amount of hits, damage2: assassin dual-wield damage ]
// TODO: IsSPDamage - Displays blue digits.
//Return adjusted can't walk delay for further processing.
/*==========================================
//clif->damage(src,dst,0,0,0,0,BDT_PICKUP,0);
/*==========================================
/*==========================================
/// Inform client(s) about a map-cell change (ZC_UPDATE_MAPINFO).
/// 0192 <x>.W <y>.W <type>.W <map name>.16B
/// Notifies the client about an item on floor (ZC_ITEM_ENTRY).
/// 009d <id>.L <name id>.W <identified>.B <x>.W <y>.W <amount>.W <subX>.B <subY>.B
/// Notifies the client of a skill unit.
/// 011f <id>.L <creator id>.L <x>.W <y>.W <unit id>.B <visible>.B (ZC_SKILL_ENTRY)
/// 01c9 <id>.L <creator id>.L <x>.W <y>.W <unit id>.B <visible>.B <has msg>.B <msg>.80B (ZC_SKILL_ENTRY2)
/// 08c7 <lenght>.W <id> L <creator id>.L <x>.W <y>.W <unit id>.B <range>.W <visible>.B (ZC_SKILL_ENTRY3)
/// 099f <lenght>.W <id> L <creator id>.L <x>.W <y>.W <unit id>.L <range>.W <visible>.B (ZC_SKILL_ENTRY4)
// Use invisible unit id for some ground skills.
/*==========================================
/// Removes a skill unit (ZC_SKILL_DISAPPEAR).
/// 0120 <id>.L
/// Sent when an object gets ankle-snared (ZC_SKILL_UPDATE).
/// 01ac <id>.L
/// Only affects units with class [139,153] client-side.
/*==========================================
/*==========================================
// bl can be null pointer? and after if BL_PC, sd will be null pointer too
//tsd has lost sight of the bl object.
//sd is watching tbl go out of view.
//Trap knocked out of sight
/*==========================================
//Tell tsd that bl entered into his view
//Tell sd that tbl walked into his view
/// Updates whole skill tree (ZC_SKILLINFO_LIST).
/// 010f <packet len>.W { <skill id>.W <type>.L <level>.W <sp cost>.W <attack range>.W <skill name>.24B <upgradable>.B }*
// workaround for bugreport:5348
// workaround for bugreport:5348; send the remaining skills one by one to bypass packet size limit
/**
/// Adds new skill to the skill tree (ZC_ADD_SKILL).
/// 0111 <skill id>.W <type>.L <level>.W <sp cost>.W <attack range>.W <skill name>.24B <upgradable>.B
/// Deletes a skill from the skill tree (ZC_SKILLINFO_DELETE).
/// 0441 <skill id>.W
/// Updates a skill in the skill tree (ZC_SKILLINFO_UPDATE).
/// 010e <skill id>.W <level>.W <sp cost>.W <attack range>.W <upgradable>.B
/// Merged clif_skillup and clif_guild_skillup, same packet was used [panikon]
/// flag:
///  0: guild call
///  1: player call
/// Updates a skill in the skill tree (ZC_SKILLINFO_UPDATE2).
/// 07e1 <skill id>.W <type>.L <level>.W <sp cost>.W <attack range>.W <upgradable>.B
/// Notifies clients in area, that an object is about to use a skill.
/// 013e <src id>.L <dst id>.L <x>.W <y>.W <skill id>.W <property>.L <delaytime>.L (ZC_USESKILL_ACK)
/// 07fb <src id>.L <dst id>.L <x>.W <y>.W <skill id>.W <property>.L <delaytime>.L <is disposable>.B (ZC_USESKILL_ACK2)
/// property:
///     0 = Yellow cast aura
///     1 = Water elemental cast aura
///     2 = Earth elemental cast aura
///     3 = Fire elemental cast aura
///     4 = Wind elemental cast aura
///     5 = Poison elemental cast aura
///     6 = Holy elemental cast aura
///     ? = like 0
/// is disposable:
///     0 = yellow chat text "[src name] will use skill [skill name]."
///     1 = no text
//Avoid sending negatives as element [Skotlex]
/// Notifies clients in area, that an object canceled casting (ZC_DISPEL).
/// 01b9 <id>.L
/// Notifies the client about the result of a skill use request (ZC_ACK_TOUSESKILL).
/// 0110 <skill id>.W <num>.L <result>.B <cause>.B
/// num (only used when skill id = NV_BASIC and cause = 0):
///     0 = "skill failed" MsgStringTable[159]
///     1 = "no emotions" MsgStringTable[160]
///     2 = "no sit" MsgStringTable[161]
///     3 = "no chat" MsgStringTable[162]
///     4 = "no party" MsgStringTable[163]
///     5 = "no shout" MsgStringTable[164]
///     6 = "no PKing" MsgStringTable[165]
///     7 = "no aligning" MsgStringTable[383]
///     ? = ignored
/// cause:
///     0 = "not enough skill level" MsgStringTable[214] (AL_WARP)
///         "steal failed" MsgStringTable[205] (TF_STEAL)
///         "envenom failed" MsgStringTable[207] (TF_POISON)
///         "skill failed" MsgStringTable[204] (otherwise)
///   ... = @see enum useskill_fail_cause
///     ? = ignored
///
/// if(result!=0) doesn't display any of the previous messages
/// Note: when this packet is received an unknown flag is always set to 0,
/// suggesting this is an ACK packet for the UseSkill packets and should be sent on success too [FlavioJS]
//Since this is the most common nullpo....
//Disable all skill failed messages
//Disable delay failed messages
// 0 - failed
/// Skill cooldown display icon (ZC_SKILL_POSTDELAY).
/// 043d <skill ID>.W <tick>.L
/// Skill attack effect and damage.
/// 0114 <skill id>.W <src id>.L <dst id>.L <tick>.L <src delay>.L <dst delay>.L <damage>.W <level>.W <div>.W <type>.B (ZC_NOTIFY_SKILL)
/// 01de <skill id>.W <src id>.L <dst id>.L <tick>.L <src delay>.L <dst delay>.L <damage>.L <level>.W <div>.W <type>.B (ZC_NOTIFY_SKILL2)
//bugreport:8263
// For some reason, late 2013 and newer clients have
// a issue that causes players and monsters to endure
// type 6 (ACTION_SKILL) skills. So we have to do a small
// hack to set all type 6 to be sent as type 8 ACTION_ATTACK_MULTIPLE
//Because the damage delay must be synced with the client, here is where the can-walk tick must be updated. [Skotlex]
/// Ground skill attack effect and damage (ZC_NOTIFY_SKILL_POSITION).
/// 0115 <skill id>.W <src id>.L <dst id>.L <tick>.L <src delay>.L <dst delay>.L <x>.W <y>.W <damage>.W <level>.W <div>.W <type>.B
//Because the damage delay must be synced with the client, here is where the can-walk tick must be updated. [Skotlex]
// 0
/// Non-damaging skill effect.
/// 011a <skill id>.W <skill lv>.W <dst id>.L <src id>.L <result>.B (ZC_USE_SKILL)
/// 09cb <skill id>.W <skill lv>.L <dst id>.L <src id>.L <result>.B (ZC_USE_SKILL2)
/// Non-damaging ground skill effect (ZC_NOTIFY_GROUNDSKILL).
/// 0117 <skill id>.W <src id>.L <level>.W <x>.W <y>.W <tick>.L
/// Presents a list of available warp destinations (ZC_WARPLIST).
/// 011c <skill id>.W { <map name>.16B }*4
// normal map name
//Store warp position here.
/// Memo message (ZC_ACK_REMEMBER_WARPPOINT).
/// 011e <type>.B
/// type:
///     0 = "Saved location as a Memo Point for Warp skill." in color 0xFFFF00 (cyan)
///     1 = "Skill Level is not high enough." in color 0x0000FF (red)
///     2 = "You haven't learned Warp." in color 0x0000FF (red)
///     3 = "Cannot save location as a Memo Point at current location." in color 0x0000FF (red)
///
/// @param sd Who receives the message
/// @param type What message
/// Teleport message (ZC_NOTIFY_MAPINFO).
/// 0189 <type>.W
/// type:
///     0 = "Unable to Teleport in this area" in color 0xFFFF00 (cyan)
///     1 = "Saved point cannot be memorized." in color 0x0000FF (red)
///     2 = "This skill cannot be used within this area." in color 0xFFFF00 (cyan)
///     3 = "This item cannot be used within this area." in color 0xFFFF00 (cyan)
///
/// @param sd Who receives the message
/// @param type What message
/// Displays Sense (WZ_ESTIMATION) information window (ZC_MONSTER_INFO).
/// 018c <class>.W <level>.W <size>.W <hp>.L <def>.W <race>.W <mdef>.W <element>.W
///     <water%>.B <earth%>.B <fire%>.B <wind%>.B <poison%>.B <holy%>.B <shadow%>.B <ghost%>.B <undead%>.B
// WBUFB(buf,20+i)= (unsigned char)battle->attr_ratio(i+1,dstatus->def_ele, dstatus->ele_lv);
// The following caps negative attributes to 0 since the client displays them as 255-fix. [Skotlex]
/// Presents a textual list of producible items (ZC_MAKABLEITEMLIST).
/// 018d <packet len>.W { <name id>.W { <material id>.W }*3 }*
/// material id:
///     unused by the client
//Avoid resending the menu twice or more times...
/// Present a list of producible items (ZC_MAKINGITEM_LIST).
/// 025a <packet len>.W <mk type>.W { <name id>.W }*
/// mk type:
///     1 = cooking
///     2 = arrow
///     3 = elemental
///     4 = GN_MIX_COOKING
///     5 = GN_MAKEBOMB
///     6 = GN_S_PHARMACY
// list type
// Only send it while Cooking else check for c.
// amount.
// AM_PHARMACY is used to Cooking.
// It fails.
//It shows nothing on the client...
// only send status changes that actually matter to the client
/// Notifies clients of a status change.
/// 0196 <index>.W <id>.L <state>.B (ZC_MSG_STATE_CHANGE) [used for ending status changes and starting them on non-pc units (when needed)]
/// 043f <index>.W <id>.L <state>.B <remain msec>.L { <val>.L }*3 (ZC_MSG_STATE_CHANGE2) [used exclusively for starting statuses on pcs]
/// 08ff <id>.L <index>.W <remain msec>.L { <val>.L }*3  (PACKETVER >= 20111108)
/// 0983 <index>.W <id>.L <state>.B <total msec>.L <remain msec>.L { <val>.L }*3 (PACKETVER >= 20120618)
/// 0984 <id>.L <index>.W <total msec>.L <remain msec>.L { <val>.L }*3 (PACKETVER >= 20120618)
//It shows nothing on the client...
// only send status changes that actually matter to the client
/// Notifies clients of a status change.
/// @see clif_status_change_sub
/// Send message (modified by [Yor]) (ZC_NOTIFY_PLAYERCHAT).
/// 008e <packet len>.W <message>.?B
/** for some reason game client crashes depending on message pattern (only for this packet) **/
/** so we redirect to ZC_NPC_CHAT **/
// don't send a void message (it's not displaying on the client chat). @help can send void line.
// 4 + len + NUL terminate
//Scrapped, as these are shared by disconnected players =X [Skotlex]
// Limit message to 255+1 characters (otherwise it causes a buffer overflow in the client)
// Limit message to 255+1 characters (otherwise it causes a buffer overflow in the client)
// don't send a void message (it's not displaying on the client chat). @help can send void line.
// 4 + len + NULL terminate
/* oh noo! another version of 0x8e! */
/* ensure the maximum */
/* process */
/* adjusting */
/* */
// 4 + len + NULL terminate
/// Send broadcast message in yellow or blue without font formatting (ZC_BROADCAST).
/// 009a <packet len>.W <message>.?B
//If there's "blue" at the beginning of the message, game client will display it in blue instead of yellow.
//If there's "ssss", game client will recognize message as 'WoE broadcast'.
/*==========================================
/// Send broadcast message with font formatting (ZC_BROADCAST2).
/// 01c3 <packet len>.W <fontColor>.L <fontType>.W <fontSize>.W <fontAlign>.W <fontY>.W <message>.?B
/// Displays heal effect (ZC_RECOVERY).
/// 013d <var id>.W <amount>.W
/// var id:
///     5 = HP (SP_HP)
///     7 = SP (SP_SP)
///     ? = ignored
/// Displays resurrection effect (ZC_RESURRECTION).
/// 0148 <id>.L <type>.W
/// type:
///     ignored
/// Sets the map property (ZC_NOTIFY_MAPPROPERTY).
/// 0199 <type>.W
/// Set the map type (ZC_NOTIFY_MAPPROPERTY2).
/// 01d6 <type>.W
/// Updates PvP ranking (ZC_NOTIFY_RANKING).
/// 019a <id>.L <ranking>.L <total>.L
// FIXME: missing documentation for the 'type' parameter
// TODO[Haru] Should this be pc_ishiding(sd)? (i.e. include Chase Walk and any new options)
//On client displays as --
//Causes crashes when a 'mob' with pvp info dies.
/*==========================================
/// Notifies the client about the result of a refine attempt (ZC_ACK_ITEMREFINING).
/// 0188 <result>.W <index>.W <refine>.W
/// result:
///     0 = success
///     1 = failure
///     2 = downgrade
/// Notifies the client about the result of a weapon refine attempt (ZC_ACK_WEAPONREFINE).
/// 0223 <result>.L <nameid>.W
/// result:
///     0 = "weapon upgraded: %s" MsgStringTable[911] in rgb(0,255,255)
///     1 = "weapon upgraded: %s" MsgStringTable[912] in rgb(0,205,205)
///     2 = "cannot upgrade %s until you level up the upgrade weapon skill" MsgStringTable[913] in rgb(255,200,200)
///     3 = "you lack the item %s to upgrade the weapon" MsgStringTable[914] in rgb(255,200,200)
/// Whisper is transmitted to the destination player (ZC_WHISPER).
/// 0097 <packet len>.W <nick>.24B <message>.?B
/// 0097 <packet len>.W <nick>.24B <isAdmin>.L <message>.?B (PACKETVER >= 20091104)
// PACKETVER >= 20091104
// isAdmin; if nonzero, also displays text above char
/// Inform the player about the result of his whisper action (ZC_ACK_WHISPER).
/// 0098 <result>.B
/// result:
///     0 = success to send whisper
///     1 = target character is not logged in
///     2 = ignored by target
///     3 = everyone ignored by target
///     other = target character is not logged in
/// Returns character name requested by char_id (ZC_ACK_REQNAME_BYGID).
/// 0194 <char id>.L <name>.24B
/// 0af7 <flag>.W <char id>.L <name>.24B
/// Presents a list of items that can be carded/composed (ZC_ITEMCOMPOSITION_LIST).
/// 017b <packet len>.W { <index>.W }*
// no item is available for card insertion
/// Notifies the client about the result of item carding/composition (ZC_ACK_ITEMCOMPOSITION).
/// 017d <equip index>.W <card index>.W <result>.B
/// result:
///     0 = success
///     1 = failure
/// Presents a list of items that can be identified (ZC_ITEMIDENTIFY_LIST).
/// 0177 <packet len>.W { <index>.W }*
/// Notifies the client about the result of a item identify request (ZC_ACK_ITEMIDENTIFY).
/// 0179 <index>.W <result>.B
/// Presents a list of items that can be repaired (ZC_REPAIRITEMLIST).
/// 01fc <packet len>.W { <index>.W <name id>.W <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W }*
// && skill_can_repair(sd,nameid)) {
/// Notifies the client about the result of a item repair request (ZC_ACK_ITEMREPAIR).
/// 01fe <index>.W <result>.B
/// index:
///     ignored (inventory index)
/// result:
///     0 = Item repair success.
///     1 = Item repair failure.
/// Displays a message, that an equipment got damaged (ZC_EQUIPITEM_DAMAGED).
/// 02bb <equip location>.W <account id>.L
// TODO: the packet seems to be sent to other people as well, probably party and/or guild.
/// Presents a list of weapon items that can be refined [Taken from jAthena] (ZC_NOTIFY_WEAPONITEMLIST).
/// 0221 <packet len>.W { <index>.W <name id>.W <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W }*
/// Notification of an auto-casted skill (ZC_AUTORUN_SKILL).
/// 0147 <skill id>.W <type>.L <level>.W <sp cost>.W <atk range>.W <skill name>.24B <upgradeable>.B
/// Adds an item to character's cart.
/// 0124 <index>.W <amount>.L <name id>.W <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W (ZC_ADD_ITEM_TO_CART)
/// 01c5 <index>.W <amount>.L <name id>.W <type>.B <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W (ZC_ADD_ITEM_TO_CART2)
/// Deletes an item from character's cart (ZC_DELETE_ITEM_FROM_CART).
/// 0125 <index>.W <amount>.L
/// Opens the shop creation menu (ZC_OPENSTORE).
/// 012d <num>.W
/// num:
///     number of allowed item slots
/// Displays a vending board to target/area (ZC_STORE_ENTRY).
/// 0131 <owner id>.L <message>.80B
/// Removes a vending board from screen (ZC_DISAPPEAR_ENTRY).
/// 0132 <owner id>.L
/// Sends a list of items in a shop.
/// R 0133 <packet len>.W <owner id>.L { <price>.L <amount>.W <index>.W <type>.B <name id>.W <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W }* (ZC_PC_PURCHASE_ITEMLIST_FROMMC)
/// R 0800 <packet len>.W <owner id>.L <unique id>.L { <price>.L <amount>.W <index>.W <type>.B <name id>.W <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W }* (ZC_PC_PURCHASE_ITEMLIST_FROMMC2)
// [4144] date 20160921 not confirmed. Can be bigger or smaller
/// Shop purchase failure (ZC_PC_PURCHASE_RESULT_FROMMC).
/// 0135 <index>.W <amount>.W <result>.B
/// result:
///     0 = success
///     1 = not enough zeny
///     2 = overweight
///     4 = out of stock
///     5 = "cannot use an npc shop while in a trade"
///     6 = Because the store information was incorrect the item was not purchased.
///     7 = No sales information.
/// Shop creation success (ZC_PC_PURCHASE_MYITEMLIST).
/// 0136 <packet len>.W <owner id>.L { <price>.L <index>.W <amount>.W <type>.B <name id>.W <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W }*
// 0 - open vending success
// 1 - message MSG_MERCHANTSHOP_MAKING_FAIL
// 2 - silent ignore
// 3 - message MSG_ID_C9D (You can not open a stall at the current location)
// ZC_ACK_OPENSTORE2
/// Inform merchant that someone has bought an item.
/// 0137 <index>.W <amount>.W (ZC_DELETEITEM_FROM_MCSTORE).
/// 09e5 <index>.W <amount>.W <GID>.L <Date>.L <zeny>.L (ZC_DELETEITEM_FROM_MCSTORE2).
// TODO : not sure for client date [Napster]
// GID
// Date
// zeny
/// Result of organizing a party (ZC_ACK_MAKE_GROUP).
/// 00fa <result>.B
/// result:
///     0 = opens party window and shows MsgStringTable[77]="party successfully organized"
///     1 = MsgStringTable[78]="party name already exists"
///     2 = MsgStringTable[79]="already in a party"
///     3 = cannot organize parties on this map
///     ? = nothing
/// Adds new member to a party.
/// role:
///     0 = leader
///     1 = normal
/// state:
///     0 = connected
///     1 = disconnected
//Pick any party member (this call is used when changing item share rules)
//Should never happen...
/// Sends party information (ZC_GROUP_LIST).
/// role:
///     0 = leader
///     1 = normal
/// state:
///     0 = connected
///     1 = disconnected
// send only to self
// send to whole party
/// Updates the job and level of a party member
/// 0abd <account id>.L <job>.W <level>.W
/// The player's 'party invite' state, sent during login (ZC_PARTY_CONFIG).
/// 02c9 <flag>.B
/// flag:
///     0 = allow party invites
///     1 = auto-deny party invites
/// Party invitation request.
/// 00fe <party id>.L <party name>.24B (ZC_REQ_JOIN_GROUP)
/// 02c6 <party id>.L <party name>.24B (ZC_PARTY_JOIN_REQ)
/// Party invite result.
/// 00fd <nick>.24S <result>.B (ZC_ACK_REQ_JOIN_GROUP)
/// 02c5 <nick>.24S <result>.L (ZC_PARTY_JOIN_REQ_ACK)
/// result=0  : char is already in a party -> MsgStringTable[80]
/// result=1  : party invite was rejected -> MsgStringTable[81]
/// result=2  : party invite was accepted -> MsgStringTable[82]
/// result=3  : party is full -> MsgStringTable[83]
/// result=4  : char of the same account already joined the party -> MsgStringTable[608]
/// result=5  : char blocked party invite -> MsgStringTable[1324] (since 20070904)
/// result=7  : char is not online or doesn't exist -> MsgStringTable[71] (since 20070904)
/// result=8  : (%s) are currently in restricted map to join a party. -> MsgStringTable[1388] (since 20080527)
/// result=9  : Cannot join a party in this map. -> MsgStringTable[1871] (since 20110215)
/// result=10 : You cannot invite or withdraw while in memorial dungeon -> message: MSG_ID_BD3 (since 20161130)
/// result=11 : The character is a level that can not join the party -> message: MSG_ID_C9A (since 20170412)
// Character not found.
/// Updates party settings.
/// 0101 <exp option>.L (ZC_GROUPINFO_CHANGE)
/// 07d8 <exp option>.L <item pick rule>.B <item share rule>.B (ZC_REQ_GROUPINFO_CHANGE_V2)
/// exp option:
///     0 = exp sharing disabled
///     1 = exp sharing enabled
///     2 = cannot change exp sharing
///
/// flag:
///     0 = send to party
///     1 = send to sd
/// 0105 <account id>.L <char name>.24B <result>.B (ZC_DELETE_MEMBER_FROM_GROUP).
/// result:
///     0 = leave
///     1 = expel
///     2 = cannot leave party on this map
///     3 = cannot expel from party on this map
// TODO: Document this flag
// Search for any online party member
/// Party chat message (ZC_NOTIFY_CHAT_PARTY).
/// 0109 <packet len>.W <account id>.L <message>.?B
/// Updates the position of a party member on the minimap (ZC_NOTIFY_POSITION_TO_GROUPM).
/// 0107 <account id>.L <x>.W <y>.W
/*==========================================
/// Updates HP bar of a party member.
/// 0106 <account id>.L <hp>.W <max hp>.W (ZC_NOTIFY_HP_TO_GROUPM)
/// 080e <account id>.L <hp>.L <max hp>.L (ZC_NOTIFY_HP_TO_GROUPM_R2)
//To correctly display the %hp bar. [Skotlex]
/*==========================================
// To correctly display the %hp bar. [Skotlex]
/// Notifies the client, that it's attack target is too far (ZC_ATTACK_FAILURE_FOR_DISTANCE).
/// 0139 <target id>.L <target x>.W <target y>.W <x>.W <y>.W <atk range>.W
/// Notifies the client about the result of an item produce request (ZC_ACK_REQMAKINGITEM).
/// 018f <result>.W <name id>.W
/// result:
///     0 = success
///     1 = failure
///     2 = success (alchemist)
///     3 = failure (alchemist)
///     4 = success (???)
///     5 = failure (???)
///     6 = failure (???)
///     7 = failure (???)
/// Initiates the pet taming process (ZC_START_CAPTURE).
/// 019e
/// Displays the result of a pet taming attempt (ZC_TRYCAPTURE_MONSTER).
/// 01a0 <result>.B
///     0 = failure
///     1 = success
/// Presents a list of pet eggs that can be hatched (ZC_PETEGG_LIST).
/// 01a6 <packet len>.W { <index>.W }*
//Disable pet hatching in GvG grounds during Guild Wars [Skotlex]
// "Pets are not allowed in Guild Wars."
/// Sends a specific pet data update (ZC_CHANGESTATE_PET).
/// 01a4 <type>.B <id>.L <data>.L
/// type:
///     0 = pre-init (data = 0)
///     1 = intimacy (data = 0~4)
///     2 = hunger (data = 0~4)
///     3 = accessory
///     4 = performance (data = 1~3: normal, 4: special)
///     5 = hairstyle
///     6 = close egg selection ui and update egg in inventory (PACKETVER >= 20180704)
///
/// If sd is null, the update is sent to nearby objects, otherwise it is sent only to that player.
/// Pet's base data (ZC_PROPERTY_PET).
/// 01a2 <name>.24B <renamed>.B <level>.W <hunger>.W <intimacy>.W <accessory id>.W <class>.W
/// Notification about a pet's emotion/talk (ZC_PET_ACT).
/// 01aa <id>.L <data>.L
/// data:
///     @see CZ_PET_ACT.
// replace mob_id component of talk/act data
/// Result of request to feed a pet (ZC_FEED_PET).
/// 01a3 <result>.B <name id>.W
/// result:
///     0 = failure
///     1 = success
/// Presents a list of skills that can be auto-spelled (ZC_AUTOSPELLLIST).
/// 01cd { <skill id>.L }*7
// reserve space for 7 skills
/// Devotion's visual effect (ZC_DEVOTIONLIST).
/// 01cf <devoter id>.L { <devotee id>.L }*5 <max distance>.W
/*==========================================
//init to 0
/// Notifies clients in area of a character's combo delay (ZC_COMBODELAY).
/// 01d2 <account id>.L <delay>.L
/// Notifies clients in area that a character has blade-stopped another (ZC_BLADESTOP).
/// 01d1 <src id>.L <dst id>.L <flag>.L
/// flag:
///     0 = inactive
///     1 = active
/// MVP effect (ZC_MVP).
/// 010c <account id>.L
/// MVP item reward message (ZC_MVP_GETTING_ITEM).
/// 010a <name id>.W
/// 010a <name id>.L
/// MVP EXP reward message (ZC_MVP_GETTING_SPECIAL_EXP).
/// 010b <exp>.L
/// Dropped MVP item reward message (ZC_THROW_MVPITEM).
/// 010d
///
/// "You are the MVP, but cannot obtain the reward because
///     you are overweight."
/// Guild creation result (ZC_RESULT_MAKE_GUILD).
/// 0167 <result>.B
/// result:
///     0 = "Guild has been created."
///     1 = "You are already in a Guild."
///     2 = "That Guild Name already exists."
///     3 = "You need the necessary item to create a Guild."
///     4 = "Can't create a Guild in this area."
/// Notifies the client that it is belonging to a guild (ZC_UPDATE_GDID).
/// 016c <guild id>.L <emblem id>.L <mode>.L <ismaster>.B <inter sid>.L <guild name>.24B
/// mode: @see enum guild_permission
// InterSID (unknown purpose)
/// Guild member login notice.
/// 016d <account id>.L <char id>.L <status>.L (ZC_UPDATE_CHARSTAT)
/// 01f2 <account id>.L <char id>.L <status>.L <gender>.W <hair style>.W <hair color>.W (ZC_UPDATE_CHARSTAT2)
/// status:
///     0 = offline
///     1 = online
// Function `clif_guild_memberlogin_notice` sends info about
// logins and logouts of a guild member to the rest members.
// But at the 1st time (after a player login or map changing)
// the client won't show the message.
// So I suggest use this function for sending "first-time-info"
// to some player on entering the game or changing location.
// At next time the client would always show the message.
// The function sends all the statuses in the single packet
// to economize traffic. [LuzZza]
/// Bitmask of enabled guild window tabs (ZC_ACK_GUILD_MENUINTERFACE).
/// 014e <menu flag>.L
/// menu flag:
///      0x00 = Basic Info (always on)
///     &0x01 = Member manager
///     &0x02 = Positions
///     &0x04 = Skills
///     &0x10 = Expulsion list
///     &0x40 = Unknown (GMENUFLAG_ALLGUILDLIST)
///     &0x80 = Notice
/// Guild basic information (Territories [Valaris])
/// 0150 <guild id>.L <level>.L <member num>.L <member max>.L <exp>.L <max exp>.L <points>.L <honor>.L <virtue>.L <emblem id>.L <name>.24B <master name>.24B <manage land>.16B (ZC_GUILD_INFO)
/// 01b6 <guild id>.L <level>.L <member num>.L <member max>.L <exp>.L <max exp>.L <points>.L <honor>.L <virtue>.L <emblem id>.L <name>.24B <master name>.24B <manage land>.16B <zeny>.L (ZC_GUILD_INFO2)
//0x150; [4144] this is packet for older versions?
// Tax Points
// Honor: (left) Vulgar [-100,100] Famed (right)
// Virtue: (down) Wicked [-100,100] Righteous (up)
// "'N' castles"
// zeny
// "'N' castles"
// zeny
// leader
/// Guild alliance and opposition list (ZC_MYGUILD_BASIC_INFO).
/// 014c <packet len>.W { <relation>.L <guild id>.L <guild name>.24B }*
/// Guild member manager information (ZC_MEMBERMGR_INFO).
/// 0154 <packet len>.W { <account>.L <char id>.L <hair style>.W <hair color>.W <gender>.W <class>.W <level>.W <contrib exp>.L <state>.L <position>.L <memo>.50B <name>.24B }*
/// state:
///     0 = offline
///     1 = online
/// memo:
///     probably member's self-introduction (unused, no client UI/packets for editing it)
//[Ind] - This is displayed in the 'note' column but being you can't edit it it's sent empty.
// [Megasantos] - Shows last date online
/// Guild position name information (ZC_POSITION_ID_NAME_INFO).
/// 0166 <packet len>.W { <position id>.L <position name>.24B }*
/// Guild position information (ZC_POSITION_INFO).
/// 0160 <packet len>.W { <position id>.L <mode>.L <ranking>.L <pay rate>.L }*
/// mode: @see enum guild_permission
/// ranking:
///     TODO
/// Notifies clients in a guild about updated position information (ZC_ACK_CHANGE_GUILD_POSITIONINFO).
/// 0174 <packet len>.W { <position id>.L <mode>.L <ranking>.L <pay rate>.L <position name>.24B }*
/// mode: @see enum guild_permission
/// ranking:
///     TODO
// FIXME: This packet is intended to update the clients after a
// commit of position info changes, not sending one packet per
// position.
// packet len
// GUILD_REG_POSITION_INFO{
// }*
/// Notifies clients in a guild about updated member position assignments (ZC_ACK_REQ_CHANGE_MEMBERS).
/// 0156 <packet len>.W { <account id>.L <char id>.L <position id>.L }*
// FIXME: This packet is intended to update the clients after a
// commit of member position assignment changes, not sending one
// packet per position.
// packet len
// MEMBER_POSITION_INFO{
// }*
/// Sends emblems bitmap data to the client that requested it (ZC_GUILD_EMBLEM_IMG).
/// 0152 <packet len>.W <guild id>.L <emblem id>.L <emblem data>.?B
/// Sends update of the guild id/emblem id to everyone in the area (ZC_CHANGE_GUILD).
/// 01b4 <id>.L <guild id>.L <emblem id>.W
// TODO this packet doesn't force the update of ui components that have the emblem visible
//      (emblem in the flag npcs and emblem over the head in agit maps) [FlavioJS]
/// Sends guild skills (ZC_GUILD_SKILLINFO).
/// 0162 <packet len>.W <skill points>.W { <skill id>.W <type>.L <level>.W <sp cost>.W <atk range>.W <skill name>.24B <upgradeable>.B }*
/// Sends guild notice to client (ZC_GUILD_NOTICE).
/// 016f <subject>.60B <notice>.120B
/// Guild invite (ZC_REQ_JOIN_GUILD).
/// 016a <guild id>.L <guild name>.24B
/// Reply to invite request (ZC_ACK_REQ_JOIN_GUILD).
/// 0169 <answer>.B
/// answer:
///     0 = Already in guild.
///     1 = Offer rejected.
///     2 = Offer accepted.
///     3 = Guild full.
///     4 = Offline or not exists
/// Notifies clients of a guild of a leaving member (ZC_ACK_LEAVE_GUILD).
/// 015a <char name>.24B <reason>.40B
/// Notifies clients of a guild of an expelled member.
/// 015c <char name>.24B <reason>.40B <account name>.24B (ZC_ACK_BAN_GUILD)
/// 0839 <char name>.24B <reason>.40B (ZC_ACK_BAN_GUILD_SSO)
// version unconfirmed
// account name (not used for security reasons)
/// Guild expulsion list (ZC_BAN_LIST).
/// 0163 <packet len>.W { <char name>.24B <account name>.24B <reason>.40B }*
/// 0163 <packet len>.W { <char name>.24B <reason>.40B }* (PACKETVER >= 20100803)
// version unconfirmed
// account name (not used for security reasons)
/// Guild chat message (ZC_GUILD_CHAT).
/// 017f <packet len>.W <message>.?B
// TODO: account_id is not used, candidate for deletion? [Ai4rei]
/// Request for guild alliance (ZC_REQ_ALLY_GUILD).
/// 0171 <inviter account id>.L <guild name>.24B
/// Notifies the client about the result of a alliance request (ZC_ACK_REQ_ALLY_GUILD).
/// 0173 <answer>.B
/// answer:
///     0 = Already allied.
///     1 = You rejected the offer.
///     2 = You accepted the offer.
///     3 = They have too any alliances.
///     4 = You have too many alliances.
///     5 = Alliances are disabled.
/// Notifies the client that a alliance or opposition has been removed (ZC_DELETE_RELATED_GUILD).
/// 0184 <other guild id>.L <relation>.L
/// relation:
///     0 = Ally
///     1 = Enemy
/// Notifies the client about the result of a opposition request (ZC_ACK_REQ_HOSTILE_GUILD).
/// 0181 <result>.B
/// result:
///     0 = Antagonist has been set.
///     1 = Guild has too many Antagonists.
///     2 = Already set as an Antagonist.
///     3 = Antagonists are disabled.
/// Adds alliance or opposition (ZC_ADD_RELATED_GUILD).
/// 0185 <relation>.L <guild id>.L <guild name>.24B
// 0
/// Notifies the client about the result of a guild break (ZC_ACK_DISORGANIZE_GUILD_RESULT).
/// 015e <reason>.L
///     0 = success
///     1 = invalid key (guild name, @see clif_parse_GuildBreak)
///     2 = there are still members in the guild
/// Displays emotion on an object (ZC_EMOTION).
/// 00c0 <id>.L <type>.B
/// type:
///     enum emotion_type
/// Displays the contents of a talkiebox trap (ZC_TALKBOX_CHATCONTENTS).
/// 0191 <id>.L <contents>.80B
/// Displays wedding effect centered on an object (ZC_CONGRATULATION).
/// 01ea <id>.L
/// Notifies the client of the name of the partner character (ZC_COUPLENAME).
/// 01e6 <partner name>.24B
// Send zero-length name if no partner, to initialize the client buffer.
/// Initiates the partner "taming" process [DracoRPG] (ZC_START_COUPLE).
/// 01e4
/// This packet while still implemented by the client is no longer being officially used.
// 0
/// Notice of divorce (ZC_DIVORCE).
/// 0205 <partner name>.24B
/// Marriage proposal (ZC_REQ_COUPLE).
/// 01e2 <account id>.L <char id>.L <char name>.24B
/// This packet while still implemented by the client is no longer being officially used.
// 0
/*==========================================
/// Notifies the client about the result of a request to disconnect another player (ZC_ACK_DISCONNECT_CHARACTER).
/// 00cd <result>.L (unknown packet version or invalid information at packet_len_table)
/// 00cd <result>.B
/// result:
///     0 = failure
///     1 = success
/// Displays various manner-related status messages (ZC_ACK_GIVE_MANNER_POINT).
/// 014a <result>.L
/// result:
///     0 = "A manner point has been successfully aligned."
///     1 = MP_FAILURE_EXHAUST
///     2 = MP_FAILURE_ALREADY_GIVING
///     3 = "Chat Block has been applied by GM due to your ill-mannerous action."
///     4 = "Automated Chat Block has been applied due to Anti-Spam System."
///     5 = "You got a good point from %s."
/// Follow-up to 0x14a type 3/5, informs who did the manner adjustment action (ZC_NOTIFY_MANNER_POINT_GIVEN).
/// 014b <type>.B <GM name>.24B
/// type:
///     0 = positive (unmute)
///     1 = negative (mute)
/// Notifies the client about the result of a request to allow/deny whispers from a player (ZC_SETTING_WHISPER_PC).
/// 00d1 <type>.B <result>.B
/// type:
///     0 = /ex (deny)
///     1 = /in (allow)
/// result:
///     0 = success
///     1 = failure
///     2 = too many blocks
/// Notifies the client about the result of a request to allow/deny whispers from anyone (ZC_SETTING_WHISPER_STATE).
/// 00d2 <type>.B <result>.B
/// type:
///     0 = /exall (deny)
///     1 = /inall (allow)
/// result:
///     0 = success
///     1 = failure
/// Play a BGM! [Rikter/Yommy] (ZC_PLAY_NPC_BGM).
/// 07fe <bgm>.24B
/// Plays/stops a wave sound (ZC_SOUND).
/// 01d3 <file name>.24B <act>.B <term>.L <npc id>.L
/// file name:
///     relative to data\wav
/// act:
///     0 = play (once)
///     1 = play (repeat, does not work)
///     2 = stops all sound instances of file name (does not work)
/// term:
///     unknown purpose, only relevant to act = 1
/// npc id:
///     The acoustic direction of the sound is determined by the
///     relative position of the NPC to the player (3D sound).
/// Displays special effects (npcs, weather, etc) [Valaris] (ZC_NOTIFY_EFFECT2).
/// 01f3 <id>.L <effect id>.L
/// effect id:
///     @see doc/effect_list.txt
/// Notifies clients of an special/visual effect that accepts an value (ZC_NOTIFY_EFFECT3).
/// 0284 <id>.L <effect id>.L <num data>.L
/// effect id:
///     @see doc/effect_list.txt
/// num data:
///     effect-dependent value
/// Remove special effects (ZC_REMOVE_EFFECT).
/// 0b0d <id>.L <effect id>.L
/// effect id:
///     @see doc/effect_list.txt
/**
/**
// Message without owner, not logged in chat
/**
// Notify the client that the storage is open
// Notify the client that the gstorage is open otherwise it will
// remain locked forever and nobody will be able to access it
// Shouldn't happen... The information should already be at the map-server
// refresh the client's screen, getting rid of any effects
// FIXME: just send to self, not area
// When you refresh, resend the death packet.
// unlike vending, resuming buyingstore crashes the client.
/* refresh-da */
// if no recipient specified just update nearby clients
// if no recipient specified just update nearby clients
/// Updates the object's (bl) name on client.
/// 0095 <id>.L <char name>.24B (ZC_ACK_REQNAME)
/// 0195 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B (ZC_ACK_REQNAMEALL)
/// 0A30 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B <title id>.L (ZC_ACK_REQNAMEALL2)
//Requesting your own "shadow" name. [Skotlex]
// Title System [Dastgir/Hercules]
// do not display party unless the player is also in a guild
/// Updates the object's (bl) name on client.
/// 0095 <id>.L <char name>.24B (ZC_ACK_REQNAME)
/// 0195 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B (ZC_ACK_REQNAMEALL)
/// 0A30 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B <title id>.L (ZC_ACK_REQNAMEALL2)
/// Updates the object's (bl) name on client.
/// 0095 <id>.L <char name>.24B (ZC_ACK_REQNAME)
/// 0195 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B (ZC_ACK_REQNAMEALL)
/// 0A30 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B <title id>.L (ZC_ACK_REQNAMEALL2)
/// Updates the object's (bl) name on client.
/// 0095 <id>.L <char name>.24B (ZC_ACK_REQNAME)
/// 0195 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B (ZC_ACK_REQNAMEALL)
/// 0A30 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B <title id>.L (ZC_ACK_REQNAMEALL2)
/// Updates the object's (bl) name on client.
/// 0095 <id>.L <char name>.24B (ZC_ACK_REQNAME)
/// 0195 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B (ZC_ACK_REQNAMEALL)
/// 0A30 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B <title id>.L (ZC_ACK_REQNAMEALL2)
/// Updates the object's (bl) name on client.
/// 0095 <id>.L <char name>.24B (ZC_ACK_REQNAME)
/// 0195 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B (ZC_ACK_REQNAMEALL)
/// 0A30 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B <title id>.L (ZC_ACK_REQNAMEALL2)
/// Updates the object's (bl) name on client.
/// 0095 <id>.L <char name>.24B (ZC_ACK_REQNAME)
/// 0195 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B (ZC_ACK_REQNAMEALL)
/// 0A30 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B <title id>.L (ZC_ACK_REQNAMEALL2)
/// Updates the object's (bl) name on client.
/// 0095 <id>.L <char name>.24B (ZC_ACK_REQNAME)
/// 0195 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B (ZC_ACK_REQNAMEALL)
/// 0A30 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B <title id>.L (ZC_ACK_REQNAMEALL2)
//Even thought mobhp ain't a name, we send it as one so the client
//can parse it. [Skotlex]
//Remove trailing space + pipe.
/// Updates the object's (bl) name on client.
/// 0095 <id>.L <char name>.24B (ZC_ACK_REQNAME)
/// 0195 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B (ZC_ACK_REQNAMEALL)
/// 0A30 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B <title id>.L (ZC_ACK_REQNAMEALL2)
/// Updates the object's (bl) name on client.
/// 0095 <id>.L <char name>.24B (ZC_ACK_REQNAME)
/// 0195 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B (ZC_ACK_REQNAMEALL)
/// 0A30 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B <title id>.L (ZC_ACK_REQNAMEALL2)
// Clients DO request this... what should be done about it? The chat's title may not fit... [Skotlex]
/// Updates the object's (bl) name on client.
/// 0095 <id>.L <char name>.24B (ZC_ACK_REQNAME)
/// 0195 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B (ZC_ACK_REQNAMEALL)
/// 0A30 <id>.L <char name>.24B <party name>.24B <guild name>.24B <position name>.24B <title id>.L (ZC_ACK_REQNAMEALL2)
//Used to update when a char leaves a party/guild. [Skotlex]
//Needed because when you send a 0x95 packet, the client will not remove the cached party/guild info that is not sent.
//No need to update as the party/guild was not displayed anyway.
// Achievement System [Dastgir/Hercules]
// Update nearby clients
/// Taekwon Jump (TK_HIGHJUMP) effect (ZC_HIGHJUMP).
/// 01ff <id>.L <x>.W <y>.W
///
/// Visually moves(instant) a character to x,y. The char moves even
/// when the target cell isn't walkable. If the char is sitting it
/// stays that way.
/// Public chat message (ZC_NOTIFY_CHAT). lordalfa/Skotlex - used by @me as well
/// 008d <packet len>.W <id>.L <message>.?B
//Account for \0
//Trunk it to avoid problems.
// send message to others
// len of message + 8 (command+len+id)
// send back message to the speaker
// Account for \0
// Truncate to avoid problems.
/*==========================
/// Displays a skill message (thanks to Rayce) (ZC_SKILLMSG).
/// 0215 <msg id>.L
/// msg id:
///     0x15 = End all negative status (PA_GOSPEL)
///     0x16 = Immunity to all status (PA_GOSPEL)
///     0x17 = MaxHP +100% (PA_GOSPEL)
///     0x18 = MaxSP +100% (PA_GOSPEL)
///     0x19 = All stats +20 (PA_GOSPEL)
///     0x1c = Enchant weapon with Holy element (PA_GOSPEL)
///     0x1d = Enchant armor with Holy element (PA_GOSPEL)
///     0x1e = DEF +25% (PA_GOSPEL)
///     0x1f = ATK +100% (PA_GOSPEL)
///     0x20 = HIT/Flee +50 (PA_GOSPEL)
///     0x28 = Full strip failed because of coating (ST_FULLSTRIP)
///     ? = nothing
/// Multi-purpose mission information packet (ZC_STARSKILL).
/// 020e <mapname>.24B <monster_id>.L <star>.B <result>.B
/// result:
///      0 = Star Gladiator %s has designed <mapname>'s as the %s.
///      star:
///          0 = Place of the Sun
///          1 = Place of the Moon
///          2 = Place of the Stars
///      1 = Star Gladiator %s's %s: <mapname>
///      star:
///          0 = Place of the Sun
///          1 = Place of the Moon
///          2 = Place of the Stars
///      10 = Star Gladiator %s has designed <mapname>'s as the %s.
///      star:
///          0 = Target of the Sun
///          1 = Target of the Moon
///          2 = Target of the Stars
///      11 = Star Gladiator %s's %s: <mapname used as monster name>
///      star:
///          0 = Monster of the Sun
///          1 = Monster of the Moon
///          2 = Monster of the Stars
///      20 = [TaeKwon Mission] Target Monster : <mapname used as monster name> (<star>%)
///      21 = [Taming Mission] Target Monster : <mapname used as monster name>
///      22 = [Collector Rank] Target Item : <monster_id used as item id>
///      30 = [Sun, Moon and Stars Angel] Designed places and monsters have been reset.
///      40 = Target HP : <monster_id used as HP>
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/// Send configurations (ZC_CONFIG).
/// 02d9 <type>.L <value>.L
/// type:
///     0 = open equip window
///     3 = homunculus autofeeding
///     value:
///         0 = disabled
///         1 = enabled
/// The player's 'view equip' state, sent during login (ZC_CONFIG_NOTIFY).
/// 02da <open equip window>.B
/// open equip window:
///     0 = disabled
///     1 = enabled
/// Sends info about a player's equipped items.
/// 02d7 <packet len>.W <name>.24B <class>.W <hairstyle>.W <up-viewid>.W <mid-viewid>.W <low-viewid>.W <haircolor>.W <cloth-dye>.W <gender>.B {equip item}.26B* (ZC_EQUIPWIN_MICROSCOPE)
/// 02d7 <packet len>.W <name>.24B <class>.W <hairstyle>.W <bottom-viewid>.W <mid-viewid>.W <up-viewid>.W <haircolor>.W <cloth-dye>.W <gender>.B {equip item}.28B* (ZC_EQUIPWIN_MICROSCOPE, PACKETVER >= 20100629)
/// 0859 <packet len>.W <name>.24B <class>.W <hairstyle>.W <bottom-viewid>.W <mid-viewid>.W <up-viewid>.W <haircolor>.W <cloth-dye>.W <gender>.B {equip item}.28B* (ZC_EQUIPWIN_MICROSCOPE2, PACKETVER >= 20101124)
/// 0859 <packet len>.W <name>.24B <class>.W <hairstyle>.W <bottom-viewid>.W <mid-viewid>.W <up-viewid>.W <robe>.W <haircolor>.W <cloth-dye>.W <gender>.B {equip item}.28B* (ZC_EQUIPWIN_MICROSCOPE2, PACKETVER >= 20110111)
// Item doesn't exist
/**
// zero-based msgstringtable.txt index
/**
/**
/**
/**
/**
/**
// 4-byte header and at least an empty string is expected
// Packet doesn't include a NUL terminator
// PACKETVER < 20151001
// Packet includes a NUL terminator
// PACKETVER > 20151001
// name and message are separated by ' : '
// name length (w/o zero byte)
// the text must start with the speaker's name
// followed by ' : '
//Hacked message, or infamous "client desynchronize" issue where they pick one char while loading another.
// Just kick them out to correct it.
// <name> " : " <message>
// messages mustn't be too long
// Normally you can only enter CHATBOX_SIZE-1 letters into the chat box, but Frost Joke / Dazzler's text can be longer.
// Also, the physical size of strings that use multibyte encoding can go multiple times over the chatbox capacity.
// Neither the official client nor server place any restriction on the length of the data in the packet,
// but we'll only allow reasonably long strings here. This also makes sure that they fit into the `chatlog` table.
// [!] packet->message is not necessarily NUL terminated
/**
// 4-byte header and at least an empty string is expected
// validate name
// name length (w/o zero byte)
// only restriction is that the name must be zero-terminated
// Packet doesn't include a NUL terminator
// PACKETVER < 20151001
// Packet includes a NUL terminator
// PACKETVER > 20151001
// messages mustn't be too long
// Normally you can only enter CHATBOX_SIZE-1 letters into the chat box, but Frost Joke / Dazzler's text can be longer.
// Also, the physical size of strings that use multibyte encoding can go multiple times over the chatbox capacity.
// Neither the official client nor server place any restriction on the length of the data in the packet,
// but we'll only allow reasonably long strings here. This also makes sure that they fit into the `chatlog` table.
// [!] packet->name is not NUL terminated
// [!] packet->message is not necessarily NUL terminated
// TODO: [4144] same packet with login server. need somehow use one function for both servers
// 3 - Rejected by server
// ------------
// clif_parse_*
// ------------
// Parses incoming (player) connection
/// Request to connect to map-server.
/// 0072 <account id>.L <char id>.L <auth code>.L <client time>.L <gender>.B (CZ_ENTER)
/// 0436 <account id>.L <char id>.L <auth code>.L <client time>.L <gender>.B (CZ_ENTER2)
/// There are various variants of this packet, some of them have padding between fields.
//The client tick is a tick, therefore it needs be unsigned. [Skotlex]
// Only valid packet version get here
// not allowed
// server closed
//Check for double login.
// Rejected by server
//An already existing node is valid only if it is for this login.
//Still recognizes last connection
/// Notification from the client, that it has finished map loading and is about to display player's character (CZ_NOTIFY_ACTORINIT).
/// 007d
//Character loading is not complete yet!
//Let pc->reg_received reinvoke this when ready.
//Rewarp player.
/* reset when warping, client dialog will go missing */
// Character Looks
// Send character inventory to the client.
// call this before pc->checkitem() so that the client isn't called to delete a non-existent item.
// Send the cart inventory, counts & weight to the client.
// Check for and delete unavailable/disabled items.
// Send the character's weight to the client.
// guild
// (needs to go before clif_spawn() to show guild emblems correctly)
// increment the number of pvp players on the map
// temporary state to track double remove_map's [FlavioJS]
// reset the callshop flag if the player changes map
// Party
// (needs to go after clif_spawn() to show hp bars correctly)
// Show hp after displacement [LuzZza]
// BattleGround System
// remove pvp stuff for pk_mode [Valaris]
// set flag, if it's a duel [LuzZza]
//TODO: Figure out the real packet to send here.
// info about nearby objects
// must use foreachinarea (CIRCULAR_AREA interferes with foreachinrange)
// pet
//Return the pet to egg. [Skotlex]
// "Pets are not allowed in Guild Wars."
//Option 3 is return to egg.
//skill->unit_move(&sd->pd->bl,timer->gettick(),1);
//homunculus [blackhole89]
//for some reason, at least older clients want this sent twice
//Homunc mimic their master's speed on each map change
// apply land skills immediately
// Mercenary mimic their master's speed on each map change
//Elemental mimic their master's speed on each map change
//Auron reported that This skill only triggers when you logon on the map o.O [Skotlex]
// Notify everyone that this char logged in [Skotlex].
//Login Event
//For some reason the client "loses" these on warp/map-change.
// abort currently running script
// restore information that gets lost on map-change
//Refresh flee penalty
//Display night.
//Clear night display.
// Battleground Mode
// [ Kill Steal Protection Disabled. KS is allowed in this map ]
// Updates Walls Info on this Map to Client
/* some conditions are map-dependent so we must recalculate */
/* Guild Aura Init */
/* show we have a vending */
// Lance
//blindness [Komurka]
//Client loses these on warp.
// Transforming into monster is not allowed in Guild Wars.
// This should be displayed last
// For automatic triggering of NPCs after map loading (so you don't need to walk 1 step first)
/* it broke at some point (e.g. during a crash), so we make it visibly dead again. */
// If player is dead, and is spawned (such as @refresh) send death packet. [Valaris]
// Visually updates player facing direction
// Trigger skill effects if you appear standing on them
// NPC Quest / Event Icon Check [Kisuka]
/// Server's tick (ZC_NOTIFY_TIME).
/// 007f <time>.L
/// Request for server's tick.
/// 007e <client tick>.L (CZ_REQUEST_TIME)
/// 0360 <client tick>.L (CZ_REQUEST_TIME2)
/// There are various variants of this packet, some of them have padding between fields.
// send second tab only if data exists
/// Sends hotkey bar.
/// 02b9 { <is skill>.B <id>.L <count>.W }*27 (ZC_SHORTCUT_KEY_LIST)
/// 07d9 { <is skill>.B <id>.L <count>.W }*36 (ZC_SHORTCUT_KEY_LIST_V2, PACKETVER >= 20090603)
/// 07d9 { <is skill>.B <id>.L <count>.W }*38 (ZC_SHORTCUT_KEY_LIST_V2, PACKETVER >= 20090617)
/// 0a00 <rotate>.B { <is skill>.B <id>.L <count>.W }*38 (ZC_SHORTCUT_KEY_LIST_V3, PACKETVER >= 20141022)
/// Request to update a position on the hotkey bar (CZ_SHORTCUT_KEY_CHANGE1).
/// 02ba <index>.W <is skill>.B <id>.L <count>.W
/// Request to update a position on the hotkey bar (CZ_SHORTCUT_KEY_CHANGE2).
/// Displays cast-like progress bar (ZC_PROGRESS).
/// 02f0 <color>.L <time>.L
/// Removes an ongoing progress bar (ZC_PROGRESS_CANCEL).
/// 02f2
/**
/// Notification from the client, that the progress bar has reached 100% (CZ_PROGRESS).
/// 02f1
/// Request to walk to a certain position on the current map.
/// 0085 <dest>.3B (CZ_REQUEST_MOVE)
/// 035f <dest>.3B (CZ_REQUEST_MOVE2)
/// There are various variants of this packet, some of them have padding between fields.
//You CAN walk on this OPT1 value.
/*else if( sd->progressbar.npc_id )
//Set last idle time... [Skotlex]
/// Notification about the result of a disconnect request (ZC_ACK_REQ_DISCONNECT).
/// 018b <result>.W
/// result:
///     0 = disconnect (quit)
///     1 = cannot disconnect (wait 10 seconds)
///     ? = ignored
/// Request to disconnect from server (CZ_REQ_DISCONNECT).
/// 018a <type>.W
/// type:
///     0 = quit
/* Rovert's prevent logout option fixed [Valaris] */
/// Requesting unit's name.
/// 0094 <id>.L (CZ_REQNAME)
/// 0368 <id>.L (CZ_REQNAME2)
/// There are various variants of this packet, some of them have padding between fields.
//struct status_change *sc;
// for disguises [Valaris]
// Lagged clients could request names of already gone mobs/players. [Skotlex]
// Block namerequests past view range
// 'see people in GM hide' cheat detection
/* disabled due to false positives (network lag + request name of char that's about to hide = race condition) */
//Skip hidden NPCs which can be seen using Maya Purple
// information is sent to all online GMs
// 0
/**
// send message to others
//FIXME: chat has range of 9 only
// send back message to the speaker
// Chat logging type 'O' / Global Chat
// trigger listening npcs
/// /mm /mapmove (as @rura GM command) (CZ_MOVETO_MAP).
/// Request to warp to a map on given coordinates.
/// 0140 <map name>.16B <x>.W <y>.W
/// Updates body and head direction of an object (ZC_CHANGE_DIRECTION).
/// 009c <id>.L <head dir>.W <dir>.B
/// head dir:
///     0 = straight
///     1 = turned CW
///     2 = turned CCW
/// dir:
///     0 = north
///     1 = northwest
///     2 = west
///     3 = southwest
///     4 = south
///     5 = southeast
///     6 = east
///     7 = northeast
/// Request to change own body and head direction.
/// 009b <head dir>.W <dir>.B (CZ_CHANGE_DIRECTION)
/// 0361 <head dir>.W <dir>.B (CZ_CHANGE_DIRECTION2)
/// There are various variants of this packet, some of them have padding between fields.
/// Request to show an emotion (CZ_REQ_EMOTION).
/// 00bf <type>.B
/// type:
///     @see enum emotion_type
// prevent use of the mute emote [Valaris]
// fix flood of emotion icon (ro-proxy): flood only the hacker player
// not more than 1 per second
// re-roll dice
/// Amount of currently online players, reply to /w /who (ZC_USER_COUNT).
/// 00c2 <count>.L
/// /w /who (CZ_REQ_USER_COUNT).
/// Request to display amount of currently connected players.
/// 00c1
// Statuses that don't let the player sit / attack / talk with NPCs(targeted)
// (not all are included in pc_can_attack)
// for disguises [Valaris]
// once attack
// continuous attack
// *pcblock script command
// sitdown
//Bugged client? Just refresh them.
// *pcblock script command
//No sitting during these states either.
// standup
//Bugged client? Just refresh them.
// *pcblock script command
/// Request for an action.
/// 0089 <target id>.L <action>.B (CZ_REQUEST_ACT)
/// 0437 <target id>.L <action>.B (CZ_REQUEST_ACT2)
/// action:
///     0 = attack
///     1 = pick up item
///     2 = sit down
///     3 = stand up
///     7 = continuous attack
///     12 = (touch skill?)
/// There are various variants of this packet, some of them have padding between fields.
/// Response to the death/system menu (CZ_RESTART).
/// 00b2 <type>.B
/// type:
///     0 = restart (respawn)
///     1 = char-select (disconnect)
/* Rovert's Prevent logout option - Fixed [Valaris] */
//Send to char-server for character selection.
/**
// Chat logging type 'W' / Whisper
//-------------------------------------------------------//
//   Lordalfa - Paperboy - To whisper NPC commands       //
//-------------------------------------------------------//
// Skip the NPC: string part.
// skip codepage indicator, if detected
// Splits the message using '#' as separators
// use the remaining string
// Calls the NPC label
//You're not in that channel, type '@join <#channel_name>'
// You're not allowed to talk on this channel
// searching destination character
// Character not found (or found through partial match).
// if player ignores everyone
// 1: target character is not logged in
// 3: everyone ignored by target
// if player is autotrading
// %s is in autotrade mode and cannot receive whispered messages.
// if player ignores the source character
// source char present in ignore list
// 2: ignored by target
// notify sender of success
// 0: success to send wisper
// Normal message
/// /b /nb (CZ_BROADCAST).
/// Request to broadcast a message on whole server.
/// 0099 <packet len>.W <text>.?B 00
// '@' command + ' ' + message + NUL
// as the length varies depending on the command used, truncate unreasonably long strings
/// Request to pick up an item.
/// 009f <id>.L (CZ_ITEM_PICKUP)
/// 0362 <id>.L (CZ_ITEM_PICKUP2)
/// There are various variants of this packet, some of them have padding between fields.
// Client REQUIRES a fail packet or you can no longer pick items.
/// Request to drop an item.
/// 00a2 <index>.W <amount>.W (CZ_ITEM_THROW)
/// 0363 <index>.W <amount>.W (CZ_ITEM_THROW2)
/// There are various variants of this packet, some of them have padding between fields.
//Because the client does not like being ignored.
/// Request to use an item.
/// 00a7 <index>.W <account id>.L (CZ_USE_ITEM)
/// 0439 <index>.W <account id>.L (CZ_USE_ITEM2)
/// There are various variants of this packet, some of them have padding between fields.
//Whether the item is used or not is irrelevant, the char ain't idle. [Skotlex]
//Send an empty ack packet or the client gets stuck.
/// Request to equip an item (CZ_REQ_WEAR_EQUIP).
/// 00a9 <index>.W <position>.W
/// 0998 <index>.W <position>.L
//Out of bounds check.
//You can equip/unequip stuff while storage is open/under status changes
// fail
//Client doesn't send the position for ammo.
/// Request to take off an equip (CZ_REQ_TAKEOFF_EQUIP).
/// 00ab <index>.W
//You can equip/unequip stuff while storage is open/under status changes
/// Request to start a conversation with an NPC (CZ_CONTACTNPC).
/// 0090 <id>.L <type>.B
/// type:
///     1 = click
// *pcblock script command
// TODO: should only work with none 3rd job skills
// the user can't click floating npcs directly (hack attempt)
/// Selection between buy/sell was made (CZ_ACK_SELECT_DEALTYPE).
/// 00c5 <id>.L <type>.B
/// type:
///     0 = buy
///     1 = sell
/// Notification about the result of a purchase attempt from an NPC shop (ZC_PC_PURCHASE_RESULT).
/// 00ca <result>.B
/// result:
///     0 = "The deal has successfully completed."
///     1 = "You do not have enough zeny."
///     2 = "You are over your Weight Limit."
///     3 = "Out of the maximum capacity, you have too many items."
///     9 = "Amounts are exceeded the possession of the item is not available for purchase."
///    10 = "Props open-air store sales will be traded in RODEX"
///    11 = "The exchange failed."
///    12 = "The exchange was well done."
///    13 = "The item is already sold and out of stock."
///    14 = "There is not enough goods to exchange."
/// Request to buy chosen items from npc shop (CZ_PC_PURCHASE_ITEMLIST).
/// 00c8 <packet len>.W { <amount>.W <name id>.W }*
//Clear shop data.
/// Notification about the result of a sell attempt to an NPC shop (ZC_PC_SELL_RESULT).
/// 00cb <result>.B
/// result:
///     0 = "The deal has successfully completed."
///     1 = "The deal has failed."
/// Request to sell chosen items to npc shop (CZ_PC_SELL_ITEMLIST).
/// 00c9 <packet len>.W { <index>.W <amount>.W }*
//Clear shop data.
/// Chatroom creation request (CZ_CREATE_CHATROOM).
/// 00d5 <packet len>.W <limit>.W <type>.B <passwd>.8B <title>.?B
/// type:
///     0 = private
///     1 = public
//not zero-terminated
// not zero-terminated
//not zero-terminated
// not zero-terminated
// uncomment for more verbose message.
//char output[150];
//sprintf(output, msg_txt(862), battle_config.min_npc_vendchat_distance); // "You're too close to a NPC, you must be at least %d cells away from any NPC."
//clif_displaymessage(sd->fd, output);
//NOTE: assumes that safestrncpy will not access the len+1'th byte
/// Chatroom join request (CZ_REQ_ENTER_ROOM).
/// 00d9 <chat ID>.L <passwd>.8B
// not zero-terminated
/// Chatroom properties adjustment request (CZ_CHANGE_CHATROOM).
/// 00de <packet len>.W <limit>.W <type>.B <passwd>.8B <title>.?B
/// type:
///     0 = private
///     1 = public
// not zero-terminated
// not zero-terminated
// not zero-terminated
// not zero-terminated
//NOTE: assumes that safestrncpy will not access the len+1'th byte
/// Request to change the chat room ownership (CZ_REQ_ROLE_CHANGE).
/// 00e0 <role>.L <nick>.24B
/// role:
///     0 = owner
///     1 = normal
// non null terminated
/// Request to expel a player from chat room (CZ_REQ_EXPEL_MEMBER).
/// 00e2 <name>.24B
// non null terminated
/// Request to leave the current chatroom (CZ_EXIT_ROOM).
/// 00e3
//Handles notifying asker and rejecter of what has just occurred.
//Type is used to determine the correct msg_txt to use:
//0:
// Your request has been rejected by autoreject option.
//Notice that a request was rejected.
/// Request to begin a trade (CZ_REQ_EXCHANGE_ITEM).
/// 00e4 <account id>.L
//You can trade while in a chatroom.
// @noask [LuzZza]
/// Answer to a trade request (CZ_ACK_EXCHANGE_ITEM).
/// 00e6 <result>.B
/// result:
///     3 = accepted
///     4 = rejected
/// Request to add an item to current trade (CZ_ADD_EXCHANGE_ITEM).
/// 00e8 <index>.W <amount>.L
/// Request to lock items in current trade (CZ_CONCLUDE_EXCHANGE_ITEM).
/// 00eb
/// Request to cancel current trade (CZ_CANCEL_EXCHANGE_ITEM).
/// 00ed
/// Request to commit current trade (CZ_EXEC_EXCHANGE_ITEM).
/// 00ef
/// Request to stop chasing/attacking an unit (CZ_CANCEL_LOCKON).
/// 0118
/// Request to move an item from inventory to cart (CZ_MOVE_ITEM_FROM_BODY_TO_CART).
/// 0126 <index>.W <amount>.L
/// Request to move an item from cart to inventory (CZ_MOVE_ITEM_FROM_CART_TO_BODY).
/// 0127 <index>.W <amount>.L
/// Request to remove cart/falcon/peco/dragon (CZ_REQ_CARTOFF).
/// 012a
// priority to remove this option before we can clear cart
// not NEW_CARTS
// NEW_CARTS
// this packet exists in clients with only new carts [4144]
/// Request to change cart's visual look (CZ_REQ_CHANGECART).
/// 01af <num>.W
// TODO: State tracking?
/// Request to select cart's visual look for new cart design (CZ_SELECTCART).
/// 0980 <identity>.L <type>.B
// RagexeRE
/// Request to increase status (CZ_STATUS_CHANGE).
/// 00bb <status id>.W <amount>.B
/// status id:
///     SP_STR ~ SP_LUK
/// amount:
///     Old clients send always 1 for this, even when using /str+ and the like.
///     Newer clients (2013-12-23 and newer) send the correct amount.
/// Request to increase level of a skill (CZ_UPGRADE_SKILLLEVEL).
/// 0112 <skill id>.W
//No clue, I have seen the client do this with guild skills :/ [Skotlex]
//Using a ground/passive skill on a target? WRONG.
// Whether skill fails or not is irrelevant, the char ain't idle. [Skotlex]
// SELF skills can be used with the storage open, issue: 8027
// never trust the client
// for disguises [Valaris]
// On basilica only caster can use Basilica again to stop it.
//Cancel pet capture.
//Can't use skills while a menu is open.
// Target skills through items cancel invincibility. [Inkfish]
/// Request to use a targeted skill.
/// 0113 <skill lv>.W <skill id>.W <target id>.L (CZ_USE_SKILL)
/// 0438 <skill lv>.W <skill id>.W <target id>.L (CZ_USE_SKILL2)
/// There are various variants of this packet, some of them have padding between fields.
/*==========================================
//Using a target skill on the ground? WRONG.
//Whether skill fails or not is irrelevant, the char ain't idle. [Skotlex]
//You can't use Graffiti/TalkieBox AND have a vending open, so this is safe.
// On basilica only caster can use Basilica again to stop it.
//Cancel pet capture.
//Can't use skills while a menu is open.
/// Request to use a ground skill.
/// 0116 <skill lv>.W <skill id>.W <x>.W <y>.W (CZ_USE_SKILL_TOGROUND)
/// 0366 <skill lv>.W <skill id>.W <x>.W <y>.W (CZ_USE_SKILL_TOGROUND2)
/// There are various variants of this packet, some of them have padding between fields.
//skill lv
//skill num
//pos x
//pos y
//Skill more info.
/// Request to use a ground skill with text.
/// 0190 <skill lv>.W <skill id>.W <x>.W <y>.W <contents>.80B (CZ_USE_SKILL_TOGROUND_WITHTALKBOX)
/// 0367 <skill lv>.W <skill id>.W <x>.W <y>.W <contents>.80B (CZ_USE_SKILL_TOGROUND_WITHTALKBOX2)
/// There are various variants of this packet, some of them have padding between fields.
//Skill lv
//Skill num
//pos x
//pos y
//skill more info
/// Answer to map selection dialog (CZ_SELECT_WARPPOINT).
/// 011b <skill id>.W <map name>.16B
// It is possible to use teleport with the storage window open issue:8027
/// Request to set a memo on current map (CZ_REMEMBER_WARPPOINT).
/// 011d
/// Answer to pharmacy item selection dialog (CZ_REQMAKINGITEM).
/// 018e <name id>.W { <material id>.W }*3
//Make it fail to avoid shop exploits where you sell something different than you see.
/// Answer to mixing item selection dialog (CZ_REQ_MAKINGITEM).
/// 025b <mk type>.W <name id>.W
/// mk type:
///     1 = cooking
///     2 = arrow
///     3 = elemental
///     4 = GN_MIX_COOKING
///     5 = GN_MAKEBOMB
///     6 = GN_S_PHARMACY
//Make it fail to avoid shop exploits where you sell something different than you see.
/// Answer to repair weapon item selection dialog (CZ_REQ_ITEMREPAIR).
/// 01fd <index>.W <name id>.W <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W
//Make it fail to avoid shop exploits where you sell something different than you see.
/// Answer to refine weapon item selection dialog (CZ_REQ_WEAPONREFINE).
/// 0222 <index>.L
//Packet exploit?
//Make it fail to avoid shop exploits where you sell something different than you see.
/// Answer to script menu dialog (CZ_CHOOSE_MENU).
/// 00b8 <npc id>.L <choice>.B
/// choice:
///     1~254 = menu item
///     255   = cancel
/// NOTE: If there were more than 254 items in the list, choice
///     overflows to choice%256.
/// NPC dialog 'next' click (CZ_REQ_NEXT_SCRIPT).
/// 00b9 <npc id>.L
/// NPC numeric input dialog value (CZ_INPUT_EDITDLG).
/// 0143 <npc id>.L <value>.L
/// NPC text input dialog value (CZ_INPUT_EDITDLGSTR).
/// 01d5 <packet len>.W <npc id>.L <string>.?B
// [4144] can't confirm exact client version. At least >= correct for 20150513
/// NPC dialog 'close' click (CZ_CLOSE_DIALOG).
/// 0146 <npc id>.L
//Avoid parsing anything when the script was done with. [Skotlex]
/// Answer to identify item selection dialog (CZ_REQ_ITEMIDENTIFY).
/// 0178 <index>.W
/// index:
///     -1 = cancel
// cancel pressed
/// Identifying item with right-click (CZ_REQ_ONECLICK_ITEMIDENTIFY).
/// 0A35 <index>.W
/// Answer to arrow crafting item selection dialog (CZ_REQ_MAKINGARROW).
/// 01ae <name id>.W
//Make it fail to avoid shop exploits where you sell something different than you see.
/// Answer to SA_AUTOSPELL skill selection dialog (CZ_SELECTAUTOSPELL).
/// 01ce <skill id>.L
/// Request to display item carding/composition list (CZ_REQ_ITEMCOMPOSITION_LIST).
/// 017a <card index>.W
/// Answer to carding/composing item selection dialog (CZ_REQ_ITEMCOMPOSITION).
/// 017c <card index>.W <equip index>.W
/// Request of character's name by char ID.
/// 0193 <char id>.L (CZ_REQNAME_BYGID)
/// 0369 <char id>.L (CZ_REQNAME_BYGID2)
/// There are various variants of this packet, some of them have padding between fields.
/// /resetskill /resetstate (CZ_RESET).
/// Request to reset stats or skills.
/// 0197 <type>.W
/// type:
///     0 = state
///     1 = skill
/// /lb /nlb (CZ_LOCALBROADCAST).
/// Request to broadcast a message on current map.
/// 019c <packet len>.W <text>.?B
// '@' + command + ' ' + message + NUL
// as the length varies depending on the command used, truncate unreasonably long strings
/// Request to move an item from inventory to storage.
/// 00f3 <index>.W <amount>.L (CZ_MOVE_ITEM_FROM_BODY_TO_STORE)
/// 0364 <index>.W <amount>.L (CZ_MOVE_ITEM_FROM_BODY_TO_STORE2)
/// There are various variants of this packet, some of them have padding between fields.
/// Request to move an item from storage to inventory.
/// 00f5 <index>.W <amount>.L (CZ_MOVE_ITEM_FROM_STORE_TO_BODY)
/// 0365 <index>.W <amount>.L (CZ_MOVE_ITEM_FROM_STORE_TO_BODY2)
/// There are various variants of this packet, some of them have padding between fields.
/// Request to move an item from cart to storage (CZ_MOVE_ITEM_FROM_CART_TO_STORE).
/// 0129 <index>.W <amount>.L
/// Request to move an item from storage to cart (CZ_MOVE_ITEM_FROM_STORE_TO_CART).
/// 0128 <index>.W <amount>.L
/// Request to close storage (CZ_CLOSE_STORE).
/// 00f7
// Unused function
/// Displays kafra storage password dialog (ZC_REQ_STORE_PASSWORD).
/// 023a <info>.W
/// info:
///     0 = password has not been set yet
///     1 = storage is password-protected
///     8 = too many wrong passwords
///     ? = ignored
/// NOTE: This packet is only available on certain non-kRO clients.
// 0
/// Answer to the kafra storage password dialog (CZ_ACK_STORE_PASSWORD).
/// 023b <type>.W <password>.16B <new password>.16B
/// type:
///     2 = change password
///     3 = check password
/// NOTE: This packet is only available on certain non-kRO clients.
//TODO
// Unused function
/// Result of kafra storage password validation (ZC_RESULT_STORE_PASSWORD).
/// 023c <result>.W <error count>.W
/// result:
///     4 = password change success
///     5 = password change failure
///     6 = password check success
///     7 = password check failure
///     8 = too many wrong passwords
///     ? = ignored
/// NOTE: This packet is only available on certain non-kRO clients.
// 0
/// Party creation request
/// 00f9 <party name>.24B (CZ_MAKE_GROUP)
/// 01e8 <party name>.24B <item pickup rule>.B <item share rule>.B (CZ_MAKE_GROUP2)
// Party locked.
// Party modification is disabled in this map.
// Party locked.
// Party modification is disabled in this map.
/// Party invitation request
/// 00fc <account id>.L (CZ_REQ_JOIN_GROUP)
/// 02c4 <char name>.24B (CZ_PARTY_JOIN_REQ)
// Party locked.
// Party modification is disabled in this map.
// @noask [LuzZza]
// Party locked.
// Party modification is disabled in this map.
// @noask [LuzZza]
/// Party invitation reply
/// 00ff <party id>.L <flag>.L (CZ_JOIN_GROUP)
/// 02c7 <party id>.L <flag>.B (CZ_PARTY_JOIN_REQ_ACK)
/// flag:
///     0 = reject
///     1 = accept
/// Request to leave party (CZ_REQ_LEAVE_GROUP).
/// 0100
// Party locked.
// Party modification is disabled in this map.
/// Request to expel a party member (CZ_REQ_EXPEL_GROUP_MEMBER).
/// 0103 <account id>.L <char name>.24B
// Party locked.
// Party modification is disabled in this map.
/// Request to change party options.
/// 0102 <exp share rule>.L (CZ_CHANGE_GROUPEXPOPTION)
/// 07d7 <exp share rule>.L <item pickup rule>.B <item share rule>.B (CZ_GROUPINFO_CHANGE_V2)
//Shouldn't happen
//Client can't change the item-field
/**
/// Changes Party Leader (CZ_CHANGE_GROUP_MASTER).
/// 07da <account id>.L
/// Party Booking in KRO [Spiria]
///
/// Request to register a party booking advertisement (CZ_PARTY_BOOKING_REQ_REGISTER).
/// 0802 <level>.W <map id>.W { <job>.W }*6
/// Result of request to register a party booking advertisement (ZC_PARTY_BOOKING_ACK_REGISTER).
/// 0803 <result>.W
/// result:
///     0 = success
///     1 = failure
///     2 = already registered
/// Request to search for party booking advertisement (CZ_PARTY_BOOKING_REQ_SEARCH).
/// 0804 <level>.W <map id>.W <job>.W <last index>.L <result count>.W
/// Party booking search results (ZC_PARTY_BOOKING_ACK_SEARCH).
/// 0805 <packet len>.W <more results>.B { <index>.L <char name>.24B <expire time>.L <level>.W <map id>.W { <job>.W }*6 }*
/// more results:
///     0 = no
///     1 = yes
// structure size (48)
/// Request to delete own party booking advertisement (CZ_PARTY_BOOKING_REQ_DELETE).
/// 0806
/// Result of request to delete own party booking advertisement (ZC_PARTY_BOOKING_ACK_DELETE).
/// 0807 <result>.W
/// result:
///     0 = success
///     1 = success (auto-removed expired ad)
///     2 = failure
///     3 = nothing registered
/// Request to update party booking advertisement (CZ_PARTY_BOOKING_REQ_UPDATE).
/// 0808 { <job>.W }*6
/// Notification about new party booking advertisement (ZC_PARTY_BOOKING_NOTIFY_INSERT).
/// 0809 <index>.L <char name>.24B <expire time>.L <level>.W <map id>.W { <job>.W }*6
/// Notification about updated party booking advertisement (ZC_PARTY_BOOKING_NOTIFY_UPDATE).
/// 080a <index>.L { <job>.W }*6
// Now UPDATE all client.
/// Notification about deleted party booking advertisement (ZC_PARTY_BOOKING_NOTIFY_DELETE).
/// 080b <index>.L
// Now UPDATE all client.
/// Modified version of Party Booking System for 2012-04-10 or 2012-04-18 (RagexeRE).
/// Code written by mkbu95, Spiria, Yommy and Ind
/// Request to register a party booking advertisement (CZ_PARTY_RECRUIT_REQ_REGISTER).
/// 08e5 <level>.W <notice>.37B
/// Party booking search results (ZC_PARTY_RECRUIT_ACK_SEARCH).
/// 08e8 <packet len>.W <more results>.B { <index>.L <char name>.24B <expire time>.L <level>.W <notice>.37B }*
/// more results:
///     0 = no
///     1 = yes
/// Result of request to register a party booking advertisement (ZC_PARTY_RECRUIT_ACK_REGISTER).
/// 08e6 <result>.W
/// result:
///     0 = success
///     1 = failure
///     2 = already registered
/// Request to search for party booking advertisement (CZ_PARTY_RECRUIT_REQ_SEARCH).
/// 08e7 <level>.W <map id>.W <last index>.L <result count>.W
/// Request to delete own party booking advertisement (CZ_PARTY_RECRUIT_REQ_DELETE).
/// 08e9
/// Result of request to delete own party booking advertisement (ZC_PARTY_RECRUIT_ACK_DELETE).
/// 08ea <result>.W
/// result:
///     0 = success
///     1 = success (auto-removed expired ad)
///     2 = failure
///     3 = nothing registered
/// Request to update party booking advertisement (CZ_PARTY_RECRUIT_REQ_UPDATE).
/// 08eb <notice>.37B
/// Notification about new party booking advertisement (ZC_PARTY_RECRUIT_NOTIFY_INSERT).
/// 08ec <index>.L <expire time>.L <char name>.24B <level>.W <notice>.37B
/// Notification about updated party booking advertisement (ZC_PARTY_RECRUIT_NOTIFY_UPDATE).
/// 08ed <index>.L <notice>.37B
/// Notification about deleted party booking advertisement (ZC_PARTY_RECRUIT_NOTIFY_DELETE).
/// 08ee <index>.L
/// Request to add to filtering list (PARTY_RECRUIT_ADD_FILTERLINGLIST).
/// 08ef <index>.L
/// Request to remove from filtering list (PARTY_RECRUIT_SUB_FILTERLINGLIST).
/// 08f0 <GID>.L
/// Request to recruit volunteer (PARTY_RECRUIT_REQ_VOLUNTEER).
/// 08f1 <index>.L
/// Request volunteer information (PARTY_RECRUIT_VOLUNTEER_INFO).
/// 08f2 <AID>.L <job>.L <level>.W <char name>.24B
//Disabled for now. Needs more info.
/// 08f3 <packet type>.W <cost>.L
/// 08f4 <target GID>.L
/// 08f5 <packet len>.W
/// 08f6 <money>.L <map name>.16B
/// 08f7 <result>.B
/// 08f8 <caller AID>.L <reason>.B
/// <reason>:
///    REASON_PROHIBITION =  0x0
///    REASON_MASTER_IN_PROHIBITION_MAP =  0x1
///    REASON_REFUSE =  0x2
///    REASON_NOT_PARTY_MEMBER =  0x3
///    REASON_ETC =  0x4
//if 0
/// 08f9 <refuse AID>.L
/// 08fa <index>.L
/// 08fb <index>.L
/// 0909 <index>.L
/// 090b <gid>.L <char name>.24B
/// 090c <gid>.L <char name>.24B
/// 091c <aid>.L
/// 0971 <pm_aid>.L
//if 0
/// Request to close own vending (CZ_REQ_CLOSESTORE).
/// 012e
/// Request to open a vending shop (CZ_REQ_BUY_FROMMC).
/// 0130 <account id>.L
// using an NPC
/// Shop item(s) purchase request (CZ_PC_PURCHASE_ITEMLIST_FROMMC).
/// 0134 <packet len>.W <account id>.L { <amount>.W <index>.W }*
// whether it fails or not, the buy window is closed
/// Shop item(s) purchase request (CZ_PC_PURCHASE_ITEMLIST_FROMMC2).
/// 0801 <packet len>.W <account id>.L <unique id>.L { <amount>.W <index>.W }*
// whether it fails or not, the buy window is closed
/// Confirm or cancel the shop preparation window.
/// 012f <packet len>.W <shop name>.80B { <index>.W <amount>.W <price>.L }* (CZ_REQ_OPENSTORE)
/// 01b2 <packet len>.W <shop name>.80B <result>.B { <index>.W <amount>.W <price>.L }* (CZ_REQ_OPENSTORE2)
/// result:
///     0 = canceled
///     1 = open
// "You can't open a shop on this map"
// "You can't open a shop on this cell."
// invalid input
/// Guild creation request (CZ_REQ_MAKE_GUILD).
/// 0165 <char id>.L <guild name>.24B
// Guild modification is disabled in this map.
/// Request for guild window interface permissions (CZ_REQ_GUILD_MENUINTERFACE).
/// 014d
/// Request for guild window information (CZ_REQ_GUILD_MENU).
/// 014f <type>.L
/// type:
///     0 = basic info
///     1 = member manager
///     2 = positions
///     3 = skills
///     4 = expulsion list
///     5 = unknown (GM_ALLGUILDLIST)
///     6 = notice
// Basic Information Guild, hostile alliance information
// Members list, list job title
// List job title, title information list
// Skill list
// Expulsion list
/// Request to update guild positions (CZ_REG_CHANGE_GUILD_POSITIONINFO).
/// 0161 <packet len>.W { <position id>.L <mode>.L <ranking>.L <pay rate>.L <name>.24B }*
/// Request to update the position of guild members (CZ_REQ_CHANGE_MEMBERPOS).
/// 0155 <packet len>.W { <account id>.L <char id>.L <position id>.L }*
// Guild leadership change
/// Request for guild emblem data (CZ_REQ_GUILD_EMBLEM_IMG).
/// 0151 <guild id>.L
/// Validates data of a guild emblem (compressed bitmap)
// sizeof(RGBTRIPLE)
// sizeof(RGBQUAD)
// sizeof(BITMAPFILEHEADER)
// sizeof(BITMAPINFOHEADER)
// NetBSD 5 and Solaris don't like pragma pack but accept the packed attribute
// not NetBSD < 6 / Solaris
//uint8 b;
//uint8 g;
//uint8 r;
// NetBSD 5 and Solaris don't like pragma pack but accept the packed attribute
// not NetBSD < 6 / Solaris
// no well-formed emblem bitmap is larger than 1782 (24 bit) / 1654 (8 bit) bytes
// BITMAPFILEHEADER.bfType (signature)
// BITMAPFILEHEADER.bfSize (file size)
// BITMAPINFOHEADER.biSize (other headers are not supported)
// BITMAPINFOHEADER.biWidth
// BITMAPINFOHEADER.biHeight (top-down bitmaps (-24) are not supported)
// BITMAPINFOHEADER.biCompression == BI_RGB (compression not supported)
// Invalid data
// BITMAPFILEHEADER.bfOffBits (offset to bitmap bits)
// BITMAPINFOHEADER.biBitCount
// BITMAPINFOHEADER.biClrUsed (number of colors in the palette)
// Defaults to 2^n if set to zero
// headers + palette
// NOTE: This check gives a little freedom for bitmap-producing implementations,
// that align the start of bitmap data, which is harmless but unnecessary.
// If you want it paranoidly strict, change the first condition from < to !=.
// This also allows files with trailing garbage at the end of the file.
// If you want to avoid that, change the last condition to !=.
/// Checks what percentage of a guild emblem is blank. A blank emblem
/// consists solely of magenta pixels. Since the client uses 16-bit
/// colors, any magenta shade that reduces to #ff00ff passes off as
/// transparent color as well (down to #f807f8).
///
/// Unlike real magenta, reduced magenta causes the guild window to
/// become see-through in the transparent parts of the emblem
/// background (glitch).
// palette indexes
// Invalid color
// if( color->r < 0xF8 || color->g > 0x07 || color->b < 0xF8 )
// Enough valid pixels were found
// full colors
// if( pixels[i].r < 0xF8 || pixels[i].g > 0x07 || pixels[i].b < 0xF8 )
// Enough valid pixels were found
// Not enough non-blank pixels found
/// Request to update the guild emblem (CZ_REGISTER_GUILD_EMBLEM_IMG).
/// 0153 <packet len>.W <emblem data>.?B
/// Guild notice update request (CZ_GUILD_NOTICE).
/// 016e <guild id>.L <msg1>.60B <msg2>.120B
// compensate for some client defects when using multilingual mode
// skip duplicate marker
// skip duplicate marker
// delete extra space at the end of string
// Helper function for guild invite functions
// not online or does not exist
// Guild modification is disabled in this map.
// @noask [LuzZza]
// Players in a clan can't join a guild
// You can't join in a clan if you're in a guild.
/// Guild invite request (CZ_REQ_JOIN_GUILD).
/// 0168 <account id>.L <inviter account id>.L <inviter char id>.L
/// Guild invite request (/guildinvite) (CZ_REQ_JOIN_GUILD2).
/// 0916 <char name>.24B
/// Answer to guild invitation (CZ_JOIN_GUILD).
/// 016b <guild id>.L <answer>.L
/// answer:
///     0 = refuse
///     1 = accept
/// Request to leave guild (CZ_REQ_LEAVE_GUILD).
/// 0159 <guild id>.L <account id>.L <char id>.L <reason>.40B
// Guild modification is disabled in this map.
//"You can't leave battleground guilds."
/// Request to expel a member of a guild (CZ_REQ_BAN_GUILD).
/// 015b <guild id>.L <account id>.L <char id>.L <reason>.40B
// Guild modification is disabled in this map.
/**
/// Guild alliance request (CZ_REQ_ALLY_GUILD).
/// 0170 <account id>.L <inviter account id>.L <inviter char id>.L
// Guild modification is disabled in this map.
// @noask [LuzZza]
/// Answer to a guild alliance request (CZ_ALLY_GUILD).
/// 0172 <inviter account id>.L <answer>.L
/// answer:
///     0 = refuse
///     1 = accept
/// Request to delete a guild alliance or opposition (CZ_REQ_DELETE_RELATED_GUILD).
/// 0183 <opponent guild id>.L <relation>.L
/// relation:
///     0 = Ally
///     1 = Enemy
// Guild modification is disabled in this map.
/// Request to set a guild as opposition (CZ_REQ_HOSTILE_GUILD).
/// 0180 <account id>.L
// Guild modification is disabled in this map.
// @noask [LuzZza]
/// Request to delete own guild (CZ_REQ_DISORGANIZE_GUILD).
/// 015d <key>.40B
/// key:
///     now guild name; might have been (intended) email, since the
///     field name and size is same as the one in CH_DELETE_CHAR.
// Guild modification is disabled in this map.
/// Pet
///
/// Request to invoke a pet menu action (CZ_COMMAND_PET).
/// 01a1 <type>.B
/// type:
///     0 = pet information
///     1 = feed
///     2 = performance
///     3 = return to egg
///     4 = unequip accessory
/// Attempt to tame a monster (CZ_TRYCAPTURE_MONSTER).
/// 019f <id>.L
/// Answer to pet incubator egg selection dialog (CZ_SELECT_PETEGG).
/// 01a7 <index>.W
/// Request to display pet's emotion/talk (CZ_PET_ACT).
/// 01a9 <data>.L
/// data:
///     is either emotion (@see enum emotion_type) or a compound value
///     (((mob id)-100)*100+(act id)*10+(hunger)) that describes an
///     entry (given in parentheses) in data\pettalktable.xml
///     act id:
///         0 = feeding
///         1 = hunting
///         2 = danger
///         3 = dead
///         4 = normal (stand)
///         5 = special performance (perfor_s)
///         6 = level up (levelup)
///         7 = performance 1 (perfor_1)
///         8 = performance 2 (perfor_2)
///         9 = performance 3 (perfor_3)
///        10 = log-in greeting (connect)
///     hungry value:
///         0 = very hungry (hungry)
///         1 = hungry (bit_hungry)
///         2 = satisfied (noting)
///         3 = stuffed (full)
///         4 = full (so_full)
/// Request to change pet's name (CZ_RENAME_PET).
/// 01a5 <name>.24B
/// Request to Evolve the pet (CZ_PET_EVOLUTION) [Dastgir/Hercules]
/// 09fb <Length>.W <EvolvedPetEggID>.W {<index>.W <amount>.W}*items
// Not Loyal Yet
// Which error?
// Client side validation is not done as it is insecure.
// Return to Egg
/**
/// /kill (CZ_DISCONNECT_CHARACTER).
/// Request to disconnect a character.
/// 00cc <account id>.L
/// NOTE: Also sent when using GM right click menu "(name) force to quit"
/**
// can invalidate 'target'
/// /killall (CZ_DISCONNECT_ALL_CHARACTER).
/// Request to disconnect all characters.
/// 00ce
/// /remove (CZ_REMOVE_AID).
/// Request to warp to a character with given login ID.
/// 01ba <account name>.24B
/// /shift (CZ_SHIFT).
/// Request to warp to a character with given name.
/// 01bb <char name>.24B
// FIXME: remove is supposed to receive account name for clients prior 20100803RE
/// /remove (CZ_REMOVE_AID_SSO).
/// Request to warp to a character with given account ID.
/// 0843 <account id>.L
/// /recall (CZ_RECALL).
/// Request to summon a player with given login ID to own position.
/// 01bc <account name>.24B
/// /summon (CZ_RECALL_GID).
/// Request to summon a player with given name to own position.
/// 01bd <char name>.24B
// FIXME: recall is supposed to receive account name for clients prior 20100803RE
/// /recall (CZ_RECALL_SSO).
/// Request to summon a player with given account ID to own position.
/// 0842 <account id>.L
/// /item /monster (CZ_ITEM_CREATE).
/// Request to execute GM commands.
/// usage:
/// /item n - summon n monster or acquire n item/s
/// /item money - grants 2147483647 Zeny
/// /item whereisboss - locate boss mob in current map.(not yet implemented)
/// /item regenboss_n t - regenerate n boss monster by t millisecond.(not yet implemented)
/// /item onekillmonster - toggle an ability to kill mobs in one hit.(not yet implemented)
/// /item bossinfo - display the information of a boss monster in current map.(not yet implemented)
/// /item cap_n - capture n monster as pet.(not yet implemented)
/// /item agitinvest - reset current global agit investments.(not yet implemented)
/// 013f <item/mob name>.24B
/// 09ce <item/mob name>.100B [Ind/Yommy<3]
// It only accepts aegis name
// nonstackable
// It only accepts sprite name
/// /hide (CZ_CHANGE_EFFECTSTATE).
/// 019d <effect state>.L
/// effect state:
///     TODO: Any OPTION_* ?
/// Request to adjust player's manner points (CZ_REQ_GIVE_MANNER_POINT).
/// 0149 <account id>.L <type>.B <value>.W
/// type:
///     0 = positive points
///     1 = negative points
///     2 = self mute (+10 minutes)
/// /rc (CZ_REQ_GIVE_MANNER_BYNAME).
/// GM adjustment of a player's manner value by -60.
/// 0212 <char name>.24B
/// Result of request to resolve account name (ZC_ACK_ACCOUNTNAME).
/// 01e0 <account id>.L <account name>.24B
/// GM requesting account name (for right-click gm menu) (CZ_REQ_ACCOUNTNAME).
/// 01df <account id>.L
//TODO: find out if this works for any player or only for authorized GMs
// insert account name here >_<
/// /changemaptype <x> <y> <type> (CZ_CHANGE_MAPTYPE).
/// GM single cell type change request.
/// 0198 <x>.W <y>.W <type>.W
/// type:
///     0 = not walkable
///     1 = walkable
//FIXME: once players leave the map, the client 'forgets' this information.
/// /in /ex (CZ_SETTING_WHISPER_PC).
/// Request to allow/deny whispers from a nick.
/// 00cf <nick>.24B <type>.B
/// type:
///     0 = (/ex nick) deny speech from nick
///     1 = (/in nick) allow speech from nick
// Add name to ignore list (block)
// fail
// try to find a free spot, while checking for duplicates at the same time
// no space for new entry
// too many blocks
// name already exists
// Aegis reports success.
//Insert in position i
// Remove name from ignore list (unblock)
// find entry
//Not found
// fail
// move everything one place down to overwrite removed entry
// wipe last entry
// success
/// /inall /exall (CZ_SETTING_WHISPER_STATE).
/// Request to allow/deny all whispers.
/// 00d0 <type>.B
/// type:
///     0 = (/exall) deny all speech
///     1 = (/inall) allow all speech
// Deny all
// fail
// success
//Unblock everyone
// success
//Wipe the ignore list.
// success
// fail
/// Whisper ignore list (ZC_WHISPER_LIST).
/// 00d4 <packet len>.W { <char name>.24B }*
/// Whisper ignore list request (CZ_REQ_WHISPER_LIST).
/// 00d3
/// Request to invoke the /doridori recovery bonus (CZ_DORIDORI).
/// 01e7
/// Request to invoke the effect of super novice's guardian angel prayer (CZ_CHOPOKGI).
/// 01ed
/// Note: This packet is caused by 7 lines of any text, followed by
///       the prayer and an another line of any text. The prayer is
///       defined by lines 790~793 in data\msgstringtable.txt
///       "Dear angel, can you hear my voice?"
///       "I am" (space separated player name) "Super Novice~"
///       "Help me out~ Please~ T_T"
/* [Ind/Hercules] */
/* game client is currently broken on this (not sure the packetver range) */
/* it sends the request when the criteria doesn't match (and of course we let it fail) */
/* so restoring the old parse_globalmes method. */
// 10.0%, 20.0%, ..., 90.0%
//Lv17-> +50 critical (noted by Poki) [Skotlex]
// prayer always shows successful Lv5 cast and disregards noskill restrictions
/// Friends List
///
/// Toggles a single friend online/offline [Skotlex] (ZC_FRIENDS_STATE).
/// 0206 <account id>.L <char id>.L <state>.B
/// 0206 <account id>.L <char id>.L <state>.B <name>.24B
/// state:
///     0 = online
///     1 = offline
//Seek friend.
//Not found
//Yeah, a 1 here means "logged off", go figure...
// PACKETVER_ZERO
//Sub-function called from clif_foreachclient to toggle friends on/off [Skotlex]
/// Sends the whole friends list (ZC_FRIENDS_LIST).
/// 0201 <packet len>.W { <account id>.L <char id>.L <name>.24B }*
/// 0201 <packet len>.W { <account id>.L <char id>.L }*
// Send friends list
//Sending the online players
/// Notification about the result of a friend add request (ZC_ADD_FRIENDS_LIST).
/// 0209 <result>.W <account id>.L <char id>.L <name>.24B
/// result:
///     0 = MsgStringTable[821]="You have become friends with (%s)."
///     1 = MsgStringTable[822]="(%s) does not want to be friends with you."
///     2 = MsgStringTable[819]="Your Friend List is full."
///     3 = MsgStringTable[820]="(%s)'s Friend List is full."
/// Asks a player for permission to be added as friend (ZC_REQ_ADD_FRIENDS).
/// 0207 <req account id>.L <req char id>.L <req char name>.24B
/// Request to add a player as friend (CZ_ADD_FRIENDS).
/// 0202 <name>.24B
// ensure that the request player's friend list is not full
// Friend doesn't exist (no player with this name)
// "Character not found."
// adding oneself as friend
// @noask [LuzZza]
// Friend already exists
//"Friend already exists."
/// Answer to a friend add request (CZ_ACK_REQ_ADD_FRIENDS).
/// 0208 <inviter account id>.L <inviter char id>.L <result>.B
/// 0208 <inviter account id>.L <inviter char id>.L <result>.L (PACKETVER >= 6)
/// result:
///     0 = rejected
///     1 = accepted
//char_id = RFIFOL(fd,6);
// adding oneself as friend
//The account id is the same as the bl.id of players.
// Find an empty slot
// Achievements [Smokexyz/Hercules]
// Also add f_sd to sd's friendlist.
//No need to add anything.
// Achievements [Smokexyz/Hercules]
/// Request to delete a friend (CZ_DELETE_FRIENDS).
/// 0203 <account id>.L <char id>.L
// Search friend
//"Name not found in list."
//remove from friend's list first
// move all chars up
//should the guy be notified of some message? we should add it here if so
//friend not online -- ask char server to delete from his friendlist
// char-server offline, abort
//"This action can't be performed at the moment. Please try again later."
// We can now delete from original requester
// move all chars up
//"Friend removed"
/// /pvpinfo list (ZC_ACK_PVPPOINT).
/// 0210 <char id>.L <account id>.L <win point>.L <lose point>.L <point>.L
// times won
// times lost
/// /pvpinfo (CZ_REQ_PVPPOINT).
/// 020f <char id>.L <account id>.L
// TODO: Is there a way to use this on an another player (char/acc id)?
/// Ranking list
/// ranking pointlist  { <name>.24B <point>.L }*10
// Unsupported
// Packet size limits this list to 10 elements. [Skotlex]
//points
// In case the MAX is less than 10.
// Unsupported
// Packet size limits this list to 10 elements. [Skotlex]
//points
// In case the MAX is less than 10.
/// 097d <RankingType>.W {<CharName>.24B <point>L}*10 <mypoint>L (ZC_ACK_RANKING)
//mypoint
//mypoint
/*
//type
// pk_list unsupported atm
// 097e <RankingType>.W <point>.L <TotalPoint>.L (ZC_UPDATE_RANKING_POINT)
/// /blacksmith list (ZC_BLACKSMITH_RANK).
/// 0219 { <name>.24B }*10 { <point>.L }*10
/// /blacksmith (CZ_BLACKSMITH_RANK).
/// 0217
/// Notification about backsmith points (ZC_BLACKSMITH_POINT).
/// 021b <points>.L <total points>.L
/// /alchemist list (ZC_ALCHEMIST_RANK).
/// 021a { <name>.24B }*10 { <point>.L }*10
/// /alchemist (CZ_ALCHEMIST_RANK).
/// 0218
/// Notification about alchemist points (ZC_ALCHEMIST_POINT).
/// 021c <points>.L <total points>.L
/// /taekwon list (ZC_TAEKWON_RANK).
/// 0226 { <name>.24B }*10 { <point>.L }*10
/// /taekwon (CZ_TAEKWON_RANK).
/// 0225
/// Notification about taekwon points (ZC_TAEKWON_POINT).
/// 0224 <points>.L <total points>.L
/// /pk list (ZC_KILLER_RANK).
/// 0238 { <name>.24B }*10 { <point>.L }*10
/// /pk (CZ_KILLER_RANK).
/// 0237
/// SG Feel save OK [Komurka] (CZ_AGREE_STARPLACE).
/// 0254 <which>.B
/// which:
///     0 = sun
///     1 = moon
///     2 = star
//Bug?
// Are these really needed? Shouldn't they show up automatically from the feel save packet?
// 0
/// Star Gladiator's Feeling map confirmation prompt (ZC_STARPLACE).
/// 0253 <which>.B
/// which:
///     0 = sun
///     1 = moon
///     2 = star
///     10 = Do you agree to cast the magic spell that consumes 1 Black Gemstone and 1,000,000 Zeny?
/// Request to change homunculus' name (CZ_RENAME_MER).
/// 0231 <name>.24B
/// Request to warp/move homunculus/mercenary to it's owner (CZ_REQUEST_MOVETOOWNER).
/// 0234 <id>.L
// Mercenary or Homunculus
// Moving Homunculus
/// Request to move homunculus/mercenary (CZ_REQUEST_MOVENPC).
/// 0232 <id>.L <position data>.3B
// Mercenary or Homunculus
// Moving Mercenary
// Moving Homunculus
/// Request to do an action with homunculus/mercenary (CZ_REQUEST_ACTNPC).
/// 0233 <id>.L <target id>.L <action>.B
/// action:
///     always 0
/// Request to invoke a homunculus menu action (CZ_COMMAND_MER).
/// 022d <type>.W <command>.B
/// type:
///     always 0
/// command:
///     0 = homunculus information
///     1 = feed
///     2 = delete
//[orn]
/// Request to resurrect oneself using Token of Siegfried (CZ_STANDING_RESURRECTION).
/// 0292
//Cannot res while under the effect of SC_HELLPOWER.
/// Information about character's status values (ZC_ACK_STATUS_GM).
/// 0214 <str>.B <standardStr>.B <agi>.B <standardAgi>.B <vit>.B <standardVit>.B
///      <int>.B <standardInt>.B <dex>.B <standardDex>.B <luk>.B <standardLuk>.B
///      <attPower>.W <refiningPower>.W <max_mattPower>.W <min_mattPower>.W
///      <itemdefPower>.W <plusdefPower>.W <mdefPower>.W <plusmdefPower>.W
///      <hitSuccessValue>.W <avoidSuccessValue>.W <plusAvoidSuccessValue>.W
///      <criticalSuccessValue>.W <ASPD>.W <plusASPD>.W
// aspd
// FIXME: What is 'plusASPD' supposed to be? Maybe a delay?
/// /check (CZ_REQ_STATUS_GM).
/// Request character's status values.
/// 0213 <char name>.24B
/// MAIL SYSTEM
/// By Zephyrus
///
/// Notification about the result of adding an item to mail (ZC_ACK_MAIL_ADD_ITEM).
/// 0255 <index>.W <result>.B
/// result:
///     0 = success
///     1 = failure
/// Notification about the result of retrieving a mail attachment (ZC_MAIL_REQ_GET_ITEM).
/// 0245 <result>.B
/// result:
///     0 = success
///     1 = failure
///     2 = too many items
/// Notification about the result of sending a mail (ZC_MAIL_REQ_SEND).
/// 0249 <result>.B
/// result:
///     0 = success
///     1 = recipient does not exist
/// Notification about the result of deleting a mail (ZC_ACK_MAIL_DELETE).
/// 0257 <mail id>.L <result>.W
/// result:
///     0 = success
///     1 = failure
/// Notification about the result of returning a mail (ZC_ACK_MAIL_RETURN).
/// 0274 <mail id>.L <result>.W
/// result:
///     0 = success
///     1 = failure
/// Notification about new mail (ZC_MAIL_RECEIVE).
/// 024a <mail id>.L <title>.40B <sender>.24B
/// Opens/closes the mail window (ZC_MAIL_WINDOWS).
/// 0260 <type>.L
/// type:
///     0 = open
///     1 = close
/// Lists mails stored in inbox (ZC_MAIL_REQ_GET_LIST).
/// 0240 <packet len>.W <amount>.L { <mail id>.L <title>.40B <read>.B <sender>.24B <time>.L }*amount
/// read:
///     0 = unread
///     1 = read
// TODO: is this official?
// Inbox is full (Max %d). Delete some mails.
/// Mail inbox list request (CZ_MAIL_GET_LIST).
/// 023f
/// Opens a mail (ZC_MAIL_REQ_OPEN).
/// 0242 <packet len>.W <mail id>.L <title>.40B <sender>.24B <time>.L <zeny>.L
///     <amount>.L <name id>.W <item type>.W <identified>.B <damaged>.B <refine>.B
///     <card1>.W <card2>.W <card3>.W <card4>.W <message>.?B
// Mail doesn't exist
// no item, set all to zero
/// Request to open a mail (CZ_MAIL_OPEN).
/// 0241 <mail id>.L
/// Request to receive mail's attachment (CZ_MAIL_GET_ITEM).
/// 0244 <mail id>.L
/// Request to delete a mail (CZ_MAIL_DELETE).
/// 0243 <mail id>.L
// can't delete mail without removing attachment first
/// Request to return a mail (CZ_REQ_MAIL_RETURN).
/// 0273 <mail id>.L <receive name>.24B
/// Request to add an item or Zeny to mail (CZ_MAIL_ADD_ITEM).
/// 0247 <index>.W <amount>.L
/// Request to reset mail item and/or Zeny (CZ_MAIL_RESET_ITEM).
/// 0246 <type>.W
/// type:
///     0 = reset all
///     1 = remove item
///     2 = remove zeny
/// Request to send mail (CZ_MAIL_SEND).
/// 0248 <packet len>.W <recipient>.24B <title>.40B <body len>.B <body>.?B
//"Cannot send mails too fast!!."
// fail
// Invalid Append condition
// fail
// id will be assigned by charserver
// will attempt to resolve name
// Message has no length and somehow client verification was skipped.
// 1 Second flood Protection
/// AUCTION SYSTEM
/// By Zephyrus
///
/// Opens/closes the auction window (ZC_AUCTION_WINDOWS).
/// 025f <type>.L
/// type:
///     0 = open
///     1 = close
/// Returns auction item search results (ZC_AUCTION_ITEM_REQ_SEARCH).
/// 0252 <packet len>.W <pages>.L <count>.L { <auction id>.L <seller name>.24B <name id>.W <type>.L <amount>.W <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W <now price>.L <max price>.L <buyer name>.24B <delete time>.L }*
// Always 1
/// Result from request to add an item (ZC_ACK_AUCTION_ADD_ITEM).
/// 0256 <index>.W <result>.B
/// result:
///     0 = success
///     1 = failure
/// Request to initialize 'new auction' data (CZ_AUCTION_CREATE).
/// 024b <type>.W
/// type:
///     0 = create (any other action in auction window)
///     1 = cancel (cancel pressed on register tab)
///     ? = junk, uninitialized value (ex. when switching between list filters)
/// Request to add an item to the action (CZ_AUCTION_ADD_ITEM).
/// 024c <index>.W <count>.L
// Always 1
// By client, amount is always set to 1. Maybe this is a future implementation.
// Consumable or pets are not allowed
// Quest Item or something else
/// Result from an auction action (ZC_AUCTION_RESULT).
/// 0250 <result>.B
/// result:
///     0 = You have failed to bid into the auction
///     1 = You have successfully bid in the auction
///     2 = The auction has been canceled
///     3 = An auction with at least one bidder cannot be canceled
///     4 = You cannot register more than 5 items in an auction at a time
///     5 = You do not have enough Zeny to pay the Auction Fee
///     6 = You have won the auction
///     7 = You have failed to win the auction
///     8 = You do not have enough Zeny
///     9 = You cannot place more than 5 bids at a time
/// Result of the auction close request (ZC_AUCTION_ACK_MY_SELL_STOP).
/// 025e <result>.W
/// result:
///     0 = You have ended the auction
///     1 = You cannot end the auction
///     2 = Auction ID is incorrect
// BUG: The client identifies this packet as 0x25d (CZ_AUCTION_REQ_MY_SELL_STOP)
/// Request to add an auction (CZ_AUCTION_ADD).
/// 024d <now money>.L <max money>.L <delete hour>.W
// Invalid Situations...
// You do not have enough zeny to pay the Auction Fee.
// Zeny Limits
// The auction has been canceled
// Just in case
// The auction has been canceled
// Auction checks...
// This bound item cannot be traded to that character.
// The auction has been canceled
// No Char Server? lets say something to the client
/// Cancels an auction (CZ_AUCTION_ADD_CANCEL).
/// 024e <auction id>.L
/// Closes an auction (CZ_AUCTION_REQ_MY_SELL_STOP).
/// 025d <auction id>.L
/// Places a bid on an auction (CZ_AUCTION_BUY).
/// 024f <auction id>.L <money>.L
//They aren't supposed to give zeny [Inkfish]
// Your GM level doesn't authorize you to perform this action.
// You have failed to bid into the auction
// You do not have enough zeny
// char server is down (bugreport:1138)
// You have failed to bid into the auction
/// Auction Search (CZ_AUCTION_ITEM_SEARCH).
/// 0251 <search type>.W <auction id>.L <search text>.24B <page number>.W
/// search type:
///     0 = armor
///     1 = weapon
///     2 = card
///     3 = misc
///     4 = name search
///     5 = auction id search
// FIXME: bug #5071
/// Requests list of own currently active bids or auctions (CZ_AUCTION_REQ_MY_INFO).
/// 025c <type>.W
/// type:
///     0 = sell (own auctions)
///     1 = buy (own bids)
/// CASH/POINT SHOP
///
/// List of items offered in a cash shop (ZC_PC_CASH_POINT_ITEMLIST).
/// 0287 <packet len>.W <cash point>.L { <sell price>.L <discount price>.L <item type>.B <name id>.W }*
/// 0287 <packet len>.W <cash point>.L <kafra point>.L { <sell price>.L <discount price>.L <item type>.B <name id>.W }* (PACKETVER >= 20070711)
/// Cashshop Buy Ack (ZC_PC_CASH_POINT_UPDATE).
/// 0289 <cash point>.L <error>.W
/// 0289 <cash point>.L <kafra point>.L <error>.W (PACKETVER >= 20070711)
/// For error return codes see enum cashshop_error@clif.h
/// Request to buy item(s) from cash shop (CZ_PC_BUY_CASH_POINT_ITEM).
/// 0288 <name id>.W <amount>.W
/// 0288 <name id>.W <amount>.W <kafra points>.L (PACKETVER >= 20070711)
/// 0288 <packet len>.W <kafra points>.L <count>.W { <amount>.W <name id>.W }.4B*count (PACKETVER >= 20100803)
/// Adoption System
///
/// Adoption message (ZC_BABYMSG).
/// 0216 <msg>.L
/// msg:
///     0 = "You cannot adopt more than 1 child."
///     1 = "You must be at least character level 70 in order to adopt someone."
///     2 = "You cannot adopt a married person."
/// Adoption confirmation (ZC_REQ_BABY).
/// 01f6 <account id>.L <char id>.L <name>.B
/// Request to adopt a player (CZ_REQ_JOIN_BABY).
/// 01f9 <account id>.L
/// Answer to adopt confirmation (CZ_JOIN_BABY).
/// 01f7 <account id>.L <char id>.L <answer>.L
/// answer:
///     0 = rejected
///     1 = accepted
// Both players need to be online
// Incorrect values
// Rejected
/// Convex Mirror (ZC_BOSS_INFO).
/// 0293 <infoType>.B <x>.L <y>.L <minHours>.W <minMinutes>.W <maxHours>.W <maxMinutes>.W <monster name>.51B
/// infoType:
///     0 = No boss on this map (BOSS_INFO_NOT).
///     1 = Boss is alive (position update) (BOSS_INFO_ALIVE).
///     2 = Boss is alive (initial announce) (BOSS_INFO_ALIVE_WITHMSG).
///     3 = Boss is dead (BOSS_INFO_DEAD).
// Boss on This Map
// First Time
// Boss is Dead
// Hours
// Minutes
/// Requesting equip of a player (CZ_EQUIPWIN_MICROSCOPE).
/// 02d6 <account id>.L
/// Receive configurations (CZ_CONFIG).
/// 02d8 <type>.L <value>.L
/// type:
///     0 = open equip window
///     2 = pet autofeeding
///     3 = homunculus autofeeding
///     value:
///         0 = disabled
///         1 = enabled
/// Request to change party invitation tick.
///     value:
///         0 = enabled
///         1 = disabled
// send to char server
/// Questlog System [Kevin] [Inkfish]
///
/// Sends list of all quest states (ZC_ALL_QUEST_LIST).
/// 02b1 <packet len>.W <num>.L { <quest id>.L <active>.B }*num
/// 097a <packet len>.W <num>.L { <quest id>.L <active>.B <remaining time>.L <time>.L <count>.W { <mob_id>.L <killed>.W <total>.W <mob name>.24B }*count }*num
/// 09f8 <packet len>.W <num>.L { <quest id>.L <active>.B <remaining time>.L <time>.L <count>.W { <hunt identification>.L <mob type>.L <mob_id>.L <min level>.L <max level>.L <killed>.W <total>.W <mob name>.24B }*count }*num
// >= than the actual length
// PACKETVER >= 20141022
// Info Needed
// Info Needed
// Info Needed
// PACKETVER >= 20141022
/// Sends list of all quest missions (ZC_ALL_QUEST_MISSION).
/// 02b2 <packet len>.W <num>.L { <quest id>.L <start time>.L <expire time>.L <mobs>.W { <mob id>.L <mob count>.W <mob name>.24B }*3 }*num
/// Notification about a new quest (ZC_ADD_QUEST).
/// 02b3 <quest id>.L <active>.B <start time>.L <expire time>.L <mobs>.W { <mob id>.L <mob count>.W <mob name>.24B }*3
/// 09f9 <quest id>.L <active>.B <start time>.L <expire time>.L <mobs>.W { <hunt identification>.L <mob type>.L <mob id>.L <min level>.L <max level>.L <mob count>.W <mob name>.24B }*3
// >= than the actual length
// Info Needed
// Info Needed
// Info Needed
/// Notification about a quest being removed (ZC_DEL_QUEST).
/// 02b4 <quest id>.L
/// Notification of an update to the hunting mission counter (ZC_UPDATE_MISSION_HUNT).
/// 02b5 <packet len>.W <mobs>.W { <quest id>.L <mob id>.L <total count>.W <current count>.W }*3
/// 09fa <packet len>.W <mobs>.W { <quest id>.L <hunt identification>.L <total count>.W <current count>.W }*3
// >= than the actual length
/// Notification of an hunting mission counter just after quest is added (ZC_HUNTING_QUEST_INFO).
/// 08fe <packet len>.W  { <quest id>.L <mob id>.L <total count>.W <current count>.W }*3
// >= than the actual length
/// Request to change the state of a quest (CZ_ACTIVE_QUEST).
/// 02b6 <quest id>.L <active>.B
/// Notification about the change of a quest state (ZC_ACTIVE_QUEST).
/// 02b7 <quest id>.L <active>.B
/// Notification about an NPC's quest state (ZC_QUEST_NOTIFY_EFFECT).
/// 0446 <npc id>.L <x>.W <y>.W <effect>.W <type>.W
/// effect:
///     0 = none
///     1 = exclamation mark icon
///     2 = question mark icon
/// type:
///     0 = yellow
///     1 = orange
///     2 = green
///     3 = purple
/// Mercenary System
///
/// Notification about a mercenary status parameter change (ZC_MER_PAR_CHANGE).
/// 02a2 <var id>.W <value>.L
/// Mercenary base status data (ZC_MER_INIT).
/// 029b <id>.L <atk>.W <matk>.W <hit>.W <crit>.W <def>.W <mdef>.W <flee>.W <aspd>.W
///     <name>.24B <level>.W <hp>.L <maxhp>.L <sp>.L <maxsp>.L <expire time>.L <faith>.W
///     <calls>.L <kills>.L <atk range>.W
// Mercenary shows ATK as a random value between ATK ~ ATK2
/// Mercenary skill tree (ZC_MER_SKILLINFO_LIST).
/// 029d <packet len>.W { <skill id>.W <type>.L <level>.W <sp cost>.W <attack range>.W <skill name>.24B <upgradeable>.B }*
// Skillable for Mercenary?
/// Request to invoke a mercenary menu action (CZ_MER_COMMAND).
/// 029f <command>.B
///     1 = mercenary information
///     2 = delete
/// Mercenary Message
/// message:
///     0 = Mercenary soldier's duty hour is over.
///     1 = Your mercenary soldier has been killed.
///     2 = Your mercenary soldier has been fired.
///     3 = Your mercenary soldier has ran away.
/// Notification about the remaining time of a rental item (ZC_CASH_TIME_COUNTER).
/// 0298 <name id>.W <seconds>.L
// '<ItemName>' item will disappear in <seconds/60> minutes.
/// Deletes a rental item from client's inventory (ZC_CASH_ITEM_DELETE).
/// 0299 <index>.W <name id>.W
// '<ItemName>' item has been deleted from the Inventory
/// Book Reading (ZC_READ_BOOK).
/// 0294 <book id>.L <page>.L
/// Battlegrounds
///
/// Updates HP bar of a camp member.
/// 02e0 <account id>.L <name>.24B <hp>.W <max hp>.W (ZC_BATTLEFIELD_NOTIFY_HP).
/// 0a0e <account id>.L <hp>.L <max hp>.L (ZC_BATTLEFIELD_NOTIFY_HP2)
// packet version can be wrong, because inconsistend data in other servers. From packets table it start from 20140312 [4144]
// To correctly display the %hp bar. [Skotlex]
/// Updates the position of a camp member on the minimap (ZC_BATTLEFIELD_NOTIFY_POSITION).
/// 02df <account id>.L <name>.24B <class>.W <x>.W <y>.W
/// Notifies clients of a battleground message (ZC_BATTLEFIELD_CHAT).
/// 02dc <packet len>.W <account id>.L <name>.24B <message>.?B
/**
/// Notifies client of a battleground score change (ZC_BATTLEFIELD_NOTIFY_POINT).
/// 02de <camp A points>.W <camp B points>.W
/// Battleground camp belong-information (ZC_BATTLEFIELD_NOTIFY_CAMPINFO).
/// 02dd <account id>.L <name>.24B <camp>.W
// name don't show in screen.
/// Custom Fonts (ZC_NOTIFY_FONT).
/// 02ef <account_id>.L <font id>.W
/*==========================================
/* default is already PARTY */
// S 0x2cb <Instance name>.61B <Standby Position>.W
// Required to start the instancing information window on Client
// This window re-appear each "refresh" of client automatically until type 4 is send to client.
// S 0x2cc <Standby Position>.W
// To announce Instancing queue creation if no maps available
// flag is priority, negative value mean cancel reservation
// S 0x2cd <Instance Name>.61B <Instance Remaining Time>.L <Instance Noplayers close time>.L
// S 0x2ce <Message ID>.L
// 0 = Notification (EnterLimitDate update?)
// 1 = The Memorial Dungeon expired; it has been destroyed
// 2 = The Memorial Dungeon's entry time limit expired; it has been destroyed
// 3 = The Memorial Dungeon has been removed.
// 4 = Create failure (removes the instance window)
//WBUFL(buf,6) = EnterLimitDate;
/// Notifies clients about item picked up by a party member (ZC_ITEM_PICKUP_PARTY).
/// 02b8 <account id>.L <name id>.W <identified>.B <damaged>.B <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W <equip location>.W <item type>.B
// equip location
// item type
/// Display gained exp (ZC_NOTIFY_EXP).
/// 07f6 <account id>.L <amount>.L <var id>.W <exp type>.W
/// var id:
///     SP_BASEEXP, SP_JOBEXP
/// exp type:
///     0 = normal exp gain/loss
///     1 = quest exp gain/loss
// Normal exp is shown in yellow, quest exp is shown in purple.
// Normal exp is shown in yellow, quest exp is shown in purple.
/// Displays digital clock digits on top of the screen (ZC_SHOWDIGIT).
/// type:
///     0 = Displays 'value' for 5 seconds.
///     1 = Incremental counter (1 tick/second), negated 'value' specifies start value (e.g. using -10 lets the counter start at 10).
///     2 = Decremental counter (1 tick/second), negated 'value' specifies start value (does not stop when reaching 0, but overflows).
///     3 = Decremental counter (1 tick/second), 'value' specifies start value (stops when reaching 0, displays at most 2 digits).
/// value:
///     Except for type 3 it is interpreted as seconds for displaying as DD:HH:MM:SS, HH:MM:SS, MM:SS or SS (leftmost '00' is not displayed).
/// Notification of the state of client command /effect (CZ_LESSEFFECT).
/// 021d <state>.L
/// state:
///     0 = Full effects
///     1 = Reduced effects
///
/// NOTE:   The state is used on Aegis for sending skill unit packet
///         0x11f (ZC_SKILL_ENTRY) instead of 0x1c9 (ZC_SKILL_ENTRY2)
///         whenever possible. Due to the way the decision check is
///         constructed, this state tracking was rendered useless,
///         as the only skill unit, that is sent with 0x1c9 is
///         Graffiti.
/// S 07e4 <length>.w <option>.l <val>.l {<index>.w <amount>.w).4b*
// Button clicked: 0 = Cancel, 1 = OK
// Canceled by player.
// It should be impossible to have more than that.
// Prevent hacking.
// Inventory index
// Change Material
// Level 1: Pure to Rough
// Level 2: Rough to Pure
/*==========================================
/// Buying Store System
///
/// Opens preparation window for buying store (ZC_OPEN_BUYING_STORE).
/// 0810 <slots>.B
/// Request to create a buying store (CZ_REQ_OPEN_BUYING_STORE).
/// 0811 <packet len>.W <limit zeny>.L <result>.B <store name>.80B { <name id>.W <amount>.W <price>.L }*
/// result:
///     0 = cancel
///     1 = open
// TODO: Make this check global for all variable length packets.
// minimum packet length
// so that buyingstore_create knows, how many elements it has access to
/// Notification, that the requested buying store could not be created (ZC_FAILED_OPEN_BUYING_STORE_TO_BUYER).
/// 0812 <result>.W <total weight>.L
/// result:
///     1 = "Failed to open buying store." (0x6cd, MSI_BUYINGSTORE_OPEN_FAILED)
///     2 = "Total amount of then possessed items exceeds the weight limit by <weight/10-maxweight*90%>. Please re-enter." (0x6ce, MSI_BUYINGSTORE_OVERWEIGHT)
///     9 = "No sale (purchase) information available." (0x705)
///    10 = "Cant open store at this location." (0xC9D)
///     ? = nothing
/// Notification, that the requested buying store was created (ZC_MYITEMLIST_BUYING_STORE).
/// 0813 <packet len>.W <account id>.L <limit zeny>.L { <price>.L <count>.W <type>.B <name id>.W }*
/// Notifies clients in area of a buying store (ZC_BUYING_STORE_ENTRY).
/// 0814 <account id>.L <store name>.80B
/// Request to close own buying store (CZ_REQ_CLOSE_BUYING_STORE).
/// 0815
/// Notifies clients in area that a buying store was closed (ZC_DISAPPEAR_BUYING_STORE_ENTRY).
/// 0816 <account id>.L
/// Request to open someone else's buying store (CZ_REQ_CLICK_TO_BUYING_STORE).
/// 0817 <account id>.L
/// Sends buying store item list (ZC_ACK_ITEMLIST_BUYING_STORE).
/// 0818 <packet len>.W <account id>.L <store id>.L <limit zeny>.L { <price>.L <amount>.W <type>.B <name id>.W }*
// TODO: Figure out, if no longer needed items (amount == 0) are listed on official.
/// Request to sell items to a buying store (CZ_REQ_TRADE_BUYING_STORE).
/// 0819 <packet len>.W <account id>.L <store id>.L { <index>.W <name id>.W <amount>.W }*
// minimum packet length
// so that buyingstore_trade knows, how many elements it has access to
/// Notifies the buyer, that the buying store has been closed due to a post-trade condition (ZC_FAILED_TRADE_BUYING_STORE_TO_BUYER).
/// 081a <result>.W
/// result:
///     3 = "All items within the buy limit were purchased." (0x6cf, MSI_BUYINGSTORE_TRADE_OVERLIMITZENY)
///     4 = "All items were purchased." (0x6d0, MSI_BUYINGSTORE_TRADE_BUYCOMPLETE)
///     ? = nothing
/// Updates the zeny limit and an item in the buying store item list (ZC_UPDATE_ITEM_FROM_BUYING_STORE).
/// 081b <name id>.W <amount>.W <limit zeny>.L
// GID
/// Deletes item from inventory, that was sold to a buying store (ZC_ITEM_DELETE_BUYING_STORE).
/// 081c <index>.W <amount>.W <price>.L
/// message:
///     "%s (%d) were sold at %dz." (0x6d2, MSI_BUYINGSTORE_TRADE_SELLCOMPLETE)
///
/// NOTE:   This function has to be called _instead_ of clif_delitem/clif_dropitem.
// price per item, client calculates total Zeny by itself
/// Notifies the seller, that a buying store trade failed (ZC_FAILED_TRADE_BUYING_STORE_TO_SELLER).
/// 0824 <result>.W <name id>.W
/// result:
///     5 = "The deal has failed." (0x39, MSI_DEAL_FAIL)
///     6 = "The trade failed, because the entered amount of item %s is higher, than the buyer is willing to buy." (0x6d3, MSI_BUYINGSTORE_TRADE_OVERCOUNT)
///     7 = "The trade failed, because the buyer is lacking required balance." (0x6d1, MSI_BUYINGSTORE_TRADE_LACKBUYERZENY)
///     ? = nothing
/// Search Store Info System
///
/// Request to search for stores (CZ_SEARCH_STORE_INFO).
/// 0835 <packet len>.W <type>.B <max price>.L <min price>.L <name id count>.B <card count>.B { <name id>.W }* { <card>.W }*
/// type:
///     0 = Vending
///     1 = Buying Store
///
/// NOTE:   The client determines the item ids by specifying a name and optionally,
///         amount of card slots. If the client does not know about the item it
///         cannot be searched.
// minimum packet length
// check, if there is enough data for the claimed count of items
// TODO: add search by item options.
/// Results for a store search request (ZC_SEARCH_STORE_INFO_ACK).
/// 0836 <packet len>.W <is first page>.B <is next page>.B <remaining uses>.B { <store id>.L <account id>.L <shop name>.80B <nameid>.W <item type>.B <price>.L <amount>.W <refine>.B <card1>.W <card2>.W <card3>.W <card4>.W }*
/// is first page:
///     0 = appends to existing results
///     1 = clears previous results before displaying this result set
/// is next page:
///     0 = no "next" label
///     1 = "next" label to retrieve more results
// make-up an item for clif_addcards
/// Notification of failure when searching for stores (ZC_SEARCH_STORE_INFO_FAILED).
/// 0837 <reason>.B
/// reason:
///     0 = "No matching stores were found." (0x70b)
///     1 = "There are too many results. Please enter more detailed search term." (0x6f8)
///     2 = "You cannot search anymore." (0x706)
///     3 = "You cannot search yet." (0x708)
///     4 = "No sale (purchase) information available." (0x705)
///     362 = silent error
/// Request to display next page of results (CZ_SEARCH_STORE_INFO_NEXT_PAGE).
/// 0838
/// Opens the search store window (ZC_OPEN_SEARCH_STORE_INFO).
/// 083a <type>.W <remaining uses>.B
/// type:
///     0 = Search Stores
///     1 = Search Stores (Cash), asks for confirmation, when clicking a store
/// Request to close the store search window (CZ_CLOSE_SEARCH_STORE_INFO).
/// 083b
/// Request to invoke catalog effect on a store from search results (CZ_SSILIST_ITEM_CLICK).
/// 083c <account id>.L <store id>.L <nameid>.W
/// Notification of the store position on current map (ZC_SSILIST_ITEM_CLICK_ACK).
/// 083d <xPos>.W <yPos>.W
/// Parse function for packet debugging.
// clif_parse ensures, that there is at least 2 bytes of data
// variable length
// clif_parse ensures, that this amount of data is already received
/*==========================================
/// Main client packet processing function
/**
/**
/*==========================================
/**
/*==========================================
/**
/*==========================================
// Can't auto cast both Extended class and 3rd class skills.
/*===========================================
// To prevent hacking.
// Changematerial
/*==========================================
/*==========================================
/// Move Item from or to Personal Tab (CZ_WHATSOEVER) [FE]
/// 0907 <index>.W
///
/// R 0908 <index>.w <type>.b
/// type:
///   0 = move item to personal tab
///   1 = move item to normal tab
/* can't move while dead. */
/* nothing to do. */
/* [Ind/Hercules] */
/// Items that are in favorite tab of inventory (ZC_ITEM_FAVORITE).
/// 0900 <index>.W <favorite>.B
/* [Ind/Hercules] placeholder for unsupported incoming packets (avoids server disconnecting client) */
// variable-length packet
//Cash Shop is disabled in this map
//Cash Shop is disabled in this map
//[Ryuuzaki] - switched positions to reflect proper values
/* TODO apply some state tracking */
// Skip empty tabs, the client only expects filled ones
/// R 0848 <len>.W <limit>.W <kafra pay>.L (<item id>.L <amount>.L <tab>.W)*
//Cash Shop is disabled in this map
// [Ryuuzaki] - These are free cash points (strangely #CASH = main cash currently for us, confusing)
// [Ryuuzaki] //changed Kafrapoints calculation. [Normynator]
//This should never happen.
/* create_egg succeeded so mark as success */
/* [Ind/Hercules] */
// [4144] packet exists only in 2011 and was dropped after
/* [Ind/Hercules] */
//PARTY
// GUILD
// SIEGE
// USE_SIMPLE_EFFECT - Forcing /mineffect in castles during WoE (probably redundant? I'm not sure)
// DISABLE_LOCKON - TODO
// COUNT_PK
// NO_PARTY_FORMATION
// BATTLEFIELD
// DISABLE_COSTUMEITEM - Disables Costume Sprite
// USECART - TODO
// SUNMOONSTAR_MIRACLE - TODO
// UNUSED
/* temp, until feature is complete */
// Client creates bg data when this packet arrives
/* temp, until feature is complete */
/* no idea */
// Sends BG ready req to all with same bg arena/type as sd
/* Made Possible Thanks to Yommy! */
// some strange byte, IDA shows.. BYTE3(BoxItemIDLength) = 2;
/* Made Possible Thanks to Yommy! */
// message: MSG_BROADCASTING_SPECIAL_ITEM_OBTAIN2
// message: MSG_BROADCASTING_SPECIAL_ITEM_OBTAIN
/* [Ind/Hercules] special thanks to Yommy~! */
/* [Ind/Hercules] - Data Thanks to Yommy
/* Bank System [Yommy/Hercules] */
/* how much zeny char has after operation */
/* money in the bank */
/* how much zeny char has after operation */
/* money in the bank */
/* TODO: official response packet (tried 0x8cb/0x97b but the display was quite screwed up.) */
/* currently mimicing */
// Base EXP : %d%% | Base Drop: %d%% | Base Death Penalty: %d%%
/**
/* TODO maybe this could be a new permission? using gm level in the meantime */
/**
/**
/* Thanks to Yommy */
/* TODO track the state <3~ */
/* NPC Market (by Ind after an extensive debugging of the packet, only possible thanks to Yommy <3) */
/* TODO track the state <3~ */
/* Roulette System [Yommy/Hercules] */
// Roulette is disabled
/** TODO **/
// Roulette is disabled
// Roulette is disabled
/** What do we need this for? (other than state tracking), game client closes the window without our response. **/
//ShowDebug("clif_parse_RouletteClose\n");
// Roulette is disabled
/** TODO maybe a new log type for roulette items? **/
/**
// Roulette is disabled
/** TODO **/
/** this scenario = clif->rd.items[i] < limit **/
/**
// close window
/**
//Track The merge item cancelation ?
/// Request to select cart's visual look for new cart design (ZC_SELECTCART).
/// 097f <Length>.W <identity>.L <type>.B
/// Starts navigation to the given target on client side
// probably this packet with other fields present in older packet versions
// How detailed will our navigation be?
// monster with destination field
// with coordinates
// without coordinates(will fail if you are already on the map)
// Which services can be used for transportation?
// If this flag is set, the navigation window will not be opened up
// Target map
// Target x
// Target y
// Target monster ID
/**
/**
// max entries with clan names
// All allies and antagonists are assumed as valid entries
// since it only gets inside the vector after the validation
// on clan->config_read
/**
/**
/**
// p->MemberName is being ignored on the client side.
/**
/* */
// filter out invalid / unsupported packets
/**
/* Browse through the session's achievement list and gather their values. */
/* Sanity check for nonull pointers. */
/* Determine Achievement Rank and current exp */
// Validate achievement rank type achievements.
/* Determine Achievement Rank Exp */
/* Send payload */
// PACKETVER >= 20141016
/**
/* Get Session Achievement Data */
/* Get total points, current rank and current rank points from the session. */
/* Determine Total Achievement Points */
/* Determine Achievement Rank */
/* Determine Achievement Rank Exp */
/* Validate rank-related achievements */
// PACKETVER >= 20141016
/**
/**
// PACKETVER >= 20141016
/**
// Same Title
/**
// Update names
// End of Achievement System
/*==========================================
//No need to continue building the packet if it failed
// packet add date is 20140716, but from players reports it wrong. Using closer known correct version.
/// Send hat effects to the client (ZC_HAT_EFFECT).
/// 0A3B <Length>.W <AID>.L <Status>.B { <HatEffectId>.W }
// do nothing
/// 0ae8 <packet len>.W
// '@' command + ' ' + NUL
// show item preview in already opened preview window
// insert cardId into equipped item in pos equipment slot into slot cardSlot.
// TODO: show or store client version
// do nothing, any packet update client tick
// PACKETVER_MAIN_NUM >= 20160601 || PACKETVER_RE_NUM >= 20160525 || defined(PACKETVER_ZERO)
// PACKETVER_MAIN_NUM >= 20160601 || PACKETVER_RE_NUM >= 20160525 || defined(PACKETVER_ZERO)
// Validate that the amount sent in the packet is matching the database
// Validate that the player have enough of the item
// Validate refine rate requirement
// All requirements are met, move to the next one
// The item is not in sources list
// PACKETVER >= 20160302
// PACKETVER >= 20160504
/*==========================================
//TODO apply delays or disconnect based on packet throughput [FlavioJS]
// Note: "click masters" can do 80+ clicks in 10 seconds
// Limit max packets per cycle to 3 (delay packet spammers) [FlavioJS]  -- This actually aids packet spammers, but stuff like /str+ gets slow without it [Ai4rei]
// begin main client packet processing loop
//Disassociate character from the socket connection.
// Player logout display [Valaris]
//Unusual logout (during log on/off/map-changer procedure)
// filter out invalid / unsupported packets
// determine real packet length
// variable-length packet
// not enough data received to form the packet
// Note: Overriding const qualifier to re-inject the decoded packet ID.
// Update key for the next packet
//Only valid packet when there is no session
//Only valid packet when player is not on a map
// Dump on console instead
// main loop end
/**
/* nothing more to do */
/* load structure data */
// PACKETVER_ZERO
// PACKETVER_ZERO
// defined(OBFUSCATIONKEY1) && defined(OBFUSCATIONKEY2) && defined(OBFUSCATIONKEY3)
// PACKETVER_ZERO
// PACKETVER_ZERO
// defined(OBFUSCATIONKEY1) && defined(OBFUSCATIONKEY2) && defined(OBFUSCATIONKEY3)
/*==========================================
/* vars */
/* core */
/* auth */
/* item-related */
// look like unused
/* unit-related */
/* main unit spawn */
/* map-related */
/* multi-map-server */
/* npc-shop-related */
/* npc-script-related */
/* client-user-interface-related */
/* player-unit-specific-related */
/* visual effects client-side */
/* sound effects client-side */
/* chat/message-related */
/* trade handling */
// unused
/* vending handling */
/* storage handling */
/* skill-list handling */
/* party-specific */
/* guild-specific */
/* battleground-specific */
/* instance-related */
/* pet-related */
/* friend-related */
/* gm-related */
/* hom-related */
/* questlog-related */
/* mail-related */
/* auction-related */
/* mercenary-related */
/* item rental */
/* party booking related */
/* Group Search System Update */
/* buying store-related */
/* search store-related */
/* elemental-related */
/* bgqueue */
/* misc-handling */
/* Hercules Channel System */
/* */
/* Bank System [Yommy/Hercules] */
/* */
/* */
/* */
/* NPC Market */
/* */
/* Merge Items */
/* Cart Deco */
/* */
/* Achievement System */
/* Title */
/*------------------------
/* dull */
/* BGQueue */
/* RagExe Cash Shop [Ind/Hercules] */
/*  */
/* Group Search System Update */
/* Bank System [Yommy/Hercules] */
/* Roulette System [Yommy/Hercules] */
/* */
/* NPC Market */
/* */
/* Achievements [Smokexyz/Hercules] */
/* RODEX */
// -- Clan system
// -- Hat Effect
// -- Pet Evolution
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\date.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// Returns YYYYMMDD of now
/*==========================================
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\duel.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// msg_txt
/*==========================================
//" -- Duels: %d/%d, Members: %d/%d, Max players: %d --"
//" -- Duels: %d/%d, Members: %d/%d --"
// " -- Duel has been created (@invite/@leave) --"
// " -- Player %s invites %s to duel --"
// "Blue -- Player %s invites you to PVP duel (@accept/@reject) --"
// " <- Player %s has left duel --"
// " -> Player %s has accepted duel --"
// " -- Player %s has rejected duel --"
/*=====================================
/* vars */
/* funcs */
//Duel functions // [LuzZza]
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\elemental.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// Initial mode
// summon level
//[(Caster's Max HP/ 3 ) + (Caster's INT x 10 )+ (Caster's Job Level x 20 )] x [(Elemental Summon Level + 2) / 3]
//Caster's Max SP /4
//Caster's [ Max SP / (18 / Elemental Summon Skill Level) 1- 100 ]
//Caster's [ Max SP / (18 / Elemental Summon Skill Level) ]
//Caster's HIT + (Caster's Base Level)
//[Elemental Summon Skill Level x (Caster's INT / 2 + Caster's DEX / 4)]
//150 + [Caster's DEX / 10] + [Elemental Summon Skill Level x 3 ]
//Caster's DEF + (Caster's Base Level / (5 - Elemental Summon Skill Level)
//Caster's MDEF + (Caster's INT / (5 - Elemental Summon Skill Level)
//Caster's FLEE + (Caster's Base Level / (5 - Elemental Summon Skill Level)
//Caster's HIT + (Caster's Base Level)
//per individual bonuses
//ATK + (Summon Agni Skill Level x 20) / HIT + (Summon Agni Skill Level x 10)
//MDEF + (Summon Aqua Skill Level x 10) / MATK + (Summon Aqua Skill Level x 20)
//FLEE + (Summon Ventus Skill Level x 20) / MATK + (Summon Ventus Skill Level x 10)
//DEF + (Summon Tera Skill Level x 25) / ATK + (Summon Tera Skill Level x 5)
// Request Char Server to create this elemental
// Elemental's summon time is over.
// Not created - loaded - DB info
// Initialize it after first summon.
// Why?
// Just remove status change.
// Master
// Elemental Spirit
// Elemental side
// Master side
// Remove previous target.
// Set new target
// Not in skill range.
// Try to walk to the target.
// Walking, waiting to be in range. Client don't handle it, then we must handle it here.
//regardless of remaining HP/SP it can be cast
//Otherwise, just cast the skill.
// Reset target.
/*===============================================================
// Select a skill.
// Set new target
// Reset target after casting the skill  to avoid continuous attack.
/**
// Remove target
// Removes the effects of the previous mode.
// Normalize elemental mode to elemental skill mode.
// Aggressive spirit mode -> Aggressive spirit skill.
// Assist spirit mode -> Assist spirit skill.
// Passive spirit mode -> Passive spirit skill.
// Use a skill immediately after every change mode.
// invalid skill id
// invalid skill id
//If can't seek yet, not an enemy, or you can't attack it, skip.
/* Fall through */
//Pick closest target?
// Check if caster can sustain the summoned elemental
// Drain SP every 10 seconds
// Can't sustain delete it.
//No thinking when you just started to walk.
//No thinking until be near the master.
// Master out of vision range.
// Master too far, chase.
//Already walking to him
//Can't move yet.
//No targets available.
// 2% chance to cast attack skill.
//Attempt to attack.
//At this point we know the target is attackable, we just gotta check if the range matches.
//Already locked.
//Target within range, engage
//Follow up if possible.
//only necessary after we're up
/*=====================================
/* */
/* */
/* funcs */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\guild.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// GP_BOUND_ITEMS
/*==========================================
//If player belongs to a different guild, kick him out.
// Modified [Komurka]
// Retrieve skill_lv learned by guild
/*==========================================
// <skill id>,<max lv>,<req id1>,<req lv1>,<req id2>,<req lv2>,<req id3>,<req lv3>,<req id4>,<req lv4>,<req id5>,<req lv5>
// enable guild's glory when required for emblems
/*==========================================
/// lookup: guild id -> guild*
/// lookup: guild name -> guild*
/// lookup: castle id -> castle*
/// lookup: map index -> castle*
/// lookup: map name -> castle*
/// lookup: player AID/CID -> member index
/// lookup: player sd -> member position
//Creation of member information
//m->exp        = 0;
//m->exp_payper = 0;
// When player create or join a guild the date is updated
/**
/**
// no members connected to this guild so do not iterate
//Code from party_send_xy_timer [Skotlex]
//------------------------------------------------------------------------
// empty name
// You're already in a guild
// You need the necessary item to create a guild
//Whether or not to create guild
// Creation failure (The guild name already exists)
//struct guild *g;
// Success
//emperium consumption
//Information request
//Information request with event
//The one in the db (if present) becomes the next event from this.
//Confirmation of the character belongs to guild
//Delete association with guild_id for all characters
// erase guild
//Get and display information for all member
// Not interested in guildless users
// Guild member
// Join channels from allied guilds
// Shortcut to skip the alliance checks again
// Alliance member
//Perform the check on the user because the first load
//If the guild master is online the first time the guild_info is received,
//that means he was the first to join, so apply guild skill blocking here.
//Also set the guild master flag.
// [LuzZza]
// [LuzZza]
//Transmission of information at all members
//Submit basic information
//Submit emblem
//Send members information
//Submit information skills
// Send information and affiliation if unsent
//clif->guild_notice(sd, g); Is already sent in clif_parse_LoadEndAck
//Occurrence of an event
/*=============================================
//Invite permission.
//checking if there no other invitation pending
//You can't invite someone who has already disconnected.
//Can't invite people inside castles. [Skotlex]
//search an empty spot in guild
/// Guild invitation reply.
/// flag: 0:rejected, 1:accepted
// subsequent requests may override the value
// mismatch
// look up the person who sent the invite
//NOTE: this can be NULL because the person might have logged off in the meantime
// Already in another guild. [Paradox924X]
// rejected
// accepted
//TODO: send a minimap update to this player
//Invoked when a player joins.
//- If guild is not in memory, it is requested
//- Otherwise sd pointer is set up.
//- Player must be authed and must belong to a guild before invoking this method
// set the Guild Master flag
// prevent Guild Skills from being used directly after relog
/*==========================================
// cancel if player not present or invalid guild_id invitation
//failure
//if all ok add player to guild
//Packets which were sent in the previous 'guild_sent' implementation.
//TODO: send new emblem info to others
//Next line commented because it do nothing, look at guild_recv_info [LuzZza]
//clif->charnameupdate(sd); //Update display name [Skotlex]
// Makes the character join their respective guild's channel for #ally chat
/*==========================================
// Can't leave inside castles
/*==========================================
//Expulsion permission
//Can't leave inside guild castles.
// find the member and perform expulsion
//Can't expel the GL!
// no such guild (error!)
// not a member (inconsistency!)
// no one online to inform
//Guild bound item check
// remove member from guild
// update char, if online
// do stuff that needs the guild_id first, BEFORE we wipe it
//Close the guild storage.
//Update display name [Skotlex]
//TODO: send emblem update to self and people around
//Character is online
//Character is offline, ask char server to do the job
//Someone is in guild storage, close them
// cleaned up [LuzZza]
//Note that this works because it is invoked in parse_LoadEndAck before connect_new is cleared.
// cleaned up [LuzZza]
//Treat char_id who doesn't match guild_id (not found as member)
//Ensure validity of pointer (ie: player logs in/out, changes map-server)
//Send XY dot updates. [Skotlex]
//Moved from guild_send_memberinfoshort [LuzZza]
/*====================================================
// Chat logging type 'G' / Guild Chat
/*====================================================
/*====================================================
// Update char position in client [LuzZza]
/*====================================================
/*====================================================
// Update char name in client [LuzZza]
/*====================================================
/*====================================================
/*====================================================
/*====================================================
// update guardians (mobs)
// update permanent guardians
// update temporary guardians
// update npcs (flags or other npcs that used flagemblem to attach to this guild)
/**
/*====================================================
//Otherwise tax everything.
/*====================================================
/*====================================================
// not a guild skill
// no guild
// not the guild master
/*====================================================
/* Guild Aura handling */
// Inform all members
//duration doesn't matter these status never end with val4
/*====================================================
// Blocks all guild skills which have a common delay time.
/*====================================================
/*====================================================
// Disable alliance creation during woe [Valaris]
//"Alliances cannot be made during Guild Wars!"
// Prevent creation alliance with same guilds [LuzZza]
// check if already allied
/*====================================================
//Character left? Cancel alliance.
// proposed guild_id alliance doesn't match tsd guildid
// consent
// Reconfirm the number of alliance
// inform other servers
// deny
/*====================================================
// Disable alliance breaking during woe [Valaris]
//"Alliances cannot be broken during Guild Wars!"
/*====================================================
// Prevent creation opposition with same guilds [LuzZza]
// checking relations
// check if not already hostile
// Prevent the changing of alliances to oppositions during WoE.
//Change alliance to opposition.
// inform other serv
/*====================================================
// failure
// new relationship
// remove relationship
// notify players
// alliance notification
// enemy notification
// Retransmission of the relationship list to all members
/**
// Destroy all relationships
/**
// We call castle_event::OnGuildBreak of all castles of the guild
// You can set all castle_events in the 'db/castle_db.txt'
//Save the new 'owner', this should invoke guardian clean up and other such things.
//Invoked on /breakguild "Guild name"
// Destroy all relationships
// [LuzZza]
//Changes the Guild Master to the specified player. [Skotlex]
// Not part of the guild
//Nothing to change.
//Notify servers that master has changed.
//Notification from Char server that a guild's master has changed. [Skotlex]
//Position 0: guild Master.
//"You no longer are the Guild Master."
//"You have become the Guild Master!"
//Block his skills for 5 minutes to prevent abuse.
// announce the change to all guild members
// Update clientside guildmaster flag
/*====================================================
/* regardless of char server allowing it, we clear the guild master's auras */
// FIXME: Why is this not done in the above loop?
/**
/**
// The castle's owner has changed? Update or remove Guardians too. [Skotlex]
// defense invest change -> recalculate guardian hp
/**
// char-server reconnected
// Load castle data then invoke OnAgitInit* on last
//Last owned castle in the list invokes ::OnAgitInit
// offset of castle or -1
//No castles owned, invoke OnAgitInit as it is.
// load received castles into memory, one by one
// update map-server castle data with new info
// last owned one
/*====================================================
// Run All NPC_Event[OnAgitStart]
/*====================================================
// Run All NPC_Event[OnAgitEnd]
/*====================================================
// Run All NPC_Event[OnAgitStart2]
/*====================================================
// Run All NPC_Event[OnAgitEnd2]
// How many castles does this guild have?
// Are these two guilds allied?
/* check */
/* exists, most likely updated the id. */
/* save the current slot */
/* add */
/* save */
/* find it */
/* found */
/* compact list */
/**
/**
/**
/* called when scripts are reloaded/unloaded */
//guild skill tree [Komurka]
/* */
/* */
/* */
/* guild flags cache */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* */
/* guild flag caching */
/* guild aura */
/* */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\homunculus.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// DBPATH
//Returns the viewdata for homunculus
// Normal Homunculus
// Evolved Homunculus
// Homunculus S
//There's no intimacy penalties on death (from Tharis)
//Delete timers when dead.
//unit remove map will invoke unit free
//Remove from map (if it has no intimacy, it is auto-removed from memory)
//Vaporize a character's homun. If flag, HP needs to be 80% or above.
//Can't vaporize a dead homun.
//Block regen while vaporized.
//Delete timers when vaporized.
//delete a homunculus, completely "killing it".
//Emote is the emotion the master should use, send negative to disable.
//This makes it be deleted right away.
// Send homunculus_dead to client
/* load previous homunculus form skills first. */
//Skill already known.
//Skill already known.
//Don't allow raising while you have granted skills. [Skotlex]
//1 skillpoint each 3 base level
//Aegis discards the decimals in the stat growth values!
// Growth: hp:%d sp:%d str(%.2f) agi(%.2f) vit(%.2f) int(%.2f) dex(%.2f) luk(%.2f) 
//Apply evolution bonuses
//status_Calc flag&1 will make current HP/SP be reloaded from hom structure
// apply land skills immediately
//status_Calc flag&1 will make current HP/SP be reloaded from hom structure
// apply land skills immediately
//levelup
// Return the new value
// Return 0 if decrease fails or intimacy became 0 else the new value
// copy data that must be saved in homunculus struct ( hp / sp )
//Do not check for max_hp/max_sp caps as current could be higher to max due
//to status changes/skills (they will be capped as needed upon stat
//calculation on login)
//dunno increase value for each food
// Too much food :/
// Delete the homunculus if intimacy <= 100
//simple Fix albator
//bugreport:3032 // FIXME[Haru]: This should be normalized by the inter-server (so that it's const here)
// You cannot use this name
/**
// Fix character ID if necessary.
// Find a random valid pos around the player
//Restore HP/SP block.
//Create a new homun.
// If homunc not yet loaded, load it
//Can't use this if homun wasn't vaporized.
//Spawn him
// send this x2. dunno why, but kRO does that [blackhole89]
//Warp him to master.
// Receive homunculus data from char server
// Failed to load
// Hom just created.
//uh? Overwrite the data.
// Correct char id if necessary.
// send this x2. dunno why, but kRO does that [blackhole89]
/* force shuffle if your level is higher than the allowed */
// Ask homunculus creation to char server
//Initial data
//32%
//21/1000
// Request homunculus creation
// no homunculus
//Load homun data;
// vaporized homunculi need to be 'called'
// already alive
//Add it back to the map.
//Resets a homunc stats back to zero (but doesn't touches hunger or intimacy)
//Reset values to level 1.
//Level it back up
//Evolved bonuses
//Base Class,Evo Class
//Name, Food, Hungry Delay, Base Size, Evo Size, Race, Element, ASPD
//base HP, SP, str, agi, vit, int, dex, luk
//Growth Min/Max HP, SP, str, agi, vit, int, dex, luk
//Evolution Min/Max HP, SP, str, agi, vit, int, dex, luk
//Check that the min/max values really are below the other one.
// <hom class>,<skill id>,<max level>[,<job level>],<req id1>,<req lv1>,<req id2>,<req lv2>,<req id3>,<req lv3>,<req id4>,<req lv4>,<req id5>,<req lv5>,<intimacy lv req>
// MinJobLvl has been added - FIXME: is this extra field even needed anymore?
// check for bounds [celest]
//This is to avoid adding two lines for the same skill. [Skotlex]
// Search an empty line or a line with the same skill_id (stored in j)
// Last permitted level have to be 0!
// Add homunc timer function to timer func list [Toms]
//Stock view data for homuncs
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\HPMmap.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// HPMDataCheck comes after all the other includes
//tracking currently not enabled
// - requires modifying how plugins calls atcommand creation
// - needs load/unload during runtime support
//unsigned int pID;/* plugin id */
/* plugin id */
/**
// Initialized by the caller.
/**
/**
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\instance.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// CELL_NOSTACK
/// Checks whether given instance id is valid or not.
// out of range
// uninitialized/freed instance slot
/*--------------------------------------
/* already got this instance */
// Start instancing window
/**
// source map not found
// Source map already belong to a Instance.
// Searching for a Free Map
// Unused map found (old instance)
// Using next map index
// Copy source map
// Generate Name for Instance Map
// Add map index
// No free map index
// Reallocate cells
// Appropriately clear cell data
// CELL_NOSTACK
//Mimic unit
//Mimic skills
//Mimic zone mf
//clear
// Flag this map as a src map for instances
// Attach to actual instance
/*--------------------------------------
/*--------------------------------------
// not instances found for this map
// This map is a instance, not a src map instance
/*--------------------------------------
// Destination Map
/*--------------------------------------
// nothing to do
/* cant be together with the previous because it will rely on all of them being up */
/*--------------------------------------
/* for npcs behave differently when being unloaded within a instance */
//There is no need for this, the pet is removed together with the player. [Skotlex]
/*--------------------------------------
// Free memory
// Remove from instance
/*--------------------------------------
/*--------------------------------------
// nothing to do
// Report users this instance has been destroyed
// Remove all maps from instance
/*--------------------------------------
// Notify instance users normal instance expiration
// Notify instance users it will be destroyed of no user join it again in "X" time
/*--------------------------------------
/*--------------------------------------
// User was on the instance map
/**
/* any (or all) of them were disabled, we destroy */
/* populate the instance again */
/* restart timers */
/* start point */
/* count */
/* */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\intif.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// GP_BOUND_ITEMS
// alias
//-----------------------------------------------------------------
// Send to inter server
// pet
//Type: 0 - PC, 1 - PET, 2 - HOM
//Request for saving registry values.
/* 0x2 = length (set later) */
/* count */
/* its a @number */
/* @string$ can get here, so we skip */
/* no need! */
/* won't be higher; the column size is 32 */
/* won't be higher; the column size is 254 */
/* prepare follow up */
/* 0x2 = length (set later) */
/* count */
/* mark & go. */
//Request the registries for this player.
/* if char server ain't online it doesn't load, shouldn't we kill the session then? */
//Request Acc Reg 2
//Request Acc Reg
//Request Char Reg
//=================================================================
// Account Storage
//-----------------------------------------------------------------
/**
/* Check for character server availability */
/**
// Total items in storage.
// Mark the storage state as received.
// Initialize the save flag as false.
// re-check remaining items.
/**
// Assert that at this point in the code, both flags are true.
// Save request has been sent
/**
// character is most probably offline.
// Flag it as unsaved, to re-attempt later
//=================================================================
// Guild Storage
//-----------------------------------------------------------------
// Party creation request
// Party information request
// Request to add a member to party
// Request to change party configuration (exp,item share)
// Request to leave party
// Request keeping party for new map ??
// Request breaking party
// Request a new leader for party
//=========================
// Clan System
//-------------------------
/**
// Request a Guild creation
// Request Guild information
// Request to add member to the guild
// Request a new leader for guild
// Request to leave guild
//Update request / Lv online status of the guild members
//Guild disbanded notification
/**
// Request a change of Guild member information
// Request a change of Guild title
// Request an update of Guildskill skill_id
// Request a new guild relationship
// Request to change guild notice
// Request to change guild emblem
/**
// Request change castle guild owner and save data
//-----------------------------------------------------------------
// Homunculus Packets send to Inter server [albator]
//-----------------------------------------------------------------
//-----------------------------------------------------------------
// Packets receive from inter server
// Request player registre
//Normally registries should arrive for in log-in chars.
//Character registry from another character.
//Character Registry
//Account Registry
//Account2 Registry
/* have it not complain about insertion of vars before loading, and not set those vars as new or modified */
//for script_add_str to refer to here in case errors occur
/**
/**
/* reset */
/* flag it back */
//Received all registry values, execute init scripts and what-not. [Skotlex]
//If flag != 0, we attach a player and open the storage
// Already open.. lets ignore this update
// Already have storage, and it has been modified and not saved yet! Exploit! [Skotlex]
// ACK guild_storage saved
/*RFIFOL(fd,2), */RFIFOL(fd,6));
// ACK party creation
// Receive party info
// ACK adding party member
// ACK changing party option
// ACK member leaving party
// ACK party break
// ACK party on new map
// ACK guild creation
// ACK guild infos
// ACK adding guild member
// ACK member leaving guild
// ACK guild member basic info
// ACK guild break
// basic guild info change notice
// 0x3839 <packet len>.w <guild id>.l <type>.w <data>.?b
//int len = RFIFOW(fd,2) - 10;
//void* data = RFIFOP(fd,10);
// guild member info change notice
// 0x383a <packet len>.w <guild id>.l <account id>.l <char id>.l <type>.w <data>.?b
//int len = RFIFOW(fd,2) - 18;
//void* data = RFIFOP(fd,18);
// ACK change of guild title
// ACK change of guild skill update
// ACK change of guild relationship
// ACK change of guild notice
// ACK change of guild emblem
// Reply guild castle data request
// ACK change of guildmaster
// Request pet creation
// ACK pet data
/* Really? Whats the point, shouldn't be sent when successful then [Ind] */
// ACK pet save data
/* Really? Whats the point, shouldn't be sent when successful then [Ind] */
// ACK deleting pet
// ACK changing name request, players,pets,homun
//Players [NOT SUPPORTED YET]
//Pets
//Hom
//----------------------------------------------------------------
// Homunculus recv packets [albator]
/* Really? Whats the point, shouldn't be sent when successful then [Ind] */
/* Really? Whats the point, shouldn't be sent when successful then [Ind] */
/***************************************
/**
/**
/**
/* check for character server. */
/* Return if no data. */
/**************************************
/**
/**
// User not online anymore
// Insert at the beginning
// Insert at the end
// sd->avail_quests and k didn't meet in the middle: some entries were skipped
// Move the entries at the end to fill the gap
/**
/**
/*==========================================
/*------------------------------------------
/** user is not online anymore and its ok (quest log also does this) **/
//FIXME: this operation is not safe [ultramage]
// cache is now in sync
/*------------------------------------------
/*------------------------------------------
/*------------------------------------------
// Free space is available for new mails
/*------------------------------------------
// Free space is available for new mails
/*------------------------------------------
// notify sender
/*==========================================
// Confirmation Packet ??
// FIXME: Leeching off a parse function
// To update the list, display your buy list
// Used to send 'You have won the auction' and 'You failed to won the auction' messages
/*==========================================
/* Really? Whats the point, shouldn't be sent when successful then [Ind] */
/* Really? Whats the point, shouldn't be sent when successful then [Ind] */
/*==========================================
/* Really? Whats the point, shouldn't be sent when successful then [Ind] */
/* Really? Whats the point, shouldn't be sent when successful then [Ind] */
/* matching e.g. previous fd owner didn't dc during request or is still the same */
/*==========================================
//Lock for retrieval process
//3856
//Unlock now that operation is completed
/*==========================================
/*------------------------------------------
// Rodex Inbox Request
// char_id: char_id
// account_id: account_id (used by account mail)
// flag: 0 - Open/Refresh ; 1 = Next Page
// user is not online anymore
/*------------------------------------------
// user is not online anymore
/*------------------------------------------
/// Updates a mail
/// flag:
///     0 - receiver Read
///     1 - user got Zeny
///     2 - user got Items
///     3 - delete
///     4 - sender Read (returned mail)
/*------------------------------------------
/*------------------------------------------
// User is not online anymore
// User is not online anymore
// User is not online anymore
//-----------------------------------------------------------------
// Communication from the inter server
// Return a 0 (false) if there were any errors.
// 1, 2 if there are not enough to return the length of the packet if the packet processing
// Verify ID of the packet
// Check the length of the packet
// Processing branch
//Quest system
// Mail System
// Auction System
//Bound items
// Mercenary System
// Elemental System
// RoDEX
// Clan System
// Skip packet
/*=====================================
//0x3800-0x380f
//0x3810 Achievements [Smokexyz/Hercules]
//0x3820
//0x3830
//0x3840
//0x3850  Auctions [Zephyrus] itembound[Akinari] Clan System[Murilo BiO]
//0x3860  Quests [Kevin] [Inkfish]
//0x3870  Mercenaries [Zephyrus] / Elemental [pakpil]
//0x3880
//0x3890  Homunculus [albator] / RoDEX [KirieZ]
/* */
/* funcs */
/******QUEST SYTEM*******/
// MERCENARY SYSTEM
// MAIL SYSTEM
// AUCTION SYSTEM
// ELEMENTAL SYSTEM
// RoDEX
/* Clan System */
/* @accinfo */
/* */
/* */
/* Achievement System */
/* parse functions */
/* RoDEX */
/* Clan System */
/* Achievement System */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\irc-bot.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/**
//#define IRCBOT_DEBUG
/// @copydoc irc_bot_interface::connect_timer()
/// @copydoc irc_bot_interface::identify_timer()
/// @copydoc irc_bot_interface::join_timer()
/// @copydoc irc_bot_interface::func_search()
/// @copydoc irc_bot_interface::parse()
/// @copydoc irc_bot_interface::parse_source()
/// @copydoc irc_bot_interface::parse_sub()
// source command :message (i.e. QUIT)
// IRCBOT_DEBUG
/// @copydoc irc_bot_interface::queue()
// No queue yet
//queue starts
//start queue timer
/// @copydoc irc_bot_interface::queue_timer()
/// @copydoc irc_bot_interface::send()
// Add to queue
/// @copydoc irc_interface_bot::pong()
/// @copydoc irc_interface_bot::privmsg_ctcp()
// Ignore it
// Ignore it
// variable for number of seconds (used with time() function)
// variable for time in structure ->tm_mday, ->tm_sec, ...
// get time in seconds since 1/1/1970
// convert seconds in structure
// like sprintf, but only for date/time (Sunday, November 02 2003 15:12:52)
// Server time (normal time): %A, %B %d %Y %X.
// IRCBOT_DEBUG
/// @copydoc irc_bot_interface::privmsg()
// CTCP
// IRCBOT_DEBUG
//break; // Uncomment this line to truncate long messages instead of posting them as multiple lines
/// @copydoc irc_bot_interface::userjoin()
// [ #%s ] User IRC.%s joined the channel.
/// @copydoc irc_bot_interface::userleave()
// [ #%s ] User IRC.%s left the channel. [Quit: %s]
// [ #%s ] User IRC.%s left the channel. [%s]
/// @copydoc irc_bot_interface::usernick()
// [ #%s ] User IRC.%s is now known as IRC.%s
/// @copydoc irc_bot_interface::relay()
/// @copydoc irc_bot_interface::init()
/// Command handlers
/// @copydoc irc_bot_interface::final()
/**
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\itemdb.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// DBPATH, RENEWAL
// struct battle_config
// MAX_MOB_DB
// W_MUSICAL, W_WHIP
// item script processing
/**
//Absolute priority to Aegis code name.
//Second priority to Client displayed name.
/*==========================================
// Absolute priority to Aegis code name.
//Second priority to Client displayed name.
/* name to item data */
/**
//Invalid item.
/**
// Search in array
// Search in dbmap
// We got all matches we can return, so we only need to count now.
/* [Ind/Hercules] */
/* [Ind/Hercules] */
/*==========================================
/// Searches for the item_data.
/// Returns the item_data or NULL if it does not exist.
// dummy data, doesn't exist
/**
/// Returns human readable name for given item type.
/// @param type Type id to retrieve name for ( IT_* ).
/**
// Base Classes
// 2-1 Classes
// 2-2 Classes
// Extended Classes
// Other Classes
//Bongun/Munak
/**
//Base classes
//Both Novice/Super-Novice are counted with the same ID
//2-1 classes
//2-2 classes
// Bard/Dancer share the same slot now.
// 0
//Special classes that don't fit above.
//Taekwon boy
//Star Gladiator
//Soul Linker
//Rebellion job can equip Gunslinger equips. [Rytech]
//Kagerou/Oboro jobs can equip Ninja equips. [Rytech]
//Bongun/Munak
//Death Knight
//Dark Collector
//Kagerou / Oboro
//Rebellion
//Summoner
//Etc item
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/* same as itemdb_isidentified but without a lookup */
//memset would be better? I failed to get the following to work though hu
//memset(&itemdb->groups[count].nameid[ecount+1],itemdb->groups[count].nameid[ecount],sizeof(itemdb->groups[count].nameid[0])*repeat);
/* [Ind/Hercules] - HCache for Packages */
// first 2 bytes = package count
//into a package, first 2 bytes = id.
//next 2 bytes = must count
//next 2 bytes = random count
//now we loop into must
//first 2 byte = item id
//next 2 byte = qty
//next 2 byte = hours
//next 1 byte = announce (1:0)
//next 1 byte = named (1:0)
//next 1 byte = ForceSerial (1:0)
//now we loop into random groups
//next 2 bytes = how many entries in this group
//now we loop into the group's list
//first 2 byte = item id
//next 2 byte = qty
//next 2 byte = rate
//next 2 byte = hours
//next 1 byte = announce (1:0)
//next 1 byte = named (1:0)
//next 1 byte = ForceSerial (1:0)
// first 2 bytes = package count
//into a package, first 4 bytes = id.
//next 2 bytes = must count
//next 2 bytes = random count
//now we loop into must
//first 4 byte = item id
//next 2 byte = qty
//next 2 byte = hours
//next 1 byte = announce (1:0)
//next 1 byte = named (1:0)
//next 1 byte = ForceSerial (1:0)
//now we loop into random groups
//next 2 bytes = how many entries in this group
//now we loop into the group's list
//first 2 byte = item id
//next 2 byte = qty
//next 2 byte = rate
//next 2 byte = hours
//next 1 byte = announce (1:0)
//next 1 byte = named (1:0)
//next 1 byte = ForceSerial (1:0)
/* validate tree, drop poisonous fruits! */
/* grab the known sizes */
/* write */
//item packages don't stop looping until something comes out of them, so if you have only one item in it the drop is guaranteed.
/**
// do nothing. plugins can do their own work
/**
// ENABLE_CASE_CHECK
/* Id Lookup */
/* Checking for duplicate entries. */
/* Name Lookup */
/* check for illegal characters in the constant. */
/* Set name as a script constant with index as value. */
/* Script Code Lookup */
/* Set Script */
/* Additional fields through plugins */
/* Allocate memory and copy contents */
/* Store ptr in the database */
// ENABLE_CASE_CHECK
// ENABLE_CASE_CHECK
// ENABLE_CASE_CHECK
/* populate the items to refer to this combo */
/*======================================
//Grom Ring
//Bride Ring
//Musical instruments are always male-only
//Whips are always female-only
/**
// item id wrong for any packet versions
// item id too big for packet version before item id in 4 bytes
// catch invalid item types
//Items that are consumed only after target confirmation
//When a particular price is not given, we should base it off the other one
//(it is important to make a distinction between 'no price' and 0z)
// Default value if none or an ivalid one was specified
// Default value if none or an ivalid one was specified
//Apply gender filtering.
// Validated. Finally insert it
// Don't free if it's inheriting the same script
// Don't free if it's inheriting the same script
// Don't free if it's inheriting the same script
// Don't free if it's inheriting the same script
// Don't free if it's inheriting the same script
// do nothing. plugins can do own work
/**
/**
/*
// Optional fields
// Use old entry as default
// This is an unsigned value, do not check for >= 0
// TODO: Remove (Deprecated - 2016-09-04 [Haru])
// Fallback to int if it's not a group
// Fallback to int if it's not a group
/**
// TODO add duplicates check for itemdb->other
/*==========================================
/**
// TODO check duplicate names also in itemdb->other
/**
/**
/**
/*==========================================
/// Destroys the item_data.
// free scripts
// trash item
// free self
/**
// clear the previous itemdb data
// Check if script was loaded
// read new data
//Epoque's awesome @reloaditemdb fix - thanks! [Ind]
//- Fixes the need of a @reloadmobdb after a @reloaditemdb to re-link monster drop data
// readjust itemdb pointer cache for each player
// reset item delays
// Check and flag items for inspection.
/* clear combo bonuses */
// Check for and delete unavailable/disabled items.
// ENABLE_CASE_CHECK
// ENABLE_CASE_CHECK
//Dummy data item.
/** it failed? we disable it **/
/* */
/* */
/* */
/* */
/* */
/* */
/* itemdb->array is cleared on itemdb->init() */
/* */
/* */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\log.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// SQL_INNODB
/// obtain log type character for item/zeny logs
// (T)rade
// (V)ending
// (P)layer
// (M)onster
// NPC (S)hop
// (N)PC Script
// Steal/Snatcher
// (C)onsumed
// Pr(O)duced/Ingredients
// MVP Rewards
// (A)dmin command
// Sto(R)age
// (G)uild storage
// (E)mail attachment
// Auct(I)on
// (B)uying Store
// (L)oot (consumed monster pick/drop)
// Ban(K) Transactions
// Divorce
// Roulette
// Rental
// Card
// Invalid in inventory
// Invalid in cart
// Egg
// Quest
// Skill
// Refine
// Other
// Achievement
// should not get here, fallback
/// obtain log type character for chat logs
// Gl(O)bal
// (W)hisper
// (P)arty
// (G)uild
// (M)ain chat
// (C)lan
// should not get here, fallback
/// check if this item should be logged according the settings
/// logs items, that summon monsters
/// logs item transactions (generic)
// disabled
//we skip logging this item set - it doesn't meet our logging conditions [Lupus]
/// logs item transactions (players)
/// logs item transactions (monsters)
/// logs zeny transactions
/// logs MVP monster rewards
/// logs used atcommands
/// logs messages passed to script command 'logmes'
/**
/**
/**
// disabled
// no chat logging during woe
// log db connection
/**
//map_log default values
//map_log/database default values
// file/table names defaults are defined inside log_config_read_database
//map_log/filter/item default values
// logs any item
// log refined items, with refine >= +5
// log rare items. drop chance <= 1%
// 1000z
/**
// map_log.database defaults are defined in order to not make unecessary calls to safestrncpy [Panikon]
/**
/**
/**
/**
// Type of storage 'file'/'table'
// e_log_pick_type
// import should overwrite any previous configuration, so it should be called last
/**
/* */
/* will be modified in a few seconds once loading is complete. */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\mail.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// Item send
//Zeny send
// Zeny Transfer
// clif->updatestatus(sd, SP_ZENY);
// Item Transfer
// check for amount overflow
// Removes the attachment from sender
//Zeny receive
// Item receive (due to failure)
//Zeny receive (due to failure)
// This function only check if the mail operations are valid
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\map.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// CELL_NOSTACK, CIRCULAR_AREA, CONSOLE_INPUT, DBPATH, RENEWAL
// npc_setcells(), npc_unsetcells()
// WFIFO*()
/*==========================================
/**
/**
/*==========================================
/*==========================================
/*==========================================
/*==========================================
// Timer function to check if there some remaining lock and remove them if so.
// Called each 1s
/**
// When reading from mapcache the cell isn't initialized
// TODO: Maybe start initializing cells when they're loaded instead of
// having to get them here? [Panikon]
/*==========================================
/*==========================================
// blocklist (2ways chainlist)
// can't delete block (already at the beginning of the chain)
//Since the head of the list, update the block_list map of []
/*==========================================
//Block not in map, just update coordinates, but do naught else.
//TODO: Perhaps some outs of bounds checking should be placed here?
//status_change_end(bl, SC_BLADESTOP, INVALID_TIMER); //Won't stop when you are knocked away, go figure...
//Shadow Form Target Moving
//Shadow Form Caster Moving
/* Guild Aura Moving */
/*==========================================
/*
/** @name Functions for block_list search and manipulation
/* @{ */
/**
//func() may delete this bl_list[] slot, checking for prev ensures it wasn't queued for deletion.
/**
/**
/**
/**
/**
// Limit search area to map size
// duplication for better performance
// func != NULL
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
// No movement.
// Movement along one axis only.
// Moving south
// North
//dy == 0
// West
// East
// Diagonal movement
/**
/**
/**
/**
//Since more skills use this, check for ending point as well.
//Targets beyond the initial ending point need the wall check.
//All these shifts are to increase the precision of the intersection point and distance considering how it's
//int math.
//k will be between 1~16 instead of 0~1
//Avoid needless calculations by not getting the sqrt right away.
//If all dot coordinates were <<4 the square of the magnitude is <<8
/**
// [Skotlex]
// check for all targets in the square that
// contains the initial and final positions (area range increased to match the
// radius given), then for each object to test, calculate the distance to the
// path and include it if the range fits and the target is in the line (0<k<1,
// as they call it).
// The implementation I took as reference is found at
// http://web.archive.org/web/20050720125314/http://astronomy.swin.edu.au/~pbourke/geometry/pointline/
// http://paulbourke.net/geometry/pointlineplane/
// I won't use doubles/floats, but pure int math for
// speed purposes. The range considered is always the same no matter how
// close/far the target is because that's how SharpShooting works currently in
// kRO
//method specific variables
//The square of the magnitude
//Same begin and ending point, can't trace path.
//Adjust final position to fit in the given area.
//TODO: Find an alternate method which does not requires a square root calculation.
//Expand target area to cover range.
//Values are shifted later on for higher precision using int math.
/**
/** @} */
/// Generates a new flooritem object id from the interval [MIN_FLOORITEM, MAX_FLOORITEM).
/// Used for floor items, skill units and chatroom objects.
/// @return The new object id
// find a free id
// update cursor
/*==========================================
/*
/*==========================================
//Avoid item stacking to prevent against exploits. [Skotlex]
/*==========================================
//No range? Return the target cell then....
//Avoid picking the same target tile.
//Limit of retries reached.
/*==========================================
//Current cell is free
//Algorithm only works up to costrange of 34
//Linear search
//Full diagonal search
//One cell diagonal, rest linear (TODO: Find a better algorithm for this)
//Get next direction
//Diagonal search complete, repeat with higher cost range
//Linear search complete, switch to diagonal directions
/*==========================================
/**
/// Adds(or replaces) the nick of charid to nick_db and fullfils pending requests.
/// Does nothing if the character is online.
// already online
/// Removes the nick of charid from nick_db.
/// Sends name to all pending requests on charid.
/// Notifies sd of the nick of charid.
/// Uses the name in the character if online.
/// Uses the name in nick_db if offline.
// not in cache, request it
/*==========================================
/*==========================================
/*==========================================
//Removing a player that is not active.
//Except when logging out, clear the auth-connect data immediately.
//Non-active players should not have loaded any data yet (or it was cleared already) so no additional cleanups are needed.
//Cancel the event timer.
/* TODO: dump this chunk after bg_queue is fully enabled */
/* two times, the npc event above may assign a new one or delete others */
//Unit_free handles clearing the player related data,
//map->quit handles extra specific data which is related to quitting normally
//(changing map-servers invokes unit_free but bypasses map->quit)
//Status that are not saved...
// Return loot to owner
// No need to Double Save Storage on Quit.
// Avoid map conflicts and warnings on next login
// Party Booking [Spiria]
/**
/**
// just a id2bl lookup because there's no npc_db
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/// Returns the nick of the target charid or NULL if unknown (requests the nick to the char server).
// character is online, return it's name
// name in nick_db
// request the name
/// Returns the struct map_session_data of the charid or NULL if the char is not online.
/*==========================================
// partial name search
// Perfect Match
// exact search only
/*==========================================
/**
/// Applies func to all the players in the db.
/// Stops iterating if func returns -1.
// stop iterating
/// Applies func to all the players in the db.
/// Stops iterating if func returns -1.
/// @see map_vforeachpc
/// Applies func to all the mobs in the db.
/// Stops iterating if func returns -1.
// stop iterating
/// Applies func to all the mobs in the db.
/// Stops iterating if func returns -1.
/// @see map_vforeachmob
/// Applies func to all the npcs in the db.
/// Stops iterating if func returns -1.
// stop iterating
/// Applies func to all the npcs in the db.
/// Stops iterating if func returns -1.
/// @see map_vforeachnpc
/// Applies func to everything in the db.
/// Stops iterating gif func returns -1.
// stop iterating
/// Applies func to everything in the db.
/// Stops iterating gif func returns -1.
/// @see map_vforeachregen
/// Applies func to everything in the db.
/// Stops iterating if func returns -1.
// stop iterating
/// Applies func to everything in the db.
/// Stops iterating if func returns -1.
/// @see map_vforeachiddb
/// Iterator.
/// Can filter by bl type.
///< flags for special behaviour
///< what bl types to return
///< database iterator
/// Returns true if the block_list matches the description in the iterator.
///
/// @param _mapit_ Iterator
/// @param _bl_ block_list
/// @return true if it matches
/* type matches */ )
/// Allocates a new iterator.
/// Returns the new iterator.
/// types can represent several BL's as a bit field.
/// TODO should this be expanded to allow filtering of map/guild/party/chat/cell/area/...?
///
/// @param flags Flags of the iterator
/// @param type Target types
/// @return Iterator
/// Frees the iterator.
///
/// @param iter Iterator
/// Returns the first block_list that matches the description.
/// Returns NULL if not found.
///
/// @param iter Iterator
/// @return first block_list or NULL
// found match
/// Returns the last block_list that matches the description.
/// Returns NULL if not found.
///
/// @param iter Iterator
/// @return last block_list or NULL
// found match
/// Returns the next block_list that matches the description.
/// Returns NULL if not found.
///
/// @param iter Iterator
/// @return next block_list or NULL
// end
// found a match
// try next
/// Returns the previous block_list that matches the description.
/// Returns NULL if not found.
///
/// @param iter Iterator
/// @return previous block_list or NULL
// end
// found a match
// try prev
/// Returns true if the current block_list exists in the database.
///
/// @param iter Iterator
/// @return true if it exists
/*==========================================
/*=========================================
// Stores the spawn data entry in the mob list.
// Returns the index of successful, or -1 if the list was full.
//Mobs have not been removed yet [Skotlex]
//When not to remove mob:
// doesn't respawn and is not a slave
// respawn data is not in cache
// hasn't spawned yet
// is damaged and mob_remove_damaged is off
// is a mvp
//Incorrect map id!
//Incorrect timer call!
//Map not empty!
// should never happen
//Mobs are already scheduled for removal
/*==========================================
/*==========================================
/*==========================================
//If gat isn't null, this is a local map.
/*==========================================
/*==========================================
// both are standing on the same spot.
// aegis-style, makes knockback default to the left.
// athena-style, makes knockback default to behind 'src'.
// upper-right
// up
// right
// up-right
// lower-right
// down
// right
// down-right
// lower-left
// down
// left
// down-left
// upper-left
// up
// left
// up-left
/*==========================================
//Pick a random diagonal direction
//Pick a random interval from the whole vector in that direction
//The complement of the previously picked segment
// gat system
// walkable ground
// non-walkable ground
// ???
// walkable water
// ???
// gap (snipable)
// ???
// default to 'wall'
/**
// TO-DO: Maybe handle the scenario, if the decoded buffer isn't the same size as expected? [Shinryo]
// Set cell properties
/*==========================================
//NOTE: this intentionally overrides the last row and column
// gat type retrieval
// base gat type checks
// base cell type checks
// special checks
/* [Ind/Hercules] */
/*==========================================
/*==========================================
// Keep X
// Going left
// Going right
// Already Exists
// Starting cell problem
// Collision
/**
/*==========================================
//Local map,Do nothing. Give priority to our own local maps over ones from another server. [Skotlex]
//That's odd, we received info that we are the ones with this map, but... we don't have it.
/**
/*==========================================
//Map either does not exists or is a local map.
/**
// Rewind file pointer before passing it to the read function.
/**
/**
/**
/**
/**
/**
/* will aFree(zone) */
/* clear the pk zone stuff */
/* clear the main zone stuff */
//Dynamic mobs flag by [random]
// first, reset maps to their initial zones:
// now it's safe to remove the zones:
// then reload everything from scratch:
/// Initializes map flags and adjusts them depending on configuration.
// mapflags
// additional mapflag data
// nocommand mapflag level
// per map base exp multiplicator
// per map job exp multiplicator
// adjustments
// make all maps pvp for pk_mode [Valaris]
/* align with 'All' zone */
/*
//Look up for the rsw
// replace with real name
// read & convert fn
//Load water height from file
/*==================================
// Set cell properties
// read cell data
// Cell is 0 (walkable) but under water level, set to 3 (walkable water)
/*======================================
/*======================================
// show progress
// try to load the map
//Initialize moblist [Skotlex]
//Initialize timer [Skotlex]
// intialization and configuration-dependent adjustments of mapflags
// finished map loading
// Next Map Index will be instances
/**
// only bother if its actually enabled
/**
/**
// Login information
// Char and map-server information
/**
// Revert to default saving
// Pass from s to ms
/**
// Remove maps
// Map list is empty on the first run, only do this for imported files.
// Add maps to map->list
// TODO: VECTOR candidate
/**
// import should overwrite any previous configuration, so it should be called last
/**
// Remove NPCs
// import should overwrite any previous configuration, so it should be called last
/**
// Append extra scripts
/**
// import should overwrite any previous configuration, so it should be called last
/**
/**
/*=======================================
// main db connection
/**
/* this zone has already been merged */
/* we don't update it for merged zones! */
/* when changing from a mapflag to another during runtime */
/* removes previous mapflags from this map */
// this one removes every flag, even if they were previously turned on before
// the current zone was applied
/* TODO: introduce enumerations to each mapflag so instead of reading the string a number of times we read it only once and use its value wherever we need */
/* cache previous values to revert */
/* not yet supported to be reversed */
// 0
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* they are applied together, no need to check both */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* not yet fully supported */
//Disable
// 0
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* implementation may be incomplete */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* we don't mind it, the server will take care of it next. */
/* we don't mind it, the server will take care of it next. */
/* nothing to do */
/* nothing to do */
/* nothing to do */
/* used on npc load and reload to apply all "Normal" and "PK Mode" zones */
/* [Ind/Hercules] */
/* remove from the tree */
/* remove from the tree */
/* is this the global template? */
/* validate */
/* we don't remove it from the three due to inheritance */
/* all ok, process */
/* only add if enabled */
/* validate */
/* we don't remove it from the three due to inheritance */
/* all ok, process */
//Some are forcefully enabled
/* only add if enabled */
/** forcefully enabled **/
/* mapflags are not validated here, so we save all anyway */
/* validate */
/* we don't remove it from the three due to inheritance */
/* all ok, process */
/* only add if enabled */
/* validate */
/* we don't remove it from the three due to inheritance */
/* all ok, process */
/* only add if enabled */
/* global template doesn't go into db -- since it isn't a alloc'd piece of data */
/* process inheritance, aka loop through the whole thing again :P */
/* all zone doesn't inherit anything (if it did, everything would link to each other and boom endless loop) */
/* append global zone to this */
/* create inherit member and add global zone to it */
/* inherit zone */
/* disabled skill count from inherit zone */
/* disabled item count from inherit zone */
/* mapflag count from inherit zone */
/* commands count from inherit zone */
/* skill capped count from inherit zone */
/* will succeed for we validated it earlier */
/* will succeed for we just put it in here */
/* process everything to override, paying attention to config_setting_get_bool */
/* we didn't find it */
/* we didn't find it */
/* we didn't find it */
/* we didn't find it */
/* we didn't find it */
/* post-load processing */
/* not supposed to go in here but in skill_final whatever */
/**
/**
//There is no need for this, the pet is removed together with the player. [Skotlex]
/**
/*==========================================
//Ladies and babies first.
/* prepares npcs for a faster shutdown process */
// remove all objects on maps
/* before channel. */
//------------------------------
// Function called when the server
// has received a crash signal.
//------------------------------
//Save all characters and then flush the inter-connection.
/// Called when a terminate signal is received.
/* Hercules Console Parser */
/* default HCP data */
/* */
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/* temp (perhaps make minimal a mask with options of what to load? e.g. plugin 1 does minimal |= mob_db; */
// TODO: Remove this when no longer needed.
// loads npcs
//Added for reliable map->id2sd() use. [Skotlex]
//Added to lower the load of the lazy mob AI. [Skotlex]
// Used for Convex Mirror quick MVP search
// efficient status_natural_heal processing
// [Zephyrus] Invisible Walls
// Pretend all maps from the mapindex are on this mapserver
/* read after item and skill initialization */
// Init npcs (OnInit)
/* after OnInit */
/* after OnInit */
/*=====================================
/* */
// can be modified in char-server configuration file
// 0=day, 1=night [Yor]
//To enable/disable @spy commands, which consume too much cpu time when sending packets. [Skotlex]
//all in a big chunk, respects order
/* */
/* funcs */
// users
// blocklist lock
// blocklist manipulation
//blocklist nb in one cell
// search and creation
//
// npc
// map item
// player to map session
/* */
// reload config file looking only for npcs
// [Skotlex]
// [Wizputer]
// [Wizputer]
// [Wizputer]
/**
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\mapreg_sql.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// map-"mysql_handle
/**
/**
/**
// write new variable to database
// val == 0
// Remove from database because it is unused.
/**
//put returned null, so we must insert.
/**
/*
/**
/**
/**
// Sanity check
/**
/**
/**
/**
/**
/* */
/* */
/* */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\mercenary.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// Request Char Server to create this mercenary
// Mercenary soldier's duty hour is over.
// +1 Loyalty on Contract ends.
// -1 Loyalty on Mercenary killed
// Not created - loaded - DB info
// <merc id>,<skill id>,<skill level>
/*=====================================
/* vars */
/* funcs */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\mob.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// AUTOLOOT_DISTANCE, DBPATH, DEFTYPE_MAX, DEFTYPE_MIN, RENEWAL_DROP, RENEWAL_EXP
//Distance added on top of 'AREA_SIZE' at which mobs enter active AI mode.
//Active idle skills should be triggered every 1 second (1000/MIN_MOBTHINKTIME)
// Probability for mobs far from players from doing their IDLE skill. (rate of 1000 minute)
// in Aegis, this is 100% for mobs that have been activated by players and none otherwise.
// Move probability for mobs away from players (rate of 1000 minute)
// in Aegis, this is 100% for mobs that have been activated by players and none otherwise.
//Max minimum chase value to use for mobs.
//After how many rude-attacks should the skill be used?
//Dynamic item drop ratio database for per-item drop ratio modifiers overriding global drop ratios.
//For loot drops delay structures.
/*==========================================
//Skip dummy mobs.
// Monsters with no base/job exp and no spawn point are, by this criteria, considered "slave mobs" and excluded from search results
/*==========================================
/// Creates a timer to spawn a tomb
/// @param nd : The tomb
/// Spawns a tomb after the delay has ended
/// @param tid : Timer id
/// @param tick : current tick
/// @param id : NPC Id
/// @param data : 0
// Sets view data to make the tomb visible and notifies client
// "Tomb"
// Tomb npc is created but not yet visible, we set view data and spawn it after some time
/*==========================================
//keep clones out (or you leak player stats)
/*==========================================
//checkid is used mostly for random ID based code, therefore clone mobs are out of the question.
/*==========================================
/*==========================================
//Remove trailing quote.
//Strip leading quotes
/*==========================================
/*==========================================
//Dead branch
// no suitable monster found, use fallback for given list
/*==========================================
// Source
// Owner
// Mob Target
// KS Protection Disabled
// Target is not MOB
// Master is not PC
// Ignores GVG, PVP and AllowKS map flags
// MVP, Slaves mobs ignores KS
// No KS Protected
// Same Owner
// Party KS allowed
// Guild KS allowed
// No KS Protected, but normal players should be protected too
// Message to KS
// [KS Warning!! - Owner : %s]
// Message to Owner
// [Watch out! %s is trying to KS you!]
// Locate spot next to player.
// if none found, pick random position on map
/*==========================================
// invalid input
//Guild not yet available, retry in 5.
// end addition [Valaris]
//Behold Aegis's masterful decisions yet again...
//"I understand the "Aggressive" part, but the "Can Move" and "Can Attack" is just stupid" - Poki#3
// id of last spawned mob
/*==========================================
// invalid input
// normalize x/y coordinates
// choose a suitable max. number of attempts
// spawn mobs, one by one
// find a suitable map cell
// attempt to find an available cell failed
// total failure
// fallback to last good x/y pair
// record last successful coordinates
// id of last spawned mob
/**
//Needed because the guild data may not be available at guardian spawn time.
//It is possible mob was already removed from map when the castle has no owner. [Skotlex]
//Liberate castle, if the guild is not found this is an error! [Skotlex]
//Not sure this is the best way, but otherwise we'd be invoking this for ALL guardians spawned later on.
//Free castle up.
// Remove guardian.
// Give bonuses.
/*==========================================
//Check if guardian already exists, refuse to spawn if so.
// TODO: Why does this not use map->id2md?
// permanent guardian
// temporary guardian
/*==========================================
// BG Team ID
/*==========================================
//(battle_config.mob_ai&0x1?0:1);
/*==========================================
// Reachability judging
/*==========================================
// TODO: Why does this not use map->bl2md?
/*==========================================
//Doesn't has respawn data!
//Base respawn time
//random variance
//Apply the spawn delay fix [Skotlex]
//Bosses
// Divide by 100 first to prevent overflows
//(precision loss is minimal as duration is in ms already)
//Plants
//Normal mobs
//Monsters should never respawn faster than within 5 seconds
//fetch till 0
//if there one let's check it otherwise go backward
//backward compatibility
/*==========================================
//Respawn data
//Monster can be spawned on an area.
// retry again later
// retry again later (players on sight)
//md->master_id = 0;
// Added for carts, falcons and pecos for cloned monsters. [Valaris]
// MvP tomb [GreenBox]
/*==========================================
// if the monster was provoked ignore the above rule [celest]
/*==========================================
// Nothing will be carried out if there is no mind of changing TAGE by TAGE ending.
// Since there was no disturbance, it locks on to target.
/*==========================================
//If can't seek yet, not an enemy, or you can't attack it, skip.
//Gangster paradise protection.
//For some reason Homun targets are never overridden.
//Pick closest target?
// Count walk path cells
//Standing monsters use range2, walking monsters use range3
/*==========================================
//If can't seek yet, not an enemy, or you can't attack it, skip.
/*==========================================
/*==========================================
//New target closer than previous one.
//Not a warp
//Does not lead to the same map.
//Pick warp that leads closest to target.
/**
/*==========================================
//Master not on a map? Could be warping, do not process.
//If the mob can move, follow around. [Check by Skotlex]
// Distance with between slave and master is measured.
// Since the master was in near immediately before, teleport is carried out and it pursues.
//Slave is busy with a target.
// Approach master if within view range, chase back to Master's area also if standing on top of the master.
// Can be NULL due to master being BL_PC
// If master is BL_MOB and in battle, lock & chase to master's target instead, unless configured not to.
//Delete the summoned mob if it's in a gvg ground and the master is elsewhere. [Skotlex]
//Avoid attempting to lock the master's target too often to avoid unnecessary overload. [Skotlex]
// Can be NULL due to master being BL_PC
// possibly chasing something
//Required check as skilltarget is not always an enemy. [Skotlex]
/*==========================================
//Because it is not unset when the mob finishes walking.
// Idle skill.
//Random walk.
//Delay next random walk when this one failed.
//Stop chasing.
//Walk instantly after dropping target
/*==========================================
// Search of a movable place
// The next walk start time is calculated.
//Can't warp chase.
//No need to do a warp chase.
//Already walking to a warp.
//Search for warps within mob's viewing range.
/*==========================================
// Abnormalities
//Should reset targets.
//Check validity of current target. [Skotlex]
//No valid target
//Chasing this target.
//Walk at least "mob_chase_refresh" cells before dropping the target unless target is non-existent
//Unlock target
// Check for target change.
//Rude attacked check.
//Can't attack back and can't reach back.
// Not yet confirmed if boss will teleport once it can't reach target.
// If can't rude Attack
// Attempt escape
//Escaped
// Attacker longer than visual area
// Attacker is not enemy of mob
// Cannot normal attack back to Attacker
// Not on Melee Range and ...
// Reach check
// Not yet confirmed if boss will teleport once it can't reach target.
// Rude attacked
//Escaped.
//TODO: Maybe it shouldn't attempt to run if it has another, valid target?
//Can't attack back, but didn't invoke a rude attacked skill...
//Attackable
//Change if the new target is closer than the actual one
//or if the previous target is not attacking the mob. [Skotlex]
// set target
//Should we reset rude attack count?
//Set the new target
//Clear it since it's been checked for already.
// Processing of slave monster
// Scan area for targets
// Scan area for items to loot, avoid trying to loot if the mob is full and can't consume the items.
//No targets available.
//Restore angry state when no targets are available.
/* bg guardians follow allies when no targets nearby */
/* we are already moving */
/* we're moving or close enough don't unlock the target. */
//This handles triggering idle/walk skill.
//Target exists, attack or loot as applicable.
//Loot time.
//Already locked.
//Can't loot...
//Still not within loot range.
//A looter that can't move? Real smart.
//Stuck. Wait before walking.
//Can't loot...
//Within looting range.
//Busy attacking?
//Logs items, taken by (L)ooter Mobs [Lupus]
//Destroy first looted item...
//Give them walk act/delay to properly mimic players. [Skotlex]
//Clear item.
//Attempt to attack.
//At this point we know the target is attackable, we just gotta check if the range matches.
//Target within range and able to use normal attack, engage
//Only attack if no more attack delay left
//Log interaction (counts as 'attacker' for the exp bonus)
//Monsters in berserk state, unable to use normal attacks, will always attempt a skill
//Only use skill if able to walk on next tick and not used a skill the last second
//Target still in attack range, no need to chase the target
//Only update target cell / drop target after having moved at least "mob_chase_refresh" cells
//Out of range...
//Can't chase. Immobile and trapped mobs should unlock target and use an idle skill.
//Only unlock target if no more attack delay left
//This handles triggering idle/walk skill.
//Current target tile is still within attack range.
//Follow up if possible.
//Hint: Chase skills are handled in the walktobl routine
//Hard AI triggered.
/*==========================================
/*==========================================
//Because it is not unset when the mob finishes walking.
//Chance to do a mob's idle skill.
/*==========================================
/*==========================================
/**
// count avoids a too long loop that would cause lag.
// if after option_drop_max_loop full iterations (running through all possibilities)
// it still fails to pick one, it'll stop at one random index in the next iteration
/*==========================================
// Set item options [KirieZ]
/*==========================================
/*==========================================
/*==========================================
//Logs items, dropped by mobs [Lupus]
//Autoloot.
// TODO: Why does this not use map->id2md?
//for Alchemist CANNIBALIZE [Lupus]
/*==========================================
/*==========================================
// Mob respawning through KAIZEL or NPC_REBIRTH [Skotlex]
//Do nothing for absorbed damage.
//Do not log non-damaging effects from non-enemies.
//Do not log self-damage.
//Let mobs retaliate against the pet's master [Skotlex]
//Let players decide whether to retaliate versus the master or the mob. [Skotlex]
//For all unhandled types.
//Log damage...
//Store data in first empty slot.
//Never overwrite first hit slot (he gets double exp bonus)
// Show HP bar to all chars who hit the mob (fixes TF_STEAL not showing HP bar right away but only when target leaves/re-enters sight range)
// check if in range
//Call when a mob has received damage.
//Store total damage...
//Stop recording damage once the cap has been reached.
//Cap damage log...
//No longer aggressive, change to retaliate AI.
//Log damage
// Achievements [Smokexyz/Hercules]
// Resend ZC_NOTIFY_MOVEENTRY to Update the HP
// must show hp bar to all char who already hit the mob.
// check if in range
/*==========================================
// bitfield of all bl types, that caused damage to the mob and are eligible for exp distribution
// Use Dead skill only if not killed by Script or Command
// filter out entries not eligible for exp distribution
// skip empty entries
// skip players not on this map
//Only logged into same map chars are counted for the total.
// skip dead players
// skip homunc's share if inactive
// skip pet's share if inactive
// record as valid damage-log entry
// determines, if the monster was killed by homunculus' damage only
//Apply first-attacker 200% exp share bonus
//TODO: Determine if this should go before calculating the MVP player instead of after.
//No exp
//Pvp no exp rule [MouseJstr]
//Only player-summoned mobs do not give exp. [Skotlex]
//Gives Exp
//Experience calculation.
//Bonus on top of your share (common to all attackers).
//All mobs are Star Targets
// [Valaris]
//Your share of the mob's exp
//jAthena's exp formula based on total damage.
//eAthena's exp formula based on max hp.
// prevents unlimited exp gain
//Exp bonus per additional attacker.
// change experience for different sized monsters [Valaris]
// zeny calculation moblv + random moblv [Valaris]
//Homun earned job-exp is always lost.
//Locate party.
//Possibly add party.
// zeny share [Valaris]
//Add to total
// zeny share [Valaris]
//tmpsd[i] is null if it has no homunc.
// zeny from mobs [Valaris]
// Achievements [Smokexyz/Hercules]
//Party share.
//End EXP giving.
//Non special mob
//All summoned give drops
//Marine Sphere Drops items.
// Item Drop
/* no player was attached, we don't use any modifier (100 = rates are not touched) */
// change drops depending on monsters size [Valaris]
//Drops affected by luk as a fixed increase [Valaris]
//Drops affected by luk as a % increase [Skotlex]
// pk_mode increase drops if 20 level difference [Valaris]
// Increase drop rate if user has SC_CASH_RECEIVEITEM
// now rig the drop rate to never be over 90% unless it is originally >90%.
// attempt to drop the item
// Official Drop Announce [Jedzkie]
// Announce first, or else ditem will be freed. [Lance]
// By popular demand, use base drop rate for autoloot code. [Skotlex]
// Ore Discovery [Celest]
// process script-granted extra drop bonuses
//check if the bonus item drop rate should be multiplied with mob level/10 [Lupus]
//it's negative, then it should be multiplied. e.g. for Mimic,Myst Case Cards, etc
// rate = base_rate * (mob_level/10) + 1
//it's positive, then it goes as it is
// process script-granted zeny bonus (get_zeny_num) [Skotlex]
// process items looted by the mob
//There are drop items.
//No drops
//Loot MUST drop!
//mapflag: noexp check [Lorky]
//[Gengar]
/* pose them randomly in the list -- so on 100% drop servers it wont always drop the same item */
//Logs items, MVP prizes [Lupus]
//Emperium destroyed by script. Discard mvp character. [Skotlex]
// Only trigger event on final kill
//So that npc_event invoked functions KNOW that mob is dead
//TK_MISSION [Skotlex]
// PCKillNPC [Lance]
/**
// Player mobs are not removed automatically by the client.
/* first we set them dead, then we delay the out sight effect */
/**
//Tell status->damage to remove it from memory.
// Note: Actually, it's 4. Oh well...
// MvP tomb [GreenBox]
//Set respawning.
//Remove from map.
// Reset the damage done on the rebirthed monster, otherwise will grant full exp + damage done. [Valaris]
//Castle with no owner? Delete the guardians.
//But don't delete the emperium, just clear it's guild-data
//Remove guardian.
//Properly remove guardian info from Castle data.
/*==========================================
// no count specified, look into the array manually, but take only max 5 elements
// nothing found
// check if at least the first value is valid
//Pick a random value, hoping it exists. [Skotlex]
/*==========================================
// Disable class changing for some targets...
// Guardians/Emperium
// Treasure Boxes
// Marine Spheres and Floras.
// Clones
// Nothing to change.
//Speed change update.
//Targets should be cleared no morph
//Need to update name display.
/*==========================================
// Resend ZC_NOTIFY_MOVEENTRY to Update the HP
// must show hp bar to all char who already hit the mob.
// check if in range
/*==========================================
/*==========================================
//Min range needed to avoid crashes and stuff. [Skotlex]
/*==========================================
/*==========================================
/*==========================================
/**
//Do not start on 0, pick some random sub subset [Skotlex]
//Increase final value by same amount to preserve total number to summon.
//Summon slaves in round-robin fashion. [Skotlex]
//These two need to be loaded from the db for each slave.
//Scale HP
//Inherit the aggressive mode of the master.
//Always aggressive
//Always passive
//Copy master.
/*==========================================
/*==========================================
//A friend was already found.
//Summoned creatures. [Skotlex]
/*==========================================
/*==========================================
//Once an effect was found, break out. [Skotlex]
/*==========================================
//Friend bl, which can either be a BL_PC or BL_MOB depending on the situation. [Skotlex]
//Skill act delay only affects non-event skills.
//Pick a starting position and loop from that.
//ANYTARGET works with any state as long as there's a target. [Skotlex]
//Lupus (max value = 10000)
//Trigger skill.
//Avoid entering on defined events to avoid "hyper-active skill use" due to the overflow of calls to this function in battle.
// HP< maxhp%
// status[num] on
// status[num] off
// friend HP < maxhp%
// friend status[num] on
// friend status[num] off
// slave < num
// attack pc > num
// slave <= num
// attack pc >= num
//Rude attacked count should be reset after the skill condition is met. Thanks to Komurka [Skotlex]
//Skill requisite failed to be fulfilled.
//Execute skill
//Ground skill.
//Pick a random enemy within skill range.
//Otherwise, fall through.
// Look for an area to cast the spell around...
//Targeted skill
//Pick a random enemy within skill range.
//Otherwise, fall through.
// else fall through
//Skill used. Post-setups...
//Display color message [SnakeDrak]
// discard extra name identifier if present [Daegaladh]
//pass on delay to same skill.
//No skill was used.
/*==========================================
//LOne WOlf explained that ANYONE can trigger the marine countdown skill. [Skotlex]
//Long-attacked should not include magic.
//Restore previous target only if skill condition failed to trigger. [Skotlex]
//Otherwise check if the target is an enemy, and unlock if needed.
// Player cloned mobs. [Valaris]
//Flag values:
//&1: Set special AI (fight mobs, not players)
//If mode is not passed, a default aggressive mode is used.
//If master_id is passed, clone is attached to him.
//Returns: ID of newly crafted copy.
//Max ATK
//Min ATK
//Max ATK
//Min ATK
//User provided mode.
//Friendly Character, remove looting.
//Let them have the same view-range as players.
//Min chase of a screen.
//Skill copy [Skotlex]
/**
//Go Backwards to give better priority to advanced skills.
//Normal aggressive mob, disable skills that cannot help them fight
//against players (those with flags UF_NOMOB and UF_NOPC are specific
//to always aid players!) [Skotlex]
/**
//Default chance of all skills: 5%
//Traps!
//Target Enemy
//Target allies
//auto-select target skill.
//Self skill
//Delay: Remove the stock 5 secs and add half of the support time.
//With a minimum of 5 secs.
//Higher skill rate usage for heal.
//Delay: Remove the stock 5 secs and add half of the support time.
//With a minimum of 2 secs.
//duplicate this so it also triggers on self.
//Certain Special skills that are passive, and thus, never triggered.
//Remove the added delay as these could trigger on "all hits".
//Untreated Skill
/**
//Finally, spawn it.
//Failed?
//Further manipulate crafted char.
//Friendly Character
//Attach to Master
//Auto Delete after a while.
//Clear references to the db
//
// Initialization
//
/*==========================================
//Using the mob->dummy data already. [Skotlex]
//Remove the mob data so that it uses the dummy data instead.
//Initialize dummy data.
//Initializing the dummy mob.
//Adjusts the drop rate of item according to the criteria given. [Skotlex]
// Logarithmic drops equation by Ishizu-Chan
//Equation: Droprate(x,y) = x * (5 - log(x)) ^ (ln(y) / ln(5))
//x is the normal Droprate, y is the Modificator.
//Classical linear rate adjustment.
/**
// only for listed mobs
// found
// for all mobs
/* (mob_parse_dbrow)_cap_value */
/**
// OptionName: value
// OptionName: [min, max]
// OptionName: [min, max, rate]
// [min, max,...]
// [min, max, rate]
/**
// Structure:
//	{
//		Rate: chance of option 1 (int)
//		OptionName1: value
//		OptionName2: [min, max]
//		OptionName3: [min, max, rate]
//      ....
//	}
// The rate for this option to be dropped (Rate field)
// 1 = Rate
// If there're empty rates, calculate them
/**
/* Structure:
// Up to MAX_ITEM_OPTIONS
/**
// maximum size (used by assertions)
// number of entries used (should be the same amount)
/**
/**
/**
/**
// (Drop Rate, "Option Group")
/**
// Setting is a number, item doesn't contain options
// (Drop Rate, "Opt Drop Group")
//No item....
//calculate and store Max available drop chance of the MVP item
//item has bigger drop chance or sold in shops
//reduce MVP drop info to not spoil common drop rate
/**
// Setting is a number, item doesn't contain options
// (Drop Rate, "Opt Drop Group")
//No drop.
//Treasure box drop rates [Skotlex]
// Added support to restrict normal drops of MVP's [Reddozen]
//calculate and store Max available drop chance of the item
//Skip treasure chests.
//item has bigger drop chance or sold in shops
/**
//Since mobs always respawn with full life...
/*
//All status should be min 1 to prevent divisions by zero from some skills. [Skotlex]
// This code was (accidentally) never enabled. It'll stay commented out until it's proven to be needed.
//Tests showed that chase range is effectively 2 cells larger than expected [Playtester]
// 0
// If the attack animation is longer than the delay, the client crops the attack animation!
// On aegis there is no real visible effect of having a recharge-time less than amotion anyway.
// Fill in remaining status data by using a dummy monster.
// Finally insert monster's data into the database.
//Copy over spawn data
/**
/*
// Optional fields
// or
// Use old entry as default
// battle_config modifiers to max_hp are applied below
// battle_config modifiers to max_hp are applied below
// MVP EXP Bonus: MEXP
// Some new MVP's MEXP multiple by high exp-rate cause overflow. [LuzZza]
// Now that we know if it is an mvp or not, apply battle_config modifiers [Skotlex]
//Mvp
//Normal mob
/**
// do nothing. plugins can do own work
/*==========================================
/**
// ENABLE_CASE_CHECK
// ENABLE_CASE_CHECK
/*==========================================
// Default fallback value, in case the database does not provide one
//MvPs
//At least have the default here.
/*==========================================
//MSG ID
//Color
//Message
// find EOL to strip
// strip previously found EOL
/*==========================================
// empty line
/*==========================================
// If ClearSkills flag is enabled clear all the previous skills.
// Clearing skills globaly is not supported
// Prepare global skill. [Skotlex]
//we strip max skill level
//Apply battle_config modifiers to rate (permillage) and delay [Skotlex]
//time overflow?
//Check that the target condition is right for the skill type. [Skotlex]
//Ground skill.
//request to return mode to normal.
//Adds a mode to the mob.
//Remove aggressive mode when the new mob type is passive.
//Add the new mode.
//Do not "set" it.
// Set this skill to ALL mobs. [Skotlex]
//Skill not for bosses
//Skill not for normal enemies.
//Skill set on a single mob.
/*==========================================
/*==========================================
/**
/**
// Only read the mob db and option drops in minimal mode
// must be read before mobdb
/**
// If the view data was not overwritten manually
// Get the new view data from the mob database
// If they are spawned right now
// Respawn all mobs on client side so that they are displayed correctly(if their view id changed)
//Mob skills need to be cleared before re-reading them. [Skotlex]
// Clear item_drop_ratio_db
/**
/*==========================================
// Initialize the mob database
//Clear the array
//This mob is used for random spawns
//The first time this is invoked, it creates the dummy mob
/**
/*==========================================
// Defines the Manuk/Splendide/Mora mob groups for the status reductions [Epoque & Frost]
/* */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\npc.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// NPC_SECURE_TIMEOUT_INPUT, NPC_SECURE_TIMEOUT_MENU, NPC_SECURE_TIMEOUT_NEXT, SECURE_NPCTIMEOUT, SECURE_NPCTIMEOUT_INTERVAL
//For holding the view data of npc classes. [Skotlex]
/* for speedup */
//Holds pointers to the commonly executed scripts for speedup. [Skotlex]
/**
/**
// First subrange
// Special IDs not included in the valid ranges
// Second subrange
// Second range
// Anything else is invalid
/// Returns a new npc id that isn't being used in id_db.
/// Fatal error if nothing is available.
// available
// find next id
// available
// full loop, nothing available
// Attached a player already. Can't trigger on anyone else.
// Can't trigger 'OnTouch_'. try 'OnTouch' later.
/*==========================================
// failed to run OnTouch event, so just click the npc
/*==========================================
//Can't change the view_data to invisible class because the view_data for all npcs is shared! [Skotlex]
// Hack to trick maya purple card [Xazax]
//Client won't display option changes for these classes [Toms]
//check if player standing on a OnTouchArea
/*==========================================
/**
/**
//Not logged in anymore OR no longer attached to a npc
//case NPCT_WAIT: var starts with this value
/**
/**
/**
//Create a new instance of ourselves to continue
/*==========================================
//Current script is aborted.
//Nothing to dequeue
//Failed to dequeue, couldn't set a timer.
//Event dequeued successfully, shift other elements.
/**
/*==========================================
// There was already another event of the same name?
// generate the data and insert it
//[Lance]
/**
// Do not run on duplicates. [Paradox924X]
/* && !ev->nd->src_id */) // Do not run on duplicates. [Paradox924X]
// a player may only have 1 script running at the same time
// runs the specified event (supports both single-npc and global events)
// skip leading "::"
// runs the specified event, with a RID attached (global only)
// runs the specified event (global only)
/*==========================================
// tracks previous execution time
/**
// This interval has already been added on startup
/*==========================================
// Timer event
//Attached player for this timer.
//timer index (starts with 0, then goes up to nd->u.scr.timeramount)
//holds total time elapsed for the script from when timer was started to when last time the event triggered.
/*==========================================
// These stuffs might need to be restored.
// Set the values of the timer
//attached rid
//current time tick
//total time from beginning to now
// Locate the event
// Arrange for the next event
// Run the script
// Attached-rid should be restored anyway.
// Restore previous data, only if this timer is a player-attached one.
/*==========================================
//Player to whom script is attached.
// Check if there is an OnTimer Event
// Failed to attach timer to this player.
// Check if timer is already started.
// Arrange for the next event
// Set event index
// Attach only the player if attachplayerrid was used.
// Set when timer is started
/*==========================================
// Nothing to stop
// Delete timer
// Set 'timer' to the time that has passed since the beginning of the timers
// Set 'tick' to zero so that we know it's off.
/*==========================================
// Check timer existence
// Delete timer
// Execute OnTimerQuit
//Set timer related info.
// Detach rid if the last attached player logged off.
//Execute label
//Restore previous data.
/*==========================================
// TODO: Get player attached timer's tick. Now we can just get it by using 'getnpctimer' inside OnTimer event.
// The last time it's active(start, stop or event trigger)
// It's a running timer
/*==========================================
//struct map_session_data *sd = NULL;
// TODO: Set player attached timer's tick.
// Check if timer is started
//Enqueue the event trigger.
//Event enqueued.
//Disabled npc, shouldn't trigger event.
/*==========================================
/*==========================================
/*==========================================
/*==========================================
// Why not enqueue it? [Inkfish]
// 0
// a npc was found, but it is disabled; don't print warning
// no npc found
// hidden chars cannot use warps
// hidden chars cannot use warps
// failed to run OnTouch event, so just click the npc
// Since walktimer always == INVALID_TIMER at this time, we stop walking manually. [Inkfish]
/*==========================================
// OnTouch NPC or Warp for Mobs
// Return 1 if Warped
// Keep Searching
// In the npc touch area
// Cannot Warp between map servers
// Warped
// Already touch this NPC
// No OnTouchNPC Event
// Stores Unique ID
// Not Warped, but killed
//Checks if there are any NPC on-touch objects on the given range.
//Flag determines the type of object to check for:
//&1: NPC Warps
//&2: NPCs with on-touch events.
//First check for npc_cells on the range given
//No NPC_CELLs.
//Now check for the actual NPC on said range.
// found a npc
/*==========================================
//Class-less npc, enable click from anywhere.
/*==========================================
// MvP tomb [GreenBox]
// TODO: Find exact color?
// "[ ^EE0000%s^000000 ]"
// "Has met its demise"
// "Time of death : ^EE0000%s^000000"
// "Defeated by"
// "[^EE0000%s^000000]" / "Unknown"
/*==========================================
// This usually happens when the player clicked on a NPC that has the view id
// of a mob, to activate this kind of npc it's needed to be in a 2,2 range
// from it. If the OnTouch area of a npc, coincides with the 2,2 range of
// another it's expected that the OnTouch event be put first in stack, because
// unit_walktoxy_timer is executed before any other function in this case.
// So it's best practice to put an 'end;' before OnTouch events in npcs that
// have view ids of mobs to avoid this "issue" [Panikon]
// The player clicked a npc after entering an OnTouch area
//Hidden/Disabled npc.
/*==========================================
// Not item script
/**
/**
/**
/*==========================================
// can't buy if npc is not visible (hack?)
// not called through a script and is not a visible NPC so an invalid call
// reset the callshop state for future calls
/*==========================================
// Global Value
// Validating Process ----------------------------------------------------
// Payment Process ----------------------------------------------------
// Delivery Process ----------------------------------------------------
//npc_buylist for script-controlled shops.
// discard old contents
// save list of bought items
// invoke event
/**
/**
/**
/**
/**
/**
/**
/**
/**
/* we skip sd->npc_shopid, npc->buysell will set it then when the player selects */
/* nothing to display, no items available */
/**
/**
/* clear */
/* the callee will rely on npc->trader_funds, upon success script->run updates them */
/**
/* clear */
/* run script will deal with it */
/*==========================================
// Invalid Item
/**
// process entries in buy list, one by one
// find this entry in the shop's sell list
//Normal items
//item_avail replacement
// no such item in shop
//item_avail replacement
// item no longer in itemdb
//Exploit? You can't buy more than 1 of equipment types o.O
// Script-controlled shops decide by themselves, what can be bought and for what price.
//Script-based shops.
// Not enough Zeny
// Too heavy
// Not enough space to store items
// custom merchant shop exp bonus
/**
// process entries in buy list, one by one
// find this entry in the shop's sell list
//Normal items
//item_avail replacement
/* TODO find official response for this */
// no such item in shop
//item_avail replacement
/* TODO find official response for this */
// item no longer in itemdb
//Exploit? You can't buy more than 1 of equipment types o.O
/* TODO find official response for this */
/* TODO find official response for this */
// Not enough Zeny
/* TODO find official response for this */
// Too heavy
/* TODO find official response for this */
// Not enough space to store items
/* wohoo someone tampered with the packet. */
/**
// process entries in buy list, one by one
// wrong inventory index
// no such item in shop
// no such item in shop
// no such item in shop
// item_avail replacement
// item_avail replacement
// item no longer in itemdb
// not enough item amount in shop
// not enough item amount in inventory
// not enough item amount in inventory
//item_avail replacement
//Exploit? You can't buy more than 1 of equipment types o.O
/* TODO find official response for this */
// Too heavy
// Not enough space to store items
// unknown exploit
/* wohoo someone tampered with the packet. */
/// npc_selllist for script-controlled shops
// discard old contents
// clear each of the card slot entries
// Clear Each item option entry
// save list of to be sold items
// process item based information into the arrays
// store each of the cards/special info from the item in the array
// invoke event
/// Player item selling to npc shop.
///
/// @param item_list 'n' pairs <index,amount>
/// @return result code for clif->parse_NpcSellListSend
// verify the sell list
// Sanity check. The client sends each inventory index at most once [Haru]
// Script-controlled shops decide by themselves, what can be sold and at what price.
// Script-controlled shops
// delete items
// Achievements [Smokexyz/Hercules]
// custom merchant shop exp bonus
//Atempt to remove an npc from a map
//This doesn't remove it from map_db
//Not assigned to a map.
//Remove npc from map->list[].npc list. [Skotlex]
//failed to find it?
/**
/**
//Chk if npc matches src_id, then unload.
//Sub-function used to find duplicates.
//Removes all npcs that are duplicates of the passed one. [Skotlex]
//Removes an npc from map and db.
//Single is to free name (for duplicates).
// remove npc chatroom object and kick users
// deallocate npc PCRE data structures
//src check for duplicate shops [Orcao]
//Clean up all events related
//
// NPC Source Files
//
/// Clears the npc source file list
/**
// prevent multiple insert of source files
// found the file, no need to insert it again
/**
/**
/**
/* remove from db */
/// Parses and sets the name and exname of a npc.
/// Assumes that m, x and y are already set in nd.
// duplicate npc
// parse name
// <Display name>::<Unique name>
// <Display name>
// invalid
// duplicate unique name, generate new one
// Parse View
// Support for using Constants in place of NPC View IDs.
// Max size of name from constants.conf, see script->read_constdb.
// Extract view ID / constant
// Check if view id is not an ID (only numbers).
// Check if constant exists and get its value.
// NPC has an ID specified for view id.
// View is ID
// Checks if given view is an ID or constant.
// Loop through view, looking for non-numeric character.
/**
// Copy INVISIBLE_CLASS view data. Actual view data is set by npc->add_to_location() later.
//Add then display an npc warp on map
/**
// w1=<from map name>,<fromX>,<fromY>,<facing>
// w4=<spanx>,<spany>,<to map name>,<toX>,<toY>
// skip and continue
// skip and continue
//try next
// continue
/**
//TODO: could be rewritten to NOT need this temp array [ultramage]
// We could use nd->u.shop.shop_item to store directly the items, but this could lead
// to unecessary memory usage by the server, using a temp dynamic array is the
// best way to do this without having to do multiple reallocs [Panikon]
// Starting items size
// 'floating' shop
// w1=<map name>,<x>,<y>,<facing>
// skip and continue
//continue
//try next
// Grow array
// Cashshop doesn't have a "buy price" in the item_db
// NPC selling items for free!
// Exploit possible: you can buy and sell back with profit
//for logs filters, atcommands and iteminfo script command
// -1 would show that the item's sold in NPC Shop
// continue
// continue
// In case of labels not terminated with ':', for user defined function support
// here we check if the label fit into the buffer
// Skip the contents of a script.
// nothing to skip
// initial bracket (assumes the previous part is ok)
// can't continue
// skip everything
// right curly
// left curly
// string
// escape sequence (not part of a multibyte character)
// can't continue
// can't continue
// end of buffer
// can't continue
// return after the last '}'
/**
// [Valaris] thanks to fov
// floating npc
// npc in a map
// unknown format, don't continue
// continue
// can't continue
// (simple) parse error, don't continue
// OnTouch area defined
// no OnTouch area
//-----------------------------------------
// Loop through labels to export them as necessary
//Execute OnInit
/**
// we skip map->addnpc, but still add it to the list of ID's
/**
//add the npc to its location
// Loop through labels to export them as necessary
// From npc_parse_script
//Execute OnInit
/**
//add the npc to its location
/**
//Add the npc to its location
/**
/**
// get the npc being duplicated
// does not match 'duplicate(%127s)', name is empty or too long
// next line, try to continue
// next line, try to continue
// get placement
// floating shop/chashshop/script
// <map name>,<x>,<y>
// <map name>,<x>,<y>,<facing>
// next line, try to continue
// try next
//try next
// <spanx>,<spany>
// <sprite id>,<triggerX>,<triggerY>
// next line, try to continue
/**
// Name already in use
// Adjust destination, if instanced
// Other types have no xs/ys
// Adjust destination, if instanced
//Set mapcell CELL_NPC to trigger event later
// Other types doesn't have touch area
//invalid range or map
// Other types doesn't have touch area
//Locate max range on which we can locate npc cells
//FIXME: does this really do what it's supposed to do? [ultramage]
//Erase this npc's cells
//Re-deploy NPC cells for other nearby npcs.
//Not on a map.
/// Changes the display name of the npc.
///
/// @param nd Target npc
/// @param newname New display name
/// Changes the display class of the npc.
///
/// @param nd Target npc
/// @param class_ New display class
// fade out
// fade in
// using here CLR_TRICKDEAD because other flags show effects.
// probably need use other flag or other way to refresh npc.
// fade out
// fade in
// @commands (script based)
// Enqueue the event trigger.
//Event enqueued.
// Disabled npc, shouldn't trigger event.
// Sanity check - Skip leading spaces (shouldn't happen)
// split atcmd parameters based on spaces
/**
// can't continue
// (simple) parse error, don't continue
// parse error, continue
/*==========================================
/**
// w1=<map name>,<x>,<y>,<xs>,<ys>
// w3=<mob name>{,<mob level>}
// w4=<mob id>,<amount>,<delay1>,<delay2>{,<event>,<mob size>,<mob ai>}
// skip and continue
// skip and continue
//Not loaded on this map-server instance.
// skip and continue
// skip and continue
// check monster ID if exists!
// skip and continue
// skip and continue
//Force a random spawn anywhere on the map.
// skip and continue
//Use db names instead of the spawn file ones.
//Verify dataset.
// skip and continue
//Update mob spawn lookup database
//Update total
//Re-sort list
//Insert into list
//Now that all has been validated. We allocate the actual memory that the re-spawn data will use.
// spawn / cache the new mobs
// check if target map has players
// (usually shouldn't occur when map server is just starting,
// but not the case when we do @reloadscript
// continue
/**
/**
// w1=<mapname>
// skip and continue
// skip and continue
//Disable mapflag rather than enable it. [Skotlex]
//Map flag disabled.
// [Kill Steal Protection]
//Disable
// Default value
//No level specified, block everyone.
//Map flag disabled.
/* remove */
//Map flag disabled.
/* remove */
// continue
/**
// skip and continue
/**
// read whole file to buffer
// UTF-8 BOM. This is most likely an error on the user's part, because:
// - BOM is discouraged in UTF-8, and the only place where you see it is Notepad and such.
// - It's unlikely that the user wants to use UTF-8 data here, since we don't really support it, nor does the client by default.
// - If the user really wants to use UTF-8 (instead of latin1, EUC-KR, SJIS, etc), then they can still do it <without BOM>.
// More info at http://unicode.org/faq/utf_bom.html#bom5 and http://en.wikipedia.org/wiki/Byte_order_mark#UTF-8
// parse buffer
// w1<TAB>w2<TAB>w3<TAB>w4
// fill w1
// fill w2
// fill w3
// fill w4 (to end of line)
// Unknown syntax
// w1 = <map name>,<x>,<y>,<facing>
// Incorrect map, we must skip the script info...
// next line
// "mapname" is not assigned to this server, we must skip the script info...
// next line
// next line
// skip and continue
// TODO
// ENABLE_CASE_CHECK
//Print summary.
/**
/**
// linked data (struct event_data*) is freed when clearing ev_db
/**
// Current file
//Clear then reload npcs files
// Clear return status in case something failed before.
/* clear guild flag cache */
//Remove all npcs/mobs. [Skotlex]
// don't remove fake_nd
// dynamic check by [random]
// Mobs were removed anyway,so delete the timer [Inkfish]
// clear mob spawn lookup index
// reset mapflags
// Reprocess npc files and reload constants
/* [Ind/Hercules] */
//Re-read the NPC Script Events cache.
// Execute main initialisation events
// The correct initialisation order is:
// OnInit -> OnInterIfInit -> OnInterIfInitOnce -> OnAgitInit -> OnAgitInit2
// Execute rest of the startup events if connected to char-server. [Lance]
// Executed when connection is established with char-server in chrif_connectack
// Refresh guild castle flags on both woe setups
// These events are only executed after receiving castle information from char-server
//Unload all npc in the given file
// FIXME: This can break in case-sensitive file systems
/* unload any npcs which could duplicate this but be in a different file */
/* refresh event cache */
/*==========================================
//Warps to another map, nothing to do about it.
// random warp
/*==========================================
//Stock view data for normal npcs.
//Invisible class is stored here.
// Should be loaded before npc processing, otherwise labels could overwrite constant values
// and lead to undefined behavior [Panikon]
/* [Ind/Hercules] */
// set up the events cache
//Debug function to locate all endless loop warps.
// Init dummy NPC
// End of initialization
/* */
/* */
/* */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\npc_chat.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// struct npc_data
// struct mob_data
// struct map_session_data
// set_var()
/**
/**
//www.troubleshooters.com/codecorn/littperl/perlreg.htm)
/**
/**
/**
// Nothing to activate...
// not in inactive list
/**
// Nothing to deactivate...
// not in active list
/**
// Nothing to deactivate...
// Cleaning the last ones.. [Lance]
/**
// Normally we would have just stuck it at the end of the list but
// this doesn't sink up with peoples usage pattern.  They wanted
// the items defined first to have a higher priority then the
// items defined later. as a result, we have to do some work up front.
/*  if we are the first pattern, stick us at the end */
/* Look for the last entry */
/**
/**
// Additional cleaning up [Lance]
/**
// Not interested in anything you might have to say...
// iterate across all active sets
// n across all patterns in that set
// 1/3 reserved for temp space required by pcre_exec
// perform pattern match
// save out the matched strings
// find the target label.. this sucks..
// run the npc script
// Various script built-ins used to support these functions
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\party.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// GP_BOUND_ITEMS, RENEWAL_EXP
//msg_txt()
// struct mob_data
// last_tick
/*==========================================
/**
// no player
// not found
/*==========================================
/*==========================================
// auto-join if not in a party
//If player belongs to a different party, kick him out.
/// Party data lookup using party id.
/// Party data lookup using party name.
// empty name
// already associated with a party
//Achievements (Smokexyz)
//Character logged off before creation ack?
//break up party since player could not be added to it.
//Success message
//We don't do any further work here because the char-server sends a party info packet right after creating the party.
// "party name already exists"
/// Invoked (from char-server) when the party info is not found.
// requester
//Those not online shouldn't apart to skill usage and all that.
// member_id in old data
// member_id in new data
// diff members
// empty
// empty
// no longer in party
// not online
// empty
// new in party
// not online
//Update other people's display. [Skotlex]
// requester
// was not in the party
// confirm if this player is a party leader
// You need to be a party leader to use this command.
// confirm if there is an open slot in the party
// confirm whether the account has the ability to invite before checking the player
// "Your GM level doesn't authorize you to preform this action on the specified player."
//You can't invite someone who has already disconnected.
// already associated with a party
// party invite blocked by player
// forged
// accepted and allowed
// rejected or failure
//Invoked when a player joins:
//- Loads up party data if not in server
//- Sets up the pointer to him
//- Player must be authed/active and belong to a party before calling this method
//He does not belongs to the party really?
/// Invoked (from char-server) when a new member is added to the party.
/// flag: 0-success, 1-failure
//Char logged off before being accepted into party.
// failed
// hp of the other party members
//Update char name's display [Skotlex]
/// Party member 'sd' requesting kick of member with <account_id, name>.
// check the requesting char's party membership
// request from someone not in party? o.O
// only party leader may remove members
// no such char in party
/// Party member 'sd' requesting exit from party.
/// Invoked (from char-server) when a party member leaves the party.
// Member was party leader, try to pick a new leader from online members
// No online members, get an offline one
// Update party's leader
/** update members **/
//Update info.
//Update name display [Skotlex]
//TODO: hp bars should be cleared too
/// Invoked (from char-server) when a party is disbanded.
//Flag&0x1: Exp change denied. Flag&0x10: Item change denied.
// Target character must be online and in your current party.
// It is only possible to change the party leader while on the same map.
// You cannot change party leaders in this map.
//Shouldn't happen
// You need to be a party leader to use this command.
//Shouldn't happen
//Change leadership.
/** update members **/
//Update info.
/// Invoked (from char-server) when a party member
/// - changes maps
/// - logs in or out
/// - gains a level (disabled)
//Check if they still exist on this map server
//Note that this works because this function is invoked before connect_new is cleared.
// synchronize minimap positions with the rest of the party
// Chat logging type 'P' / Party Chat
//Increase Triple Attack rate of Monks.
//Increase Counter rate of Star Gladiators
//Twilight Pharmacy, requires Super Novice
//Twilight Pharmacy, Requires Taekwon
//Unknown case?
//Increase Triple Attack rate of Monks.
//+100/150/200% rate
//Increase Counter rate of Star Gladiators
//+100/150/200% rate
// for each existing party,
// no online party members so do not iterate
// for each member of this party,
// perform position update
// perform hp update
// exp share and added zeny share [Valaris]
// count the number of players eligible for exp sharing
// zeny from mobs [Valaris]
//Does party loot. first_charid holds the charid of the player who has time priority to take the item.
//item distribution to party members.
//Round Robin
// reset counter to 1st person in party so it'll stop when it reaches "itemc"
//Chosen char can't pick up loot.
//Successful pick.
//Random pick
//Collect pick candidates
//Pick a random member.
//Discard this receiver.
//Successful pick.
//Give it to the char that picked it up
// To use for Taekwon's "Fighting Chant"
// int c = 0;
// party_foreachsamemap(party->sub_count, sd, 0, &c);
/**
//Return value.
// Special check for Minstrel's and Wanderer's chorus skills.
/**
/*==========================================
// already registered
// Notice
// already registered
// Notice
// Update time.
// Update time.
// Party Booking [Spiria]
// Constructor, init vars
// Party Booking [Spiria]
/*=====================================
/* */
/* funcs */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\path.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// CELL_NOSTACK, CIRCULAR_AREA
/// @name Structures and defines for A* pathfinding
/// @{
/// Path node
///< pointer to parent (for path reconstruction)
///< X-coordinate
///< Y-coordinate
///< Actual cost from start to this node
///< g_cost + heuristic(this, goal)
///< SET_OPEN / SET_CLOSED
/// Binary heap of path nodes
/// Comparator for binary heap of path nodes (minimum cost at top)
/// Estimates the cost from (x0,y0) to (x1,y1).
/// This is inadmissible (overestimating) heuristic used by game client.
// Manhattan distance
/// @}
// Translates dx,dy into walking direction
/*==========================================
//Cap to prevent too much processing...?
//TODO: use 'struct point' here instead?
/*==========================================
// use dummy output variable
/// @name A* pathfinding related functions
/// @{
/// Pushes path_node to the binary node_heap.
/// Ensures there is enough space in array to store new element.
/// Updates path_node in the binary node_heap.
/// Path_node processing in A* pathfinding.
/// Adds new node to heap and updates/re-adds old ones if necessary.
// We processed this node before
// New path to this node is better than old one
// Update costs and parent
// Put it in open set again
// Index is already taken; see `tp` array FIXME for details
// New node
///@}
/*==========================================
// use dummy output variable
//Do not check starting cell as that would get you stuck.
/*|| md->getcellp(md, bl, x0, y0, cell)*/)
// Check destination cell
// Try finding direct path to target
// Direct path goes diagonally first, then in straight line.
// calculate (sgn(x1-x0), sgn(y1-y0))
// Current position = starting cell
// Advance current position
// destination x reached, no longer move along x-axis
// destination y reached, no longer move along y-axis
// success
// obstacle = failure
// easy path successful.
// easy path unsuccessful
// !(flag&1)
// A* (A-star) pathfinding
// We always use A* for finding walkpaths because it is what game client uses.
// Easy pathfinding cuts corners of non-walkable cells, but client always walks around it.
// 'Open' set
// FIXME: This array is too small to ensure all paths shorter than MAX_WALKPATH
// can be found without node collision: calc_index(node1) = calc_index(node2).
// Figure out more proper size or another way to keep track of known nodes.
// Start node
// Put start node to 'open' set
// error flag
// Saves allowed directions for the current cell. Diagonal directions
// are only allowed if both directions around it are allowed. This is
// to prevent cutting corner of nearby wall.
// For example, you can only go NW from the current cell, if you can
// go N *and* you can go W. Otherwise you need to walk around the
// (corner of the) non-walkable cell.
// Look for the lowest f_cost node in the 'open' set
// Remove it from 'open' set
// Add current node to 'closed' set
// Process neighbors of current node
// (x+1, y-1) 5
// (x+1, y) 6
// (x+1, y+1) 7
// (x, y+1) 0
// (x-1, y+1) 1
// (x-1, y) 2
// (x-1, y-1) 3
// (x, y-1) 4
// Recreate path
// A* end
//Distance functions, taken from http://www.flipcode.com/articles/article_fastdistance.shtml
//In this case, we just do a square comparison. Add 1 tile grace for diagonal range checks.
//There appears to be something wrong with the approximation below when either dx/dy is 0! [Skotlex]
// coefficients equivalent to ( 123/128 * max ) and ( 51/128 * min )
/**
/**
//Bonus factor used by client
//This affects even horizontal/vertical lines so they are one cell longer than expected
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\pc.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// DBPATH, GP_BOUND_ITEMS, MAX_SPIRITBALL, RENEWAL, RENEWAL_ASPD, RENEWAL_CAST, RENEWAL_DROP, RENEWAL_EXP, SECURE_NPCTIMEOUT
// get_atcommand_level()
// battle_config
// is_day_of_*()
// guild-"search(), guild_request_info()
// struct mob_data
// fake_nd
// party-"search()
// pet_unlocktarget()
// script_config
// struct status_data
// get_svn_revision()
// NAME_LENGTH, MAX_CARTS, NEW_CARTS
// safestrncpy()
//Converts a class to its array index for CLASS_COUNT defined arrays.
//Note that it does not do a validity check for speed purposes, where parsing
//player input make sure to use a pc->db_checkid first!
/**
// map_session_data.group is expected to be non-NULL at all times
/**
/**
/**
// In case of a full Royal Guard party.
//just recalc status no need to recalc hp
// No more Royal Guards in Banding found.
// Reset the counter
//Add yourself
// Get total HP of all Royal Guards in party.
// Set average HP.
// If a Royal Guard have full HP, give more HP to others that haven't full HP.
// Set hp
// Set the counter. It doesn't count your self.
// Set atk and def.
/**
// Not supported
/**
// Not implemented
/**
//Normal resurrection
//Just for saving on the char-server (with values as if respawned)
/*==========================================
/* assumes i is valid (from default areas where it is called, it is) */
// Check for Rentals on Inventory
// Nothing here
// min(next_tick,3600000) 1 hour each timer to keep announcing to the owner, and to avoid a but with rental time > 15 days
// Update Timer as this one ends first than the current one
/*==========================================
//Only copy the Cart/Peco/Falcon options, the rest are handled via
//status change load/saving. [Skotlex]
//When Jailed, do not move last point.
/*==========================================
// at this point, we can not know the value :(
//to be set to 1 after player is fully authed and loaded.
//Required to prevent homunculus copuing a base speed of 0.
// [4144] probably pc_equippoint should be replaced to pc_item_equippoint
//Not equippable by players.
//Kagerou and Oboro can dual wield daggers. [Rytech]
//Not equippable by players.
// Kagerou and Oboro can dual wield daggers. [Rytech]
// single-hand
// dual-wield
// unknown, default to right hand type
// already adopted baby / in adopt request
// You need to be married and in party with baby to adopt
// Not married, wrong married
// Both parents need to be in the same party
// Parents need to have their ring equipped
// Already adopted a baby
// Parents need at least lvl 70 to adopt
/*==========================================
// Preserve current job levels and progress
// Success, proceed to configure parents and baby skills
// Restore progress
// Baby Skills
// Parents Skills
// Achievements [Smokexyz/Hercules]
// Parent 1
// Parent 2
// Baby
// Job Change Fail
/*=================================================
// check if sc data is already loaded.
// Also works with left-hand weapons [DracoRPG]
//Spirit of Super Novice equip bonuses. [Skotlex]
//Can equip all helms
//In weapons, the look determines type of weapon.
//Level 4 Knives are equippable.. this means all knives, I'd guess?
//All 1H swords
//All 1H Axes
//All 1H Maces
//All 1H Staves
//Not equipable by class. [Skotlex]
//Not usable by upper class. [Inkfish]
/*==========================================
//Set the map-server used job id. [Skotlex]
// Checks and fixes to character status data, that are required
// in case of configuration change or stuff, which cannot be
// checked on char-server.
//Initializations to null/0 unneeded since map_session_data was filled with 0 upon allocation.
// [MouseJstr]
/**
/**
//This is the actual option used in battle.
//Set here because we need the inventory data for weapon sprite parsing.
// Achievements [Smokexyz/Hercules]
// initialize storage item vector.
// Check and flag items for inspection.
// Event Timers
// Rental Timer
//warp player
// try warping to a default map instead (church graveyard)
// if we fail again
//warp player stuck in invaild cell
//Prevent S. Novices from getting the no-death bonus just yet. [Skotlex]
//display login notice
// Send friends list
// %s revision '%s' (src) / '%s' (scripts)
/**
/* [Ind/Hercules] */
// Request all registries (auth is considered completed whence they arrive)
/*==========================================
//Attempts to set a mob.
//Can't change hate targets.
//Display current
//Wrong size
/*==========================================
// Cash shop
// Cooking Exp
// Better check for class rather than skill to prevent "skill resets" from unsetting this
//SG map and mob read [Komurka]
//for now - someone need to make reading from txt/sql
//Weird... maybe registries were reloaded?
// prevents loading pets, homunculi, mercenaries or elementals if the character doesn't have a client attached
// Restore any cooldowns
//Auth is fully okay, update last_login
// Storage Request
// MAIL SYSTEM - Request Mail Inbox
//Character already loaded map! Gotta trigger LoadEndAck manually.
// Invisible: On
// decrement the number of pvp players on the map
// unregister the player for ranking
/* [Ind/Hercules] */
// Achievements [Smokexyz/Hercules]
//Do not count wedding/link skills. [Skotlex]
//Don't touch these
//First clear skills.
/* permanent skills that must be re-checked */
/*==========================================
//Unable to normalize job??
// Restore original level of skills after deleting earned skills.
//Enable Bard/Dancer spirit linked skills.
// Link dancer skills to bard.
// Set the level to the same as the linking skill
// Tag it as a non-savable, non-uppable, bonus skill
// Link bard skills to dancer.
// Set the level to the same as the linking skill
// Tag it as a non-savable, non-uppable, bonus skill
/**
//Only skills you can't have are npc/guild ones
//Skill already known.
//Not learned.
//Real learned level
// need to get its own skilltree
// job level requirement wasn't satisfied
//Cannot be learned via normal means. Note this check DOES allows raising already known skills.
//Spirit skills cannot be learned, they will only show up on your tree when you get buffed.
// need to manually specify a skill level
//So it is not saved, and tagged as a "bonus" skill.
// skill list has changed, perform another pass
//
/* Taekwon Ranker Bonus Skill Tree
//Do not include Quest/Wedding skills.
// So it is not saved, and tagged as a "bonus" skill.
// Remember original level
//Checks if you can learn a new skill after having leveled up a skill.
//Function serves no purpose if this is set
//Unable to normalize job??
//Already learned
//Not learned.
//Real lerned level
// need to get its own skilltree
//Cannot be learned via normal means.
// Make sure all the skills are in the correct condition
// before persisting to the backend.. [MouseJstr]
// limit 1st class and above to novice job levels
// limit 2nd class and above to first class job levels (super novices are exempt)
// regenerate change_level_2nd
// if neither 2nd nor 3rd jobchange levels are known, we have to assume a default for 2nd
// limit 3rd class to 2nd class/trans job levels
// regenerate change_level_3rd
// restore non-limiting flags
/*==========================================
// no change
// stop old status change
// start new status change
// update overweight status
//Character is invisible. Stealth class-change. [Skotlex]
//viewdata is set on uncloaking.
// We need to update the client so it knows that a costume is being used
//It seems the cart info is lost on undisguise.
// autospell array size
//Auto-update flag value.
//No range defined? Use both.
//No attack type defined? Use weapon.
//These two would never trigger without BF_SKILL
//By default autospells should only trigger on normal weapon attacks.
// autospell array size
// each autospell works independently
/**
//Default range: both
//Default target: enemy.
//Default type: weapon.
// Update existing effect if any.
//Apply config rate adjustment settings.
//Absolute drop.
//Relative drop, max/min limits are applied at drop time.
//Both are absolute rates.
//Both are relative rates.
//Give preference to relative rate.
//No range defined? Use both.
//No attack type defined? Use weapon.
//These two would never trigger without BF_SKILL
// Logout / Unequipped an item with an activated bonus
/**
/*==========================================
//Shield, used for royal guard
//Become weapon element.
//Become arrow element.
//Negative bonuses will underflow, this will be handled in status_calc_pc through casting
//If this is called outside of status_calc_pc, you'd better pray they do not underflow and end with UINT_MAX max_hp.
//Non stackable increase
//Stackable increase
//Raw increase
//Stackable increase - Made it linear as per rodatazone
// Decomposed RC_ALL:
// Maya Purple Card effect allowing to see Hiding/Cloaking people [DracoRPG]
//AppleGirl Was Here
// [Valaris]
// [Valaris]
// [Valaris]
// [Valaris]
// [Valaris]
//[Lupus] it should stack, too. As any other cards rate bonuses
// Decomposed RC_ALL:
// Decomposed RC_ALL:
// Decomposed RC_ALL:
// Decomposed RC_ALL:
/*==========================================
//Right hand
//Shift the rest of elements up.
//Left hand
//Shift the rest of elements up.
//Shift the rest of elements up.
//Shift the rest of elements up.
//Shift the rest of elements up.
// Decomposed RC_ALL:
// Decomposed RC_ALL:
// Decomposed RC_ALL:
// Decomposed RC_ALL:
// Decomposed RC_ALL:
// Decomposed RC_ALL:
// Decomposed RC_ALL:
// Decomposed RC_ALL:
//Better mention this so the array length can be updated. [Skotlex]
// Better mention this so the array length can be updated. [Skotlex]
// Better mention this so the array length can be updated. [Skotlex]
//Better mention this so the array length can be updated. [Skotlex]
//Better mention this so the array length can be updated. [Skotlex]
//Standard item bonus.
//bonus2 bSkillUseSPrate,n,x;
//bonus2 bSkillUseSP,n,x;
//Support or Self (non-auto-target) skills should pick self.
//Support or Self (non-auto-target) skills should pick self.
// Decomposed RC_ALL:
// Decomposed RC_ALL:
//Support or Self (non-auto-target) skills should pick self.
//bonus4 bSetDefRace,n,x,r,y;
//bonus4 bSetMDefRace,n,x,r,y;
/*==========================================
//Set skill data overwriting whatever was there before.
//Remove skill.
//Only recalculate for passive skills.
//Item bonus skill.
//Non-granted skill, store it's level.
//Add skill bonus on top of what you had.
// Store previous level.
//Set that this is a bonus skill.
//Remove skill.
//Only recalculate for passive skills.
//Unknown flag?
/**
//Invalid item index.
// target item missing
// only weapons and armor are allowed
// target must be identified
// card slots reserved for other purposes
// item must be unequipped
// card cannot be compounded on this item type
// attempted to place shield card on left-hand weapon.
// no free slots
/**
//Invalid card index.
// target card missing
// must be a card
/*==========================================
// remember the card id to insert
// failed
// success
// no free slots
//
// Items
//
/*==========================================
// merchant discount
// rogue discount
/*==========================================
//OverCharge
/*==========================================
// FIXME: This does not consider the checked item's cards, thus could check a wrong slot for stackability.
/*==========================================
/*==========================================
//prevent command UB
//Not enough.
// Achievements [Smokexyz/Hercules]
// Removed %dz.
/**
//Changed Kafrapoints calculation. [Normynator]
//prevent command UB
//prevent command UB
//prevent command UB
//shouldn't happen but jsut in case
/*==========================================
//prevent command UB
// Achievements [Smokexyz/Hercules]
// Gained %dz.
/**
/*==========================================
// item stack limitation
/* no restrictions */
/* need proper code? */
/* need proper code? */
// Stackable | Non Rental
// clear equip and favorite fields first, just in case
// Achievements [Smokexyz/Hercules]
// auto-favorite
//Auto-equip
/* rental item check */
/*==========================================
// It's here because the data would most likely get zeroed in following if [Hemagx]
/*==========================================
//pc->delitem would fail on this case.
// You can't drop items in this map
// This item cannot be dropped.
/*==========================================
// Distance is too far
//This function takes care of giving the item to whoever should have it, considering party-share options.
//Display pickup animation.
/*==========================================
//Not consumable item
//if it has no script, you can't really consume it!
//clif->messagecolor_self(sd->fd, COLOR_WHITE, msg_txt(1474));
// You cannot use this item while sitting.
// TODO: Is there no better way to handle this, other than hardcoding item IDs?
/* Fall through */
// Yellow Butterfly Wing
// Green Butterfly Wing
// Red Butterfly Wing
// Blue Butterfly Wing
// "Duel: Can't use this item in duel."
// Mercenary Items
// Mercenary Scrolls
//Gender check
//Required level check
//Not equipable by class. [Skotlex]
//Not usable by upper class. [Haru]
// Normal classes (no upper, no baby, no third classes)
// Upper classes (no third classes)
//pre-re has no use for the extra, so we maintain the previous for backwards compatibility
// Baby classes (no third classes)
// Third classes (no upper, no baby classes)
// Upper third classes
// Baby third classes
/*==========================================
// You cannot use this item while storage is open.
// *pcblock script command
// Store information for later use before it is lost (via pc->delitem) [Paradox924X]
// Statuses that don't let the player use items
// Prevent mass item usage. [Skotlex]
/* Items with delayed consume are not meant to work while in mounts except reins of mount(12622) */
//Since most delay-consume items involve using a "skill-type" target cursor,
//perform a skill-use check before going through. [Skotlex]
//resurrection was picked as testing skill, as a non-offensive, generic skill, it will do.
//FIXME: Is this really needed here? It'll be checked in unit.c after all and this prevents skill items using when silenced [Inkfish]
/*|| !status->check_skilluse(&sd->bl, &sd->bl, ALL_RESURRECTION, 0)*/ ) )
/* item not found. try first empty now */
// found
// [%d] seconds left until you can use
// [%d] seconds left until you can use
// Delay has not expired yet
// not yet used item (all slots are initially empty)
// should not happen
//clean up used delays so we can give room for more
/* on restricted maps the item is consumed but the effect is not used */
//Dead Branch & Bloody Branch & Porings Box
//Abort pet catching.
// Removes abracadabra/randomize spell flag for delayed consume items or item doesn't get consumed
//Check if the item is to be consumed immediately [Skotlex]
// Famous player's potions have 50% more efficiency
//Even more effective potions.
// Update item use time.
/*==========================================
// item stack limitation
// Check item trade restrictions
// This item cannot be stored.
/* TODO: there is no official response to this? */
// item already in cart, stack it
// no room
// item not stackable or not present, add it
// no room
/* clear */
/*==========================================
/*==========================================
//Invalid index check [Skotlex]
/*==========================================
/*==========================================
//Invalid index check [Skotlex]
/* both restricted to inventory */
// FIXME: is this the correct reason flag?
// FIXME: is this the correct reason flag?
/*==========================================
// %s stole an Unknown Item (id: %i).
// %s stole %s.
/*==========================================
//already stolen from / status change check
// check noloot map flag [Lorky]
//Reached limit of steal attempts. [Lupus]
//Can't steal from
// base skill success chance (percentual)
// Try dropping one item, in the order from first to last possible slot.
// Droprate is affected by the skill success rate.
//TODO: Should we disable stealing when the item you stole couldn't be added to your inventory? Perhaps players will figure out a way to exploit this behaviour otherwise?
//you can't steal from this mob any more
//Failed to steal due to overweight
//Logs items, Stolen from mobs [Lupus]
/**
// mob_lv * skill_lv / 10 + random [mob_lv*8; mob_lv*10]
/*==========================================
//Revive dead people before warping them
//stop = true; Uncomment if adding new checks
/* we hit a instance, if empty we populate the spawn data */
// Misc map-changing settings
// Cancel some map related stuff.
//You may not get out!
//Will later check if this is needed. [Rytech]
//minimap dot fix [Kevin]
// make sure vending is allowed here
// "You can't open a shop on this map"
// Only if the character is already on a map
//if can't find any map-servers, just abort setting position.
//remove from map, THEN change x/y coordinates
// makes character face north
//Free session data from this map server [Kevin]
// make it random
// pick a random walkable cell
// "You can't open a shop on this cell."
// makes character face north
// [MouseJstr]
//Tag player for rewarping after map-loading is done. [Skotlex]
// Increased guild castle regen [Valaris]
/* given autotrades have no clients you have to trigger this manually otherwise they get stuck in memory limbo bugreport:7495 */
/*==========================================
//Teleport forbidden
/*==========================================
// check mapflags
// "Saved point cannot be memorized."
// check inputs
// invalid input
// check required skill level
// "You haven't learned Warp."
// "Skill Level is not high enough."
// prevent memo-ing the same map multiple times
//
// Skills
//
/*==========================================
/*==========================================
// Skills requiring specific weapon types
// Spurt requires bare hands (feet, in fact xD)
// Skills requiring a shield
/*==========================================
/*==========================================
//Novice And 1-1 Jobs
//2-1 Jobs
//2-2 Jobs
//Trans Novice And Trans 1-1 Jobs
//Trans 2-1 Jobs
//Trans 2-2 Jobs
//Baby Novice And Baby 1-1 Jobs
//Baby 2-1 Jobs
//Baby 2-2 Jobs
//3-1 Jobs
//3-2 Jobs
//Trans 3-1 Jobs
//Trans 3-2 Jobs
//Baby 3-1 Jobs
//Baby 3-2 Jobs
//Reverts the map-style class id to the client-style one.
//Novice And 1-1 Jobs
//2-1 Jobs
//2-2 Jobs
//Trans Novice And Trans 2-1 Jobs
//Trans 2-1 Jobs
//Trans 2-2 Jobs
//Baby Novice And Baby 1-1 Jobs
//Baby 2-1 Jobs
//Baby 2-2 Jobs
//3-1 Jobs
//3-2 Jobs
//Trans 3-1 Jobs
//Trans 3-2 Jobs
//Baby 3-1 Jobs
//Baby 3-2 Jobs
/*====================================================
// 550
// 551
// 552
// 553
// 554
// 555
// 556
// 557
// 558
// 559
// 560
// 561
// 562
// 563
// 564
// 565
// 566
// 567
// 568
// 569
// 570
// 571
// 572
// 573
// 574
// 575
// 576
// 577
// 578
// 579
// 580
// 581
// 582
// 583
// 584
// 585
// 586
// 587
// 588
// 589
// 590
// 591
// 592
// 593
// 594
// 595
// 596
// 597
// 598
// 599
// 600
// 601
// 602
// 603
// 604
// 605
// 606
// 607
// 608
// 609
// 610
// 611
// 612
// 613
// 614
// 622
// 623
// 624
// 625
// 626
// 627
// 628
// 629
// 630
// 656
// 657
// 658
// 659
// 660
// 661
// 631
// 632
// 633
// 634
// 635
// 636
// 637
// 662
// 663
// 664
// 665
// 666
// 667
// 668
// 638
// 639
// 640
// 641
// 642
// 643
// 644
// 645
// 646
// 647
// 648
// 649
// 650
// 651
// 652
// 653
// 654
// "Unknown Job"
// either player or target is currently detached from map blocks (could be teleporting),
// but still connected to this map, so we'll just increment the timer and check back later
// increase time a bit to loosen up map's load
/*|| bl->type != BL_PC*/)
//Kyoki pointed out that the max overcarry exp is the exp needed for the previous level -1. [Skotlex]
//<Skotlex> update pet's level
//LORDALFA - LVLUPEVENT
//Reenable steelbody resurrection on dead.
//Kyoki pointed out that the max overcarry exp is the exp needed for the previous level -1. [Skotlex]
//Permanent blind effect from SG_DEVIL.
/**
//should happen first before we caluclate any modifiers
//Race modifier
//PK modifier
/* this doesn't exist in Aegis, instead there's a CrazyKiller check which double all EXP from this point */
// pk_mode additional exp if monster >20 levels [Valaris]
//Buffs modifier
//Applying Race and PK modifier First then Premium (Perment modifier) and finally buff modifier
/**
// [MouseJstr]
// no exp on pvp maps
//Note that this value should never be greater than the original
//base_exp, therefore no overflow checks are needed. [Skotlex]
// Cap exp to the level up requirement of the previous level when you are at max level,
// otherwise cap at UINT_MAX (this is required for some S. Novice bonuses). [Skotlex]
// Experience Gained Base:%"PRIu64" (%.2f%%) Job:%"PRIu64" (%.2f%%)
// Share master EXP to homunculus
/*==========================================
/*==========================================
//Base exp needed for next level.
//Base exp needed for this level.
/*==========================================
//Job exp needed for next level.
//Job exp needed for this level.
/// Returns the value of the specified stat.
/// Sets the specified stat to the specified value.
/// Returns the new value.
// Achievements [Smokexyz/Hercules]
// Calculates the number of status points PC gets when leveling up (from level to level+1)
//Use values from "db/statpoint.txt"
//Default increase
/// Returns the number of stat points needed to change the specified stat by val.
/// If val is negative, returns the number of stat points that would be needed to
/// raise the specified stat from (current value - val) to current value.
// Official servers show '0' when max is reached
// renewal status point cost formula
/**
// renewal status point cost formula
/**
// check conditions
// check limits
// cap to the maximum status points available
// check status points
// Sanity check
// set new values
// update increase cost indicator
// update statpoint count
// update stat value
// required
// send after the 'ack' to override the truncated value
/**
// set new value
// update increase cost indicator
// update stat value
// required
// send after the 'ack' to override the truncated value
/*==========================================
//Don't allow raising while you have granted skills. [Skotlex]
// Only recalculate for passive skills.
// Required to grant all TK Ranger skills.
// Check if a new skill can Lvlup
/* cart weight info was updated by status_calc_pc */
// may skill everything at any time anyways, and this would cause a huge slowdown
/* TODO: official response? */
/*==========================================
//Get ALL skills except npc/guild ones. [Skotlex]
//and except SG_DEVIL [Komurka] and MO_TRIPLEATTACK and RG_SNATCHER [ultramage]
//Nonexistant skills should return a max of 0 anyway.
//Cannot be learned normally.
// celest
//Required because if you could level up all skills previously,
//the update will not be sent as only the lv variable changes.
/*==========================================
//Also reset skills
// not 88 [celest]
// give platinum skills upon changing
// Updates needed stat points - Valaris
// End Addition
// unequip items that can't be equipped by base 1 [Valaris]
/*==========================================
// New statpoint table used here - Dexity
//pc->statp[] goes out of bounds, can't reset!
// extra 52+48=100 stat points
// Updates needed stat points - Valaris
// End Addition
//bugreport:2200
/*==========================================
//Remove stuff lost when resetting skills.
/**
//Remove perma blindness due to skill-reset. [Skotlex]
//Avoid reseting wedding/linker skills.
//Only handle quest skills in a special way when you can't learn them manually
//Wipe them
// reset
// Remove all SCs that can't be inactivated without a skill
// Don't reset trick dead if not a novice/baby
// do not reset basic skill
/*==========================================
// not applicable
// member revived by battleground
//If warping fails, send a normal stand up packet.
/*==========================================
// Achievements [Smokexyz/Hercules]
/*==========================================
// Unlock all targets...
// Your mercenary soldier has ran away.
// Leave duel if you die [LuzZza]
/* TODO: purge when bgqueue is deemed ok */
// Clear anything NPC-related when you die and was interacting with one.
/* e.g. not killed through pc->damage */
//Reset menu skills/item skills
//Reset ticks.
// Guardians/summons should not level. [Skotlex]
// monster level up [Valaris]
// update name with new level
// Maybe Player Summon
//Pass on to master...
// Achievements [Smokexyz/Hercules]
// PK/Karma system code (not enabled yet) [celest]
// originally from Kade Online, so i don't know if any of these is correct ^^;
// note: karma is measured REVERSE, so more karma = more 'evil' / less honourable,
// karma going down = more 'good' / more honourable.
// The Karma System way...
// If player killed was more evil
// If player killed was more good
// or the PK System way...
// player killed is dishonourable?
// honour points earned
// honour points lost
// To-do: Receive exp on certain occasions
// CharId
// activate Steel body if a super novice dies at 99+% exp [celest]
// changed penalty options, added death by player if pk_mode [Valaris]
// Moved this outside so it works when PVP isn't enabled and during pk mode [Ancyker]
// Remove autotrade to prevent autotrading from save point
// pvp
// disable certain pvp functions on pk_mode [Valaris]
//GvG
// Respawn by BG
//Reset "can log out" tick.
// only novices will receive no penalty
// script
//
/*==========================================
//Base job, extracting upper type.
//Extract base class tree. [Skotlex]
/*==========================================
//Capping to max
// clif->updatestatus(sd, SP_BASELEVEL);  // Gets updated at the bottom
// clif->updatestatus(sd, SP_JOBLEVEL);  // Gets updated at the bottom
// can't set negative zeny
// send to char server
// the vault uses a different packet
// status_change_start/status_change_end already sends packets warning the client
/*==========================================
/*==========================================
// A potion produced by an Alchemist in the Fame Top 10 gets +50% effect [DracoRPG]
//All item bonuses.
//Individual item bonuses.
// Recovery Potion
// 2014 Halloween Event : Pumpkin Bonus
// 1.5 times
/*==========================================
//Heal
//Damage (negative rates indicate % of max rather than current), and only kill target IF the specified amount is 100%
//Crossed signs
/*==========================================
//Normalize job.
//This will automatically adjust bard/dancer classes to the correct gender
//That is, if you try to jobchange into dancer, it will turn you to bard.
//Nothing to change.
// changing from 1st to 2nd job
// changing from 2nd to 3rd job
//Things to remove when changing class tree.
//Remove status specific to your current tree skills.
/* going off star glad lineage, reset feel to not store no-longer-used vars in the database */
// unequip invalid item for class
//Change look, if disguised, you need to undisguise
//to correctly calculate new job sprite without
// Fix atcommand @jobchange when the player changing from 3rd job having alternate body style into non-3rd job, crashing the client
// move sprite update to prevent client crashes with incompatible equipment [Valaris]
//Update skill tree.
//Remove peco/cart/falcon
//You do not need a skill for this.
//if you were previously famous, not anymore.
//It may be that now they are famous?
// Achievements [Smokexyz/Hercules]
/*==========================================
/*==========================================
//Use the battle_config limits! [Skotlex]
//Update Guild Window. [Skotlex]
//Use the battle_config limits! [Skotlex]
//Update Guild Window. [Skotlex]
//Use the battle_config limits! [Skotlex]
/*==========================================
//Option has to be changed client-side before the class sprite or it won't always work (eg: Wedding sprite) [Skotlex]
// Mounting
// Dismount
//Cart On
//Apply speed penalty.
//Cart Off
//Remove speed penalty.
//Falcon ON
//Falcon OFF
// Mounting
// Dismount
// End all SCs that can be reset when mado is taken off
//Disguises break sprite changes
//Restore normal look.
//Stop attacking on new view change (to prevent wedding/santa attacks.
// Skill list needs to be updated after base change.
/*==========================================
// Never trust the values sent by the client! [Skotlex]
// Push cart is required
/* everything else is an allowed ID so we can move on */
/* first time, so fill cart data */
/* forcefully update */
//Recalc speed penalty.
// Update option
// clear cart bits
// set cart
/* FIXME: These setter methods are inconsistent in their class/skill checks.
/**
// add falcon if he have the skill
// remove falcon
/**
/**
/**
// Ensure only one dragon is set at a time.
// remove dragon
/**
// remove wug
/**
// The client doesn't let you, this is to make cheat-safe
/**
/*==========================================
//check if this GM level can drop items
/**
/**
/**
/**
/**
//This really shouldn't happen, so it's possible the data was lost somewhere, we should request it again.
//intif->request_registry(sd,type==3?4:type);
/**
//This really shouldn't happen, so it's possible the data was lost somewhere, we should request it again.
//intif->request_registry(sd,type==3?4:type);
/**
/* SAAD! those things should be stored elsewhere e.g. char ones in char table, the cash ones in account_data table! */
//Char reg
// Lost the bonus.
/* its a entry that was deleted, so we reset array */
/* either way, it will require either delete or replace */
/**
/* a entry that was deleted, so we reset */
/* either way, it will require either delete or replace */
/*==========================================
/*==========================================
/*==========================================
// find the named event timer
// not found
/*==========================================
/*==========================================
/* called when a item with combo is worn */
/* ensure this isn't a duplicate combo */
/* found a match, skip this combo */
//Cards
// We have found a match
/* we haven't found all the ids for this combo, so we can return */
/* means we broke out of the count loop w/o finding all ids, we can move to the next combo */
/* we got here, means all items in the combo are matching */
/* called when a item with combo is removed */
/* nothing to do here, player has no combos */
/* check if this combo exists in this user */
/* no match, skip this combo */
/* it's empty, we can clear all the memory */
/* check if combo requirements still fit -- don't touch retval! */
/**
//Added check to prevent sending the same look on multiple slots ->
//causes client to redraw item on top of itself. (suggested by Lupus)
/*==========================================
//With a few exceptions, item should go in all specified slots.
// [Valaris]
// FIXME: pc->isequip: equip level failure uses 2 instead of 0
// fail
// fail
/* won't fail from this point onwards */
//Accesories should only go in one of the two,
//User specified both slots..
//Dual wield capable weapon.
//User specified both slots, pick one for them.
//Accesories should only go in one of the two,
//User specified both slots..
//Dual wield capable weapon.
//User specified both slots, pick one for them.
//Update skill-block range database when weapon range changes. [Skotlex]
//No data, or no weapon equipped
//Slot taken, remove item from there.
//Check if status changes should be halted.
/* check for combos (MUST be before status_calc_pc) */
//No cards
//Update skill data
//OnEquip script [Skotlex]
//No cards
/**
// Unequipping => stop dancing.
/*==========================================
// if player is berserk then cannot unequip
//Nothing to unequip
//Check for seven wind (but not level seven!)
// On Armor Change...
//Check for activated autobonus [Inkfish]
/* check for combos (MUST be before status_calc_pc) */
/* Item Options checking */
//OnUnEquip script [Skotlex]
/*==========================================
// Avoid reorganizing items when we are vending, as that leads to exploits (pointed out by End of Exam)
// check for invalid(ated) items
// force closing
/*==========================================
// cannot register pvp rank for hidden GMs
/*==========================================
/*==========================================
// do not calculate the pvp rank for a hidden GM
/*==========================================
/*==========================================
// Achievements [Smokexyz/Hercules]
/*==========================================
// Char is not married
// Lets char server do the divorce
// No char server connected
// Both players online, lets do the divorce manually
/*==========================================
// charid2sd returns NULL if not found
/*==========================================
// charid2sd returns NULL if not found
/*==========================================
// charid2sd returns NULL if not found
/*==========================================
// charid2sd returns NULL if not found
/*==========================================
//Script drains cannot kill you.
//Character regen. Flag is used to know which types of regen can take place.
//&1: HP regen
//&2: SP regen
/*==========================================
/*==========================================
//Someone was saved on last call, normal cycle
//Noone was saved, so save first found char.
//Not our turn to save yet.
//Save char.
//Night/day state does not match.
//New night effect by dynamix [Skotlex]
/*================================================
// if we want a day
//Already day.
// 0=day, 1=night [Yor]
// The day has arrived!
/*================================================
// if we want a night
//Already nigth.
// 0=day, 1=night [Yor]
// The night has fallen...
//Reset sitting tick.
/**
// already burning
// Avoid negative HEAT
/**
/**
/**
/**
/**
/**
// skip trickdead for non-novices
/**
// Foreach job
// Foreach inherited job
// No more skills to copy
// Not existing yet, copy
// Already existing, merge
// Foreach skill
// Foreach requirement
/* lets update all players skill tree */
/**
/**
/**
/*==========================================
/**
// Reset and read skilltree
// fill in the blanks
// reset
// Reset then read attr_fix
// reset then read statspoint
//return 1;
// generate the remaining parts of the db if necessary
//save setting
//temporarily disable to force pc->gets_status_point use default values
// seed value
//restore setting
//Classes that do not need exp tables.
// no skill cooldown is associated with this character
// create a new skill cooldown object for map storage
/* no official response for this scenario exists. */
/* status change data arrived from char-server */
// don't display if it's unlimited or unknow value
// "Your account time limit is: %d-%m-%Y %H:%M:%S."
/* This timer exists only when a character with an expire timer > 24h is online */
/* It loops through online players once an hour to check whether a new < 24h is available */
/* ongoing timer */
/* not within the next 24h, enable the global check */
/* global check not running, enable */
/* starts in 1h, repeats every hour */
/**
/**
/**
/* either way, this goes down */
/**
/**
/**
//Checks if the given class value corresponds to a player class. [Skotlex]
//JOB_NOVICE isn't checked for class is supposed to be unsigned
/**
/**
/**
/**
/**
// 0%, 10%, 20%, ...
// 10.0%, 20.0%, ..., 90.0%
// "Dear angel, can you hear my voice?"
// "I am %s Super Novice~"
// "Help me out~ Please~ T_T"
//Lv17-> +50 critical (noted by Poki) [Skotlex]
// prayer always shows successful Lv5 cast and disregards noskill restrictions
/**
// The transmission of GM only Wisp/Page from server to inter-server
// + null
// information is sent to all online GM
/**
//	FIXME: JOB_SUPER_NOVICE_E(4190) is not supposed to be 3rd Job. (Issue#2383)
// 0=day, 1=night [Yor]
// add night/day timer [Yor]
/*=====================================
/* vars */
/* */
// These macros are used instead of a sum of sizeof(), to ensure that padding won't interfere with our size, and code won't rot when adding more fields
/* */
/* */
/* */
/* */
/* */
/* */
/* funcs */
// Special Shop System
// [MouseJstr]
// Skotlex
// Skotlex
// by [yor]
// by [yor]
// Rental System
/**
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\pc_groups.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// atcommand-"exists(), atcommand-"load_groups()
// clif-"GM_kick()
// mapiterator
// pc-"set_group()
// strcmp
///< dummy group used in dummy map sessions @see pc_get_dummy_sd()
/**
/**
/**
// FIXME hardcoded name
// Retrieve the pointer
// Save number of groups
// Check if all commands and permissions exist
// Make sure there is "commands" group
// Make sure there is "permissions" group
// Apply inheritance
// counter for processed groups
// group already processed
// this group does not inherit from others
// we need to do that group first
// Copy settings (commands/permissions) that are not defined yet
// copied commands and permissions from one of inherited groups
// copied commands from all of inherited groups
// we're done with this group
// while(i < group_count)
// Pack permissions into GroupSettings.e_permissions for faster checking
// does not have this permission
// Atcommand permissions are processed by atcommand module.
// Fetch all groups and relevant config setting and send them
// to atcommand->load_group() for processing.
// All data is loaded now, discard config
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/* refresh online users permissions */
/**
/* */
/* */
/* */
/* */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\pet.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// DBPATH
// msg_txt()
/* Pet is lost, delete the egg */
//No pet egg here.
// Inventory full
/*==========================================
//Skotlex: Use pet's skill
//Offensive self skill? Could be stuff like GX.
//Skill invoked.
/*==========================================
//You lost the pet already, the rest is irrelevant.
/* Pet Autofeed */
//TODO: this is way too high
// Stop walking for 2000ms
// Pet Evolution
// The pet egg wasn't found: it was probably hatched with the old system that deleted the egg.
//Wrong pet?? Set incubate to no and send it back for saving.
//The pet_id value was lost? odd... restore it.
//is it REALLY Needed to save the char for hatching a pet? [Skotlex]
// Get Egg Index
// Pet Evolution, Hide the egg by setting broken attribute (0x2)  [Asheraf]
// bind the egg to the character to avoid moving it via forged packets [Asheraf]
//Forged packet!
// TODO: Why does this not use map->id2md?
// Invalid inputs/state, abort capture.
//FIXME: delete taming item here, if this was an item-invoked capture and the item was flagged as delay-consume [ultramage]
//catch_target_class == 0 is used for universal lures (except bosses for now). [Skotlex]
//mob will do /ag if wrong lure is used on them.
/**
// i = pet->search_petDB_index(sd->catch_target_class,PET_CLASS);
// issue: 8150
// Before this change in cases where more than one pet egg were requested in a short
// period of time it wasn't possible to know which kind of egg was being requested after
// the first request. [Panikon]
//New pets are not named.
//You lost the pet already.
// You can't return your pet because your inventory is full.
//bugreport:3032 // FIXME[Haru]: This should be normalized by the inter-server (so that it's const here)
// You cannot use this name for your pet.
//Send status so client knows oet name change got rejected.
//Updates view_data.
//Skotlex: start support timers if need
// Skotlex: halt support timers if needed
//No thinking when you just started to walk.
//Pet should just... well, random walk.
//Master too far, chase.
//Already walking to him
//Can't move yet.
//Return speed to normal.
//Wait until the pet finishes walking back to master.
//Use half the pet's range of sight.
//Just walk around.
//Already next to master.
//Already walking to him
//Target already locked.
//enemy targetted
//Chase
//Unreachable target.
//Continuous attack.
//Item Targeted, attempt loot
//Out of range
//Unreachable target.
//Target is unlocked regardless of whether it was picked or not.
//New target closer than previous one.
//The smart thing to do is use pd->loot->max (thanks for pointing it out, Shinomori)
//prevent picked up during 10*1000ms
/*==========================================
// determine the time for the next timer
// the duration until pet bonuses will be reactivated again
// the duration for pet bonuses to be in effect
//Lost pet...
// wait for the next timer
/*==========================================
//Display a heal animation?
//Detoxify is chosen for now.
/*==========================================
//Wait until the pet can act again.
//Another skill is in effect
//Wait (how long? 1 sec for every 10% of remaining)
// Pet Evolution
/**
// Remove any previous scripts in case reloaddb was invoked.
/*==========================================
// [Valaris]
// [Skotlex]
// [Valaris]
/* Pet Evolution [Dastgir/Hercules] */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\quest.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
///< Quest database
/**
/**
// TODO[Haru]: is this necessary? Does quest_send_mission not take care of this?
/**
// Insertion point
// The character has some completed quests, make room before them so that they will stay at the end of the array
/**
/**
//Search for quest
// Compact the array
/**
/**
// Skip inactive quests
// process quest-granted extra drop bonuses
// TODO: Should this be affected by server rates?
// TODO: We might want a new log type here?
// Failed to obtain the item
/**
// The quest is complete, so it needs to be moved to the completed quests block at the end of the array.
/**
/**
/*
//safestrncpy(entry->name, str, sizeof(entry->name));
// This is an unsigned value, do not check for >= 0
// Note: We ensure that objectives_count < MAX_QUEST_OBJECTIVES because
//       quest_log (as well as the client) expect this maximum size.
// Zero = any monster
/**
/**
// Remove no longer existing entries
// And inform the client if necessary
// Move entries if there's a gap to fill
/**
/*
// Default to nothing if icon id is invalid.
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
/**
// Update quest data for players, to ensure no entries about removed quests are left over.
/**
/* */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\refine.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/** @file
/// @copydoc refine_interface::refinery_refine_request()
/// @copydoc refine_interface::refinery_add_item()
/// @copydoc refine_interface_private::is_refinable()
/// @copydoc refine_interface::get_randombonus_max()
/// @copydoc refine_interface::get_bonus()
/// @copydoc refine_interface::get_refine_chance()
/// @copydoc refine_interface_private::announce_behavior_string2enum()
/// @copydoc refine_interface_private::failure_behavior_string2enum()
/// @copydoc refine_interface_private::readdb_refinery_ui_settings_items()
/// @copydoc refine_interface_private::readdb_refinery_ui_settings_sub()
/// @copydoc refine_interface_private::readdb_refinery_ui_settings()
/// @copydoc refine_interface_private::readdb_refine_libconfig_sub()
// default value for all rates.
// enriched ores up to +10 only.
// enriched ores up to +10 only.
/// @copydoc refine_interface_private::readdb_refine_libconfig()
/// @copydoc refine_interface::init()
/// @copydoc refine_interface::final()
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\rodex.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// NOTE : These values are hardcoded into the client
// Cost of each Attached Item
// Percent of Attached Zeny that will be paid as Tax
// Maximun number of messages that can be sent in one day
/// Checks if RoDEX System is enabled in the server
/// Returns true if it's enabled, false otherwise
/// Checks and refreshes the user daily number of Stamps
/// @param sd : The player who's being checked
// Note : Weirdly, iRO starts this with maximum messages of the day and decrements
//        but our clients starts this at 0 and increments
/// Attaches an item to a message being written
/// @param sd : The player who's writting
/// @param idx : the inventory idx of the item
/// @param amount : Amount of the item to be attached
/// Removes an item attached to a message being writen
/// @param sd : The player who's writting the message
/// @param idx : The index of the item
/// @param amount : How much to remove
/// Request if character with given name exists and returns information about him
/// @param sd : The player who's requesting
/// @param name : The name of the character to check
/// @param base_level : Reference to return the character base level, if he exists
/// @param char_id : Reference to return the character id, if he exists
/// @param class : Reference to return the character class id, if he exists
/// Sends a Mail to an character
/// @param sd : The player who's sending
/// @param receiver_name : The name of the character who's receiving the message
/// @param body : Mail message
/// @param title : Mail Title
/// @param zeny : Amount of zeny attached
/// Returns result code:
///     RODEX_SEND_MAIL_SUCCESS = 0,
///         RODEX_SEND_MAIL_FATAL_ERROR = 1,
///         RODEX_SEND_MAIL_COUNT_ERROR = 2,
///         RODEX_SEND_MAIL_ITEM_ERROR = 3,
///         RODEX_SEND_MAIL_RECEIVER_ERROR = 4
// this will not inform client of the success yet. (see rodex_send_mail_result)
/// The result of a message send, called by char-server
/// @param ssd : Sender's sd
/// @param rsd : Receiver's sd
/// @param result : Message sent (true) or failed (false)
/// Retrieves one message from character
/// @param sd : Character
/// @param mail_id : Mail ID that's being retrieved
/// Returns the message
/// Request to read a mail by its ID
/// @param sd : Who's reading
/// @param mail_id : Mail ID to be read
/// Deletes a mail
/// @param sd : Who's deleting
/// @param mail_id : Mail ID to be deleted
/// give requested zeny from message to player
/// Gets attached zeny
/// @param sd : Who's getting
/// @param mail_id : Mail ID that we're getting zeny from
// give requested items from message to player
/// Gets attached item
/// @param sd : Who's getting
/// @param mail_id : Mail ID that we're getting items from
/// Cleans user's RoDEX related data
/// - should be called everytime we're going to stop using rodex in this character
/// @param sd : Target to clean
/// @param flag :
///     0 - clear everything
///     1 - clear tmp only
/// User request to open rodex, load mails from char-server
/// @param sd : Who's requesting
/// @param open_type : Box Type (see RODEX_OPENTYPE)
/// User request to read next page of mails
/// @param sd : Who's requesting
/// @param open_type : Box Type (see RODEX_OPENTYPE)
/// @param last_mail_id : The last mail from the current page
// Should not happen
// Find where the page starts
// Valid page, get first item of next page
// Should not happen, invalid lower_id given
/// User's request to refresh his mail box
/// @param sd : Who's requesting
/// @param open_type : Box Type (See RODEX_OPENTYPE)
/// @param first_mail_id : The first mail id known by client, currently unused
// Some clients sends the first mail id it currently has and expects to receive
// a list of newer mails, other clients sends first mail id as 0 and expects
// to receive the first page (as if opening the box)
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\script.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// RENEWAL, RENEWAL_ASPD, RENEWAL_CAST, RENEWAL_DROP, RENEWAL_EDP, RENEWAL_EXP, RENEWAL_LVDMG, SCRIPT_CALLFUNC_CHECK, SECURE_NPCTIMEOUT, SECURE_NPCTIMEOUT_INTERVAL
// NEW_CARTS
// usage: getcharip
// operators
/// Reports on the console the src of a script error.
//Can't report source.
/// Reports on the console information about the script data.
// no value
// number
// string
// reference
// variable
// constant
// param
// ???
// label
/// Reports on the console information about the current built-in function.
// no stack
// script currently not executing a built-in function or corrupt stack
/*==========================================
/// Checks event parameter validity
/*==========================================
// hash*33 + c
// hash*65599 + c
// UNIX ELF hash
// athena hash
/*==========================================
// hash*33 + c
// hash*65599 + c
// UNIX ELF hash
// athena hash
// ENABLE_CASE_CHECK
/*==========================================
/// Looks up string using the provided id.
/// Returns the uid of the string, or -1.
// ENABLE_CASE_CHECK
//empty bucket, add new node here
// string already in list
// reached the end
// append node to end of list
// grow list if neccessary
// grow string buffer if neccessary
// ENABLE_CASE_CHECK
/// Stores a copy of the string and returns its id.
/// If an identical string is already present, returns its id instead.
// ENABLE_CASE_CHECK
// empty bucket, add new node here
// scan for end of list, or occurence of identical string
// string already in list
// reached the end
// append node to end of list
// Local scope vars are checked separately to decrease false positives
// Known duplicates, don't bother warning the user
// TODO
// ENABLE_CASE_CHECK
// grow list if neccessary
// grow string buffer if neccessary
/**
/**
/**
/**
// Embedded data backpatch there is a possibility of label
//Notice that this is negative, from jA (Rayce)
// assume C_NAME
/*==========================================
//Prevent overwriting constants values, parameters and built-in functions [Skotlex]
/// Skips spaces and/or comments.
// line comment
// block comment
// end of block comment
/// Skips a word.
/// A word consists of undercores and/or alphanumeric characters,
/// and valid variable prefixes/postfixes.
// prefix
// temporary char variable
// account variable
// instance variable
// npc variable
// global variable
// postfix
// string
/// Adds a word to script->str_data.
/// @see skip_word
/// @see script->add_str
// Check for a word
// Duplicate the word
// add the word
/// Parses a function call.
/// The argument list can have parenthesis or not.
/// The number of arguments is checked.
// is need add check for arg null pointer below?
// buildin function
// Use a dummy, null string
// script defined function
// count func as argument
// <func name> ';'
// <func name> '(' ')'
/*
// <func name>
// <func name> <arg list>
// skip '('
// not an argument
// next argument
// no more arguments
// skip comma
/// Processes end of logical script line.
/// @param first When true, only fix up scheduling data is initialized
/// @param p Script position for error reporting in set_label
// mark end of line for stack cleanup
// fix up '-' labels
// initialize data for new '-' label fix up scheduling
/**
// process the variable index
// push the getelementofarray method into the stack
// process the sub-expression for this assignment
// closing parenthesis is required for this script
// push the closing function stack operator onto the stack
// No array index, simply push the variable or value onto the stack
/// Parse a variable assignment using the direct equals operator
/// @param p script position where the function should run from
/// @return NULL if not a variable assignment, the new position otherwise
// pre ++
// pre --
// skip the variable where applicable
// end of the line or invalid buffer
// array variable so process the array as appropriate
// end of line or invalid characters remaining
// =
// +=
// -=
// ^=
// |=
// &=
// *=
// **=
// /=
// %=
// post ++
// post --
// <<=
// >>=
// failed to find a matching operator combination so invalid
// pre ++
// pre --
// (nothing more to skip)
// =
// <<=
// >>=
// **=
// everything else
// end of line or invalid buffer
// push the set function onto the stack
// always append parenthesis to avoid errors
// increment the total curly count for the position in the script
// parse the variable currently being modified
// cannot assign a variable which exists as a function or label
// Push variable onto the stack
// Push variable onto the stack once again (first argument of setr)
// post ++ / --
// Push variable onto the stack (third argument of setr)
// pre ++ / --
// process the value as an expression
// push the type of modifier onto the stack
// decrement the curly count for the position within the script
// close the script by appending the function operator
// push the buffer from the method
/*
// Hexadecimal
// Decimal
// At least one digit, and next isn't a letter or _
/**
/*==========================================
// Skip leading zeros, we don't support octal literals
// Cast is safe, as it's already been checked for overflows
//'"'
// label , register , function etc
// successfully processed a variable assignment
// array(name[i] => getelementofarray(name,i) )
// FIXME: What are we skipping here?
// Skip string
// FIXME: What are we skipping here?
/*==========================================
// Pre ++ -- operators
/* C_ADD_PRE */ || (p[0]=='-'&&p[1]=='-') /* C_SUB_PRE */ ) { // Pre ++ -- operators
// Unary - ! ~ operators
// ?:
// +
// -
// **
// *
// /
// %
// &&
// &
// ||
// |
// ^
// ==
// !=
// ~=
// ~!
// >>
// >=
// >
// <<
// <=
// <
/* return first untreated operator */
/*==========================================
/*==========================================
//Close decision for if(); for(); while();
// Syntax-related processing
// attempt to process a variable assignment
// variable assignment processed so leave the method
//Binding decision for if(), for(), while()
// { ... } Closing process
//Close decision  if, for , while
//Closing switch()
// Remove temporary variables
// Go to the end pointer unconditionally
// You are here labeled
//Exists default
// Label end
// free the list of case label
//Closing decision if, for , while
// Syntax-related processing
// break, case, continue, default, do, for, function,
// if, switch, while ? will handle this internally.
// break Processing
// Closing decision if, for , while
//Processing case
//Jump for FALLTHRU
// You are here labeled
//Decision statement switch
// check whether case label is integer or not
//Numeric value
// pre-skip because '-' can not skip_word
//Check for constants
// length of word at p2
// Bad I do not parse twice
// Label after the completion of FALLTHRU
// check duplication of case label [Rayce]
// Processing continue
//Flag put the link for continue
//Closing decision if, for , while
// Switch - default processing
// Put the label location
// Skip to the next link w/o condition
// The default label
// Label of the (do) form here
// Execute the initialization statement
// Form the start of label decision
// For (; Because the pattern of always true ;)
// Skip to the end point if the condition is false
// Skip to the beginning of the loop
// Labels to form the next loop
// Process the next time you enter the loop
// A ')' last for; flag to be treated as'
// Skip to the determination process conditions
// Loop start labeling
// internal script function
// function <name> ;
// function declaration - just register the name
// register only, if the name was not used by something else
// already registered
// Close condition of if, for, while
// function <name> <line/block of code>
// Jump over the function code
// Set the position of the function (label)
// register only, if the name was not used by something else
// If process
//Prevent if this {} non-c script->syntax. from Rayce (jA)
// Processing of switch ()
// Form the start of label decision
// Skip to the end point if the condition is false
// If (...) for (...) hoge (); as to make sure closed closed once again
// Close judgment if, for, while, of do
// flag == 1 : closed
// flag == 0 : not closed
// if-block and else-block end is a new line
// Skip to the last location if
// Put the label of the location
// else  or else - if
// else - if
// else
// Close if
// Put the label of the final location
// Because the position of the pointer is the same if not else for this
// (Come here continue) to form the label here
// Skip to the end point if the condition is false
// do-block end is a new line
// Skip to the starting point
// Form label of the end point conditions
// for-block end is a new line
// Skip to the next loop
// End for labeling
// while-block end is a new line
// Skip to the decision while
// End while labeling
// Back
// Put the label of the location
/// Retrieves the value of a constant.
// not found or not a constant
/// Creates new constant or parameter with given value.
// existing parameter or constant
// existing name
/* adds data to a existent constant in the database, inserted normally via parse */
// existing constant
/**
// ensures it will be overwritten
/**
// Standard UNIX tab size is 8
/*==========================================
// len = 8
// len = 8
// len = 8
// Like Clang does, let's print the code with tabs expanded to spaces to ensure that the marker will be under the right character
// len = 8
// Find the line where the error occurred
/*==========================================
// empty script
/* as valid values are >= 0 */
// who called parse_script is responsible for clearing the database after using it, but just in case... lets clear it here
//Restore program state when script has problems. [from jA]
// ENABLE_CASE_CHECK
// does not require brackets around the script
// empty script and can return NULL
// ENABLE_CASE_CHECK
// requires brackets around the script
// empty script and can return NULL
// ENABLE_CASE_CHECK
// clear references of labels, variables and internal functions
// Special handling only label
// All other lumped
// default unknown references to variables
// 'function name;' without follow-up code
// Note: i is modified in the line above.
// ENABLE_CASE_CHECK
/// Returns the player attached to this script, identified by the rid.
/// If there is no player attached, the script is terminated.
/**
// not a variable/constant
// needs player attached
// string variable
// integer variable
// string variable
// global
// local
// empty string
// duplicate string
// integer variable
// global
// local
/**
// u.num is int32 because it comes from script->get_val
/**
// Special case with no st available, only sd
// Retrieve the missing sd
/**
/**
/**
/**
/* its the only member left, no need to do anything other than delete the array data */
/**
/**
/* from player */
/* char reg */
/* temp char reg */
/* account reg */
/* map reg */
/* npc/script */
/* instance */
/**
/* search */
/* if existent */
/* if empty, we gotta remove it */
/* new entry */
/* we do nothing if its empty, no point in modifying array data for a new empty member */
/* we only move to create if not empty */
/**
// to avoid this don't do script->add_str(") without setting its type.
// either use script->add_variable() or manually set the type
// string variable
// integer variable
// FIXME: This isn't safe, in 32bits systems we're converting a 64bit pointer
// to a 32bit int, this will lead to overflows! [Panikon]
// Instead of just stop the script execution we let the character close
// the window if it was open.
/// Converts the data to a string
// nothing to convert
// int -> string
// reference -> string
//##TODO when does this happen (check script->get_val) [FlavioJS]
// unsupported data type
/// Converts the data to an int
// nothing to convert
// string -> int
// the result does not overflow or underflow, it is capped instead
// ex: 999999999999 is capped to INT_MAX (2147483647)
// change radix to 0 to support octal numbers "o377" and hex numbers "0xFF"
//if( num >= INT_MAX )
// unsupported data type
// FIXME this function is being used to retrieve the position of labels and
// probably other stuff [FlavioJS]
//
// Stack operations
//
/// Increases the size of the stack
/// Pushes a value into the stack (with reference)
/// Pushes a string into the stack
/// Pushes a constant string into the stack
/// Pushes a retinfo into the stack
/// Pushes a copy of the target position into the stack
/// Removes the values in indexes [start,end[ from the stack.
/// Adjusts all stack pointers.
// nothing to pop
// free stack elements
// Note: This is necessary evern if we're also doing it in run_func
// (in the RETFUNC block) because not all functions return.  If a
// function (or a sub) has an 'end' or a 'close', it'll reach this
// block with its scope vars still to be freed.
// move the rest of the elements
// adjust stack pointers
///
///
///
/*==========================================
// destroy the storage construct containing the variables
/// Creates a new script state.
///
/// @param script Script code
/// @param pos Position in the code
/// @param rid Who is running the script (attached player)
/// @param oid Where the code is being run (npc 'object')
/// @return Script state
/// Frees a script state.
///
/// @param st Script state
// backup was not restored
//Current script is aborted.
/**
//
// Main execution unit
//
/*==========================================
/*==========================================
/// Ternary operators
/// test ? if_true : if_false
// "" -> false
// 0 -> false
/// Binary string operators
/// s1 EQ s2 -> i
/// s1 NE s2 -> i
/// s1 GT s2 -> i
/// s1 GE s2 -> i
/// s1 LT s2 -> i
/// s1 LE s2 -> i
/// s1 RE_EQ s2 -> i
/// s1 RE_NE s2 -> i
/// s1 ADD s2 -> s
// (max_capturing_groups+1)*3
// C_RE_NE
/// Binary number operators
/// i OP i -> i
//if( op == C_MOD )
// operators that can overflow/underflow
/// Binary operators
// automatic conversions
// convert int-string to string-string
// convert string-int to string-string
// ss => op_2str
// pop the two values before the top one
// don't free C_CONSTSTR
// ii => op_2num
// invalid argument
/// Unary operators
/// NEG i -> i
/// NOT i -> i
/// LNOT i -> i
// not a number
/// Checks the type of all arguments passed to a built-in function.
///
/// @param st Script state whose stack arguments should be inspected.
/// @param func Built-in function for which the arguments are intended.
// optional argument or unknown number of optional parameters ( no types are after this )
// more arguments than necessary ( should not happen, as it is checked before )
// get name for variables to determine the type they refer to
// variant
// string
// int ( params and constants are always int )
// variables
// label
/// Executes a buildin command.
/// Stack: C_NAME(<command>) C_ARG <arg0> <arg1> ... <argN>
// position after the last argument
// C_NAME of the command
//Report error
// Stack's datum are used when re-running functions [Eoe]
// return from a user-defined function
// pop distractions from the stack
// pop arguments and retinfo
/*==========================================
// TODO In jAthena, this function can take over the pending script in the player. [FlavioJS]
//      It is unclear how that can be triggered, so it needs the be traced/checked in more detail.
// NOTE At the time of this change, this function wasn't capable of taking over the script state because st->scriptroot was never set.
//dont even bother.
/*==========================================
//Character mismatch. Cancel execution.
/// Detaches script state from possibly attached character and restores it's previous script if any.
///
/// @param st Script state to detach.
/// @param dequeue_event Whether to schedule any queued events, when there was no previous script.
//Remove tag for removal.
// For the Secure NPC Timeout option (check config/Secure.h) [RR]
// We're done with this NPC session, so we cancel the timer (if existent) and move on
// rid was set to 0, before detaching the script state
/// Attaches script state to possibly attached character and backups it's previous script, if any.
///
/// @param st Script state to attach.
// there is already a backup
// load default.
/**
/*==========================================
// pop unused stack data. (unused return value)
// Skip string
//Restore previous script
//Delay execution
// Get sd since script might have attached someone while running. [Inkfish]
//Resume later (st is already attached to player).
//Report BOTH scripts to see if that can help somehow.
//Dispose of script.
//Restore previous stack and save char.
//Restore previous script if any.
/**
// import should overwrite any previous configuration, so it should be called last
/**
/// resets a temporary character array variable to given value
/* non-existent array, nothing to empty */
/// sets a temporary character array variable element idx to given value
/// @param refcache Pointer to an int variable, which keeps a copy of the reference to varname and must be initialized to 0. Can be NULL if only one element is set.
// save to avoid repeated script->add_str calls
/**
/* got no need for those! */
/**
/*==========================================
// number of buckets with a certain number of items
// minimun count of collision
// maximun count of collision
// Note: this will always result in <nr labels>/<nr buckets>
// ENABLE_CASE_CHECK
/**
/**
// No translations in minimal mode
/* 0 is default, which is whatever is in the npc files hardcoded (in our case, English) */
/**
// WIN32
// Skip slash
/**
// Empty ID (i.e. header) to be ignored
// Empty (untranslated) string to be ignored
// Missing context
//uint8 lang_id + msgstr_len + '\0'
/**
// Add string
// Continuation line
// Pop final '\0'
// New context, reset everything
// New id, reset string if any
// Add last string
/**
/**
/**
/**
/**
/*==========================================
// ENABLE_CASE_CHECK
/* returns name of current function being run, from within the stack [Ind/Hercules] */
/**
/*
// placeholder = "%%" ; (special case)
// placeholder = "%n" ; (ignored)
// std-placeholder = "%" [pos-parameter] [flags] [width] [precision] [length] type
// pos-parameter = number "$"
// flags = *("-" / "+" / "0" / SP)
// width = number / ("*" [pos-parameter])
// pos-parameter = number "$"
// precision = "." (number / ("*" [pos-parameter])) ; (not needed/implemented)
// length = "hh" / "h" / "l" / "ll" / "L" / "z" / "j" / "t" ; (not needed/implemented)
// type = "d" / "i" / "u" / "f" / "F" / "e" / "E" / "g" / "G" / "x" / "X" / "o" / "s" / "c" / "p" / "a" / "A"
// ignored if '+' is specified
// Piggyback printf
// Piggyback printf
// Piggyback printf
// Append the remaining part
//-----------------------------------------------------------------------------
// buildin functions
//
/////////////////////////////////////////////////////////////////////
// NPC interaction
//
/// Appends a message to the npc dialog.
/// If a dialog doesn't exist yet, one is created.
///
/// mes "<message>";
/**
/// Displays the button 'next' in the npc dialog.
/// The dialog text is cleared and the script continues when the button is pressed.
///
/// next;
/// Clears the NPC dialog and continues the script without press next button.
///
/// mesclear();
/// Ends the script and displays the button 'close' on the npc dialog.
/// The dialog is closed when the button is pressed.
///
/// close;
/// Displays the button 'close' on the npc dialog.
/// The dialog is closed and the script continues when the button is pressed.
///
/// close2;
/// Counts the number of valid and total number of options in 'str'
/// If max_count > 0 the counting stops when that valid option is reached
/// total is incremented for each option (NULL is supported)
// initial empty options
// count menu options
/// Displays a menu with options and goes to the target label.
/// The script is stopped if cancel is pressed.
/// Options with no text are not displayed in the client.
///
/// Options can be grouped together, separated by the character ':' in the text:
///   ex: menu "A:B:C",L_target;
/// All these options go to the specified target label.
///
/// The index of the selected option is put in the variable @menu.
/// Indexes start with 1 and are consistent with grouped and empty options.
///   ex: menu "A::B",-,"",L_Impossible,"C",-;
///       // displays "A", "B" and "C", corresponding to indexes 1, 3 and 5
///
/// NOTE: the client closes the npc dialog when cancel is pressed
///
/// menu "<option_text>",<target_label>{,"<option_text>",<target_label>,...};
// TODO detect multiple scripts waiting for input at the same time, and what to do when that happens
// argument count is not even (1st argument is at index 2)
// target label
// menu options
// not a label
// append option(s)
// empty string, ignore
/* menus beyond this length crash the client (see bugreport:6402) */
// client supports only up to 254 entries; 0 is not used and 255 is reserved for cancel; excess entries are displayed but cause 'uint8' overflow
// Cancel was pressed
// goto target label
// get target label
// entry found
// Invalid selection
// TODO remove this temporary crash-prevention code (fallback for multiple scripts requesting user input)
/// Displays a menu with options and returns the selected option.
/// Behaves like 'menu' without the target labels.
///
/// select(<option_text>{,<option_text>,...}) -> <selected_option>
///
/// @see menu
/* menus beyond this length crash the client (see bugreport:6402) */
// Cancel was pressed
// XXX: we should really be pushing -1 instead
// return selected option
// entry found
// TODO: throw a deprecation warning for scripts using @menu
/////////////////////////////////////////////////////////////////////
// ...
//
/// Jumps to the target script label.
///
/// goto <label>;
/*==========================================
// TODO: Can this happen? when?
// TODO: Can this happen? when?
// script code
// scope variables
// scope arrays
// script location
// argument count
// default stack pointer
/*==========================================
// TODO: Can this happen? when?
// script code
// scope variables
// scope arrays
// script location
// argument count
// default stack pointer
/// Retrieves an argument provided to callfunc/callsub.
/// If the argument doesn't exist
///
/// getarg(<index>{,<default_value>}) -> <value>
/// Returns from the current function, optionaly returning a value from the functions.
/// Don't use outside script functions.
///
/// return;
/// return <value>;
// Incorrect usage of return outside the scope of a function or subroutine.
// No need for further processing, running script is about to be aborted.
// return value
// scope variable
// current scope, convert to value
// Reference to the parent scope, remove reference pointer
// npc variable
// npc variable without a reference set, link to current script
// Reference to the parent scope's script, remove reference pointer.
// no return value
/// Returns a random number from 0 to <range>-1.
/// Or returns a random number from <min> to <max>.
/// If <min> is greater than <max>, their numbers are switched.
/// rand(<range>) -> <int>
/// rand(<min>,<max>) -> <int>
// min,max
// range
/*==========================================
/*==========================================
// choose a suitable max number of attempts
// find a suitable map cell
// Warp area to area
// normalize x3/y3 coordinates
/*==========================================
/*==========================================
/**
/**
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*
// first invocation, display npc input box
// take received text/value and store it in the designated variable
// declare the copyarray method here for future reference
/// Sets the value of a variable.
/// The value is converted to the type of the variable.
///
/// set(<variable>,<value>) -> <variable>
//struct script_data* datavalue;
//datavalue = script_getdata(st,3);
// TODO: see de43fa0f73be01080bd11c08adbfb7c158324c81
// the value being referenced is a variable
// array variable being copied into another array variable
// player must be attached in order to copy a player variable
// non-matching array value types
// push the maximum number of array values to the stack
// call the copy array method directly
// Optional argument used by post-increment/post-decrement constructs to return the previous value
// return a copy of the variable reference
/////////////////////////////////////////////////////////////////////
/// Array variables
///
/// Sets values of an array, from the starting index.
/// ex: setarray arr[1],1,2,3;
///
/// setarray <array variable>,<value1>{,<value2>...};
// not a variable
// no player attached
// string array
// int array
/// Sets count values of an array, from the starting index.
/// ex: cleararray arr[0],0,1;
///
/// cleararray <array variable>,<value>,<count>;
// not a variable
// no player attached
/// Copies data from one array to another.
/// ex: copyarray arr[0],arr[2],2;
///
/// copyarray <destination array variable>,<source array variable>,<count>;
// not a variable
// data type mismatch
// no player attached
// nothing to copy
// destination might be overlapping the source - copy in reverse order
// normal copy
// out of range - assume ""/0
/// Returns the size of the array.
/// Assumes that everything before the starting index exists.
/// ex: getarraysize(arr[3])
///
/// getarraysize(<array variable>) -> <int>
// not a variable
// FIXME: Is the unsigned difference really intended here?
// not a variable
/// Deletes count or all the elements in an array, from the starting index.
/// ex: deletearray arr[4],2;
///
/// deletearray <array variable>;
/// deletearray <array variable>,<count>;
// not a variable
// no player attached
// not a variable
/* non-existent array, nothing to empty */
// not a variable
// nothing to free
// nothing to free
// Better to iterate directly on the array, no speed-up from using sa
// Compact and overwrite
// Clean up any leftovers that weren't overwritten
// using sa to speed up
// Clear any entries between start and start+count, if they exist
// Move back count positions any entries between start+count to fill the gaps
// Clear their originals
// Less expensive than sorting it, most likely
/// Returns a reference to the target index of the array variable.
/// Equivalent to var[index].
///
/// getelementofarray(<array variable>,<index>) -> <variable reference>
// not a variable
// out of range
/////////////////////////////////////////////////////////////////////
/// ...
///
/*==========================================
// As setlook but only client side
/*==========================================
/*==========================================
/*==========================================
// item name
// item id
// returns string, regardless of what it was
/*==========================================
// item name
// item id
// returns string, regardless of what it was
/*==========================================
// Character name was given
// Character ID was given
// Use RID by default if no name was provided
// Player not attached
// Get item from DB via item name
// Get item from DB via item ID
// returns string, regardless of what it was
/*==========================================
//nb of empty slot
// item name
// item id
// returns string, regardless of what it was
//total weight for all chk
// too heavy
// item is already in inventory, but there is still space for the requested amount
// stackable
// non-stackable
//variable sub checkweight
//variable for array parsing
//array size
// not a variable
// not supported
//cpntonie to depop rest
// item is already in inventory, but there is still space for the requested amount
// stackable
// non-stackable
//end switch
//end loop DO NOT break it prematurly we need to depop all stack
/*==========================================
// "<item name>"
//No item created.
// <item id>
//Violet Box, Blue Box, etc - random item pick
//No item created.
// <amount>
//return if amount <=0, skip the useles iteration
//Not a correct bound type
// <Account ID>
// Attached player
// no target
//Check if it's stackable.
// if not pet egg
/*==========================================
//Not a correct bound type
// <Account ID>
// Attached player
// no target
// Invalide nameid
//Check if it's stackable.
// if not pet egg
/*==========================================
/*==========================================
// Player not attached!
//Failed
/* || itemdb->isstackable(nameid)*/) {
//Even though named stackable items "could" be risky, they are required for certain quests.
//Char Name
//Char Id was given
//Failed
//we don't use 255! because for example SIGNED WEAPON shouldn't get TOP10 BS Fame bonus [Lupus]
//Failed to add item, we will not drop if they don't fit
/*==========================================
/*==========================================
//No item created.
//Failed...
/*==========================================
// pick random position on map
// Locate spot next to player.
// if equip or weapon or egg type only drop one.
/// Counts / deletes the current item given by idx.
/// Used by buildin_delitem_search
/// Relies on all input data being already fully valid.
// delete associated pet
/// Searches for item(s) and checks, if there is enough of them.
/// Used by delitem and delitem2
/// Relies on all input data being already fully valid.
/// @param exact_match will also match item attributes and cards, not just name id
/// @return true when all items could be deleted, false when there were not enough items to delete
// prefer always non-equipped items
// when searching for nameid only, prefer additionally
// non-refined items
// card-less items
// 1st pass -- less important items / exact match
// wrong/invalid item
// not matching attributes
// not matching exact attributes
// pet which cannot be deleted
// named/carded item
// count / delete item
// 2nd pass -- any matching item
// either everything was already consumed or no items were skipped
// wrong/invalid item
// pet which cannot be deleted
// not matching attributes
// count / delete item
// not enough items
// we are done with the work
// get rid of the items now
/// Deletes items from the target/attached player.
/// Prioritizes ordinary items.
///
/// delitem <item id>,<amount>{,<account id>}
/// delitem "<item name>",<amount>{,<account id>}
// <account id>
// attached player
// "<item name>"
// <item id>
// nothing to do
// success
/// Deletes items from the target/attached player.
///
/// delitem2 <item id>,<amount>,<identify>,<refine>,<attribute>,<card1>,<card2>,<card3>,<card4>{,<account ID>}
/// delitem2 "<Item name>",<amount>,<identify>,<refine>,<attribute>,<card1>,<card2>,<card3>,<card4>{,<account ID>}
// <account id>
// attached player
// "<item name>"
// <item id>
// nothing to do
// success
/**
/*==========================================
/*==========================================
/*==========================================
//return 0, according docs
/*==========================================
// Deprecate old form - getnpcid(<type>{, <"npc name">})
/*==========================================
/*==========================================
/*==========================================
//Search leader
//leader not found
// guild does not exist
/*==========================================
/*==========================================
/*==========================================
/**
/*==========================================
/*==========================================
// display name
// visible part of display name
// Return the name, there is no '#' present
// # fragment
// unique name
// map name
// Only valid map indexes allowed (issue:8034)
/**
/*==========================================
// get inventory position of item
/*==========================================
// get inventory position of item
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/**
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
//Logs items, got from (N)PC scripts [Lupus]
// status calc will happen in pc->equipitem() below
//Logs items, got from (N)PC scripts [Lupus]
// Achievements [Smokexyz/Hercules]
/* The following check is exclusive to characters (possibly only whitesmiths)
// Fame point system [DracoRPG]
// Success to refine to +10 a lv1 weapon you forged = +1 fame point
// Success to refine to +10 a lv2 weapon you forged = +25 fame point
// Success to refine to +10 a lv3 weapon you forged = +1000 fame point
/*==========================================
// Call before changing refine to 0.
//recalculate bonus
//notify client of failure
// display failure effect
/*==========================================
//Logs items, got from (N)PC scripts [Lupus]
// status calc will happen in pc->equipitem() below
//Logs items, got from (N)PC scripts [Lupus]
// Achievements [Smokexyz/Hercules]
/*==========================================
//recalculate bonus
/*==========================================
/*==========================================
/*==========================================
/// See 'doc/item_bonus.txt'
///
/// bonus <bonus type>,<val1>;
/// bonus2 <bonus type>,<val1>,<val2>;
/// bonus3 <bonus type>,<val1>,<val2>,<val3>;
/// bonus4 <bonus type>,<val1>,<val2>,<val3>,<val4>;
/// bonus5 <bonus type>,<val1>,<val2>,<val3>,<val4>,<val5>;
// no player attached
// these bonuses support skill names
// 2nd value can be skill name
// 2nd value can be skill name
// no player attached
// no player attached
// no player attached
/// Changes the level of a player skill.
/// <flag> defaults to 1
/// <flag>=0 : set the level of the skill
/// <flag>=1 : set the temporary level of the skill
/// <flag>=2 : add to the level of the skill
///
/// skill <skill id>,<level>,<flag>
/// skill <skill id>,<level>
/// skill "<skill name>",<level>,<flag>
/// skill "<skill name>",<level>
// no player attached, report source
/// Changes the level of a player skill.
/// like skill, but <flag> defaults to 2
///
/// addtoskill <skill id>,<amount>,<flag>
/// addtoskill <skill id>,<amount>
/// addtoskill "<skill name>",<amount>,<flag>
/// addtoskill "<skill name>",<amount>
///
/// @see skill
// no player attached, report source
/// Increases the level of a guild skill.
///
/// guildskill <skill id>,<amount>;
/// guildskill "<skill name>",<amount>;
// no player attached, report source
// not guild skill
/// Returns the level of the player skill.
///
/// getskilllv(<skill id>) -> <level>
/// getskilllv("<skill name>") -> <level>
// no player attached, report source
/// Returns the level of the guild skill.
///
/// getgdskilllv(<guild id>,<skill id>) -> <level>
/// getgdskilllv(<guild id>,"<skill name>") -> <level>
/// Returns the 'basic_skill_check' setting.
/// This config determines if the server checks the skill level of NV_BASIC
/// before allowing the basic actions.
///
/// basicskillcheck() -> <bool>
/// Returns the GM level of the player.
///
/// getgmlevel() -> <level>
// no player attached, report source
/// set the group ID of the player.
/// setgroupid(<new group id>{,"<character name>"|<account id>})
/// return 1 on success, 0 if failed.
// no player attached, report source
/// Returns the group ID of the player.
///
/// getgroupid({<account id>}) -> <int>
// no player attached, report source
/// Terminates the execution of this script instance.
///
/// end
/* are we stopping inside a function? */
/* grab the first, aka the original */
/// Checks if the player has that effect state (option).
///
/// checkoption(<option>) -> <bool>
// no player attached, report source
/// Checks if the player is in that body state (opt1).
///
/// checkoption1(<opt1>) -> <bool>
// no player attached, report source
/// Checks if the player has that health state (opt2).
///
/// checkoption2(<opt2>) -> <bool>
// no player attached, report source
/// Changes the effect state (option) of the player.
/// <flag> defaults to 1
/// <flag>=0 : removes the option
/// <flag>=other : adds the option
///
/// setoption <option>,<flag>;
/// setoption <option>;
// no player attached, report source
// Request to remove everything.
// Add option
// Do not show the wedding sprites
// Remove option
/// Returns if the player has a cart.
///
/// checkcart() -> <bool>
///
/// @author Valaris
// no player attached, report source
/// Sets the cart of the player.
/// <type> defaults to 1
/// <type>=0 : removes the cart
/// <type>=1 : Normal cart
/// <type>=2 : Wooden cart
/// <type>=3 : Covered cart with flowers and ferns
/// <type>=4 : Wooden cart with a Panda doll on the back
/// <type>=5 : Normal cart with bigger wheels, a roof and a banner on the back
///
/// setcart <type>;
/// setcart;
// no player attached, report source
/// Returns if the player has a falcon.
///
/// checkfalcon() -> <bool>
///
/// @author Valaris
// no player attached, report source
/// Sets if the player has a falcon or not.
/// <flag> defaults to 1
///
/// setfalcon <flag>;
/// setfalcon;
// no player attached, report source
/**
// no player attached, report source
// if (pc_isridingdragon(sd))
/**
// no player attached, report source
// Color variants for Rune Knight dragon mounts.
// Sanity checks and auto-detection
// Rune Knight (Dragon)
// default value
// Ranger (Warg)
// Mechanic (Mado Gear)
// Knight / Crusader (Peco Peco)
/// Returns if the player has a warg.
///
/// checkwug() -> <bool>
///
// no player attached, report source
/// Sets the save point of the player.
///
/// save "<map name>",<x>,<y>
/// savepoint "<map name>",<x>,<y>
// no player attached, report source
/*==========================================
/* Asgard Version */
//type 2:(Get the number of seconds elapsed since 00:00 hours, Jan 1, 1970 UTC
//        from the system clock.)
//type 1:(Second Ticks: 0-86399, 00:00:00-23:59:59)
//type 0:(System Ticks)
// TODO: change this to int64 when we'll support 64 bit script values
/*==========================================
/* Asgard Version */
//Sec(0~59)
//Min(0~59)
//Hour(0~23)
//WeekDay(0~6)
//MonthDay(01~31)
//Month(01~12)
//Year(20xx)
//Year Day(01~366)
//(format error)
/*
/*==========================================
// Mapflag preventing from openstorage here
// success flag.
// Mapflag preventing from openstorage here
/*==========================================
/// itemskill <skill id>,<level>{,flag
/// itemskill "<skill name>",<level>{,flag
/* temporarily disabled, awaiting for kenpachi to detail this so we can make it work properly */
/*==========================================
/*==========================================
/*==========================================
/*==========================================
// bonus for npc-given exp
/*==========================================
/*==========================================
/*==========================================
// Try to redirect to the instance map, not the src map
/*==========================================
/*==========================================
// Try to redirect to the instance map, not the src map
/*==========================================
//same fix but with killmonster instead - stripping events from mobs.
//Strips the event from the mob if it's killed the old method.
/*==========================================
//Return ID of newly crafted clone.
//Failed to create clone.
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
// get number of timers
// get the number of tick before the next timer runs
// get the number of ticks before the last timer runs
// type mismatch => skip
// player variable but no player attached
// for faster lookup we try to reduce the scope of the search if possible
// fallback to global lookup (slowest option)
/*==========================================
//Two arguments: NPC name and attach flag.
//Check if argument is numeric (flag) or string (npc name)
// dereference if it's a variable
//NPC name
//Flag
//Attach
/*==========================================
//Two arguments: NPC name and attach flag.
//Check if argument is numeric (flag) or string (npc name)
// dereference if it's a variable
//NPC name
//Flag
//Attach
/*==========================================
//Two arguments: NPC name and attach flag.
//Check if argument is numeric (flag) or string (npc name)
// Dereference if it's a variable
//NPC name
//Flag
//Detach
/*==========================================
// FIXME: change this to int64 when we'll support 64 bit script values
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
// default fontType (FW_NORMAL)
// default fontSize
// default fontAlign
// default fontY
// Broadcast source or broadcast region defined
// If bc_npc flag is set, use NPC as broadcast source
// BC_ALL
/*==========================================
/* Runs item effect on attached character.
// default fontType (FW_NORMAL)
// default fontSize
// default fontAlign
// default fontY
/*==========================================
// default fontType (FW_NORMAL)
// default fontSize
// default fontAlign
// default fontY
/*==========================================
// npc
// pc
/*==========================================
/*disp_num=1,*/ group_level = 0;
// skip hidden sessions
/* Temporary fix for bugreport:1023.
/*==========================================
// map id on this server (m == -1 if not in actual map-server)
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/* Starts a status effect on the target unit or on the attached player.
//If from NPC we make default flag SCFLAG_NOAVOID to be unavoidable
// When there isn't a duration specified, try to get it from the skill_db
//skill.c set the flags before running the script, this is a potion-pitched effect.
// Thrown potions only last half.
// Mark that this was a thrown sc_effect
/// Ends one or all status effects on the target unit or on the attached player.
///
/// sc_end <effect_id>{,<unit_id>};
//##TODO how does this work [FlavioJS]
/* status that can't be individually removed (TODO sc_config option?) */
//This should help status_change_end force disabling the SC in case it has no limit.
// SC_BERSERK requires skill_lv that's stored in sce->val1 when being removed [KirieZ]
// remove all effects
/*==========================================
//get for the bl assigned
/*==========================================
// no player attached
// invalid status type given
// no status is active
// return the amount of time remaining
// TODO: change this to int64 when we'll support 64 bit script values
/*==========================================
/*==========================================
/*==========================================
/*==========================================
// Remove morph state.
// Respawn homunculus.
/*==========================================
/*==========================================
// [Zephyrus]
//These two functions bring the eA MAPID_* class functionality to scripts.
//Just use male when not found.
/*==========================================
// do not send egg list, when you already have a pet
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
//Do not show the wedding sprites
//Baby classes screw up when showing wedding sprites. [Skotlex] They don't seem to anymore.
//Updated client view. Base, Weapon and Cloth Colors.
// to avoid any problem with equipment and invalid sex, equipment is unequiped.
/*==========================================
/*==========================================
/*==========================================
//  npc name to display
//use current npc name
// broadcast to all players connected
/////////////////////////////////////////////////////////////////////
// NPC waiting room (chat room)
//
/// Creates a waiting room (chat room) for this npc.
///
/// waitingroom "<title>",<limit>{,"<event>"{,<trigger>{,<zeny>{,<minlvl>{,<maxlvl>}}}}};
/// Removes the waiting room of the current or target npc.
///
/// delwaitingroom "<npc_name>";
/// delwaitingroom;
/// Kicks all the players from the waiting room of the current or target npc.
///
/// kickwaitingroomall "<npc_name>";
/// kickwaitingroomall;
/// Enables the waiting room event of the current or target npc.
///
/// enablewaitingroomevent "<npc_name>";
/// enablewaitingroomevent;
/// Disables the waiting room event of the current or target npc.
///
/// disablewaitingroomevent "<npc_name>";
/// disablewaitingroomevent;
/// Returns info on the waiting room of the current or target npc.
/// Returns -1 if the type unknown
/// <type>=0 : current number of users
/// <type>=1 : maximum number of users allowed
/// <type>=2 : the number of users that trigger the event
/// <type>=3 : if the trigger is disabled
/// <type>=4 : the title of the waiting room
/// <type>=5 : the password of the waiting room
/// <type>=16 : the name of the waiting room event
/// <type>=32 : if the waiting room is full
/// <type>=33 : if there are enough users to trigger the event
/// -- Custom Added
/// <type>=34 : minimum player of waiting room
/// <type>=35 : maximum player of waiting room
/// <type>=36 : minimum zeny required
///
/// getwaitingroomstate(<type>,"<npc_name>") -> <info>
/// getwaitingroomstate(<type>) -> <info>
/// Warps the trigger or target amount of players to the target map and position.
/// Players are automatically removed from the waiting room.
/// Those waiting the longest will get warped first.
/// The target map can be "Random" for a random position in the current map,
/// and "SavePoint" for the savepoint map+position.
/// The map flag noteleport of the current map is only considered when teleporting to the savepoint.
///
/// The id's of the teleported players are put into the array $@warpwaitingpc[]
/// The total number of teleported players is put into $@warpwaitingpcnum
///
/// warpwaitingpc "<map name>",<x>,<y>,<number of players>;
/// warpwaitingpc "<map name>",<x>,<y>;
// can't teleport on this map
// fee set
// no zeny to cover set fee
/////////////////////////////////////////////////////////////////////
// ...
//
/// Detaches a character from a script.
///
/// @param st Script state to detach the character from.
/*==========================================
/*==========================================
/*==========================================
/*==========================================
// here we don't throw an error, so the command can be used
// to detect whether or not a map exists
/* pvp timer handling */
// nothing to do
// disable ranking functions if pk_mode is on [Valaris]
// not applicable
//fixed Lupus
// disable ranking options if pk_mode is on [Valaris]
/*==========================================
//Optional second parameter added by [Skotlex]
//Warp out owners
//Warp out outsiders
// Warp out players not in guild [Valaris]
//Catch ALL players (in case some are 'between maps' on execution time)
//Remove script mobs.
// Agit already Start.
// Agit already End.
// Agit2 already Start.
// Agit2 already End.
/*==========================================
/*==========================================
/// Sets the guild_id of this npc.
///
/// flagemblem <guild_id>;
/* guild flag caching */
/* adding a id */
/* removing a flag */
/* =====================================================================
/// Returns the number of cards that have been compounded onto the specified equipped item.
/// getequipcardcnt(<equipment slot>);
/// Removes all cards from the item found in the specified equipment slot of the invoking character,
/// and give them to the character. If any cards were removed in this manner, it will also show a success effect.
/// successremovecards(<slot>);
/// Removes all cards from the item found in the specified equipment slot of the invoking character.
/// failedremovecards(<slot>, <type>);
/// <type>=0 : will destroy both the item and the cards.
/// <type>=1 : will keep the item, but destroy the cards.
/// <type>=2 : will keep the cards, but destroy the item.
/// <type>=3 : will just display the failure effect.
// add cards to inventory, clear
// destroy the item
/* ================================================================
// Added by RoVeRT
// Added by RoVeRT
// Added by RoVeRT
//bl=map->id2bl(st->oid);
/*================================================
//requested a string
/*==========================================
// "<event label>",<guardian index>
// Dereference if it's a variable
// "<event label>"
// <guardian index>
/*==========================================
// Invalid Map
/// Retrieves various information about the specified guardian.
///
/// guardianinfo("<map_name>", <index>, <type>) -> <value>
/// type: 0 - whether it is deployed or not
///       1 - maximum hp
///       2 - current hp
///
/*==========================================
/*==========================================
// TODO: add matk here if needed
/*==========================================
/**
/**
/**
// Remove the option
/* Add Option Index */
/* Add Option Value */
/* Unequip and simulate deletion of the item. */
// status calc will happen in pc->equipitem() below
// notify client of a refine.
// notify client to simulate item deletion.
/* Log deletion of the item. */
/* Equip and simulate addition of the item. */
// notify client to simulate item addition.
/* Log addition of the item. */
// force equip the item at the original position.
// show effect
/*==========================================
// TODO: Validate data in a similar way as during database load
/*==========================================
/*==========================================
//Clear previous bonus
//init
// waiting state
// wait for timer to start
/*==========================================
//Let'em loot at least 1 item.
//Release whatever was there already and reallocate memory
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
/*==========================================
// specified part of map
// entire map
// entire server
/*==========================================
/*==========================================
//FIXME: enumerating map squares (map->foreach) is slower than enumerating the list of online players (map->foreachpc?) [ultramage]
// area around
// entire map
// specified part of map
/*==========================================
//Halt previous bonus
//Init
/*==========================================
/// petskillattack <skill id>,<level>,<div>,<rate>,<bonusrate>
/// petskillattack "<skill name>",<level>,<div>,<rate>,<bonusrate>
/*==========================================
/// petskillsupport <skill id>,<level>,<delay>,<hp>,<sp>
/// petskillsupport "<skill name>",<level>,<delay>,<hp>,<sp>
//Clear previous skill
//init memory
//Use delay as initial offset to avoid skill/heal exploits
/*==========================================
/// skilleffect <skill id>,<level>
/// skilleffect "<skill name>",<level>
/* ensure we're standing because the following packet causes the client to virtually set the char to stand,
/*==========================================
/// npcskilleffect <skill id>,<level>,<x>,<y>
/// npcskilleffect "<skill name>",<level>,<x>,<y>
/*==========================================
/*==========================================
/*==========================================
/*==========================================
//Use a dummy character.
/**
/*==========================================
/*
/*==========================================
/*
/*==========================================
/*==========================================
/*==========================================
/*==========================================
// discard extra name identifier if present
// change npc walkspeed [Valaris]
// ensure nd->ud is safe to edit
// make an npc walk to a position [Valaris]
// ensure nd->ud is safe to edit
// stop an npc's movement [Valaris]
// ensure nd->ud is safe to edit
// set click npc distance [4144]
// return current npc direction [4144]
// set npc direction [4144]
// return npc class [4144]
/*==========================================
//1
//2
//3
//4
//5
//6
//7
//8
//9
//12
//13
/*==========================================
/*==========================================
// Possible needly check function parameters on C_STR,C_INT,C_INT
//Get Character Position
//Get NPC Position
//In case the origin is not an npc?
//Get Pet Position
//Get Mob Position
//Get Homun Position
//Get Mercenary Position
//Get Elemental Position
//No object found.
//Set MapName$
//Set MapX
//Set MapY
//Return Success value
/*==========================================
//Now it is ready for spawning.
/*==========================================
/*================================================
//No card. Count amount in inventory.
//Count cards.
//No cards
//[Lupus]
/*================================================
//Original hash to reverse it when full check fails.
//Cards
//New hash system which should support up to 4 slots on any equipment. [Skotlex]
// check if card is already used by another set
// We have found a match
// Set hash so this card cannot be used by another
//Card found
//When check fails, restore original hash values. [Skotlex]
/*================================================
//we get CURRENT WEAPON inventory index from status.c [Lupus]
// script_pushint(st,status->current_equip_item_index);
/*=======================================================
/*=======================================================
//=======================================================
// Unequip [Spectre]
//-------------------------------------------------------
/*=======================================================
// HACK: Retrieve number as string (auto-converted) for battle_set_value
//=======================================================
// strlen [Valaris]
//-------------------------------------------------------
//=======================================================
// isalpha [Valaris]
//-------------------------------------------------------
//=======================================================
// charisupper <str>, <index>
//-------------------------------------------------------
//=======================================================
// charislower <str>, <index>
//-------------------------------------------------------
//=======================================================
// charat <str>, <index>
//-------------------------------------------------------
//=======================================================
// isstr <argument>
//
// returns type:
// 0 - int
// 1 - string
// 2 - other
//-------------------------------------------------------
// we don't start at 1, to leave room for primitives
// fallback to primitive type if unknown
// nothing was passed
// XXX: because all we have is the label pos we can't be sure which
//      one is the correct label if more than one has the same pos.
//      We might want to store both the pos and str_data index in
//      data->u.num, similar to how C_NAME stores both the array
//      index and str_data index in u.num with bitmasking. This
//      would also avoid the awkward for() loops as we could
//      directly access the string with script->get_str().
// NIL
//=======================================================
// chr <int>
//-------------------------------------------------------
//=======================================================
// ord <chr>
//-------------------------------------------------------
//=======================================================
// setchar <string>, <char>, <index>
//-------------------------------------------------------
//=======================================================
// insertchar <string>, <char>, <index>
//-------------------------------------------------------
//=======================================================
// delchar <string>, <index>
//-------------------------------------------------------
//return original
//=======================================================
// strtoupper <str>
//-------------------------------------------------------
//=======================================================
// strtolower <str>
//-------------------------------------------------------
//=======================================================
// substr <str>, <start>, <end>
//-------------------------------------------------------
//=======================================================
// explode <dest_string_array>, <str>, <delimiter>
// Note: delimiter is limited to 1 char
//-------------------------------------------------------
// not a variable
// data type mismatch
// no player attached
// FIXME[Haru]: SCRIPT_MAX_ARRAYSIZE should really be unsigned (and INT32_MAX)
//break at delimiter but ignore after reaching last array index
//set last string
//=======================================================
// implode <string_array>
// implode <string_array>, <glue>
//-------------------------------------------------------
// not a variable
// data type mismatch
// no player attached
//count chars
//empty array check (AmsTaff)
//allocate mem
//build output
//=======================================================
// sprintf(<format>, ...);
// Implements C sprintf, except format %n. The resulting string is
// returned, instead of being saved in variable by reference.
//-------------------------------------------------------
//=======================================================
// sscanf(<str>, <format>, ...);
// Implements C sscanf.
//-------------------------------------------------------
// Get data
// If the source string is empty but the format string is not, we return -1
// according to the C specs. (if the format string is also empty, we shall
// continue and return 0: 0 conversions took place out of the 0 attempted.)
// Issue sscanf for each parameter
// Skip
// EOS
// Validate output
// Save value if any
// String
// Number
// Disable used format (%... -> %*...)
//=======================================================
// strpos(<haystack>, <needle>)
// strpos(<haystack>, <needle>, <offset>)
//
// Implements PHP style strpos. Adapted from code from
// http://www.daniweb.com/code/snippet313.html, Dave Sinkula
//-------------------------------------------------------
// matched starting char -- loop through remaining chars
// matched all of 'needle' to null termination
//===============================================================
// replacestr <input>, <search>, <replace>{, <usecase>{, <count>}}
//
// Note: Finds all instances of <search> in <input> and replaces
// with <replace>. If specified will only replace as many
// instances as specified in <count>. By default will be case
// sensitive.
//---------------------------------------------------------------
//found enough, stop looking
//complete match
//append excess after enough found
//========================================================
// countstr <input>, <search>{, <usecase>}
//
// Note: Counts the number of times <search> occurs in
// <input>. By default will be case sensitive.
//--------------------------------------------------------
//complete match
/// Changes the display name and/or display class of the npc.
/// Returns 0 is successful, 1 if the npc does not exist.
///
/// setnpcdisplay("<npc name>", "<new display name>", <new class id>, <new size>) -> <int>
/// setnpcdisplay("<npc name>", "<new display name>", <new class id>) -> <int>
/// setnpcdisplay("<npc name>", "<new display name>") -> <int>
/// setnpcdisplay("<npc name>", <new class id>) -> <int>
// not found
// update npc
// Required to update the visual size
// case-insensitive substring search [lordalfa]
// List of mathematics commands --->
//[zBuffer]
//[zBuffer]
//[zBuffer]
// <--- List of mathematics commands
// avoid print error message twice
// avoid print error message twice
// [zBuffer] List of dynamic var commands --->
// maximum number of rows
// check target variables
// it's a variable
// requires a player
// no player attached
// Execute the query
// No data received
// Count the number of columns to store
// Store data
// Free data
// logs->mysql_handle == NULL
//Allows escaping of a given string.
// variable
// param
// constant
// Push the 'pointer' so it's more flexible [Lance]
// <--- [zBuffer] List of dynamic var commands
// Pet stat [Lance]
// flag the user as using a valid script call for opening the shop (for floating NPCs)
//Buy window
//Sell window
//Show menu
//Not found.
// get the count of new entries
// generate new shop item list
//Not found.
// get the count of new entries
// append new items to existing shop item list
//Not found.
// remove specified items from the shop item list
//Sets a script to attach to a shop npc.
//Not found.
/*==========================================
/*=======================================================
// Item ID found
// First empty slot
// If the item ID was found, prefer it
// Fill in the slot with the item and rate
//No place to put the new drop
/*=======================================================
// No drop on that monster
/*==========================================
//requested a string
//wrong Index
// check vending [Nab4]
// check chatting [Marka]
// TODO: change this to int64 when we'll support 64 bit script values
// not a variable
// no player attached
// string array
// not supported
// Set array
// [zBuffer] List of player cont commands --->
// <--- [zBuffer] List of player cont commands
// [zBuffer] List of mob control commands --->
//## TODO always return if the request/whatever was successfull [FlavioJS]
/**
/* type bounds */
// Note: UDT_TYPE is not valid here
/* Mandatory Argument 3. Subject to deprecate. */
/* checks if value is out of bounds. */
/* checks if value is out of bounds. */
/* checks if the argument doesn't exist, if required.
/* checks if the data is an integer. */
/* checks if the data is a string. */
// Send update to client.
/* Set the values */
// send homun data
// send pet data
// end of bl->type switch
/**
/* Type check */
/* Argument checks. Subject to deprecate */
// no player attached
// end of bl->type switch
/**
/**
// Send update to client.
// Send update to client.
/// Makes the unit walk to target position or target id
/// Returns if it was successfull
///
/// unitwalk(<unit_id>,<x>,<y>) -> <bool>
/// unitwalk(<unit_id>,<target_id>) -> <bool>
// ensure the ((struct npc_data*)bl)->ud is safe to edit
// We'll use harder calculations.
/// Kills the unit
///
/// unitkill <unit_id>;
/// Warps the unit to the target position in the target map
/// Returns if it was successfull
///
/// unitwarp(<unit_id>,"<map name>",<x>,<y>) -> <bool>
//Warp the script's runner
// ensure ((struct npc_data *)bl)->ud is safe to edit
/// Makes the unit attack the target.
/// If the unit is a player and <action type> is not 0, it does a continuous
/// attack instead of a single attack.
/// Returns if the request was successfull.
///
/// unitattack(<unit_id>,"<target name>"{,<action type>}) -> <bool>
/// unitattack(<unit_id>,<target_id>{,<action type>}) -> <bool>
// get unit
// request the attack
// get actiontype
/// Makes the unit stop attacking and moving
///
/// unitstop <unit_id>;
// ensure ((struct npc_data *)bl)->ud is safe to edit
/// Makes the unit say the message
///
/// unittalk(<unit_id>,"<message>"{, show_name{, <send_target>{, <target_id>}}});
/// Makes the unit do an emotion
///
/// unitemote <unit_id>,<emotion>;
///
/// @see e_* in const.txt
/// Makes the unit cast the skill on the target or self if no target is specified
///
/// unitskilluseid <unit_id>,<skill_id>,<skill_lv>{,<target_id>};
/// unitskilluseid <unit_id>,"<skill name>",<skill_lv>{,<target_id>};
/// Makes the unit cast the skill on the target position.
///
/// unitskillusepos <unit_id>,<skill_id>,<skill_lv>,<target_x>,<target_y>;
/// unitskillusepos <unit_id>,"<skill name>",<skill_lv>,<target_x>,<target_y>;
// <--- [zBuffer] List of mob control commands
/// Pauses the execution of the script, detaching the player
///
/// sleep <mili seconds>;
// detach the player
// do nothing
// sleep for the target amount of time
// sleep time is over
/// Pauses the execution of the script, keeping the player attached
/// Returns if a player is still attached
///
/// sleep2(<mili secconds>) -> <bool>
// do nothing
// sleep for the target amount of time
// sleep time is over
/// Awakes all the sleep timers of the target npc
///
/// awake "<npc name>";
// already awake ???
// char not online anymore / another char of the same account is online - Cancel execution
/// Returns a reference to a variable of the target NPC.
/// Returns 0 if an error occurs.
///
/// getvariableofnpc(<variable>, "<npc name>") -> <reference>
// Not a reference (aka varaible name)
// not a npc variable
// NPC not found or has no script
// player not found, return default value
/// Opens a warp portal.
/// Has no "portal opening" effect/sound, it opens the portal immediately.
///
/// warpportal <source x>,<source y>,"<target map>",<target x>,<target y>;
///
/// @author blackhole89
// map not found
// ensure nd->ud is safe to edit
// failed
/// Retrieves the value of the specified flag of the specified cell.
///
/// checkcell("<map name>",<x>,<y>,<type>) -> <bool>
///
/// @see cell_chk* constants in const.txt for the types
/// Modifies flags of cells in the specified area.
///
/// setcell "<map name>",<x1>,<y1>,<x2>,<y2>,<type>,<flag>;
///
/// @see cell_* constants in const.txt for the types
/*==========================================
// Invalid Guild
// Invalid Guild
/*------------------------------------------
/****************************
// "Fix" returned quest state value to make more sense.
// 0 = Not Started, 1 = In Progress, 2 = Completed.
// Not found
/*==========================================
/**
// convert to array index.
/*==========================================
// Invalid Map
// Logout Event
// Die Event
// Creation failed
// This is always < MAX_CHAT_USERS
// Invalid Map
// Invalid Map
// TODO: Why does this not use map->id2md?
/*==========================================
// Already exists
// No free instances
// Invalid type
// Unknown
// [Saithis]
// default fontType (FW_NORMAL)
// default fontSize
// default fontAlign
// default fontY
/*==========================================
// Amount of needed Partymembers for the Instance.
// Minimum Level needed to join the Instance.
// Maxium Level allowed to join the Instance.
// Returns false if party does not exist.
// Not enough Members in the Party to join Instance.
/*==========================================
/*==========================================
// 0:self, 1:target, 2:master, default:random
// Cancel the casting skill.
/*==========================================
// trim spin-over
// zero distance
// pushing backwards
// turn around
/// Invokes buying store preparation window
/// buyingstore <slots>;
/// Invokes search store info window
/// searchstores <uses>,<effect>;
/// Displays a number as large digital clock.
/// showdigit <value>[,<type>];
/**
/**
/**
// Can't mount with one of these
// In both cases, return 1.
/**
/**
/* check if a character name is specified */
/**
// TODO: add support for exported functions (#2142)
// WTF... ?
// for some reason local functions can have type C_NAME
/**
/**
/* update existent entry */
/* compact the list now that we freed a slot somewhere */
/* not found */
// Use a dummy character.
// compatibility with previous implementation (deprecated!)
// to check for plugin permissions
// to ckeck for built-in permission
/* getrandgroupitem <container_item_id>,<quantity> */
// if not pet egg
/* cleanmap <map_name>;
/* Cast a skill on the attached player.
/* Turns a player into a monster and grants SC attribute effect. [malufett/Hercules]
// Transforming into monster is not allowed in Guild Wars.
// Cannot transform into monster while in disguise.
// Clear previous
/**
/**
/**
/**
/**
// Entry already exists
/**
/**
/**
/**
/**
/**
/**
/**
/**
// ...
// Move beyond the last position to invalidate qicheck
/**
// ...
/**
/**
/* New Battlegrounds Stuff */
/* bg_team_create(map_name,respawn_x,respawn_y) */
/* returns created team id or -1 when fails */
//ev and dev will be dropped.
// Invalid Map
// Creation failed
/* bg_join_team(team_id{,optional account id}) */
/* when account id is not present it tries to autodetect from the attached player (if any) */
/* returns 0 when successful, 1 otherwise */
/*==============[Mhalicot]==================
/*==========================================
/* bg_match_over( arena_name {, optional canceled } ) */
/* returns 0 when successful, 1 otherwise */
// Check that instance mapname is a valid map
/* modify an instances' reload-spawn point */
/* instance_set_respawn <map_name>,<x>,<y>{,<instance_id>} */
/* returns 1 when successful, 0 otherwise. */
/**
/**
/* no need to run this if its empty */
/* has been manually updated, make it reflect on sql */
/* has been manually updated, make it reflect on sql */
/**
/**
/* setcurrency(<Val1>,{<Val2>}) */
/**
/* clear list */
/**
/**
/* lookup */
/* didn't find it */
/**
//Event enqueued.
/** By Cydh
// getcalendartime(<day of month>, <day of week>{, <hour>{, <minute>}});
// Returns the UNIX Timestamp of next ocurrency of given time
// Next Month
// Today
// But past time, next month
// Loops until month has finding a month that has day_of_month
// This week
// Today
// Next week
// Next week
// Next occurence of hour/min
/*==========================================
/** place holder for the translation macro **/
// declarations that were supposed to be exported from npc_chat.c
/**
/**
// Common parameters - sender/message/zeny
// Item list
// Common parameters - sender/message/zeny
// Item list
// Tests
// Set data to message
/**
/**
/**
/**
// Already Enabled
// Remove
// show/hide camera info
// allow change some camera parameters
// update preview window to given item
// insert or remove card into equipped item
// send ack to inventory expand request
// send final ack to inventory expand request
// adjust player inventory size to given value positive or negative
// return current player inventory size
// force close roulette window if it opened
/**
/**
// Reset 'Feeling' maps.
// Reset hatred target marks.
/**
// arg must follow the pattern: (v|s|i|r|l)*\?*\*?
// 'v' - value (either string or int or reference)
// 's' - string
// 'i' - int
// 'r' - reference (of a variable)
// 'l' - label
// '?' - one optional parameter
// '*' - unknown number of optional parameters
/* something replaced it, skip. */
// Overriding
// Adding new function
// Note: This is a no-op if script->buildin is already large enough
//   (it'll only have effect when a plugin adds a new command)
/* we only store the arguments, its the only thing used out of this */
/**
/**
/**
/**
/**
/**
/* Commands for internal use by the script engine */
// NPC interaction
//for future jA script compatibility
//
// [LuzZza]
// [Fredzilla] [Paradox924X] [Jedzkie] [Dastgir]
// [Fredzilla]
// Simulates but don't Store it
// [Valaris]
// [Valaris]
// [Valaris]
// attached the player id to the npc timer [Celest]
// detached the player id from the npc timer [Celest]
// returns id of the current attached player. [Skotlex]
// [4144]
// <Agit>
// <Agitcheck>
// Flag Emblem
// SoundEffectAll [Codemaster]
// display mob data [Valaris]
// summon guardians
// display guardian data [Valaris]
// [Valaris]
// [Valaris]
// [Valaris]
// [Skotlex]
// [Skotlex]
// skill effect [Celest]
// npc skill effect [Valaris]
// npc skill effect [Valaris]
// npc skill effect with num [4144]
// skill effect on players[Valaris]
// nude command [Valaris]
// Added by RoVeRT
// [MouseJstr]
// [MouseJstr]
// [MouseJstr]
// [MouseJstr]
// [Valaris][Murilo BiO]
// [Valaris]
// [Valaris]
// [Valaris]
// [4144]
// [4144]
// [4144]
// [4144]
//by Lorky [Lupus]
//this command actls as MES but rints info into LOG file either SQL/TXT [Lupus]
// summons a slave monster [Celest]
// check whether it is night time [Celest]
// check whether another item/card has been equipped [Celest]
// check how many items/cards are being equipped [Celest]
// check how many items/cards are being equipped in the same arm [Lupus]
// returns the refined number of the current item, or an item with index specified [celest]
// sets the server to night time
// sets the server to day time
// Define pattern to listen for [MouseJstr]
// Activate a pattern set [MouseJstr]
// Deactive a pattern set [MouseJstr]
// Delete a pattern set [MouseJstr]
//added from jA [Lupus]
//end jA addition
// unequip command [Spectre]
//strlen [Valaris]
//isalpha [Valaris]
// [Mirei]
// [Mirei]
// Lordalfa - To bring strstr to scripting Engine.
//[Lupus] returns Items Buy / sell Price, etc info
//[Lupus] set Items Buy / sell Price, etc info
//[Lupus] returns CARD ID or other info from CARD slot N of equipped item
// List of mathematics commands --->
//[zBuffer]
//[zBuffer]
//[zBuffer]
// <--- List of mathematics commands
// [zBuffer] List of dynamic var commands --->
// <--- [zBuffer] List of dynamic var commands
// Deprecated 2019-03-11
// [Skotlex]
// [Lance]
//Set NEW item bonus script. Lupus
//disguise player. Lupus
//undisguise player. Lupus
//Lupus
// [zBuffer] List of player cont commands --->
// Deprecated 2018-05-04
// <--- [zBuffer] List of player cont commands
// [zBuffer] List of mob control commands --->
/* Unit Data */
// originally by Qamera [Celest]
// [Celest]
// <--- [zBuffer] List of mob control commands
//[orn]
//[Zephyrus]
//[Skotlex]
//[Skotlex]
// WoE SE
// Achievements [Smokexyz/Hercules]
// BattleGround
// Instancing
/**
//[Ind]
//[Ind]
/**
/* alias of itemeffect */
/**
/**
//Quest Log System [Inkfish]
/**
// Monster Transform [malufett/Hercules]
/* New BG Commands [Hercules] */
/* New Shop Support */
/* Navigation */
/* Clan System */
// -- RoDEX
// -- HatEffect
// camera
// Pre-alloc to speed up
/**
// Synonyms and combined values
// for setunitdata use *unitwarp, for getunitdata use *getmapxy
// use *unitwalk
/**
// aegis->athena slot position conversion table
/* */
/* parse */
/* script_config base */
//ontouch_name (runs on first visible char to enter area, picks another char if the first char leaves)
//ontouch2_name (run whenever a char walks into the OnTouch area)
//onuntouch_name (run whenever a char walks from the OnTouch area)
// for ENABLE_CASE_CHECK
// end ENABLE_CASE_CHECK
/**
/* */
/* */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\searchstore.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// struct s_search_store_info
// battle_config.*
// clif-"open_search_store_info, clif-"search_store_info_*
// struct map_session_data
// aMalloc, aRealloc, aFree
// nullpo_*
// ShowError, ShowWarning
// safestrncpy
/// retrieves search function by type
/// retrieves search-all function by type
/// checks if the player has a store by type
/// returns player's store id by type
// invalid input
// validate lists
// drop previous results
// allocate max. amount of results
// search
// skip own shop, if any
// exceeded result size
// reclaim unused memory
// present results
// one page displayed
// cleanup
// update uses
// notify of failure
/// checks whether or not more results are available for the client
// nothing (more) to display
// present results
// one more page displayed
// release results
// no such result, crafted
// no longer online
// no longer vending/buying or not same shop
// item no longer being sold/bought
// display coords
// not on same map, wipe previous marker
// open remotely
// to bypass range checks
// unknown
/// checks whether or not sd has opened account_id's shop remotely
/// removes range-check bypassing for remotely opened stores
/// receives results from a store-specific callback
// no more
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\skill.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// DBPATH, MAGIC_REFLECTION_TYPE, OFFICIAL_WALKPATH, RENEWAL, RENEWAL_CAST, VARCAST_REDUCTION()
// ranges reserved for mapping skill ids to skilldb offsets
//Since only mob-casted splash skills can hit ice-walls
// Some skills can now hit ground skills(traps, ice wall & etc.)
/// Returns the id of the skill, or 0 if not found.
/// Maps skill ids to skill db offsets.
/// Returns the skill's array index, or 0 (Unknown Skill).
// avoid ranges reserved for mapping guild/homun/mercenary skills
// map skill id to skill db index
//[Ind/Hercules] GO GO GO LESS! - http://herc.ws/board/topic/512-skill-id-processing-overhaul/
// 1020 - 2000 are empty
// 2058 - 2200 are empty - 1020+57
// 2549 - 3000 are empty - 1020+57+348
// 3036 - 5000 are empty - 1020+57+348+35
// validate result
// Skill DB
//Combo skill.
//Combo skill.
//Returns actual skill range taking into account attack range and AC_OWL [Skotlex]
//Mobs have a range of 9 regardless of skill used.
//TODO: Find a way better than hardcoding the list of skills affected by AC_VULTURE
/**
// added to allow GS skills to be effected by the range of Snake Eyes [Reddozen]
/**
/**
// Enable non players to use self skills on others. [Skotlex]
// HP recovery
// not RENEWAL
// HP recovery
// RENEWAL
/**
// not RENEWAL
// RENEWAL
// Critical Wound has no effect on offensive heal. [Inkfish]
// Only affects Heal, Sanctuary and PotionPitcher.(like bHealPower) [Inkfish]
// MATK part of the RE heal formula [malufett]
// Note: in this part matk bonuses from items or skills are not applied
// RENEWAL
// Making plagiarize check its own function [Aru]
// Never copy NPC/Wedding Skills
// Transcendent-class skills
//Added so plagarize can't copy agi/bless if you're undead since it damages you
// Couldn't preserve 3rd Class/Summoner skills except only when using Reproduce skill. [Jobbie]
// Reproduce will only copy skills according on the list. [Jobbie]
// [MouseJstr] - skill ok to cast? and when?
// invalid skill id
// can do any damn thing they want
// Teleport lv 3 bypasses this check.[Inkfish]
// Epoque:
// This code will compare the player's attack motion value which is influenced by ASPD before
// allowing a skill to be cast. This is to prevent no-delay ACT files from spamming skills such as
// AC_DOUBLE which do not have a skill delay and are not regarded in terms of attack motion.
// attempted to cast a skill before the attack motion has finished
/**
//You can't use skills while in the new mounts (The client doesn't let you, this is to make cheat-safe)
// gonna be checked in 'skill->castend_nodamage_id'
// uncomment for more verbose message.
//char output[150];
//sprintf(output, msg_txt(862), battle_config.min_npc_vendchat_distance); // "You're too close to a NPC, you must be at least %d cells away from any NPC."
//clif->message(sd->fd, output);
// always allowed
// noicewall flag [Valaris]
// This skill uses this msg instead of skill fails.
// invalid skill id
//can be used with angriff
/* Fall through */
//Use master's criteria.
//Use master's criteria.
// Invalid Skill ID
// cap to nearest square layout
// simple single-definition layout
// 6 - default aegis direction
//Warlock
// default 1x1 layout
/*==========================================
// don't forget auto attacks! - celest
// Don't apply effect if miss.
//skill additional effect is about adding effects to the target...
//So if the target can't be inflicted with statuses, this is pointless.
// These statuses would be applied anyway even if the damage was blocked by some skills. [Inkfish]
// Trigger status effects
// Any ranged physical attack takes status arrows into account (Grimtooth...) [DracoRPG]
// Trigger has attack type consideration.
// Trigger has range consideration.
//Range Failed.
// Fixed duration
// Default duration
// Trigger status effects on skills
// no damage, return;
// Normal attacks (no skill used)
// If a normal attack is a skill, it's splash damage. [Inkfish]
// Automatic trigger of Blitz Beat
// Automatic trigger of Warg Strike [Jobbie]
// Gank
// Chance to trigger Taekwon kicks [Dralnu]
//Stance triggered
//Stance triggered
//Stance triggered
//additional chance from SG_FRIEND [Komurka]
// Enchant Poison gives a chance to poison attacked enemies
//Don't use sc_start since chance comes in 1/10000 rate.
// Enchant Deadly Poison gives a chance to deadly poison attacked enemies
//Poison chance must be that of Envenom. [Skotlex]
/* Fall through */
/**
//On third hit, there is a 150% to freeze the target
/**
//Chance to cause blind status vs demon and undead element, but not against players
// emote icon still shows even there is no armor equip.
//Only stuns mid-sized mobs.
//Based on observations by [Tharis], Mental Breaker should do SP damage
//equal to Matk*skLevel.
// Equipment breaking monster skills [Celest]
//Does not work on bosses
// Headcrush has chance of causing Bleeding status, except on demon and undead element
//Any enemies hit by this skill will receive Stun, Darkness, or external bleeding status ailment with a 5%+5*skill_lv% chance.
// debuff the following statuses
//Note: attack_type is passed as BF_WEAPON for the actual target, BF_MISC for the splash-affected mobs.
//70% base stun chance...
//0.1% coma rate.
//TODO: Made up formula
//Prevent duplicate agi-down effect.
//Deactivatable Statuses: Kyrie Eleison, Auto Guard, Steel Body, Assumptio, and Millennium Shield
// Use flag=2, the stun duration is not vit-reduced.
// 4 banding RGs: Targets will be stunned at 100% chance for 4 ~ 8 seconds, irreducible by STAT.
// 6 banding RGs: activate Pinpoint Attack Lv1-5
// Uses skill->addtimerskill to avoid damage and setsit packet overlaping. Officially clif->setsit is received about 500 ms after damage packet.
// 50% chance to cause Blind on Undead and Demon monsters.
//  [(Skill Level x 5) + (Caster?s DEX + Caster?s Base Level) / 10]
// Need official rate. [LimitLine]
// Starting SCs here instead of do it in skill->additional_effect to simplify the code.
// 5 seconds until I get official
// Reduces ASPD and movement speed
// Reduces LUK? Needed confirm it, may be it's bugged in kRORE?
// Sit down for 3 seconds.
// Non confirmed rate.
//custom rate.
/**
// TODO: What's the chance/time?
// TODO: What's the chance/time?
// TODO: What's the chance/time?
// TODO: What's the chance/time?
//Pass heritage to Master for status causing effects. [Skotlex]
// Coma, Breaking Equipment
// Self weapon breaking
// Cart Termination/Tomahawk won't trigger breaking data. Why? No idea, go ask Gravity.
// Target weapon breaking
// Target armor breaking
// This effect does not work with skills.
// Autospell when attacking
// one or more trigger conditions were not fulfilled
//Special case, Sonic Blow autospell should stop the player attacking.
//Special case, due to its nature of coding.
//Set canact delay. [Skotlex]
//Autobonus when attacking
// one or more trigger conditions were not fulfilled
//Polymorph
// autospell already being executed
// No target
/* Split off from skill->additional_effect, which is never called when the
// don't forget auto attacks! [celest]
//Counter effects.
//Trigger has range consideration.
//Range Failed.
// [orn]
// SG_MIRACLE [Komurka]
// Soul Drain should only work on targeted spells [Skotlex]
// Character stuck in attacking animation while 'sitting' fix. [Skotlex]
// (bugreport:5303)
//Clear bounced spell check.
// updated to force healing to allow healing through berserk
// Trigger counter-spells to retaliate against damage causing skills.
// one or more trigger conditions were not fulfilled
// Set canact delay. [Skotlex]
//Autobonus when attacked
// one or more trigger conditions were not fulfilled
/*=========================================================================
//Bare fists should not break :P
// Axes and Maces can't be broken [DracoRPG]
//Rods and Books can't be broken [Skotlex]
//Cause Strip effect.
//Nothing to break.
//Upper Head
//Body
//Left/Right hands
//Return list of pieces broken.
// Mado Gear cannot be divested [Ind]
/*=========================================================================
// No knocking
// Actual knockback distance is 0.
// Bosses can't be knocked-back
// Basilica caster can't be knocked-back by normal monsters.
// ankle snare cannot be knocked back
// <optimized>: do the computation here instead of outside
// direction from src to target, reversed
// take the reversed 'direction' and reverse it
// Any knockback will cancel it.
// send over the proper flag
/*
// Nullify reflecting ability
// item-based reflection
// status-based reflection
// Kaite only works against non-players if they are low-level.
/*
//magic reflected
// Source is the master behind the attack (player/mob/pet)
// dsrc is the actual originator of the damage, can be the same as src, or a skill casted by src.
//Target to be attacked.
//When caster is not the src of attack, this is a ground skill, and as such, do the relevant target checking. [Skotlex]
//Note that splash attacks often only check versus the targeted mob, those around the splash area normally don't get checked for being hidden/cloaked/etc. [Skotlex]
// To block skills that aren't called via battle_check_target [Panikon]
// issue: 8203
//Don't need it.
// Is this check really needed? FrostNova won't hurt you if you step right where the caster is?
//Trick Dead protects you from damage, but not from buffs and the like, hence it's placed here.
//Skotlex: Adjusted to the new system
// [Valaris]
/*if (skill_id == -1) Does it ever worked?
/* Need more info cause NPC_EARTHQUAKE is ground type */
// Earthquake on multiple targets is not counted as a target skill. [Inkfish]
//Magic reflection, switch caster/target
//Don't need it.
/* bugreport:2564 flag&2 disables double casting trigger */
/* bugreport:7859 magical reflected zeroes blow count */
//Spirit of Wizard blocks Kaite's reflection
//Consume one Fragment per hit of the casted skill? [Skotlex]
/* Kaite bypasses */
/**
// Wiz SL canceled and consumed fragment
// issue:6415 in pre-renewal Kaite reflected the entire damage received
// regardless of caster's equipment (Aegis 11.1)
//Wiz SL canceled and consumed fragment
// the skill takes the weapon's element
//Use status element
//Use random element
//100% should be counted as the 80~99% interval
//Uses 20% SP intervals.
//SP Cost: 1% + 0.5% per every 20% SP
//Reduction: 6% + 6% every 20%
/* MAGIC_REFLECTION_TYPE */
//This will prevent skill additional effect from taking effect. [Skotlex]
//Estimate SP cost of a single water-ball
// Animation used here in eAthena [Wolfie]
// Only one target is chosen.
//Skill hit type
//Only skills that knockback even when they miss. [Skotlex]
//For correct knockback.
//Used to signal if this skill can be combo'ed later on.
//End combo state after skill is invoked. [Skotlex]
//Extend combo time.
//Update combo-skill
// Cancel combo wait
//bonus from SG_FRIEND [Komurka]
/* Fall through */
/* Fall through */
// AC_DOUBLE can start the combo with other monster types, but the
// monster that's going to be hit by HT_POWER should be RC_BRUTE or RC_INSECT [Panikon]
//bonus from SG_FRIEND [Komurka]
//Can't attack nor use items until skill's delay expires. [Skotlex]
//Switch End
//Possible to chain
//Display damage.
//Should look like Holy Cross [Skotlex]
//Skills that need be passed as a normal attack for the client to display correctly.
//Disable delay or attack will do no damage since source is dead by the time it takes effect. [Skotlex]
// fall through
// the surrounding targets
// needs -1 as skill level
// the central target doesn't display an animation
// needs -2(!) as skill level
/* Fall through */
// avoid damage display redundancy
/* makes the damage value not overlap with previous damage (when displayed by the client) */
//Updated to not be able to copy skills if the blow will kill you. [Skotlex]
/**
// Split all the check into their own function [Aru]
//Level dependent and limitation.
//Skills with can't walk delay also stop normal attacking for that
//duration when the attack connects. [Skotlex]
//Instant damage
//Deal damage before knockback to allow stuff like firewall+storm gust combo.
//Counter status effects [Skotlex]
// Hell Inferno burning status only starts if Fire part hits.
// Apply knock back chance in SC_TRIANGLESHOT skill.
//Only knockback if it's still alive, otherwise a "ghost" is left behind. [Skotlex]
//Reflected spells do not bounce back (bl == dsrc since it only happens for direct skills)
// default
//direction
// backwards
// This ensures the storm randomly pushes instead of exactly a cell backwards per official mechanics.
// Official servers push target to the West
/* monsters with skill lv higher than MAX_SKILL_LEVEL may get this value beyond the max depending on conditions, we cap to the system's limit */
//blown-specific handling
//Delayed damage must be dealt after the knockback (it needs to know actual position of target)
//Reflected magics are done directly on the target not on paladin
//This check is only for magical skill.
//For BF_WEAPON skills types track var rdamage and function battle_calc_return_damage
/**
// Oblivion Curse gives a 2nd success chance after the 1st one passes which is reducible. [Rytech]
// 10% of damage dealt
//skill->addtimerskill(src, tick + dmg.div_*dmg.amotion, bl->id, 0, 0, skill_id, skill_lv, BF_MAGIC, flag|2);
//Should return 0 when damage was reflected
// Ground skills are exceptions. [Inkfish]
//Disabling skill animation doesn't works on multi-hit.
// show damage on trap targets
/*==========================================
// several splash skills need this initial dummy packet to display correctly
//Non stackable on themselves and traps (including venom dust which does not has the trap inf2 set)
//Avoid stacking with same kind of trap. [Skotlex]
//Non players do not check for the skill's splash-trigger area.
//Allow casting Bomb/Demonstration Right under emperium [Skotlex]
// to be expanded later
// if the caster is a monster/NPC, only check for players
// otherwise just check characters
/*==========================================
// Requirements
// Intimacy Requirements
// Check item existences
// No item
// Consume items
/*==========================================
/*==========================================
// Source not on Map
//Required since it has to warp.
// Target offline?
// Target not on Map
// Different Maps
// Exceptions
// SR_FLASHCOMBO
// Caster is Dead
// only the first hit will be amplify
//Clear bounced spell check.
/**
// Hit a Lightning on the current Target
// only the first hit will be amplify
// Remaining Chains Hit
/* After 2 bounces, it will bounce to other targets in 7x7 range. */
// Search for a new Target around current one...
// only the first hit will be amplify
// status inflicts are depend on what summoned element is used.
// Casters Part
// Target's Part
// SR_FLASHCOMBO
// fall through ...
//Free skl now that it is no longer needed.
/*==========================================
/*==========================================
// SR_FLASHCOMBO
//Reveal trap.
/*==========================================
//GTB makes all targeted magic display miss with a single bolt.
//Unneeded
//[orn]
//[orn]
/**
/* Fall through */
// decide the ailment first (affects attack damage and effect)
//TODO: is there really no cleaner way to do this?
//Becomes a splash attack when Soul Linked.
// Taekwon kicks [Dralnu]
// teleport to target (if not on WoE grounds)
// cause damage and knockback if the path to target was a straight one
//HACK: since knockback officially defaults to the left, the client also turns to the left... therefore,
// make the caster look in the direction of the target
/* Fall through */
//It won't shoot through walls since on castend there has to be a direct
//line of sight between caster and target.
// change direction [Celest]
// Move 2 cells for Issen(from target)
// for Asura(from caster)
// RENEWAL
// not RENEWAL
// RENEWAL
// only NJ_ISSEN don't have slide effect in GVG
// The cell is not reachable (wall, object, ...), move next to the target
// TODO: Need activation chance.
// Splash attack skills.
// a fake packet will be sent for the first target to be hit
//Recursive invocation
// skill->area_temp[0] holds number of targets in area
// skill->area_temp[1] holds the id of the original target
// skill->area_temp[2] counts how many targets have already been processed
// -1 will be used in packets instead of the skill level
// original target gets no animation (as well as all NPC skills)
// TODO: Need activation chance.
/* Fall through */
// if skill damage should be split among targets, count them
//SD_LEVEL -> Forced splash damage for Auto Blitz-Beat -> count targets
//special case: Venom Splasher uses a different range for searching than for splashing
// recursive invocation of skill->castend_damage_id() with flag|1
// Prevent double item consumption when the target explodes (item requirements have already been processed in skill_castend_nodamage_id)
//Damage depends on distance, so add it to flag if it is > 1
//Coded apart for it needs the flag passed to the damage calculation.
// Chain effect and check range gets reduction by recursive depth, as this can reach 0, we don't use blowcount
// Determine the Bowling Bash area depending on configuration
// Gutter line system
// Gutter line system without demi gutter bug
// Area around caster
// Initialization, break checks, direction
// Ignore monsters outside area
// Ignore monsters already in list
// Random direction
// Create an empty list of already hit targets
// Direction is walkpath
// Add current target to the list of already hit targets
// Keep moving target in direction square by square
// Target coordinates (get changed even if knockback fails)
// If target cell is a wall then break
// Splash around target cell, but only cells inside area; we first have to check the area is not negative
// Recursive call
// Self-collision
// Original hit or chain hit depending on flag
// all the enemies between the caster and the target are hit, as well as the target
//Active part of the attack. Skill-attack [Skotlex]
//NOTE: This is used in skill->castend_nodamage_id to avoid affecting the target.
// Palm Strike takes effect 1sec after casting. [Skotlex]
//clif->skill_nodamage(src,bl,skill_id,skill_lv,0); //Can't make this one display the correct attack animation delay :/
//Display an absorbed damage attack.
//[blackhole89]
// learnable level
// non-players bypass the water requirement
// natural water cell
// skill-induced water cell
// consume cell
// queue the remaining count - 1 timerskill Waterballs
//Should attack undead and demons. [Skotlex]
/* Fall through */
/* Fall through */
/**
// [Celest]
//You don't move on GVG grounds.
// Spear Boomerang auto cast chance only works if you have mastered Spear Boomerang.
// Don't damage party members.
// No damage to Members
// the official server send these two packets.
// Only Hits Invisible Targets
// Don't absorb when caster was in full HP
// Don't absorb heal from Ice Walls or other skill units.
// 25% each for equal sharing
// Priority is to release SpellBook
// SpellBook
// List all available spell to be released
// Random select of spell to be released.
// Now extract the data from the preserved spell
//something went wrong :(
// Last spell to be released
// Summon Balls
// Doesn't deal damage through non-shootable walls.
// Only RA_WUGBITE has the skill fail message.
// Only Hits Invisible Targets
//TODO: Need a confirmation if the other type of hidden status is included to be scanned. [Jobbie]
// Need confirm it.
// Destination area
// To teleport Self
// Aegis send this packet too.
//by default cloaking skills are remove by aoe skills so no more checking/removing except hiding and cloaking exceed.
// Recursive homun skill
// TODO: Need activation chance.
// TODO: What's the activation chance for the effect?
/* no skill - basic/normal attack */
//Set flag to 1 so ammo is not double-consumed. [Skotlex]
//Should only remove after the skill has been casted.
// ensure that the skill last-cast tick is recorded
// consume arrow on last invocation to this skill.
// perform skill requirement consumption
/*==========================================
// not found
// ???
// otherwise handled in unit->skillcastcancel()
// restore original walk speed
// Use a do so that you can break out of it when the skill fails.
//These should become skill_castend_pos
/* Fall through */
//Find a random spot to place the skill. [Skotlex]
//If it's not an enemy, and not silenced, you can't use the skill on them. [Skotlex]
// Check target validity.
//Combo skills
// Casted through combo.
//Offensive skill.
//Remove neutral targets (but allow enemy if skill is designed to be so)
// You can use Phantom Thurst on party members in normal maps too. [pakpil]
// Fogwall makes all offensive-type targeted skills fail at 75%
//Avoid doing double checks for instant-cast skills.
//Consume items anyway. [Skotlex]
// Tests show wings don't overwrite the delay but skill scrolls do. [Inkfish]
// Cooldown application
// Increases/Decreases cooldown of a skill by item/card bonuses.
// SC_MAGICPOWER needs to switch states before any damage is actually dealt
// On aegis damage skills are also increase by camouflage. Need confirmation on kRO.
// only normal attack and auto cast skills benefit from its bonuses
// 0
//Clear bounced spell check.
// they just set the data so leave it as it is.[Inkfish]
//mobs can't clear this one as it is used for skill condition 'afterskill'
//Skill failed.
//When Asura fails... (except when it fails from Fog of Wall)
//Consume SP/spheres
//End states
//Move character to target anyway.
//Display movement + animation.
//You can't place a skill failed packet here because it would be
//sent in ALL cases, even cases where skill_check_condition fails
//which would lead to double 'skill failed' messages u.u [Skotlex]
/*==========================================
// [Celest]
/**
// Supportive skills that can't be cast in users with mado
//Check for undead skills that convert a no-damage skill into a damage one. [Skotlex]
// [orn]
/**
//Apparently only player casted skills can be offensive like this.
//Offensive heal does not works on non-enemies. [Skotlex]
//Since it is a self skill, this one ends here rather than in damage_id. [Skotlex]
//prevent reiteration
//cast on homun
//cast on master
//Skill is actually ground placed.
//Skills that cause an status should be blocked if the target element blocks its element.
// [orn]
/**
/**
//Highness Heal: starts at 1.7 boost + 0.3 for each level
//Bounce back heal
//When you try to heal yourself under Kaite, the heal is voided.
//Needed so that it actually displays 0 when healing.
// The actual penalty...
//Apply penalty
//0.2% penalty per each.
//Revive
//Count it in, then fall-through to the Resurrection code.
//Resurrection level 3 is used
//Invalid target, skip resurrection.
//No reviving in WoE grounds!
//Both Redemptio and Res show this skill-animation.
/* monsters using lvl 48 get the rate benefit but the duration of lvl 10 */
//Prevent duplicate agi-down effect.
//Required lv for it to appear
// player-casted
// mob-casted
//Assume offensive skills
// Reset Damage Logs
//Check they are not another crusader [Skotlex]
// Cannot cast on another bard/dancer-type class of the same gender as caster
// added failure chance and chance to break weapon if turned on [Valaris]
//Allow re-enchanting to lengthen time. [Skotlex]
// 100% success rate at lv4 & 5, but lasts longer at lv5
// "You broke the target's weapon."
//Passive Magnum, should had been casted on yourself.
// Initiate 10% of your damage becomes fire element.
/* Check if the target is an enemy; if not, skill should fail so the character doesn't unit->movepos (exploitable) */
// Works just like the above list of skills, except animation caused by
// status must trigger AFTER the skill cast animation or it will cancel
// out the status's animation.
// Master
// Homun
/* Was modified to only affect targetted char. [Skotlex] */
// 0
// Prevent spamming [Valaris]
//dstsd->sc.data[SC_ENCHANTPOISON] //People say you should be able to recast to lengthen the timer. [Skotlex]
//Cannot change target when already have one
//TODO: How much does base level affects? Dummy value of 1% per level difference used. [Skotlex]
// Only players can be devoted
// Level difference requeriments
// Cannot Devote a player devoted from another source
// Mercenary only can devote owner
// Crusader Cannot be devoted
// Players affected by SC_HELLPOWERR cannot be devoted.
// Mercenary only can Devote owner
// Player Devoting Player
// No free slots, skill Fail
// Mercenary Devoting Owner
//Passive part of the attack. Splash knock-back+stun. [Skotlex]
//Use Misc rather than weapon to signal passive pushback
// split the if for readability, and included gunslingers in the check so that their coins cannot be removed [Reddozen]
// check if target is a monster and not a Boss, for the 20% chance to absorb 2 SP per monster's level [Reddozen]
/* Fall through */
//Passive side of the attack.
// [orn]
//Self Destruction hits everyone in range (allies+enemies)
//Except for Summoned Marine spheres on non-versus maps, where it's just enemy.
//Required to prevent chain-self-destructions hitting back.
//Hide skill-scream animation.
//Mado Gear cannot hide
// If the client receives a skill-use packet immediately before a walkok packet, it will discard the walk packet! [Skotlex]
// So aegis has to resend the walk ok.
// custom hack to make the mob display the skill, because these skills don't show the skill use text themselves
//NOTE: mobs don't have the sprite animation that is used when performing this skill (will cause glitches)
// %s : %s !!
// Level 6-10 doesn't consume a red gem if it fails [celest]
// not to consume items
//Is this equation really right? It looks so... special.
// Mercenary Supportive Skills
// Fail on Players
// Cannot be Used on Emperium
/* failed, don't consume anything, return */
// consume sp only if succeeded
// Weapon Refining [Celest]
//Prevent vending of GMs with unnecessary Level to trade/drop. [Skotlex]
// duel restriction [LuzZza]
//"Duel: Can't use %s in duel."
// [MouseJstr]
//Produce a Deadly Poison Bottle.
//Rate in percent
//Minimum rate 5%
//Duration in ms
//Minimum duration 0ms
//Special message when trying to use strip on FCP [Jobbie]
//Attempts to strip at rate i and duration d
//Nothing stripped.
//Maybe replace with potion_hp, but I'm unsure how that works [Playtester]
// Don't consume item requirements
//Prepare 200 White Potions.
//Prepare 200 Slim White Potions.
//check if you can produce all three, if not, then fail:
//100 Alcohol
//50 Acid Bottle
//50 Flame Bottle
//200 empty bottle are required at total.
// Outside PvP it should only affect party members and no skill fail message.
//Rogue's spirit defends against dispel.
/**
//val4 = out-of-song-area
//Mark a dispelled berserk to avoid setting hp to 100 by setting hp penalty to 0.
//Affect all targets on splash area.
//This is the correct implementation as per packet logging information. [Skotlex]
//Fails on noteleport maps, except for GvG and BG maps [Skotlex]
//20% max SP damage.
//Nothing to cancel.
//Only 10% success chance against bosses. [Skotlex]
//HP damage only on pvp-maps when against players.
//Recover 2% HP [Skotlex]
//Recover half damaged HP at level 5 [Skotlex]
//Recover some of the SP used
// Animation used here in official [Wolfie]
// 0
//Only works on monsters.
//This skill should fail if target is wearing bathory/evil druid card [Brainstorm]
//TO-DO This is ugly, fix it
//Disable attacking/acting/moving for skill's duration.
// only works once
//When suiciding, neither exp nor drops is given.
// or does it increase casting rate? just a guess xD
// not really needed... but adding here anyway ^^
//If cast on self, run forward, else run away.
//Run skillv tiles overriding the can-move check.
//Otherwise it isn't updated in the AI.
//Multiply the rest of mobs. [Skotlex]
//val[0] is the emotion to use.
//NPC_EMOTION & NPC_EMOTION_ON can change a mob's mode 'permanently' [Skotlex]
//val[1] 'sets' the mode
//val[2] adds to the current mode
//val[3] removes from the current mode
//val[4] if set, asks to delete the previous mode change.
//If mode gets set by NPC_EMOTION then the target should be reset [Playtester]
// Fix 100% movement speed in all levels. [Frost]
//Have val4 passed as 6 is for "infinite cloak" (do not end on attack/skill use).
// not sure what it does
// The earned is the same % of the target HP than it cost the caster. [Skotlex]
// The earned is the same % of the target SP than it cost the caster. [Skotlex]
// parent-baby skills
// Mercenaries can remove any trap
// Players can only remove their own traps or traps on Vs maps.
// prevent picking up expired traps
// get back all items used to deploy the trap
// get back 1 trap
// if it is already trapping something don't spring it,
// remove trap should be used instead
// otherwise fall through to below
/** Renewal dropped the 3/4 hp requirement **/
// RENEWAL
//HelloKitty2 (?) explained that this silently fails when target is
//already inflicted. [Skotlex]
//Has a 55% + skill_lv*5% success chance.
// RENEWAL
// Slim Pitcher
// Updated to block Slim Pitcher from working on barricades and guardian stones.
// Full Chemical Protection
// Don't consume item requirements
//AppleGirl
//Can't use Longing for Freedom while under Moonlight Petals. [Skotlex]
// consume sp only if succeeded [Inkfish]
// heals SP to 0
// matk halved
// all buffs removed
// 1000 damage, random armor destroyed
// atk halved
// 2000HP heal, random teleported
// random 2 other effects
//Should not re-trigger this one.
// stop freeze or stoned
// curse coma and poison
// confusion
// 6666 damage, atk matk halved, cursed
// 4444 damage
// stun
// atk,matk,hit,flee,def reduced
//NOTE: here, 'type' has the value of the associated MAPID, not of the SC_SOULLINK constant.
//Erase death count 1% of the casts
//SC_SOULLINK invokes status_calc_pc for us.
// [marquis007]
// New guild skills [Celest]
// i don't know if it actually summons in a circle, but oh well. ;P
//AuronX reported you CAN memorize the same map as all three. [Skotlex]
/* per official standards, this skill works on players and mobs. */
//Base rate
// [orn]
// [orn]
// Homun
// Master
//TODO: Shouldn't also players and the like switch targets?
// Failed
// [orn]
//Self
//Master
/**
//Eh? why double skill packet?
// Homun single-target support skills [orn]
//For SD_PREAMBLE
//For SD_PREAMBLE
// players only, skill allows 5 buying slots
// formula not confirmed
// 20% HP
//Generates a random number between 1 - 100 which is then used to determine how many shields will generate.
//20% chance for 4 shields.
//30% chance for 3 shields.
//50% chance for 2 shields.
/**
// Every time the skill is casted the status change is reseted adding a counter.
// Max counter
// if you haven't enough HP skill fails.
/**
// Success Chance: (40 + 10 * Skill Level) %
//Success rate only applies to the curing effect and not stat bonus. Bonus status only applies to non infected targets
// Success Chance: (40 + 10 * Skill Level) %
// Success rate only applies to the curing effect and not stat bonus. Bonus status only applies to non infected targets
//As of the behavior in official server Clearance is just a super version of Dispell skill. [Jobbie]
// Only affect mob, party or self.
//Mark a dispelled berserk to avoid setting hp to 100 by setting hp penalty to 0.
// Should the level of Lex Divina be equivalent to the level of Silentium or should the highest level learned be used? [LimitLine]
/**
// Should not work with bosses.
// Success Chance: On self, 100%
// On Players, (20 + 10 * Skill Level) %
// On Monsters, (40 + 10 * Skill Level) %
// Doesn't hit/cause Freezing to invisible enemy // Really? [Rytech]
// Do not hit invisible enemy
// Failure on Rate
// officially it doesn't work like a stack
//Can't move while selecting a spellbook.
/**
/**
// % of max hp regen
// The skill_lv is stored in val1 used in skill_select_menu to determine the used skill lvl [Xazax]
//First we set the success chance based on the caster's build which increases the chance.
// We then reduce the success chance based on the target's build.
//Finally we set the minimum success chance cap based on the caster's skill level and DEX.
//If the target was successfully inflected with the Ignorance status, drain some of the targets SP.
//If the target was successfully inflected with the Unlucky status, give 1 of 3 random status's.
//Targets in the Unlucky status will be affected by one of the 3 random status's regardless of resistance.
//Skill will first check if a shield is equipped. If none is found on the caster the skill will fail.
//Generates a number between 1 - 3. The number generated will determine which effect will be triggered.
// Splash AoE ATK
//Damage Reflecting Increase.
//Weapon Attack Increase.
// Nothing should happen if the shield has no mdef, not even displaying a message
// Splash AoE MATK
//Splash AoE Lex Divina
//Magnificat
// Nothing should happen if the shield has no refine, not even displaying a message
//Now breaks Armor at 100% rate
//DEF Increase
//Status Resistance Rate
// HP Recovery
// 1% penalty.
// Assume 15 spiritballs in non-characters
//1%sp per spiritball.
/* Fall through */
// val4 indicates caster's voice lesson level
//Required to check if the lord of madness effect will be applied.
//The god of madness deals 9999 fixed unreduceable damage when 8 or more enemy players are affected.
//skill->attack(BF_MISC,src,src,bl,skillid,skilllv,tick,flag);//To renable when I can confirm it deals damage like this. Data shows its dealt as reflected damage which I don't have it coded like that yet. [Rytech]
//Destiny position.
//Given map not found?
// [(15 + 5 * Skill Level) + ( Caster?s INT / 5 ) + ( Caster?s Job Level / 5 ) - ( Target?s INT / 6 ) - ( Target?s LUK / 10 )] %
// Remove previous elemental first.
// Summoning the new one.
// Standard mode.
// At level 4 delete elementals.
// Select mode based on skill level used.
// the first one cancels and the last one will take effect resetting the timer
//Minimal chance is 10%.
//Coded to both inflect the status and drain the target's SP only when successful. [Rytech]
// No ammo.
// Only attack if the target is an enemy.
//Otherwise, it fails, shows animation and removes items.
// This packet is received twice actually, I think it is to show the animation.
// There aren't teleport, just push the master away.
// This not heals at the end.
// replace existing charms of other type
// unlock target lock
//[(Base chance of success) - ( target's int / 10)]%.
// This skill does not work on monsters.
// Does not work on Boss monsters.
// random between 751 ~ 850
//refresh intimacy info
//start on master
//Now it is ready for spawning.
/* somehow its handled outside this switch, so we need a empty case otherwise default would be triggered. */
//Should only remove after the skill had been casted.
//Mob skill event for no damage skills (damage ones are handled in battle_calc_damage) [Skotlex]
//Log interaction (counts as 'attacker' for the exp bonus)
// ensure that the skill last-cast tick is recorded
// consume arrow on last invocation to this skill.
// perform skill requirement consumption
/*==========================================
// restore original walk speed
//Avoid double checks on instant cast skills. [Skotlex]
//Consume items anyway.
//Cooldown application
// Increases/Decreases cooldown of a skill by item/card bonuses.
// 0
// only normal attack and auto cast skills benefit from its bonuses
// Warp-Portal thru items will clear data in skill_castend_map. [Inkfish]
//Non mobs can't clear this one as it is used for skill condition 'afterskill'
/* skill count without self */
/*==========================================
//Simplify skill_failed code.
//50% fail chance under ASH
// The storage window is closed automatically by the client when there's
// any kind of map change, so we need to restore it automatically
// issue: 8027
//Need lv2 to be able to warp here.
//Given map not found?
// crash prevention
// check if the chosen map exists in the memo list
// This checks versus skill_id/skill_lv...
// Clear data that's skipped in 'skill_castend_pos' [Inkfish]
// record the destination coordinates
/*==========================================
//if(skill_lv <= 0) return 0;
// [Celest]
//Skill effect.
//Effect is displayed on respective switch case.
// SC_MAGICPOWER needs to switch states before any damage is actually dealt
//Does not consumes if the skill is already active. [Skotlex]
// not to consume items
//Disable it.
// Don't consume gems if cast on LP
//Ground-placed skill implementation.
// Set flag to 1 to prevent deleting ammo (it will be deleted on group-delete).
//Ammo should be deleted right away.
// Cancel Basilica
// Create Basilica. Start SC on caster. Unit timer start SC on others.
// [Valaris]
/* Fall through */
// The Meteor should inflict curse if Catnip fruit is consumed.
// Currently Catnip fruit is added as requirement.
// Creates a random Cell in the Splash Area
//Should only remove after the skill has been casted.
// not to consume item.
//You don't move on GVG grounds.
// Correct info, don't change any of this! [Celest]
//Now it is ready for spawning.
// Slim Pitcher [Celest]
//Apply skill bonuses
// Plant Cultivation [Celest]
//Was under someone else's Gospel. [Skotlex]
// PA_GOSPEL music packet
// [orn]
/* Fall through */
/**
//status_change_end(src,SC_POISONINGWEAPON,INVALID_TIMER); // 08/31/2011 - When using poison smoke, you no longer lose the poisoning weapon effect.
/**
// Store first caster's location to avoid glitch on unit setting
/**
/**
// To remove previous skills - cannot used combined
// Set bomb on current Position
// Creates a random Cell in the Splash Area
//If player doesent know Acid Demonstration or knows level 5 or lower, effect 5 will cast level 5 Acid Demo.
// FIXME: Code after this point assumes that the group has one and only one unit, regardless of what the skill_unit_db says.
// If player knows a level of Acid Demonstration greater then 5, that level will be casted.
//Should only remove after the skill has been casted.
// ensure that the skill last-cast tick is recorded
// consume arrow if this is a ground skill
// perform skill requirement consumption
/// transforms 'target' skill unit into dissonance (if conditions are met)
//They don't match (song + dance) is valid.
//Set dissonance
//Add ensemble to signal this unit is overlapping.
//Remove dissonance
//Update look of affected cell.
//Does the song/dance overlapping -> dissonance check. [Skotlex]
//When flag is 0, this unit is about to be removed, cancel the dissonance effect
//When 1, this unit has been positioned, so start the cancel effect.
//Reset state
/**
// by default the backup is empty
// val2&UF_ENSEMBLE is a hack to indicate dissonance
// protection against attempts to read an empty backup / write to a full backup
//Transform
// backup
// replace
//Restore
/*==========================================
// for traps, firewall and fogwall - celest
//nb of attack blocked
/**
// previous implementation (not used anymore)
//Warp Portal morphing to active mode, extract relevant data from src. [Skotlex]
//Copy the (x,y) position you warp to
//as well as the mapindex to warp to.
// Store caster id.
//The target changes to "all" if used in a gvg map. [Skotlex]
/**
// longer trap times in WOE [celest]
//HelloKitty confirmed that these are interchangeable,
//so you can change element and not consume gemstones.
//Use the previous limit (minus the elapsed time) [Skotlex]
//This can happen...
//FIXME: This value is not used anywhere, what is it for? [Skotlex]
// Flee increase
// Perfect dodge increase
// Hit increase
// Casting time reduction
//For some reason at level 10 the base delay reduction is 50%.
// After-cast delay reduction
// ASPD decrease
// Movement speed adjustment.
// ASPD decrease
// Movement speed adjustment.
// MaxHP percent increase
// MaxSP percent increase
// SP cost reduction
// This formula was taken from a RE calculator
// and the changes published on irowiki
// Luckily, official tests show it's the right one
// ASPD increase
// ASPD works with 1000 as 100%
// Critical increase
//Because every 10 crit is an actual cri point.
//Watk increase
//Def increase
//Watk increase
//Def increase
//Watk increase
//Exp increase bonus.
//Elemental Resistance
//Status ailment resistance
//Delete previous Kaensins/Suitons
// Type of Poison
//it doesn't matter
// Can't be placed on top of Land Protector.
// no. of aura
// aura type
//Store if this skill needs to consume ammo.
//Signals if this is a song/dance/duet
//if tick is greater than current, do not invoke onplace function just yet. [Skotlex]
//Eh... we have to write something here... even though mobs shouldn't use this. [Skotlex]
//Hermod is a encore with a warp!
// don't place skill units on walls (except for songs/dances/encores)
// no path between cell and center of casting.
//Nearby cross, linear decrease with no diagonals
//Diagonal edges
// center.
//Double duration of cells on top of Deluge/Suiton
// execute on all targets standing on this cell
//No cells? Something that was blocked completely by Land Protector?
//success, unit created.
//Store number of tiles.
//Store whether this is a song/dance
/*==========================================
//AoE skills are ineffective. [Skotlex]
//Hidden characters are immune to AoE skills except to these. [Skotlex]
//In case the group is deleted, we need to return the correct skill id, still.
// If you are fiberlocked and can't move, it will only increase your fireweakness level. [Inkfish]
//Couldn't trap it?
//Does not affect the caster.
//Does not affect the caster.
/* we break it because officials break it, lovely stuff. */
//Map not available on this map-server.
//Send val3 =1 to reduce agi.
//Should dispell only allies.
//Needed to check when a dancer/bard leaves their ensemble area.
// If Aegis, apple of idun doesn't update its effect
// Let it fall through
// Don't buff themselves without link!
// From here songs are already active
// eA style:
// Readjust timers since the effect will not last long.
// Aegis style:
// Songs won't renew unless finished
// Update with new values as the current one will vanish soon
// Why are we storing skill_lv as val1?
// officially, icewall has no problems existing on occupied cells [ultramage]
//Destroy the cell. [Skotlex]
// 0
//Knockback out of area if affected char isn't in Moonlit effect
//Also needed to prevent infinite loop crash.
// iRO Wiki says that this skill don't affect to Boss monsters.
//Does not affect the caster.
// Does not affect the caster or Boss.
/*==========================================
// Status Effects for Unit caster.
// Maestro or Wanderer is unaffected by traps of trappers he or she charmed [SuperHulk]
//These happen when a trap is splash-triggered by multiple targets on the same cell.
//Not all have it, eg: Traps don't have it even though they can be hit by Heaven's Drive [Skotlex]
//Take into account these hit more times than the timer interval can handle.
//Only damage enemies with offensive Sanctuary. [Skotlex]
// reduce healing count if this was meant for damaging [hekate]
//Will heal demon and undead element monsters, but not players.
//Damage enemies
//SG skills [Komurka]
//If target isn't knocked back it should hit every "interval" ms [Playtester]
// sp damage to players
// mobs
// costs 2 SP per hit
//costs additional 8 SP if miss
// mobs
//should end when out of sp.
/**
//SG counter does not reset per stormgust. IE: One hit from a SG and two hits from another will freeze you.
//SG hit counter.
//Attack absorbed.
//Couldn't trap it?
/**
//Changed ID so it does not invoke a for each in area again.
// it won't work on players
// it won't trigger on caster
// Cluster Bomb/Icebound has 1s to disappear once activated.
//Changed ID so it does not invoke a for each in area again.
//Apple of Idun [Skotlex]
// Don't buff themselves!
// Aegis style
// Check if the remaining time is enough to survive the next update
// Apple of Idun is not active. Start it now
// eA style: doesn't need this
// Don't let buff themselves!
// Aegis style
// Check if song has enough time to survive the next check
// Update with new values as the current one will vanish
// Had enough time or not, it now has. Exit
// Song was not active. Start it now
// Support Effect only on party, not guild
// Positive buff count
//Duration
// Heal 1~9999 HP
// End all negative status
// Immunity to all status
// MaxHP +100%
// MaxSP +100%
// All stats +20
// Level 10 Blessing
// Level 10 Increase AGI
// Enchant weapon with Holy element
// Enchant armor with Holy element
// DEF +25%
// ATK +100%
// HIT/Flee +50
// Offensive Effect
// Negative buff count
// Deal 1~9999 damage
// Curse
// Blind
// Poison
// Level 10 Provoke
// DEF -100%
// ATK -100%
// Flee -100%
// Speed/ASPD -25%
// knock-back any enemy except Boss
//clif->changetraplook(&src->bl, UNT_FIREPILLAR_ACTIVE);
/**
//Oblivion Curse gives a 2nd success chance after the 1st one passes which is reducible. [Rytech]
// Reveal hidden players every 5 seconds.
// TODO: check if other hidden status can be removed.
/* Enable this if kRO fix the current skill. Currently no damage on undead and demon monster. [Jobbie]
// Don't work on Self (video shows that)
///map->moveblock(bl, src->bl.x, src->bl.y, tick); // in official server it doesn't behave like this. [malufett]
// Couldn't trap it?
//The caster is the only one who can step on the Plants, without destroying them
// It has effect on everything, including monsters, undead property and demon
//+1% each 5s
//each 5s
//timer
//after 5 stop hit and destroy me
// Couldn't trap it?
/*==========================================
//Need to delete the trap if the source died.
//Clear Hermode if the owner moved.
/*==========================================
//Check if you just stepped out of your ensemble skill to cancel dancing. [Skotlex]
//We don't check for SC_LONGING because someone could always have knocked you back and out of the song/dance.
//FIXME: This code is not perfect, it doesn't checks for the real ensemble's owner,
//it only checks if you are doing the same ensemble. So if there's two chars doing an ensemble
//which overlaps, by stepping outside of the other partner's ensemble will cause you to cancel
//your own. Let's pray that scenario is pretty unlikely and none will complain too much about it.
/* Fall through */
// eAthena style: update everytime
// Aegis style: update only when it was not a reduced effect
//NOTE: It'd be nice if we could get the skill_lv for a more accurate extra time, but alas...
//not possible on our current implementation.
//Store the fact that this is a "reduced" duration effect.
//Players get blind ended immediately, others have it still for 30 secs. [Skotlex]
/*==========================================
//Necessary in case the group is deleted after calling on_place/on_out [Skotlex]
//Target-type check.
//Ensemble check to terminate it.
// Don't let a Bard/Dancer update their own song timer
/*==========================================
/*==========================================
//Contains the list of characters found.
//Partner found for ensembles, or the two companions for Benedictio. [Skotlex]
//This adjusts dir to account for the direction the sd is facing.
//Must be standing to the left/right of Priest.
// Adoramus does not consume Blue Gemstone when there is at least 1 Priest class next to the caster
// Comet does not consume Red Gemstones when there is at least 1 Warlock class next to the caster
//Warning: Assuming Ensemble Dance/Songs for code speed. [Skotlex]
/*==========================================
//As if there were infinite partners.
//Execute the skill on the partners.
//Warning: Assuming Ensemble skills here (for speed)
//Chorus skills are not to be parsed as ensambles
//Else: new search for partners.
//Apply the average lv to encore skills.
//I know c should be one, but this shows how it could be used for the average of n partners.
/*==========================================
//Non alchemist summoned mobs have nothing to do here.
/*==========================================
//Assume spirit spheres are used as ammo instead.
/**
//GMs don't override the skillItem check, otherwise they can use items without them being consumed! [Skotlex]
//Need to do arrow state check.
//Need to do Spiritball check.
// Hocus-Pocus was used. [Inkfish]
// When a target was selected, consume items that were skipped in pc_use_item [Skotlex]
//Something went wrong, item exploit?
//Consume
// [marquis007]
//Do not consume item.
// Rental usable items are not consumed until expiration
// Turn off check.
// Check the skills that can be used while mounted on a warg
// Hunter skills
// Ranger skills
// Other
// in official there is no message.
// Check the skills that can be used whiled using mado
//Can only update state when weapon/arrow info is checked.
// perform skill-specific checks (and actions)
// "You can't open a shop on this map"
// "You can't open a shop on this cell."
// duel restriction [LuzZza]
//"Duel: Can't use %s in duel."
//To disable Asura during the 5 min skill block uncomment this block...
// 0
//Placed here as ST_MOVE_ENABLE should not apply if rooted or on a combo. [Skotlex]
// Cannot be used by Non-Taekwon classes
// Soul Linkers cannot use this skill
//Anti-Soul Linker check in case you job-changed with Stances active.
//Combo needs to be ready
//Kick chain
//Do not repeat a kick.
//Cancel combo wait.
//Combo ready.
//Dance Skill ID
//Dance Skill LV
//Check there's no wall in the range+1 area around the caster. [Skotlex]
//Not enough exp.
//Auron insists we should implement SP consumption when you are not Soul Linked. [Skotlex]
//Only invoke on skill begin cast (instant cast skill). [Kevin]
// other checks were already done in skillnotok()
//Unusable when at full SP.
//Can't summon if a hom is already out
//Can't vapo homun if you don't have an active homun or it's hp is < 80%
/**
/**
// issue: 7935
//clif->skill_fail(sd, skill_id, USESKILL_FAIL_NEED_ITEM, require.amount[0], 0, require.itemid[0]);
/**
/**
/**
// Don't check for partner.
// Just fails, no msg here.
// You are too close to a stone or emperium to do this skill
/* TODO official response */ // You are too close to a stone or emperium to do this skill
//  -20% each W/M in the party.
// Can't be casted until you've walked all cells.
//Cannot be used if Mado is equipped.
//When using a combo, cancel the can't move delay to enable the skill. [Skotlex]
//mhp is the max-hp-requirement, that is,
//you must have this % or less of HP to cast it.
// There's no need to check if the skill is part of a combo if it's
// already been checked before, see unit_skilluse_id2 [Panikon]
// Note that if this check is read part of issue:8047 will reappear!
// 0
//GMs don't override the skillItem check, otherwise they can use items without them being consumed! [Skotlex]
//Need to do arrow state check.
//Need to do Spiritball check.
// Cast start or cast end??
/* temporarily disabled, awaiting for kenpachi to detail this so we can make it work properly */
// Casting finished (Hocus-Pocus)
// perform skill-specific checks (and actions)
//Fails when: exceed max limit. There are other plant types already out.
//Skill requires stuff equipped in the arrow slot.
// Skill Failed. [%s] requires %dx %s.
//Ammo type check. Send the "wrong weapon type" message
//which is the closest we have to wrong ammo type. [Skotlex]
//Haplo suggested we just send the equip-arrows message instead. [Skotlex]
//clif->skill_fail(sd, skill_id, USESKILL_FAIL_THIS_WEAPON, 0, 0);
/* Fall through */
// type&2: consume items (after skill was used)
// type&1: consume the others (before skill was used)
// TarotCard will consume sp in skill_cast_nodamage_id [Inkfish]
//Zeny is reduced on skill->attack.
//Gemstones are checked, but not subtracted from inventory.
/* temporarily disabled, awaiting for kenpachi to detail this so we can make it work properly */
// not 0
// 0
// Hocus-Pocus don't have requirements.
// Turn off check.
/* Fall through */
// invalid skill id
//Assume this skill is using the weapon, therefore it requires arrows.
//Enable use on all ammo types.
//Don't delete items when hom is already out.
// celest
// no gems required at level 1-5
// All gem skills except Hocus Pocus and Ganbantein can cast for free with Mistress card [helvetica]
// Hocus Pocus always use at least 1 gem
// Hocus Pocus always use at least 1 gem
/* requirements are level-dependent */
// Check for cost reductions due to skills & SCs
//FIXME: Need real data. this is a custom value.
//It should consume whatever is left as long as it's at least 1.
// must consume all regardless of the amount required
/*==========================================
// calculate base cast time (reduced by dex)
// not instant cast
// instant cast
// calculate cast time reduced by item/card bonuses
// config cast time multiplier
// return final cast time
//ShowInfo("Castime castfix = %d\n",time);
/*==========================================
// mobs casttime is fixed nothing to alter.
//ShowInfo("Castime castfix_sc = %d\n",time);
// mobs casttime is fixed nothing to alter.
// fixed time
// variable time
// no fixed cast time
// Increases/Decreases fixed/variable cast time of a skill by item/card bonuses.
// bonus bVariableCast
// bonus bFixedCast
// bonus2 bSkillFixedCast
// bonus2 bSkillVariableCast
// bonus2 bVariableCastrate
// bonus2 bFixedCastrate
// All variable cast additive bonuses must come first
// Variable cast reduction bonuses
//Reduces 30% Variable Cast Time of Water spells.
// Fixed cast reduction bonuses
// [{(Caster?s INT / 15) + (Caster?s Base Level / 15) + (Radius Skill Level x 5)}] %
// Fixed cast non percentage bonuses
// bonus2 bVariableCastrate
// now compute overall factors
// reduction from status point
// underflow checking/capping
/*==========================================
//Will use picked skill's delay.
// If set to <0, add to attack motion.
// Delay reductions
//Monk combo skills have their delay reduced by agi/dex.
// There is no Delay on Basilica creation, only on cancel
// if skill delay is allowed to be reduced by dex
//To be capped later to minimum.
// if skill delay is allowed to be reduced by agi
//To be capped later to minimum.
// After Delay of Wind element spells reduced by 50%.
//min delay
// Delay can never be below amotion [Playtester]
//        ShowInfo("Delay delayfix = %d\n",time);
/*=========================================
/*==========================================
//Failed....
// No item selected ('Cancel' clicked)
//Invalid index??
//Again invalid item....
// Lv1/2/3/4 weapons consume 1 Iron Ore/Iron/Steel/Rough Oridecon
// Armors consume 1 Steel
/* clear broken state */
// FIXME: is this the correct reason flag?
/*==========================================
/*==========================================
// if the item isn't refinable
// Aegis leaked formula. [malufett]
// FIXME: is this the correct reason flag?
// Fame point system [DracoRPG]
// Success to refine to +10 a lv1 weapon you forged = +1 fame point
// Success to refine to +10 a lv2 weapon you forged = +25 fame point
// Success to refine to +10 a lv3 weapon you forged = +1000 fame point
/*==========================================
// Player must learn the skill before doing auto-spell [Lance]
//Soul Linker bonus. [Skotlex]
/*==========================================
/*==========================================
//Frost Joke / Scream cannot target invisible or MADO Gear characters [Ind]
//It has been reported that Scream/Joke works the same regardless of woe-setting. [Skotlex]
/*==========================================
/*==========================================
//This is the target of the skill, do a full attack and skip target checks.
//Skills that don't require the animation to be removed
//Area-splash, disable skill animation.
/*==========================================
//All groups to be deleted are first stored on an array since the array elements shift around when you delete them. [Skotlex]
/*==========================================
// for graffiti cleaner [Valaris]
//For Ranger's Detonator [Jobbie/3CeAM]
//List of Hunter and Ranger Traps that can be detonate.
/*==========================================
/* guild auras are not canceled! */
//Check for offensive Land Protector to delete both. [Skotlex]
// SA_LANDPROTECTOR blocks everything except songs/dances/traps (and NOLP)
// TODO: Do these skills ignore land protector when placed on top?
// Don't touch song/dance.
// The official implementation makes them fail to appear when casted on top of ANYTHING
// but I wonder if they didn't actually meant to fail when casted on top of each other?
// hence, I leave the alternate implementation here, commented. [Skotlex]
/*
//These cannot override each other.
//Can't be placed on top of these
//Cheap 'hack' to notify the calling function that duration should be doubled [Skotlex]
//These can't be placed on top of themselves (duration can't be refreshed)
//SA_LANDPROTECTOR blocks everything except songs/dances/traps (and NOLP)
/*==========================================
/**
// Don't let enemy_count be 0 when spliting trap damage
/*==========================================
/* Fall through */
/* Fall through */
/*==========================================
//Check for walls.
//End cloaking.
//Remove wall bonus
//Add wall speed bonus
/**
//Avoid cloaking with no wall and low skill level. [Skotlex]
//Due to the cloaking card, we have to check the wall versus to known
//skill level rather than the used one. [Skotlex]
//if (sd && val1 < 3 && skill->check_cloaking(bl,NULL))
/**
//Check for walls.
//End camouflage.
//Remove wall bonus
/* because damage can cancel it */
/*==========================================
// crash-protection against poor coding
// invisible in PvP/GvG
// always invisible
// perform oninit actions
//Check for dissonance.
/*==========================================
//Cancel dissonance effect.
// invoke onout event
// perform ondelete actions
// hack to avoid clientside cell bug
// AS_CLOAKING in low levels requires a wall to be cast, thus it needs to be
// checked again when a wall disapears! issue:8182 [Panikon]
// Use 3x3 area to check for users near cell
// Note : Removing the unit don't remove the status (official info)
// Someone Trapped
// Remove the Unit ID
// don't free yet
/*==========================================
/// Returns the target skill_unit_group or NULL if not found.
/// Returns a new group_id that isn't being used in skill->group_db.
/// Fatal error if nothing is available.
// available
// find next id
// available
// full loop, nothing available
// find a free spot to store the new unit group
// array is full, make room by discarding oldest group
//Since elements must have shifted, we use the last slot.
//Sanctuary starts healing +1500ms after casted. [Skotlex]
/*==========================================
//This prevents status_change_end attempting to re-delete the group. [Skotlex]
// end Gospel's status change on 'src'
// (needs to be done when the group is deleted by other means than skill deactivation)
//Remove reference to this group. [Skotlex]
// remove all unit cells
// clear Talkie-box string
// schedules deallocation of whole array (HACK)
// locate this group, swap with the last entry and delete it
/*==========================================
/*==========================================
/*==========================================
//AoE skills are ineffective. [Skotlex]
/**
// check for expiration
// skill unit expired (inlined from skill_unit_onlimit())
//clif->changetraplook(bl, UNT_FIREPILLAR_ACTIVE);
// Used Trap don't returns back to item
// revert unit back into a trap
// warp portal opens (morph to a UNT_WARP_WAITING cell)
// UNT_WARP_WAITING
// restart timers
// apply effect to all units standing on it
// If it was deactivated.
// This unit isn't removed while SC_BANDING is active.
// skill unit is still active
// icewall loses 50 hp every second
// trap's hp
//Don't continue if unit or even group is expired and has been deleted.
//Unit disabled, but it should not be deleted yet.
//Disable processed cell.
// number of live cells
//All tiles were processed, disable skill.
/*==========================================
/*==========================================
// Fiberlock is never supposed to trigger on skill->unit_move. [Inkfish]
//Necessary in case the group is deleted after calling on_place/on_out [Skotlex]
//Lullaby is the exception, bugreport:411
//Non-dualmode unit skills with a timer don't trigger when walking, so just return
//Target-type check.
//Ensemble check to see if they went out/in of the area [Skotlex]
//Clear this skill id.
//Store this skill id.
//Clear skill ids we have stored in onout.
//Store this unit id.
/*==========================================
//Onout, clear data
//Onplace, check any skill units you have left.
/*==========================================
//Ensembles may not be moved around.
//Icewalls and Wall of Thorns don't get knocked back
// m_flag:
//  0: Neither of the following (skill_unit_onplace & skill_unit_onout are needed)
//  1: Unit will move to a slot that had another unit of the same group (skill_unit_onplace not needed)
//  2: Another unit from same group will end up positioned on this unit (skill_unit_onout not needed)
//  3: Both 1+2.
//Cancel dissonance effect.
//Move Cell using "smart" criteria (avoid useless moving around)
//Cell moves independently, safely move it.
//Cell moves unto another cell, look for a replacement cell that won't collide
//and has no cell moving into it (flag == 2)
//Move to where this cell would had moved.
//Skip this cell as we have used it.
//Don't move the cell as a cell will end on this tile anyway.
//We only moved the cell in 0-1
//Check for dissonance effect.
/*==========================================
// must iterate again to check other skills that produce it. [malufett]
// special case
// cannot carry the produced stuff
// Non-weapon, non-food item (itemlv must match)
// Food (any item level between 10 and 20 will do)
// Weapon (itemlv must be higher or equal)
/*==========================================
// exclude the recipe
//A skill can be specified for some override cases.
//Note that qty should always be one if you are using these!
// FIXME: is this the correct reason flag?
// FIXME: is this the correct reason flag?
/**
// FIXME: is this the correct reason flag?
// Ores & Metals Refining - skill bonuses are straight from kRO website [DracoRPG]
//Base chance
// Temper Iron bonus: +26/+32/+38/+44/+50
// Temper Steel bonus: +35/+40/+45/+50/+55
// Star Crumbs are 100% success crafting rate? (made 1000% so it succeeds even after penalties) [Skotlex]
// Enchanted Stones
// Enchanted stone Craft bonus: +15/+20/+25/+30/+35
/**
//100% success
// Potion Preparation - reviewed with the help of various Ragnainfo sources [DracoRPG]
//Player got a homun
//His homun is a vanil with instruction change
//+1% bonus per level
//Common items, receive no bonus or penalty, listed just because they are commonly produced
// Elemental Converter Creation
// should be 100% success rate
/**
//itemid depend on makerune()
//rune rank it_diff 9 craftable rune
//Rank C
//Rank B
//Rank A
//Rank S
/**
// (620 - 20 * Skill Level)
// (Caster?s INT) + (Caster?s DEX / 2) + (Caster?s LUK) + (Caster?s Job Level) + Random number between (30 ~ 150) +
// (Caster?s Base Level - 100) + (Potion Research x 5) + (Full Chemical Protection Skill Level) x (Random number between 4 ~ 10)
// difficulty factor
// Random number between (30 ~ 150)
// (Caster?s Job Level / 4) + (Caster?s LUK / 2) + (Caster?s DEX / 3)
// FIXME[Haru]: This smells, if anyone knows the intent, please rewrite the expression in a more clear form.
// difficulty factor
// Food/Bomb creation fails.
// FIXME[Haru]: This smells. If anyone knows the intent, please rewrite the expression in a more clear form.
//Assume Cooking Dish
//Legendary Cooking Set.
//100% Success
// Weapon Forging - skill bonuses are straight from kRO website, other things from a jRO calculator [DracoRPG]
// Base
// Smithing skills bonus: +5/+10/+15
// Weaponry Research bonus: +1/+2/+3/+4/+5/+6/+7/+8/+9/+10, Oridecon Research bonus (custom): +1/+2/+3/+4/+5
// Element Stone: -20%, Star Crumb: -15% each, Weapon level malus: -0/-20/-30
// +10
// +5
// +3
// +0?
//if it's a Baby Class
//Baby penalty is 50% (bugreport:4847)
//Success, or crafting multiple items.
// CharId
//Flag is only used on the end, so it can be used here. [Skotlex]
/**
// CharId
// TODO: update PICKLOG
// 0
// Fame point system [DracoRPG]
// Success to forge a lv3 weapon with 3 additional ingredients = +10 fame point
//Apply quantity modifiers.
//Success
//Add fame as needed.
// Success to prepare 3 Condensed Potions in a row
// Success to prepare 5 Condensed Potions in a row
// Success to prepare 7 Condensed Potions in a row
// Success to prepare 10 Condensed Potions in a row
//Failure
//Visual effects and the like.
//Those that don't require a skill?
//Cooking items.
//Success
//Success
//Failure
// TODO: update PICKLOG
// 0
//25% Damage yourself, and display same effect as failed potion.
/* Fall through */
// Fame point system [DracoRPG]
// FIXME[Haru]: This '%1' is certainly not intended. If anyone knows the purpose, please rewrite this code.
//Cooking items.
// FIXME: is this the correct reason flag?
// CharId
// t_lv used to take duration from skill->get_time2
// Status must be forced to end so that a new poison will be applied if a player decides to change poisons. [Rytech]
// 2 + 2 * skill_lv
//in Aegis it store the level of GC_RESEARCHNEWPOISON in val1
// non-offensive and non-magic skills do not affect the status
// update current display.
// Spawn Position
// FIXME: is this intended to be there twice?
// Warlock Spellbooks. [LimitLine/3CeAM]
// Search for information of this item
// User don't know the skill
// This is how official saves spellbook. [malufett]
// increase points
// The level the skill will be autocasted
// Probability at level 10 was increased to 15.
// Level 1
// Level 2
// At level 2 have a fail chance. You loose your items if it fails.
// Search for objects that can be created.
// Verification of overlap between the objects required and the list submitted.
// must be in exact amount
// match
// No more items required
/**
// Traps aren't recovered.
/*==========================================
/**
// create a new skill cooldown object for map storage
/* duplicate, update necessary */
// Don't do anything if there's already a tick longer than the incoming one
/* somehow, the timer vanished. (bugreport:8367) */
// [orn]
// [orn]
// [orn]
/**
/*
//No data found.
//Single value, have the whole range have the same value.
//Check for linear change with increasing steps until we reach half of the data acquired.
//No match, try next step.
//Apply linear increase
//Check if we have switched from + to -, cap the decrease to 0 in said cases.
//Okay.. we can't figure this one out, just fill out the stuff with the previous value.
/*
//when != it was already cleared during skill_defaults() no need to repeat
// standard square layouts go first
// afterwards add special ones
//Warlock
// these will be handled later
//Level 1 (count 4, cross of 3x3)
//Level 2-3 (count 8, cross of 5x5)
//Level 4-5 (count 12, cross of 7x7
//lv1
//lv2/3
//lv4/5
//Fill in the rest using lv 5.
//Skip, this way the check below will fail and continue to the next skill.
// firewall and icewall have 8 layouts (direction-dependent)
// For each Direction
// Can do it
// Can't do it.
// Skills that need to be confirmed.
// Can't do it.
// needs more info
/**
/**
// always check to make sure the session properly exists
// no skill cooldown is associated with this character
// process each individual cooldown associated with the character
// expired cooldowns will be 1, so they'll expire in the normal way just after this.
// ProduceItemID,ItemLV,RequireSkill,Requireskill_lv,MaterialID1,MaterialAmount1,......
// SourceID,MakeID1,MakeAmount1,...,MakeID5,MakeAmount5
// skill_id,PreservePoints
// SkillID,Rate
// Still need confirm it.
// SkillID
// skill_id,DummyName,RequiredHocusPocusLevel,Rate
// ProductID,BaseRate,MakeAmount1,MakeAmountRate1...,MakeAmount5,MakeAmountRate5
/**
// enough to contain "Lv100" in case of custom MAX_SKILL_LEVEL
/**
/**
/**
/**
/**
// enough to contain "Lv100" in case of custom MAX_SKILL_LEVEL
/**
/**
/**
/*  MAX_SINGLE_WEAPON_TYPE excluded */
// invalid type
/**
/**
// Invalid Entry
/**
/**
/**
// TODO: Per-level item requirements are not implemented yet!
// We just take the first level for the time being (old txt behavior)
/**
//By default, target just characters.
/**
// Invalid Type
/**
/**
// Does nothing like a boss. *cough* plugins *cough*
/**
/* Direct assignment of temporary skill storage to skill db */
/* Put skill name in name2id DB */
/* Set Name to Id script constants */
/**
// Libconfig error report.
// Possible Syntax error.
/* Skill ID */
/* Skill Name Constant */
/* Skill Description */
/* Max Level */
/* Range */
/* Hit Type */
/* Skill Type */
/* Skill Info */
/* Skill Attack Type */
/* Skill Element */
/* Damage Type */
/* Splash Range */
/* Number of Hits */
// Default 1
/* Interrupt Cast */
/* Cast Defense Rate */
/* Skill Instances */
/* Knock-Back Tiles */
/**
/* Cast Time */
/* After Cast Act Delay */
/* After Cast Walk Delay */
/* Skill Data/Duration */
/* Skill Data/Duration 2 */
/* Skill Cool Down */
/* Fixed Casting Time */
/* Cast Time Options */
/**
/* HP Costs */
/* Max HP Trigger */
/* SP Cost */
/* HP Rate */
/* SP Rate */
/* Zeny Cost */
/* Spirit Sphere Cost */
/* Weapon Types */
/* Ammunition Types */
/* Ammunition Amount */
/* State */
/* Spirit Sphere Cost */
/* Item Requirements and Amounts */
/**
/* Unit IDs [1,2] */
/* Layout */
/* Range */
/* Interval */
/* Flag */
/* Target */
/* Additional Fields for Plugins */
// Validate the skill entry, add it to the duplicate array and increment count on success.
/*===============================
// init skill db structures
/* when != it was called during init and this procedure was already performed by skill_defaults()  */
// load skill databases
// refresh ItemDB constants before loading of skills
// ENABLE_CASE_CHECK
// ENABLE_CASE_CHECK
//Warlock
//Guillotine Cross
//[Ind/Hercules] refresh index cache
/* lets update all players skill tree : so that if any skill modes were changed they're properly updated */
/*==========================================
/* initialize the interface */
/* */
/* */
/* */
/* accessors */
/* Skill DB Libconfig */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\status.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// ANTI_MAYAP_CHEAT, DBPATH, DEFTYPE_MAX, DEFTYPE_MIN, DEVOTION_REFLECT_DAMAGE, RENEWAL, RENEWAL_ASPD, RENEWAL_EDP
/**
/**
/**
/**
// indicates that the status displays a visual effect for the affected unit, and should be sent to the client for all supported units
//First we define the skill for common ailments. These are used in skill_additional_effect through sc cards. [Skotlex]
//The main status definitions
// Homunculus S
/**
/**
/**
/**
/**
/**
/**
// Renewal: atk2 & def2
/**
/**
/**
/**
// it does show the snow icon on mobs but doesn't affect it.
// At the moment, no icon on officials
/**
/**
// Elemental Spirit summoner's 'side' status changes.
// Storing the target job rather than simply SC_SOULLINK simplifies code later on.
// Other SC which are not necessarily associated to skills.
// Cash Items
// Mercenary Bonus Effects
// Guillotine Cross Poison Effects
// Royal Guard status
// Mechanic status
// Other skills status
// Geneticist Foods / Throwable items
// Geffen Scrolls
// Monster Transform
// Eden Crystal Synthesis
// Geffen Magic Tournament
// MVP Scrolls
// Clan System
// Costumes
//Min elemental level.
//For copying a status_data structure from b to a, without overwriting current Hp and Sp
/**
/**
//Assume all was charged so there are no 'not enough' fails.
//Inflicts damage on the target with the according walkdelay.
//If flag&1, damage is passive and does not triggers canceling status changes.
//If flag&2, fail if target does not has enough to subtract.
//If flag&4, if killed, mob must not give exp/loot.
//flag will be set to &8 when damaging sp of a dead character
/* From here onwards, we consider it a 32-type as the client does not support higher and the value doesn't get through percentage modifiers */
//Not a valid SP target.
//Assume absorbed damage.
// Let through. battle.c/skill.c have the whole logic of when it's possible or
// not to hurt someone (and this check breaks pet catching) [Skotlex]
//Cannot damage a bl not on a map, except when "charging" hp/sp
// 0
//Endure count is only reduced by non-players on non-gvg maps.
//val4 signals infinite endure. [Skotlex]
// stop walking when attacked in disguise to prevent walk-delay bug
//Still lives or has been dead before this damage.
//To let the dead function cast skills and all that.
//NOTE: These dead functions should return: [Skotlex]
//0: Death canceled, auto-revived.
//Non-zero: Standard death. Clear status, cancel move/attack, etc
//&2: Also remove object from map.
//&4: Also delete object from memory.
//Unhandled case, do nothing to object.
//Death canceled.
//Normal death
//Reset regen ticks.
//flag&8 = disable Kaizel
//Look for Osiris Card's bonus effect on the character and revive 100% or revive normally
// Ensure the monster has not already reborn before doing so.
//Delete from memory. (also invokes map removal code)
//remove from map
//Some death states that would normally be handled by unit_remove_map
/**
/* From here onwards, we consider it a 32-type as the client does not support higher and the value doesn't get through percentage modifiers */
//-INT_MIN == INT_MIN in some architectures!
//End auto berserk.
// send hp update to client
//Does percentual non-flinching damage/heal. If mob is killed this way,
//no exp/drops will be awarded if there is no src (or src is target)
//If rates are > 0, percent is of current HP/SP
//If rates are < 0, percent is of max HP/SP
//If !flag, this is heal, otherwise it is damage.
//Furthermore, if flag==2, then the target must not die from the subtraction.
//Must not kill target.
//Ugly check in case damage dealt is too much for the received args of
//status->heal / status->damage. [Skotlex]
//Invalid target.
//Animation only if character is already on a map.
//Invalid target.
//Animation only if character is already on a map.
/*==========================================
// *pcblock script command
//Normal attack checks.
//This mode is only needed for melee attacking.
//Dead state is not checked for skills as some skills can be used
//on dead characters, said checks are left to skill.c [Skotlex]
// Items that cast skills using 'itemskill' will not be handled by map_zone_db.
/* is boss */
/* is not boss */
//Gloria Avoids pretty much everything....
//Should fail when used on top of Land Protector [Skotlex]
//Stunned/Frozen/etc
//Can't cast, casted stuff can't damage.
//Targeted spells can't come off.
//Prevents skill usage
// Lvl 5 Lesson or higher allow you use 3rd job skills while dancing.v
//Allow everything except dancing/re-dancing. [Skotlex]
//Can't amp out of Wand of Hermode :/ [Skotlex]
/* Do not block item-casted skills.*/ && (src->type != BL_PC || sd->skillitem != skill_id)) {
//Skills blocked through status changes...
//Blocked only from using the skill (stuff like autospell may still go through
//Only skill you can use is marionette again to cancel it
//Cannot use marionette if you are being buffed by another
//Skill blocking.
//##TODO## make this a flag in skill_db?
// Skills that can be used even under Man Hole effects.
//Usable skills while hiding.
//Non players can use all skills while hidden.
//New mounts can't attack nor use skills in the client; this check makes it cheat-safe [Ind]
//No further checking needed.
/* attacks in invincible are capped to 1 damage and handled in batte.c; allow spell break and eske for sealed shrine GDB when in INVINCIBLE state. */
//If targeting, cloak+hide protect you, otherwise only hiding does.
// Applies even if the target hides
// Ground type
// Buff/debuff skills started before hiding
//god-knows-why gcc doesn't shut up until this happens
//Allow targeting of items to pick'em up (or in the case of mobs, to loot them).
//TODO: Would be nice if this could be used to judge whether the player can or not pick up the item it targets. [Skotlex]
// Can't use support skills on Homunculus (only Master/Self)
// Can't use Weapon endow skills on Mercenary (only Master)
// Can't use Potion Pitcher on Mercenaries
//Check for chase-walk/hiding/cloaking opponents.
//Skotlex: Calculates the initial status for the given mob
//first will only be false when the mob leveled up or got a GuardUp level.
//Set basic level on respawn.
//Check if we need custom base-status
//No special status required.
/* minimum for the unit to function properly */
//Max HP setting from Summon Flora/marine Sphere
//Remove special AI when this is used by regular mobs.
// different levels of HP according to skill level
//AM_CANNIBALIZE
// increase from mobs leveling up [Valaris]
// change for sized monsters [Valaris]
// Strengthen Guardians - custom value +10% / lv
//Initial battle status
//Skotlex: Calculates the stats of the given pet.
// pets discard all modes, except walking
// attack support requires the pet to be able to attack
//Lv Up animation
//Not done the first time because the pet is not visible yet
//Support rate modifier (1000 = 100%)
//Triple max SP for top ranking Taekwons over level 90.
//Supernovice lvl99 hp bonus.
//Extented Supernovice lvl150 hp bonus.
//Trans classes get a 25% hp bonus
//Baby classes get a 30% hp penalty
//Triple max HP for top ranking Taekwons over level 90.
// +1% per each point of VIT
/**
/**
// the minimum for the respawn setting is SP:1
/* Just used for Plugin to give bonuses. */
//Calculates player data from scratch without counting SC adjustments.
//Should be invoked whenever players raise stats, learn passive skills or change equipment.
//Check for recursive call preemption. [Skotlex]
// pointer to the player's base status
// previous skill tree
// previous weight
//Too many recursive calls!
// remember player-specific values that are currently being shown to the client (for refresh purposes)
// SkillTree calculation
//Load Hp/SP from char-received data.
// these are not zeroed. [zzo]
// zeroed arrays
//Clear intravision as long as nothing else is using it
// FIXME: Most of these stuff should be calculated once, but how do I fix the memset above to do that? [Skotlex]
// Give them all modes except these (useful for clones)
//[Lupus]
// Autobonus
// Parse equipment.
//We pass INDEX to status->current_equip_item_index - for EQUIP_SCRIPT (new cards solution) [Lupus]
/* ammo has special handler down there */
//Execute equip-script on login
// sanitize the refine level in case someone decreased the value in between
// Left-hand weapon
// renewal magic attack refine bonus
//Overrefined bonus.
//Abort, script->run retriggered this. [Skotlex]
// Forged weapon
// 3 Star Crumbs now give +40 dmg
//Do not overwrite element from previous bonuses.
//Shield
//Shield
//Abort, script->run retriggered this. [Skotlex]
// Arrows
//don't run scripts on throwable items
//Abort, script->run retriggered status_calc_pc. [Skotlex]
/* we've got combos to process */
/**
//Abort, script->run retriggered this.
//Store equipment script bonuses
//Parse Cards
//We pass INDEX to status->current_equip_item_index - for EQUIP_SCRIPT (new cards solution) [Lupus]
/* ammo doesn't have cards */
//Card script execution.
// Uses MAX_SLOTS to support Soul Bound system [Inkfish]
//Execute equip-script on login
//Left hand status.
//Abort, script->run his function. [Skotlex]
/* parse item options [Smokexyz] */
//Abort, script->run his function. [Skotlex]
// Clan Buffs
// Pet Bonus
//param_bonus now holds card bonuses.
// Damage modifiers from weapon type
//When Riding with spear, damage modifier to mid-class becomes
//same as versus large size.
// ----- STATS CALCULATION -----
// Job bonuses
// If a Super Novice has never died and is at least joblv 70, he gets all stats +10
// Absolute modifiers from passive skills
// +1 INT / 2 lv
// Bonuses from cards and equipment as well as base stat, remember to avoid overflows.
// ------ BASE ATTACK CALCULATION ------
// Base batk value is set on status->calc_misc
// weapon-type bonus (FIXME: Why is the weapon_atk bonus applied to base attack?)
// Absolute modifiers from passive skills
// it doesn't work in RE.
// ----- HP MAX CALCULATION -----
// Basic MaxHP value
//We hold the standard Max HP here to make it faster to recalculate on vit changes.
//This is done to handle underflows from negative Max HP bonuses
// Absolute modifiers from passive skills
// Apply relative modifiers from equipment
// ----- SP MAX CALCULATION -----
// Basic MaxSP value
//This is done to handle underflows from negative Max SP bonuses
// Absolute modifiers from passive skills
// Apply relative modifiers from equipment
// ----- RESPAWN HP/SP -----
//
//Calc respawn hp and store it on base_status
// ----- MISC CALCULATION -----
//Equipment modifiers for misc settings
// ----- HIT CALCULATION -----
// Absolute modifiers from passive skills
// is this correct in pre? there is already hitrate bonus in battle.c
// ----- FLEE CALCULATION -----
// Absolute modifiers from passive skills
// ----- EQUIPMENT-DEF CALCULATION -----
// Apply relative modifiers from equipment
// ----- EQUIPMENT-MDEF CALCULATION -----
// Apply relative modifiers from equipment
// ----- ASPD CALCULATION -----
// Unlike other stats, ASPD rate modifiers from skills/SCs/items/etc are first all added together, then the final modifier is applied
// Basic ASPD value
// Relative modifiers from passive skills
// needs more info
// ----- DMOTION -----
//
// ----- MISC CALCULATIONS -----
// Weight
// Skill SP cost
//Underflow protections.
// Anti-element and anti-race
// Update the card-bonus data
// Agi
// Dex
//This status change should grant card-type elemental resist.
// Undead Scroll
// Geffen Scrolls
// Geffen Magic Tournament
// ----- CLIENT-SIDE REFRESH -----
//Will update on LoadEndAck
// Spirit Marble status activates automatically for a infinite
// amount of time when the skill is learned. Felt this was the
// best place to put this. [Rytech]
//[orn]
//It seems adelay = amotion for Homunculus.
//Calculates base regen values.
//Only players have skill/sitting skill regen for now.
// Skill-related recovery (only when sit)
//Power up Enjoyable Rest
//Calculates SC related regen rates.
//No regen
//No natural SP regen
// Tension relax allows the user to recover HP while overweight
// at 1x speed. Other SC ignored? [csnv]
// HP Regen applies only in Pre-renewal
//Remove regen as specified by val4
//if insignia lvl 1
// Recovery Items
/// Recalculates parts of an object's battle status according to the specified flags.
/// @param flag bitfield of values from enum scb_flag
/*enum scb_flag*/int flag)
/** [Playtester]
/** [Skotlex]
//No difference.
//Should not affect weapon refine bonus
//Since mode changed, reset their state.
// No status changes alter these yet.
//if(flag&SCB_SIZE)
//if(flag&SCB_RACE)
//if(flag&SCB_RANGE)
//FIXME: Should perhaps a status_zap should be issued?
//It's safe to ignore bst->dmotion since no bonus affects it.
// mercenary and mobs
// absolute percentage modifier
// mercenary and mobs
/// Recalculates parts of an object's base status and battle status according to the specified flags.
/// Also sends updates to the client wherever applicable.
/// @param flag bitfield of values from enum scb_flag
/// @param first if true, will cause status_calc_* functions to run their base status initialization code
// previous battle status
// pointer to current battle status
/* clear and move on */
/* flag and stop */
// remember previous values
// calculate the object's base status too
// pets are not affected by statuses
// Otherwise, the mob will spawn with lower MATK values
// assume there will be no statuses active
// client update handled by caller
// compare against new values and send client updates
//Checks whether the source can see and chase target.
/* NPCs don't care for the rest */
//Check for chase-walk/hiding/cloaking opponents.
// Basic ASPD value
/* [malufett/Hercules] */
// base weapon delay
// single weapon
// dual-wield
// percentual delay reduction from stats
// raw delay adjustment from bAspd bonus
/* angra manyu disregards aspd_base and similar */
//Normally only players have base-atk, but homunc have a different batk
// equation, hinting that perhaps non-players should use this for batk.
// [Skotlex]
// FIXME: What should go here?
// 0
// ! RENEWAL
// RENEWAL
// not RENEWAL
// RENEWAL
// temporary until all are formulated
//Fills in the misc data that can be calculated from the other status info (except for level)
//Non players get the value set, players need to stack with previous bonuses.
// renewal formulas
// Increase. Already initialized in status_calc_homunculus_
//base level + ( every 1 dex = +1 hit ) + (every 3 luk = +1 hit) + 175
//base level + ( every 1 agi = +1 flee ) + (every 5 luk = +1 flee) + 100
//base level + (every 2 vit = +1 def) + (every 5 agi = +1 def)
//(every 4 base level = +1 mdef) + (every 1 int = +1 mdef) + (every 5 dex = +1 mdef) + (every 5 vit = +1 mdef)
// not RENEWAL
// RENEWAL
//(every 1 luk = +0.3 critical)
//(every 10 luk = +1 perfect flee)
//Players don't have a critical adjustment setting as of yet.
/* Fall through */
/*==========================================
// added based on skill updates [Reddozen]
// added based on skill updates [Reddozen]
/* some statuses that are hidden in the status window */
//water type
//Curse shouldn't effect on this?  <- Curse OR Bleeding??
// 0
// Eden Crystal Synthesis
/* some statuses that are hidden in the status window */
//70 lvl1, 100lvl2
/* some statuses that are hidden in the status window */
// take note fixed value first before % modifiers
//70 lvl1, 100lvl2
// Eden Crystal Synthesis
// Geffen Magic Tournament
/* some statuses that are hidden in the status window */
/* some statuses that are hidden in the status window */
// RockmanEXE; changed based on updated [Reddozen]
//custom
/* some statuses that are hidden in the status window */
// SG skill [Komurka]
// 10% Flee reduction
// mob
// water type
// should be final and unmodifiable by any means
/* some statuses that are hidden in the status window */
/* some statuses that are hidden in the status window */
// does not provide 90 DEF in renewal mode
//[orn]
// Provoke doesn't alter player defense->
/* some statuses that are hidden in the status window */
//in renewal only the VIT stat bonus is boosted by angelus
/* some statuses that are hidden in the status window */
// no longer provides 90 MDEF in renewal mode
// It has been confirmed that eddga card grants 1 MDEF, not 0, not 10, but 1.
// Final MDEF increase divided by 10 since were using classic (pre-renewal) mechanics. [Rytech]
/* some statuses that are hidden in the status window */
//GetMoveHasteValue2()
//Same bonus
//GetMoveSlowValue()
// Longing for Freedom cancels song/dance penalty
// Used by Slow_Down_Potion [Frost]
// Should be 50 (-50% speed)
//+90% walking speed.
// It stacks to other statuses so always put this at the end.
// Doesn't affect the movement speed by Quagmire, Decrease Agi, Slow Grace [Frost]
// permanent item-based speedup
//GetMoveHasteValue1()
// Used by NPC_AGIUP [Frost]
// Used by Speed_Up_Potion and Guyak_Pudding [Frost]
// permanent item-based speedup
//GetSpeed()
// ChangeSpeed
// flag&1 - fixed value [malufett]
// flag&2 - percentage value
// ASPD fixed values
// needs more info
// ASPD percentage values
// needs more info
// needs more info
// TODO: SC_SWING shouldn't stack with skill1 modifiers
// +5 ASPD
// should be final and unmodifiable by any means
// will be recap for proper bl anyway
/// Calculates an object's ASPD modifier (alters the base amotion value).
/// Note that the scale of aspd_rate is 1000 = 100%.
// It has been confirmed on official servers that MvP mobs have no dmotion even without endure
// Fix amount.
// Max HP decrease: [Skill Level x 4] %
// Max HP increase: [Skill Level x 2] %
/**
//Set mode
//Add mode
//Del mode
/**
/*==========================================
//Class used on all code should be the view class of the mob.
/*==========================================
//Only BL with speed data but no status_data [Skotlex]
//Guardian's guild [Skotlex]
// Guardian guild data may not been available yet, castle data is always set
//Alchemist's mobs [Skotlex]
//Guardian's guild [Skotlex]
//Alchemist's mobs [Skotlex]
//Adapt class to a Mounted one.
//[blackhole89]
/// Returns the status_change data of bl or NULL if it doesn't exist.
/**
//Percentual resistance: 10000 = 100% Resist
//Example: 50% -> sc_def=5000 -> 25%; 5000ms -> tick_def=5000 -> 2500ms
//-1 = use sc_def
//Linear resistance substracted from rate and tick after percentual resistance was applied
//Example: 25% -> sc_def2=2000 -> 5%; 2500ms -> tick_def2=2000 -> 500ms
// If no source, it can't be resisted (NPC given)
/// Returns the 'bl's level, capped to 'cap'
/// returns the difference between the levels of 'bl' and 'src', both capped to 'maxlv', multiplied by 'factor'
//Status that are blocked by Golden Thief Bug card or Wand of Hermod
// Protects against status effects
//For players: 60000 - 450*vit - 100*luk
//For monsters: 30000 - 200*vit
// Linear reduction instead
// kRO balance update lists this formula
//Half duration for players.
//No duration reduction
//No duration reduction
//Caster can increase final duration with luk
// Special property: immunity when luk is zero
// Curse only has a level penalty and no resistance
// Lasts 5 times less on bosses
//Duration greatly reduced for players.
// Linear Reduction of Rate
//5 second (Fixed) + 25 second - {( INT + LUK ) / 20 second }
//5 second (fixed) + { Stasis Skill level * 5 - (Target's VIT + DEX) / 20 }
// 100% on caster
// 100% - (100 - 0.8 x INT)
/* Fall through */
// {(Base Success chance) - (Target's AGI / 4)}
//Effect that cannot be reduced? Likely a buff.
//Status resist
//Status resistance.
//When tick def not set, reduction is the same for both.
//Natural resistance
//Minimum chances
//Minimum of 5%
//Minimum of 50%
//Item resistance (only applies to rate%)
//Aegis accuracy
//Even if a status change doesn't have a duration, it should still trigger
//Rate reduction
//Minimum durations
//Minimum duration 5s
// Minimum duration 10s
//Skills need to trigger even if the duration is reduced below 1ms
/* [Ind/Hercules] fast-checkin sc-display array */
/* the all-mighty compact-o-matic */
/**
//Unable to receive status changes
// SC_NOCHAT should work even on dead characters
//Emperium/BG Monsters can't be afflicted by status changes
//prevent status addinh hp to gvg mob (like bloodylust=hp*3 etc...
// 0
//Adjust total_tick according to status resistances
// Check for inmunities / sc fails
//Undead are immune to Freeze/Stone
// SC_LEXAETERNA should be removed when applying SC_STONE or SC_FREEZE
//Cannot override other opt1 status changes. [Skotlex]
//Immune to Frozen and Freezing status if under Warmer status. [Jobbie]
// There all like berserk, do not everlap each other
// Only affects demons and undead element (but not players)
// Overthrust can't take effect if under Max Overthrust. [Skotlex]
// Overthrust and Overthrust Max cannot be used on Mado Gear [Ind]
// Adrenaline doesn't affect Mado Gear [Ind]
// Mado is immune to magnificat
// Mado is immune to wind walk, cart boost, etc (others above) [Ind]
// Pile up with previous values.
// Base mode
//Del mode
//Add mode
//No change.
//Abort previous status
//Strip skills, need to divest something or it fails.
//apply sc anyway if loading saved sc_data
//Reuse to check success condition.
//Minimal duration: Only strip without causing the SC
//GX effect. Do not take shield off..
//Minimal duration: Only strip without causing the SC
//Minimal duration: Only strip without causing the SC
//Minimal duration: Only strip without causing the SC
// Stats only for Mercenaries
//L-Accessory
//R-Accessory
//Minimal duration: Only strip without causing the SC
// it doesn't stack or even renewed
//Check for BOSS resistances
//Before overlapping fail, one must check for status cured.
//Check for overlapping fails
//Can't be re-closed in.
//Otherwise your Hp/Sp would get refilled while still within effect of the last invocation.
//Must not override a casting gospel char.
//Don't let you override infinite endure.
//Kaahi overwrites previous level regardless of existing level.
//Delete timer if it exists.
//When a player is already jailed, do not edit the jail data.
//you cannot override master guild aura
// stackable ailments
//Return true to not mess up skill animations. [Skotlex]
// Do not parse val settings when loading SCs
// Fall through to SC_INC_AGI
//Agi change
// Hit-count [Celest]
//val4 signals infinite endure (if val4 == 2 it is infinite endure from Berserk)
//Def reduction
// duration sent to the client should be infinite
// [Celest]
//Chance to Poison enemies.
//Damage increase (+50 +50*lv%)
//[Ind] - iROwiki says each level increases its duration by 3 seconds
// Number of counters [Skotlex]
// + 5*val1; //Chance to counter. [Skotlex]
//SP gained
//%Max HP to absorb
// val4 holds current about of party memebers when casting AB_PRAEFATIO,
// as Praefatio's barrier has more health and blocks more hits than Kyrie Elesion.
//== PR_KYRIE
// Hits
//== AB_PRAEFATIO
//Increase barrier strength per party member.
// use skill level to determine barrier health.
//val1: Skill lv
//Lasts 1 invocation
//Matk% increase
// 0 = ready to be used, 1 = activated and running
//Lasts 5 hits
//Poisoning Chance (2.5+0.5%) in 1/10000 rate
// val1 : Element Lvl (if called by skill lvl 1, takes random value between 1 and 4)
// val2 : Element (When no element, random one is picked)
// val3 : 0 = called by skill 1 = called by script (fixed level)
// Max Level
// Not need to keep this info.
//Race/Ele resist
// %Dmg reflected
//Watk reduction
//Def reduction
//Vit reduction
//Int reduction
//Val1 Skill LV of Autospell
//Val2 Skill ID to cast
//Val3 Max Lv to cast
//Chance of casting
//Watk increase
//Flee increase
//HP increase
//No penalties.
//Agi penalty
//Walk speed penalty
//For boss casted skills [Skotlex]
//val1 : Skill ID + LV
//val2 : Skill Group of the Dance.
//val3 : Brings the skill_lv (merged into val1 here)
//val4 : Partner
//Tick duration
// [GodLesZ] tick time
//Aspd penalty.
//Cri bonus
// Store previous values as they could be removed.
// A hardcoded interval of 60 seconds is expected, as the time that SC_NOCHAT uses is defined by
// mmocharstatus.manner, each negative point results in 1 minute with this status activated
// This is done this way because the message that the client displays is hardcoded, and only
// shows how many minutes are remaining. [Panikon]
//Mute filters.
//Petrified HP-damage iterations.
//Petrifying time.
// not with WL_SIENNAEXECRATE
//Min time
//Actual status changes take effect on petrified state.
//Lose 10/15% of your life as long as it doesn't brings life below 25%
// fall through
//Damage iterations
// [GodLesZ] tick time
//val4: HP damage
// [GodLesZ] tick time
// val1 = heal percent/amout
// val2 = seconds between heals
// val4 = total of heals
// [GodLesZ] tick time
// Search for Boss on this Map
// No MVP on this map - MVP is dead
// No need to start SC
// [GodLesZ] tick time
// [GodLesZ] tick time
// unused, previously speed adjustment
//Seconds before SP substraction happen.
//Interval at which SP is drained.
//Speed adjustment.
//SP cost.
//Monsters should be able to walk with no penalties. [Skotlex]
//SP consumption rate.
// duration sent to the client should be infinite
// unused, previously walk speed adjustment
//val4&1 signals the presence of a wall.
//val4&2 makes cloak not end on normal attacks [Skotlex]
//val4&4 makes cloak not end on using skills
//Standard cloaking.
/* splash status */
//Val2 should bring the skill-id.
// [GodLesZ] tick time
//Permanent effects.
//Damage reduction
// unused, previously speed adjustment
//Aspd adjustment
//See if there are devoted characters, and pass the status to them. [Skotlex]
//SP cost
//Decrease at 10secs intervals.
// duration sent to the client should be infinite
// [GodLesZ] tick time
//Block Chance
// Flee bonus is 1/1/2/2/3/3/4/4/5/5
//HP healing is performing after the calc_status call.
//Val2 holds HP penalty
//Val4 holds damage interval
//val3 holds skill duration
// [GodLesZ] tick time
// self effect
// [GodLesZ] tick time
//Remove buffs/debuffs
// fetch caster information
// fetch target's stats
// battle status
//Cap to 99 (default)
//1st Transcendent Spirit works similar to Marionette Control
// Fetch target's stats
// Battle status
//Reflect chance
//Reflections
//Memorized casts.
//aspd reduction
//HP Regerenation rate: 200% 200% 300%
//SP Regeneration Rate: 100% 200% 300%
//if val4 comes set, this blocks regen rather than increase it.
// Inherits Status From Source
//Coma. Sends a char to 1HP. If val2, do not zap sp
//Start lock on caster.
//Increase count of locked enemies and refresh time.
//Status failed.
//Number of bounces: 1 + skill_lv/5
//33*3 + 1 -> 100%
//33, 66%
//Dodge 1 attack total.
//Custom. For high level mob usage, higher level means more blocks. [Skotlex]
//val1: Skill ID
//val2: When given, target (for autotargetting skills)
//val3: When set, this combo time should NOT delay attack/movement
//val3: If set to 2 this combo will delay ONLY attack
//val3: TK: Last used kick
//val4: TK: Combo time
//Chance to consume: 11-skill_lv%
//Store time at which you started running.
// Note: this int64 value is stored in two separate int32 variables (FIXME)
//HP heal
//SP cost
//Kaahi Timer.
//0 -> Half stat.
//Store the card-bonus data that should not count in the %
//Agi
//Dex
//Power increase
//val2 holds if it was casted on self, or is bonus received from others
//Power increase
// aspd increase
//Batk/Watk Increase
//Hit Increase
//Def reduction
//Endure effect
//def increase
//watk increase
//Chance to break weapon
//Change to break armor
//Critical increase
//Hit increase
//def increase
//flee increase
//Aspd increase
//Agi/Dex decrease.
// gs_something1 [Vicious]
//Aspd increase
//Flee decrease
//Batk increase
//No armor reduction to players.
//Def reduction
//Def2 reduction
//val2 signals autoprovoke.
//Atk increase
//Def reduction.
//val2 = 10*val1; //Speed change rate.
//Def bonus
//Atk rate change.
//Leech chance
//Leech percent
//Aspd change
//bAtk/wAtk rate change
//matk increase.
//mdef2 reduction.
//Def changes randomly every second...
// [GodLesZ] tick time
// val1 is duration in minutes. Use INT_MAX to specify 'unlimited' time.
// When first called:
// val2 Jail map_index
// val3 x
// val4 y
// When renewing status' information
// val3 Return map_index
// val4 return coordinates
/// Current Coordinates
/// Current Map
//1. Place in Jail (val2 -> Jail Map, val3 -> x, val4 -> y
//2. Set restore point (val3 -> return map, val4 return coords
// If player is being jailed and is already in jail (issue: 8206)
//Use save point.
// number of hits blocked
//knockback value.
// number of hits blocked
//Vit increase
//Int increase
//TODO: Reduce skill's duration. But for how long?
//NPC_DEFENDER:
//Damage reduction
//Attack requirements to be blocked:
//Range
//Type
//end previous enchants
//Make sure the received element is valid.
//Heal effectiveness decrease
//Magic reflection/cast rate
//Boost mdef
//Boost def
//20% per level
//Actual boost (since 100% = 1000)
//Speed cast decrease
//Factor by which displayed damage is increased by
//Trigger rate
//% of life to be revived with
// case SC_ARMOR_RESIST:
// Mod your resistance against elements:
// val1 = water | val2 = earth | val3 = fire | val4 = wind
// break;
//case ????:
//Place here SCs that have no SCB_* data, no skill associated, no ICON
//associated, and yet are not wrong/unknown. [Skotlex]
//break;
//% of life to be revived with
// Manuk group
// Splendide group
// Mora group
/**
// [GodLesZ] tick time
// Total Ticks to Burn!!
// [GodLesZ] tick time
/**
//DEF/MDEF Increase
// [GodLesZ] tick time
/**
// Chance
// [GodLesZ] tick time
// [GodLesZ] tick time
// [GodLesZ] tick time
// Blind status that last for 30 seconds
// [GodLesZ] tick time
// [GodLesZ] tick time
// [GodLesZ] tick time
// Hits
// Walk speed
// [GodLesZ] tick time
// Evasion rate of physical attacks. Flee
// Evasion rate of magical attacks.
// half on players
// val2 = sp reduction per second
// [GodLesZ] tick time
// [GodLesZ] tick time
// [GodLesZ] tick time
// [GodLesZ] tick time
//Store time at which you started running.
// Note: this int64 value is stored in two separate int32 variables (FIXME)
// [GodLesZ] tick time
// ASPD
// CRITICAL
// [GodLesZ] tick time
// ATK Reduction
//ASPD. Need to confirm if Movement Speed reduction is the same. [Jobbie]
//HIT
// Removes Animals
// Cast reduction
// Flee Reduction
// Crit and Flee2 Reduction
// bypasses coating protection and MADO
//spcost = 6 - level (lvl1:5 ... lvl 5: 1)
// [GodLesZ] tick time
// [GodLesZ] tick time
//Movement Speed And ASPD Increase
//MDEF Increase In %
//DEF Increase In %
// [GodLesZ] tick time
// [GodLesZ] tick time
//HP recovery
//SP drain
// [GodLesZ] tick time
// [GodLesZ] tick time
//HP/SP Drain Timer
/*val2 = 12000 - 2000 * val1;//HP/SP Drain Timer
//Added to prevent val3 from dividing by 0 when using level 6 or higher through commands. [Rytech]
// [GodLesZ] tick time
// 1% per SkillLv chance
//ASPD Increase
//Fixed Cast Time Reduction
//MaxHP Increase
//INT Reduction. Formula Includes Caster And 2nd Performer.
//STR And Crit Reduction. Formula Includes Caster And 2nd Performer.
//MaxHP Reduction
//Increased SP Cost.
//Number of Reflects
// [GodLesZ] tick time
// Chance
// Max rage counters
//endless duration in the client
// Chance to evade magic damage.
// Defence added
// [GodLesZ] tick time
// [GodLesZ] tick time
// ATK bonus
// All stat bonus
// [GodLesZ] tick time
//Remove buffs/debuffs
//  [(Job Level / 2) + (40 + 5 * Skill Level)] %
// [GodLesZ] tick time
// take note there is no def increase as skill desc says. [malufett]
// ASPD increase: [(Target AGI x Skill Level) / 60] %
// MDEF decrease: MDEF [(200 / Caster INT) x Skill Level]
// ATK increase: ATK [{(Caster DEX / 4) + (Caster STR / 2)} x Skill Level / 5]
// STAT DEF increase: [(Caster VIT / 4) x Skill Level]
// Watk. TODO: Renewal (Atk2)
// % Increase damage.
// Change into fire element.
// Watk. TODO: Renewal (Atk2)
// Bonus Matk
// % Freezing chance
// Change into water elemet
// Matk. TODO: Renewal (Matk1)
// % Increase speed and flee.
// % Increase damage
// % Increase DEF
// % Increase Damage
// Bonus MaxHP
// Elemental modifier.
// Reductions. Atk2, Flee1
// Flee.
// Increase Elemental's attack.
// SP consume.
// [GodLesZ] tick time
// [Frost]
// HP Consume.
// Endure effect
// [Frost]
// SP Consume.
// Val1: 1 = Regular Potion, 2 = Thrown Potion
// Val2: 1 = Small Potion, 2 = Medium Potion, 3 = Large Potion
// Val3: MaxHP Increase By Fixed Amount
// Val4: HP Heal Percentage
// If potion was normally used, take the user's BaseLv.
// If potion was thrown at someone, take the thrower's BaseLv.
// Prevents a negeative value from happening.
// Val1: 1 = Regular Potion, 2 = Thrown Potion
// Val2: 1 = Small Potion, 2 = Medium Potion, 3 = Large Potion
// Val3: MaxSP Increase By Fixed Amount
// Val4: SP Heal Percentage
// If potion was normally used, take the user's BaseLv.
// If potion was thrown at someone, take the thrower's BaseLv.
// Prevents a negeative value from happening.
//atk bonus
// Flee reduction.
// hp/sp reduction timer
//max hp bonus
// Aspd Bonus
// Chance of holy attack
//flee bonus
//aspd bonus
//dmg reduction
//dmg on status end
//activation chance
//atk bonus
//[Lighta] need real info
//def reduction
//varcast augmentation
//[Lighta] need real info
//aspd reduction %
//dmg reduction %
//start endure for same duration
//[Lighta] need real info
/**
/**
// Prevents a negeative value from happening
// AGI
// Move speed increase
// Ranged ATK increase
// %Max HP to absorb
// MHP% damage
// BATK%, MATK%
// WATK%, MATK%
// Move speed reduction
// Special considerations when loading SC data.
/* values that must be set regardless of SCFLAG_LOADED e.g. val_flag */
/* [Ind/Hercules] */
//Those that make you stop attacking/walking....
// Set option as needed.
//On Aegis, when turning on a status change, first goes the option packet, then the sc packet.
//Reset DYE color
//Currently No SC's use this
//Reset Body Style
// When starting a new SC (not loading), its remaining duration is the same as the total
/**
//Don't trust the previous sce assignment, in case the SC ended somewhere between there and here.
// reuse old sc
// new sc
//Infinite duration
//Skotlex: Pet Status Effect Healing
//don't heal if already set
//Do not use percent_heal as this healing must override BERSERK's block.
//Damage all SP
// First Message
// Recover Full HP
// Recover Full SP
/**
// Officially tested its 1%hp drain. [Jobbie]
// run OnTouch_ on next char in range
//Status change with no calc, no icon, and no skill associated...?
/**
/* all others: just copy val1 */
/**
/**
//OPT1
// Burning need this to be showed correctly. [pakpil]
//OPT2
//OPT3
//Why does it shares the same opt as Overthrust? Perhaps we'll never know...
//Simulate Explosion Spirits effect for NPC_POWERUP [Skotlex]
// doesn't seem to do anything
// 0
//SG skills [Komurka]
// from DA_CONTRACT (looks like biolab mobs aura)
// 0
//OPTION
/**
//Avoid sprite sync problems.
// Cancel cast when get status [LuzZza]
/**
// TODO: Blessing and Agi up should do 1 damage against players on Undead Status, even on PvM
// but cannot be plagiarized (this requires aegis investigation on packets and official behavior) [Brainstorm]
//Also blocks the ones below...
//Also blocks the ones below...
//Removes the Aspd potion effect, as reported by Vicious. [Skotlex]
//Cancels Normal Overthrust. [Skotlex]
//Cancels Assumptio
//Cancels Offertorium
//Cancels Magnificat
//Cancel Decrease Agi, but take no further effect [Skotlex]
//NPC_CHANGEUNDEAD will debuff Blessing and Agi Up
// Remove previous one.
//Group A Status (doesn't overlap)
//Group B Status
/**
/**
// Confirmed.
// Immune to status ailements
// Immune to status ailements
/*==========================================
//Only when its Holy or Dark that it doesn't dispell on death
//If for some reason status_change_end decides to still keep the status when quitting. [Skotlex]
/*==========================================
//Do not end infinite endure.
//Could be a SC with infinite duration
//"Ugly workaround"  [Skotlex]
//delays status change ending so that a skill that sets opt1 fails to
//trigger when it also removed one
//Petrify time counter.
//Removing the 'level' shouldn't affect anything in the code
//since these SC are not affected by it, and it lets us know
//if we have already delayed this attack or not.
//to not kill him
// Note: this int64 value is stored in two separate int32 variables (FIXME)
// Clear Status from others
// Clear Status from Master
// initially this is NULL, when a character logs in
// end status on partner as well
//This will prevent recursive loops.
// erase associated land skill
//If status was already ended, do nothing.
//Decrease count
//No more holds, free him up.
//Caster has been unlocked... nearby chars need to be unlocked.
//Since most people use this to escape the hold....
/// Marionette target
// check for partner and end their marionette status as well
//If val2 is removed, no HP penalty (dispelled?) [Skotlex]
//Sit down force of Saturday Night Fever has the duration of only 3 seconds.
//Clear the group.
//Clear the skill area. [Skotlex]
//Clear the group.
/* might have been cleared before status ended, e.g. land protector */
//Delete timer if it exists.
//natural expiration.
//guess hes not in jail :P
// "lose almost all their HP and SP" on natural expiration.
// Note: vending/buying is closed by unit_remove_map, no
// need to do it here.
// Because map->quit calls status_change_end with tid INVALID_TIMER
// from here it's not neccesary to continue
/**
// Terminated by Damage
/* might have been cleared before status ended, e.g. land protector */
/* might have been cleared before status ended, e.g. land protector */
// used the default area size cause there is a chance the caster could knock back and can't clear the target.
/* required for overlapping */
//Check for warp trigger + AoE trigger
/* Fall through */
//opt3
//Simulated Explosion spirits effect.
// doesn't seem to do anything
// 0
//SG skills [Komurka]
// from DA_CONTRACT (looks like biolab mobs aura)
// 0
// update HP bar when becoming visible again
//Restore DYE color
// Currently No SC's use this
// Restore Body color
//On Aegis, when turning off a status change, first goes the sc packet, then the option packet.
//bugreport:681
//Out of hiding, invoke on place.
//Trigger on-touch event.
/*==========================================
// set the next timer of the sce (don't assume the status still exists)
//Not enough SP to continue.
//Not enough SP to continue.
//SL bonus -> x10 duration
//Random defense.
//Fail if it's time to substract SP and there isn't.
//Restore trap immunity
// use for Shadow Form 2 seconds checking.
//Auto-provoke (it is ended in status->heal)
//Stop damaging after 25% HP left.
// Check if the status still last (can be dead since then).
//Timeout will be handled by pc->setpos
// val1 < 0 = per max% | val1 > 0 = exact amount
// Update X - Y on minimap
//SP consumption by time of dancing skills
//Moonlit's cost is 4sp*skill_lv [Skotlex]
//Upkeep is also every 10 secs.
// 5% every 10 seconds [DracoRPG]
//Every 60 seconds your manner goes up by 1 until it gets back to 0.
// custom Venom Splasher countdown timer
// 0
//Blind lasts forever while you are standing on the fog.
// {Target VIT x (New Poison Research Skill Level - 3)} + (Target HP/100)
// Cannot Kill
// 3% Damage each 4 seconds
// Killed? Should not
// Random Skill Cast
//can't cast if sit
//Damage is every 10 seconds including 3%sp drain.
//cancel dmg only if cancelable
// Deals fixed (1000 + 3%*MaxHP)
//damage is like endure effect with no walk delay
// Target still lives. [LimitLine]
// Also remove stored spell as well.
// 5 + 5% per level
// Recovers 3% of the player's MaxHP/MaxSP every 2 seconds.
// Drains 2% of HP and 1% of SP every seconds.
// doesn't work on mobs
// Cooling
// Suggestion 1% each second
// Do not kill, just keep you with 1 hp minimum
// Time out
// No more SP status should end, and in the next second will end for the other affected players
// Source no more under Magnetic Field
// 1% SP Upkeep Cost
// 1% every 5 seconds [Jobbie]
// Reduce 8 SP every 10 seconds.
// Force to sit every 10 seconds.
// Reduce 100 HP every 10 seconds.
// Reduce 90 SP every 10 seconds.
/* they only end by status_change_end */
//drain hp/sp
// default for all non-handled control paths is to end the status
/*==========================================
//gcc: enum args get promoted to int
/* Reveal hidden ennemy on 3*3 range */
// for every 2 seconds do the checking
// [100 - (Skill Level x 10)] %
/* Fall through */
/* Reveal hidden target and deal little dammages if ennemy */
// for every 2 seconds do the checking
// [100 - (Skill Level x 10)] %
// The hit is not counted if it's against a trap
// This signals it to end.
//Remove trap immunity temporarily so it triggers if you still stand on it
//Lock char has released the hold on everyone...
/**
/**
//  Any +MATK you get from skills and cards, including cards in weapon, is added here.
//This is the only portion in MATK that varies depending on the weapon level and refinement rate.
// Left and right matk stacks
// Only use right hand weapon level
// not RENEWAL
//Hom Min Matk is always the same as Max Matk
/**
/**
// Just get matk
// Get unmodified from sc matk
/**
// Update matk
/*==========================================
//Debuffs
//Debuffs that can be spreaded.
// NOTE: We'll add/delte SCs when we are able to confirm it.
//case SC_NOEQUIPWEAPON://Omg I got infected and had the urge to strip myself physically.
//case SC_NOEQUIPSHIELD://No this is stupid and shouldnt be spreadable at all.
//case SC_NOEQUIPARMOR:// Disabled until I can confirm if it does or not. [Rytech]
//case SC_NOEQUIPHELM:
//case SC__STRIPACCESSARY:
// Special cases
//Natural regen related stuff.
//Apply sitting regen bonus.
//Sitting HP regen
//Half as fast when overweight.
//Full
//Sitting SP regen
//Half as fast when overweight.
//Full
// SC_TENSIONRELAX allows HP to be recovered even when overweight. [csnv]
//Natural Hp regen
// Homun HP regen fix (they should regen as if they were sitting (twice as fast)
//full.
//Natural SP regen
// Homun SP regen fix (they should regen as if they were sitting (twice as fast)
//full.
//Skill regen
//Skill HP regen
//Full
//Skill SP regen
//Angel of the Sun/Moon/Star
//Full
//Natural heal main timer.
// This difference is always positive and lower than UINT_MAX (~24 days)
/**
/**
// Safe value if none are specified
// Safe value if none are specified
// Safe value if none are specified
// Safe value if none are specified
// Safe value if none are specified
/* limit only to possible maximum level of the given class */
/* some are still empty? then let's use the average increase */
// Safe value if none are specified
/* [malufett/Hercules] */
/*------------------------------------------
// @TODO: find a better way of handling this
//Disable Hallucination.
// to be used by plugins
/**
// initialize databases to default
//
//not necessary during boot
// reset job_db.conf data
// reset job_db2.txt data
// Job-specific stats bonus
// size_fix.txt
// read databases
//
/*==========================================
/*=====================================
/* vars */
//we need it for new cards 15 Feb 2005, to check if the combo cards are insrerted into the CURRENT weapon only
//to avoid cards exploits
//Contains inventory index of an equipped item. To pass it into the EQUP_SCRIPT [Lupus]
//To prevent card-stacking (from jA) [Skotlex]
// These macros are used instead of a sum of sizeof(), to ensure that padding won't interfere with our size, and code won't rot when adding more fields
/* funcs */
// for looking up associated data
//Define for standard HP/SP skill-related cost triggers (mobs require no HP/SP to use skills)
//Used to set the hp/sp of an object to an absolute value (can't kill)
// [Skotlex]
//[Skotlex]
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\storage.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// struct map_session_data
/*==========================================
//Sort item by storage_comp_item (nameid)
/**
//Save closed storages.
//Function to be invoked upon server reconnection to char. To save all 'dirty' storages [Skotlex]
/*==========================================
//Already open?
// Storage has not been loaded yet.
//check is this GM level is allowed to put items to storage
// Your GM level doesn't authorize you to perform this action.
/* helper function
/*==========================================
// item stack limitation
//Check if item is storable. [Skotlex]
// This item cannot be stored.
// This bound item cannot be stored there.
//Stackable
// existing items found, stack them
// set a save flag.
// Check if storage exceeds limit.
// set a save flag.
/*==========================================
/*==========================================
// storage full
// No item on that spot
/*==========================================
//Nothing there
/*==========================================
// storage full / storage closed
//No item there.
/*==========================================
//Nothing there.
// probably this line is useless? it remove inventory lock but not storage [4144]
/*==========================================
//Invokes the storage saving as well.
/* Erase deleted account storage items from memory
/*==========================================
//Invokes the storage saving as well.
/**
/*==========================================
//Can't open both storages at a time.
//check is this GM level can open guild storage and store items [Lupus]
// Your GM level doesn't authorize you to perform this action.
/*==========================================
// item stack limitation
//Check if item is storable. [Skotlex]
// This item cannot be stored.
// This bound item cannot be stored there.
//Stackable
//Add item
/*==========================================
/*==========================================
/*==========================================
//inform fail
//log_fromstorage(sd, index, 1);
/*==========================================
/*==========================================
/*==========================================
//Char quitting, close it.
/*==========================================
//Storage has been correctly saved.
//Close storage for sd and save it
//This one also saves the storage. [Skotlex]
//Only during a guild break flag is 1 (don't save storage)
/* */
/* */
/* */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\stylist.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// Initialize the db
// Load the db
// Clear the db
/* core */
/* */
/* database */
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\trade.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/*==========================================
// You can't trade in this map
// character does not exist
//Trade fails if you are using an NPC.
// If a character tries to trade to another one then cancel the previous one
// Once canceled then continue to the new one.
// person is in another trade
//check if both GMs are allowed to trade
// Your GM level doesn't authorize you to perform this action.
// GM is not allowed to trade
// Players can not request trade from far away, unless they are allowed to use @trade.
// too far
/*==========================================
//Already trading or no partner set.
// character does not exist
//Already trading or wrong partner.
// Cancel
//If client didn't send accept, it's a broken packet?
// Players can not request trade from far away, unless they are allowed to use @trade.
// Check here as well since the original character could had warped.
// too far
//Check if you can start trade.
//Fail
//Initiate trade
/**
// get inventory of player
// remove this part: arrows can be trade and equipped
// re-added! [celest]
// remove equipped items (they can not be trade)
// check items in player inventory
// if more than the player have -> hack
// Hack on trade: character '%s' (account: %d) try to trade more items that he has.
// This player has %d of a kind of item (id: %d), and try to trade %d of them.
// if we block people
// forced to disconnect because of the hack
// message about the ban
//  This player has been definitively blocked.
// if we ban people
// type: 2 - ban (year, month, day, hour, minute, second)
// forced to disconnect because of the hack
// message about the ban
//  This player has been banned for %d minute(s).
// message about the ban
//  This player hasn't been banned (Ban option is disabled).
// remove item from inventory
/*==========================================
// check zenys value against hackers (Zeny was already checked on time of adding, but you never know when you lost some zeny since then.
// get inventory of player
// check free slot in both inventory
//qty Exploit?
//Stackable item.
// look for an empty slot.
// search if it's possible to add item (for full inventory)
/*==========================================
//Can't add stuff.
//Why do this.. ~.~ just send an ack, the item won't display on the trade window.
// 0 is for zeny, 1 is unknown. Gravity, go figure...
//Item checks...
//Can't trade
//Can't partner-trade
// This item cannot be traded.
// Rental System
// This item cannot be traded.
// This bound item cannot be traded to that character.
//Locate a trade position
//No space left
//fail to add item -- the player was over weighted.
//The same item as before is being readjusted.
//packet deal exploit check
//New deal item
// Return the index as it was received
/*==========================================
//Can't add stuff.
// invalid values, no appropriate packet for it => abort
/*==========================================
/*==========================================
// Not trade accepted
// give items back (only virtual)
// give items back (only virtual)
/*==========================================
//Locked should be 1 (pressed ok) before you can press trade.
//Not yet time for trading.
//Now is a good time (to save on resources) to check that the trade can indeed be made and it's not exploitable.
// check exploit (trade more items that you have)
// check exploit (trade more items that you have)
// check for full inventory (can not add traded items)
// check the both players
// trade is accepted and correct.
// save both player to avoid crash: they always have no advantage/disadvantage between the 2 players
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\unit.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// RENEWAL_CAST
/**
/**
// Check if there is an obstacle between
// Official number of walkable cells is 14 if and only if there is an obstacle between. [malufett]
// If type is a NPC, please disregard.
//Generally speaking, the walk path is already to an adjacent tile
//so we only need to shorten the path if the range is greater than 1.
//Trim the last part of the path to account for range,
//but always move at least one cell when requested to move.
//When chasing, units will target a diamond-shaped area in range [Playtester]
/**
//Set to false here because if an error occurs, it should not be executed again
//Flush target_to as it might contain map coordinates which should not be used by other functions
//If stepaction is set then we remembered a client request that should be executed on the next step
//Execute request now if target is in attack range
//Execute ground skill
//If a player has target_id set and target is in range, attempt attack
//Execute normal attack
//Execute non-ground skill
// Stop moved because it is missing from the block_list
//Get icewall walk block depending on boss mode (players can't be trapped)
//Monsters will walk into an icewall from the west and south if they already started walking
//Monsters can only leave icewalls to the west and south
//But if movement fails more than icewall_walk_block times, they can ignore this rule
//Needs to be done here so that rudeattack skills are invoked
//Monsters in this situation first use a chase skill, then unlock target and then use an idle skill
//Refresh view for all those we lose sight
//walked cell counter, to be used for walk-triggered skills. [Skotlex]
//If you move, you lose your counters. [malufett]
//map->moveblock has altered the object beyond what we expected (moved/warped it)
// arbitrary non-INVALID_TIMER value to make the clif code send walking packets
//Script could have warped char, abort remaining of the function.
// mercenary should be warped after being 3 seconds too far from the master [greenbox]
// reset the tick, he is not far anymore
//Movement was successful, reset walktoxy_fail_count
// Warped
//Walk skills are triggered regardless of target due to the idle-walk mob state.
//But avoid triggering on stop-walk calls.
//Walk skills are supposed to be used while walking
//Skill used, abort walking
//Fix position as walk has been canceled.
//Resend walk packet for proper Self Destruction display.
// mercenary should be warped after being 3 seconds too far from the master [greenbox]
//A directly invoked timer is from battle_stop_walking, therefore the rest is irrelevant.
//If stepaction is set then we remembered a client request that should be executed on the next step
//Delete old stepaction even if not executed yet, the latest command is what counts
//Delay stepactions by half a step (so they are executed at full step)
//not required not damaged recently
//Keep trying to run.
//Update target trajectory.
//Cancel chase.
//Reached destination.
//Aegis uses one before every attack, we should
//only need this one for syncing purposes. [Skotlex]
//Update chase-path
//Stopped walking. Update to_x and to_y to current location [Skotlex]
//Walked on occupied cell, call unit_walktoxy again
//Execute step timer on next step instead
//flag parameter:
//&1 -> 1/0 = easy/hard
//&2 -> force walking
//&4 -> Delay walking if the reason you can't walk is the canwalk delay
//&8 -> Search for an unoccupied cell and cancel if none available
//This might change x and y
// Count walk path cells
// Check if there is an obstacle between
// Official number of walkable cells is 14 if and only if there is an obstacle between. [malufett]
// If type is a NPC, please disregard.
// Delay walking command. [Skotlex]
//Sets target to 0
// Stepaction might be delayed due to occupied cell
// unit->walktoxy removes any remembered stepaction and resets ud->target_to
//Randomize the target position
// When you come to the center of the grid because the change of destination while you're walking right now
// Call a function from a timer unit->walktoxy_sub
//To set Mob's CHASE/FOLLOW states (shouldn't be done if there's no path to reach)
//Keep waiting?
// Chases a tbl. If the flag&1, use hard-path seek,
// if flag&2, start attacking upon arrival within range, otherwise just walk to that character.
//Should walk on the same cell as target (for looters)
//Note that if flag&2, this SHOULD be attack-range
//Chase to attack.
//Sets target to 0
//Randomize the target position
//Can't move, wait a bit before invoking the movement.
/**
//If you can't run forward, you must be next to a wall, so bounce back. [Skotlex]
//Set running to 0 beforehand so status_change_end knows not to enable spurt [Kevin]
//Why is a clif->slide (skill->blown) AND a fixpos needed? Ask Aegis.
/**
// determine destination cell
// Search for available path
//if sprinting and there's a PC/Mob/NPC, block the path [Kevin]
// Can't run forward
//There must be an obstacle nearby. Attempt walking one cell at a time.
//Makes bl attempt to run dist cells away from target. Uses hard-paths.
//Instant warp function.
// unreachable
// arbitrary non-INVALID_TIMER value to make the clif code send walking packets
//Script could have warped char, abort remaining of the function.
// Check if pet needs to be teleported. [Skotlex]
//Too far, teleport.
// Pushes a unit by given amount of cells into given direction. Only
// map cell restrictions are respected.
// flag:
//  &1  Do not send position update packets.
//Stop stepaction when knocked back
// return amount of knocked back cells
//Warps a unit/ud to a given map/position.
//In the case of players, pc->setpos is used.
//it respects the no warp flags, so it is safe to call this without doing nowarpto/nowarp checks.
//Type 1 is invalid, since you shouldn't warp a bl with the "death"
//animation, it messes up with unit_remove_map! [Skotlex]
//Random map position.
//Invalid target cell
//Can't find a nearby cell
//Use pc_setpos
/*==========================================
//NOTE: We are using timer data after deleting it because we know the
//timer->delete function does not messes with it. If the function's
//behavior changes in the future, this code could break!
//Force moving at least one cell.
//Enough time has passed to cover half-cell
//Read, the check in unit_set_walkdelay means dmg during running won't fall through to this place in code [Kevin]
/*==========================================
// Prevent moving while casting
// Only players are affected by SA_FREECAST and similar
// Skills with an explicit free cast setting always allow walking regardless of SA_FREECAST
// SA_FREECAST doesn't affect guild skills
// SA_FREECAST not available
//Can't move
// Status changes that block movement
// cannot move while gospel is in effect
// Basilica caster cannot move
//Need wall at level 1-2
// Icewall walk block special trapped monster mode
//Make sure rudeattacked skills are invoked
/*==========================================
/*==========================================
//Bosses can ignore skill induced walkdelay (but not damage induced)
//Make sure walk delay is not decreased
//Don't set walk delays when already trapped.
//Immune to being stopped for double the flinch time
//Stop walking, if chasing, readjust timers.
//Minimal delay (walk-delay) disabled. Just stop walking.
//Resume running after can move again [Kevin]
//-------------- stop here
//Do not continue source is dead
//Unneeded
//temp: used to signal combo-skills right now.
// Only non-targetable skills should use auto target
// exploit fix
//Auto-select target. [Skotlex]
//Target_id checking.
// [MouseJstr]
//Check for skills that auto-select target
//Homun-auto-target skills.
// Choose attack target for now
// Attacking nothing, choose master as default target instead
// choose default target
//Normally not needed because clif.c checks for it, but the at/char/script commands don't! [Skotlex]
/**
// Record the status of the previous skill)
//Prevent using the dance skill if you no longer have the skill in your tree.
/* temporarily disabled, awaiting for kenpachi to detail this so we can make it work properly */
// NPC-objects can override cast distance
// Maximum visible distance before NPC goes out of sight
// Skill cast distance from database
// New action request received, delete previous action request if not executed yet
// Remember the skill request from the client while walking to the next cell
// Attacking will be handled by unit_walktoxy_timer in this case
//Check range when not using skill on yourself or is a combo-skill during attack
//(these are supposed to always have the same range as your attack)
// Walk-path check failed.
// Aegis calc remove trap based on Master position, ignoring mercenary O.O
// Arrow-path check failed.
//Stop attack on non-combo skills [Skotlex]
//Else-wise, delay current attack sequence
//temp: Used to signal force cast now.
//Can't cast on non-dead characters.
// Can't cast on other characters when limit is reached
// No Casting time on basilica cancel
//+100% every 3 cells of distance
// ...but hard-limited to 300%.
//Emergency Call double cast when the user has learned Leap [Daegaladh]
// moved here to prevent Suffragium from ending if skill fails
// NPC-objects do not have cast time
/**
//Warped away!
//need TK_RUN or WUGDASH handler to be done before that, see bugreport:6026
// even though this is not how official works but this will do the trick. bugreport:6829
// in official this is triggered even if no cast time.
//Cast targeted skill event.
// self-targeted skills shouldn't show different direction
// not on the map
//Normally not needed since clif.c checks for it, but at/char/script commands don't! [Skotlex]
/**
// can't cast ground targeted spells on wall cells
/* Check range and obstacle */
// NPC-objects can override cast distance
// Maximum visible distance before NPC goes out of sight
// Skill cast distance from database
// New action request received, delete previous action request if not executed yet
// Remember the skill request from the client while walking to the next cell
// Convert coordinates to target_to so we can use it as target later
// Attacking will be handled by unit_walktoxy_timer in this case
//Walk-path check failed.
//Arrow-path check failed.
// moved here to prevent Suffragium from ending if skill fails
// NPC-objects do not have cast time
// 0
/**
//Warped away!
// in official this is triggered even if no cast time.
/*========================================
/**
//Clear target
//Clear timer
/**
//Clear remembered step action
//Clear timer
//Means current target is unattackable. For now only unlocks mobs.
/*==========================================
// monster npcs [Valaris]
// *pcblock script command
// submitted by leinsirk10 [Celest]
// overweight or mounted on warg - stop attacking
//If you're to attack continuously, set to auto-case character
//Just change target/type. [Skotlex]
// New action request received, delete previous action request if not executed yet
// Remember the attack request from the client while walking to the next cell
// Attacking will be handled by unit_walktoxy_timer in this case
//Do attack next time it is possible. [Skotlex]
//Attack NOW.
//Cancels an ongoing combo, resets attackable time and restarts the
//attack timer to resume attacking after amotion time. [Skotlex]
//Combo wasn't active.
//Nothing more to do.
/*==========================================
//Same place
/*==========================================
// It judges whether it can adjoin or not.
//Look for a suitable cell to place in.
//No valid cells.
// Check if there is an obstacle between
// Official number of walkable cells is 14 if and only if there is an obstacle between. [malufett]
// If type is a NPC, please disregard.
/*==========================================
// 2 cells from Master Position
// Pick a Random Dir
// Exactly Master Position
/*==========================================
// can't attack under these conditions
// Follow up.
// can't attack while casting
// attacking when under cast delay has restrictions:
//requested attack.
//Otherwise, we are in a combo-attack, delay this until your canact time is over. [Skotlex]
// Extra range when chasing (does not apply to mobs locked in an icewall)
// Player tries to attack but target is too far, notify client
// Monster: Chase if required
//Within range, but no direct line of attack
//Sync packet only for players.
//Non-players use the sync packet on the walk timer. [Skotlex]
//First attack is always a normal attack
// Set mob's ANGRY/BERSERK states.
// Link monsters nearby [Skotlex]
/**
// You can't move if you can't attack neither.
/*==========================================
//Nothing to cancel.
//See if it can be canceled.
//fixed flags being read the wrong way around [blackhole89]
// unit_data initialization process
/*==========================================
/*==========================================
/*==========================================
/*==========================================
//Already removed?
//Clear target even if there is no timer
//Clear stepaction even if there is no timer
// Do not reset can-act delay. [Skotlex]
/*= ud->canact_tick*/ = timer->gettick();
//map-change/warp dispells.
// Ensure the bl is a PC; if so, we'll handle the removal of cloaking and cloaking exceed later
//callme before warp
//Leave/reject all invitations.
// issue: 8027
//Force close it when being warped.
// Check if warping and not changing the map.
//minimap dot fix [Kevin]
// this is only place where map users is decreased, if the mobs were removed too soon then this function was executed too many times [FlavioJS]
//[Skotlex]
// decrement the number of active pvp players on the map
// temporary state to track double remove_map's [FlavioJS]
// Drop previous target mob_slave_keep_target: no.
//If logging out, this is deleted on unit->free
//If logging out, this is deleted on unit->free
// do nothing
/**
//CLR_RESPAWN is the warp from logging out, CLR_TELEPORT is the warp from teleporting, but pets/homunc need to just 'vanish' instead of showing the warping animation.
/*==========================================
//Players are supposed to logout with a "warp" effect.
// Notify friends that this char logged out. [Skotlex]
// free attached scripts that are waiting
/* [Ind/Hercules] */
// Achievement [Smokexyz/Hercules]
// Title [Dastgir/Hercules]
//Remove pet.
// permanently remove the mob
// Last freed mob is responsible for deallocating the group's spawn data.
//Players are handled by map_quit
// nothing to do
/* */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\map\vending.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/// Returns an unique vending shop id.
/*==========================================
/*==========================================
// not vending
//check if both GMs are allowed to trade
// Your GM level doesn't authorize you to perform this action.
// register vending uid
/*==========================================
// against duplicate packets
// invalid shop
// shop has changed
// store information was incorrect
// shop too far away
// invalid amount of purchased items
//number of free cells in the buyer's inventory
// duplicate item in vending to check hacker with multiple packets
// copy vending list
// some checks
// zeny counter
// weight counter
// check of item index in the cart
//picked non-existing item
// you don't have enough zeny
// too much zeny = overflow
// you can not buy, because overweight
//Check to see if cart/vend info is in sync.
// if they try to add packets (example: get twice or more 2 apples if marchand has only 3 apples).
// here, we check cumulative amounts
// send more quantity is not a hack (an other player can have buy items just before)
// not enough quantity
//We'd add this item to the existing one (in buyers inventory)
//Buyer has no space in his inventory
//too many items
// vending item
//print buyer's name
// compact the vending list
// speedup
//Always save BOTH: buyer and customer
//check for @AUTOTRADE users [durf]
//see if there is anything left in the shop
//Close Vending (this was automatically done by the client, we have to do it manually for autovenders) [Skotlex]
//They have no reason to stay around anymore, do they?
/*==========================================
// can't open vendings lying dead || didn't use via the skill (wpe/hack) || can't have 2 shops at once
// skill level and cart check
// check number of items in shop
// invalid item count
// filter out invalid items
// offset adjustment (client says that the first cart position is 2)
// invalid position
// invalid item or insufficient quantity
//NOTE: official server does not do any of the following checks!
// unidentified item
// broken item
// It should not be in the cart but just in case
// can't trade bound items w/o permission
// untradeable item
// item successfully added
//"Some of your items cannot be vended and were removed from the shop."
// no valid item found
// custom reply packet
/// Checks if an item is being sold in given player's vending.
// not vending
// not found
/// Searches for all items in a vending, that match given ids, price and possible cards.
/// @return Whether or not the search should be continued.
// not vending
// not found
// too low price
// too high price
// check cards
// something, that is not a carded
// found
// no card match
// result set full
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\plugins\constdb2doc.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/// db/constants.conf -> doc/constants.md generator plugin
// Plugin name
// Which server types this plugin works with?
// Plugin version
// HPM Version (don't change, macro is automatically updated)
/// To override script_constdb_comment
/// To override script_set_constant, called by script_read_constdb
/* Link */
/* Run */
/* Unlink */
/// Cloned from itemdb_search
/* File Type Detector */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\plugins\db2sql.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// Plugin name
// Which server types this plugin works with?
// Plugin version
// HPM Version (don't change, macro is automatically updated)
// not RENEWAL
/// Conversion state tracking.
///< Currently open file pointer
///< Buffer pointer
///< Buffer length
///< Output buffer
///< Database table name
/// Whether the item_db converter will automatically run.
/// Whether the mob_db converter will automatically run.
/// Backup of the original item_db parser function pointer.
/// Backup of the original mob_db parser function pointer.
//
/**
/**
//herc.ws - http://github.com/HerculesWS/Hercules\n"
//www.gnu.org/licenses/>.\n\n"
/**
// Base Classes
// 2-1 Classes
// 2-2 Classes
// Extended Classes
// Extended Classes (special handling)
// Other Classes
//Bongun/Munak
/**
// id
// name_english
// name_japanese
// type
// subtype
// price_buy
// price_sell
// weight
// atk
// matk
// defence
// range
// slots
// equip_jobs
// This is an unsigned value, do not check for >= 0
// equip_upper
// equip_genders
// equip_locations
// weapon_level
// equip_level_min
// equip_level_max
// refineable
// disable_options
// view_sprite
// bindonequip
// forceserial
// buyingstore
// delay
// trade_flag
// trade_group
// nouse_flag
// nouse_group
// stack_amount
// stack_flag
// FIXME: Use an enum
// sprite
// script
// equip_script
// unequip_script
/**
/**
/* link */
/* unlink */
/**
// id
// Sprite
// kName
// iName
// LV
// HP
// SP
// EXP
// JEXP
// Range1
// ATK1
// ATK2
// DEF
// MDEF
// STR
// AGI
// VIT
// INT
// DEX
// LUK
// Range2
// Range3
// Scale
// Race
// Element
// Mode
// Speed
// aDelay
// aMotion
// dMotion
// MEXP
// MVP{i}id
// MVP{i}per
// Scan for cards
// Drop{i}id
// Drop{i}per
// DropCardid
// DropCardper
/**
/**
/* link */
// Set up modifiers
/* unlink */
// Run mob_skill_db converter
/**
/**
//case MST_AROUND: // same value as MST_AROUND4
/**
/**
// MonsterID
// Info
// State
// SkillID
// SkillLv
// Rate
// CastTime
// Delay
// Cancelable
// Target
// Condition
// ConditionValue
// Val1-Val5
// Emotion
/**
/**
/* link */
/* unlink */
/**
/**
/**
/**
/**
/**
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\plugins\dbghelpplug.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// Ported from eAthena Dev Team's version @ http://eathena-project.googlecode.com/svn/trunk/src/plugins/dbghelpplug.c
// Currently supported dbghelp 5.1
/**
/////////////////////////////////////////////////////////////////////
// Include files
//
/////////////////////////////////////////////////////////////////////
// Types from Cvconst.h (DIA SDK)
//
/*
/* _NO_CVCONST_H */
/////////////////////////////////////////////////////////////////////
// dbghelp function prototypes
//
/////////////////////////////////////////////////////////////////////
// Custom info
/// Internal structure used to pass some data around
// PrintStacktrace
// PrintFunctionDetail
// PrintDataInfo
/// dbghelp dll filename
// Default report filename, used when the module path is unavailable
// Extended information printed in the console
//github.com/HerculesWS/Hercules/issues\n"
// Print object children?
// WARNING: This will generate huge dump files!
//#define DBG_PRINT_CHILDREN
/////////////////////////////////////////////////////////////////////
// Global variables
/////////////////////////////////////////////////////////////////////
// Code
/// Writes the minidump to file. The callback function will at the
/// same time write the list of modules to the log file.
///
/// @param file Filename of the minidump
/// @param ptrs Exception info
/// @param module_callback Callback for MiniDumpWriteDump
/// @param log_file Log file
// open minidump file
/// Prints module information to the log file.
/// Used as a callback to MiniDumpWriteDump.
///
/// @param data Log file
/// @param callback_input
/// @param callback_output
/// @return
/// Prints details about the current process, platform and exception
/// information to the log file.
///
/// @param exception Exception info
/// @param context Exception context
/// @param log_file Log file
// print the command line
// Print system information
// print the exception code
// print where the fault occured
// if the exception was an access violation, print additional information
// print the register info
//  IOPL level value
//  VIP (virtual interrupt pending)
//  VIF (virtual interrupt flag)
//  VIF (virtual interrupt flag)
//  OF (overflow flag)
//  IF (interrupt enable flag)
//  SF (sign flag)
//  ZF (zero flag)
//  AF (aux carry flag)
//  PF (parity flag)
//  CF (carry flag)
/* defined(_M_IX86) */
//TODO add more processors
/// Prints the typename of the symbol.
///
/// @param typeIndex Type index of the symbol
/// @param symtag Symbol tag
/// @param withParens If brackets are printed around the typename
/// @param interData Inter data
// inter data
//
// next
// next
// print root type
// next dimension
// print dimensions
// next dimension
/// Prints the bytes in the target location.
///
/// @param log_file Log file
/// @param p Pointer to the data
/// @param length Length of the data in bytes
/// Prints a wide string/char value.
///
/// @param log_file Log file
/// @param p Pointer to the value
/// @param length Length of the value in bytes
/// Prints a string/char value.
///
/// @param log_file Log file
/// @param p Pointer to the value
/// @param length Length of the value in bytes
/// Prints a float value.
///
/// @param log_file Log file
/// @param p Pointer to the value
/// @param length Length of the value in bytes
/// Prints a hex value.
///
/// @param log_file Log file
/// @param p Pointer to the value
/// @param length Length of the value in bytes
/// Prints an unsigned integer value.
///
/// @param log_file Log file
/// @param p Pointer to the value
/// @param length Length of the value in bytes
/// Prints a signed integer value.
///
/// @param log_file Log file
/// @param p Pointer to the value
/// @param length Length of the value in bytes
/// Prints a nul-terminated wide string value.
/// Checks if the memory can be read from.
///
/// @param log_file Log file
/// @param str Target string
// check if memory is readable
// print readable part
// print string
/// Prints a nul-terminated string value.
/// Checks if the memory can be read from.
///
/// @param log_file Log file
/// @param str Target string
// check if memory is readable
// print readable part
// print string
// forward declaration of Dhp__PrintDataContents
/// Prints the value of the data symbol.
/// Checks if the memory can be read from.
///
/// @param typeIndex Type index of the symbol
/// @param symtag Symbol tag
/// @param pVariable Address to the symbol contents
/// @param pInterData Inter data
// inter data
//
// check if memory is readable
// add to make sure it's not optimized out in release mode
// Don't continue if there's no valid data
// child isn't a pointer, print the contents
// string or wide string
// print values
// count children
// Prepare to get an array of "TypeIds", representing each of the children.
// SymGetTypeInfo(TI_FINDCHILDREN) expects more memory than just a
// TI_FINDCHILDREN_PARAMS struct has.  Use derivation to accomplish this.
// Get the array of TypeIds, one for each child type
// Iterate through each of the children
// Get the offset of the child member, relative to its parent
// Calculate the address of the member
// print contents of the child
/// Prints the contents of the data symbol. (type and value)
///
/// @param typeIndex Type index of the symbol
/// @param pVariable Address of the symbol contents
/// @param pInterData Inter data
// inter data
//
// print type
// print value
/// Prints information about the data symbol.
///
/// @param pSymInfo Symbol info
/// @param pInterData Inter data
// inter data
// my data
// Determine the scope and address of the variable
// parameter
// local
// parameter as local (bug in DBGHELP 5.1)
// register, optimized out(?)
// It must be a global variable
// check if we should to log the variable
// print prefix and name
// print value
// print postfix
/// Prints information about the symbol.
///
/// @param pSymInfo Symbol info
/// @param pInterData Inter data
/*fprintf(pInterData->log_file, "<unsupported symtag %d>", pSymInfo->Tag);*/ break;
/// Prints the details of one symbol to the log file.
/// Used as a callback for SymEnumSymbols.
///
/// @param pSymInfo Symbol info
/// @param symSize Size of the symbol info structure
/// @param pData Inter data
// try other symbols
/// Prints the source code of the target line.
/// Searches for the target file in the original path,
/// in the last src folder of the original path (relative)
/// and in the current directory.
///
/// @param filename Original source file
/// @param line Target line
/// @param log_file Log file
// generate search paths
// original path
// last src folder path
// no path
// current directoy
// search for file and line
// found line
/// Prints details of one function to the log file.
///
/// @param interData Inter data
// inter data
//
// frame info
// restrict symbol enumeration to this frame only
// function name and displacement
// log all function parameters
// find the source line for this function.
// log all function local variables
/// Walks over the stack and prints all relevant information to the log file.
///
/// @param context Exception context
/// @param log_file Log file
// Use thread information - if not supplied.
// If no context is supplied, skip 1 frame
// Write the stack trace
/* defined(_M_IX86) */
// Check that the address is not zero.
// Sometimes StackWalk returns TRUE with a frame of zero.
/// Checks if a debugger is attached to this process
///
/// @return TRUE is a debugger is present
/// Loads the dbghelp.dll library.
///
/// @return TRUE is sucessfull
// load the functions
// initialize the symbol loading code
// Set the 'load lines' option to retrieve line number information.
// Set the 'deferred loads' option to map the debug info in memory only when needed.
// Initialize the dbghelp DLL with the default path and automatic
// module enumeration (and loading of symbol tables) for this process.
/// Unloads the dbghelp.dll library.
/// Creates the report and minidump files.
/// Puts the resulting pathnames in the arguments.
/// The buffers must be at least MAX_PATH+1 in size.
///
/// @param out_lpszLogFileName Buffer for the report filename
/// @param out_lpszDmpFileName Buffer for the minidump filename
/// @return TRUE if the files were created
// "YYYYMMDDhhmmss"
// ".rpt" or ".dmp"
// Generate base filename for the report/minidump
// remove extension
// in temp folder
// in current folder
// failed to create log file
// failed to create dump file
// success
/// Unhandled exception handler. Where the magic starts... ;D
///
/// @param ptrs Exception information
/// @return What to do with the exception
// check if the crash handler was already loaded (crash while handling the crash)
// don't log anything if we're running inside a debugger ...
// ... or if we can't load dbghelp.dll ...
// ... or if we can't create the log files
// open log file
// print information about the process
// print the stacktrace
// write the minidump file and use the callback to print the list of modules to the log file
// inform the user
// terminate the application
/////////////////////////////////////////////////////////////////////
// Plugin
/// Previous exception filter.
/**
/**
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\plugins\generate-translations.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// Plugin name
// Which server types this plugin works with?
// Plugin version
// HPM Version (don't change, macro is automatically updated)
// string map parsed (used when exporting strings only)
/* Set during startup when attempting to export the lang, unset after server initialization is over */
/// Whether the translations template generator will automatically run.
/* Not WIN32 */
// WIN32 check
/**
/* When exporting we don't know what is a translation and what isn't */
// The length of *string will always be at least 1 because of the '\0'
// [!] Note: VECTOR_LENGTH() will lie.
/* exclude null terminator */
// + ".pot"
//herc.ws - http://github.com/HerculesWS/Hercules\n"
//www.gnu.org/licenses/>.\n\n"
// allow_override is true in nested calls
// allow_override is true in nested calls
/**/*.pot' file with all translateable strings from scripts, server terminates afterwards.");
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\plugins\HPMHooking.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
// Plugin name
// Which server types this plugin works with?
// Plugin version
// HPM Version (don't change, macro is automatically updated)
/* hooking points db -- for quick lookup */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\plugins\mapcache.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/**
/* Should always be the first Hercules file included! (if you don't make it first, you won't be able to use interfaces) */
/* should always be the last Hercules file included! (if you don't make it last, it'll intentionally break compile time) */
///< Plugin name
///< Which server types this plugin works with?
///< Plugin version
///< HPM Version (don't change, macro is automatically updated)
/**
// This is the main header found at the very beginning of the map cache
// This is the header appended before every compressed map cells info in the map cache
/**
/**
/* F_OK */
// Reads an uint32 in little-endian from the buffer
// Reads a float (32 bits) from the buffer
//Creating big enough buffer to ensure ability to hold compressed data
// Rewind file pointer before passing it to the read function.
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\plugins\sample.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/// Sample Hercules Plugin
/* Should always be the first Hercules file included! (if you don't make it first, you won't be able to use interfaces) */
/* should always be the last Hercules file included! (if you don't make it last, it'll intentionally break compile time) */
// Plugin name
// Which server types this plugin works with?
// Plugin version
// HPM Version (don't change, macro is automatically updated)
//@sample command - 5 params: const int fd, struct map_session_data* sd, const char* command, const char* message, struct AtCommandInfo *info
//script command 'sample(num);' - 1 param: struct script_state* st
//console command 'sample' - 1 param: char *line
/* sample packet implementation */
/* cmd 0xf3 - it is a client-server existent id, for clif_parse_GlobalMessage */
/* in this sample we do nothing and simply redirect */
/* socket didn't fully log-in? this packet shouldn't do anything then! */
/* sample usage of appending data to a socket_data (sockt->session[]) entry */
/* sample usage of appending data to a map_session_data (sd) entry */
/* storage var */
/* my custom prehook for pc_dropitem, checks if amount of item being dropped is higher than 1 and if so cap it to 1 and store the value of how much it was */
/* postHook receive retVal as the first param, allows posthook to act accordingly to whatever the original was going to return */
/* we don't do anything if pc_dropitem didn't return 1 (success) */
/* signs whether pre-hook did this */
/**
/*
/* do anything with the var e.g. config_switch(val) */
/* for our example we will save it in global variable */
/* please note, battle settings can be only returned as int for scripts and other usage */
/* Battle Config Settings need to have return function in-case scripts need to read it */
/* first we check the key to know what setting we need to return with strcmpi then return it */
/* run when server starts */
// Atcommands only make sense on the map server
/* addAtcommand("command-key",command-function) tells map server to call ACMD(sample) when "sample" command is used */
/* - it will print a warning when used on a non-map-server plugin */
//link our '@sample' command
// Script commands only make sense on the map server
/* addScriptCommand("script-command-name","script-command-params-info",script-function) tells map server to call BUILDIN(sample) for the "sample(i)" command */
/* - it will print a warning when used on a non-map-server plugin */
/* addCPCommand("console-command-name",command-function) tells server to call CPCMD(sample) for the 'this is a sample <optional-args>' console call */
/* in "console-command-name" usage of ':' indicates a category, for example 'this:is:a:sample' translates to 'this is a sample',
/* addPacket(packetID,packetLength,packetFunction,packetIncomingPoint) */
/* adds packetID of packetLength (-1 for dynamic length where length is defined in the packet { packetID (2 Byte) , packetLength (2 Byte) , ... })
// The following hooks would show an error message where pc->dropitem doesn't exist (login or char server)
/* in this sample we add a PreHook to pc->dropitem */
/* to identify whether the item being dropped is on amount higher than 1 */
/* if so, it stores the amount on a variable (my_pc_dropitem_storage) and changes the amount to 1 */
/* in this sample we add a PostHook to pc->dropitem */
/* if the original pc->dropitem was successful and the amount stored on my_pc_dropitem_storage is higher than 1, */
/* our posthook will display a message to the user about the cap */
/* - by checking whether it was successful (retVal value) it allows for the originals conditions to take place */
/**
/* triggered when server starts loading, before any server-specific data is set */
/* makes map server listen to mysetting:value in any "battleconf" file (including imported or custom ones) */
/* value is not limited to numbers, its passed to our plugins handler (parse_my_setting) as const char *,
/* run when server is ready (online) */
/* run when server is shutting down */
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\plugins\script_mapquit.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/// Base author: Haru <haru@dotalux.com>
/// mapquit() script command
// Plugin name
// Which server types this plugin works with?
// Plugin version
// HPM Version (don't change, macro is automatically updated)
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\test\test_libconfig.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
/// Base author: Haru <haru@dotalux.com>
//void (*write) (const struct config_t *config, FILE *stream);
//int (*write_file) (struct config_t *config, const char *filename);
/* Test File */\n"
/* End test file */\n";
//void (*set_include_dir) (struct config_t *config, const char *include_dir);
/* Test File */\n"
/* End test file */\n";
/* Test File */\n"
/* End test file */\n";
//int (*setting_set_int) (struct config_setting_t *setting, int value);
//int (*setting_set_int64) (struct config_setting_t *setting, int64 value);
//int (*setting_set_float) (struct config_setting_t *setting, double value);
//int (*setting_set_bool) (struct config_setting_t *setting, int value);
//int (*setting_set_string) (struct config_setting_t *setting, const char *value);
/* Test File */\n"
/* End test file */\n";
/* Test File */\n"
/* End test file */\n";
/* Test File */\n"
/* End test file */\n";
/* Test File */\n"
/* End test file */\n";
/* Test File */\n"
/* End test file */\n";
/* Test File */\n"
/* End test file */\n";
/* Test File */\n"
/* End test file */\n";
//TEST("libconfig->write", test_libconfig_write);
//TEST("libconfig->write_file", test_libconfig_write_file);
//TEST("libconfig->set_include_dir", test_libconfig_set_include_dir);
//int (*setting_set_format) (struct config_setting_t *setting, short format);
//short (*setting_get_format) (const struct config_setting_t *setting);
//struct config_setting_t * (*setting_set_int_elem) (struct config_setting_t *setting, int idx, int value);
//struct config_setting_t * (*setting_set_int64_elem) (struct config_setting_t *setting, int idx, int64 value);
//struct config_setting_t * (*setting_set_float_elem) (struct config_setting_t *setting, int idx, double value);
//struct config_setting_t * (*setting_set_bool_elem) (struct config_setting_t *setting, int idx, int value);
//struct config_setting_t * (*setting_set_string_elem) (struct config_setting_t *setting, int idx, const char *value);
//struct config_setting_t * (*setting_add) (struct config_setting_t *parent, const char *name, int type);
//int (*setting_remove) (struct config_setting_t *parent, const char *name);
//int (*setting_remove_elem) (struct config_setting_t *parent, unsigned int idx);
//void (*setting_set_hook) (struct config_setting_t *setting, void *hook);
//void (*set_destructor) (struct config_t *config, void (*destructor)(void *));
//TEST("libconfig->setting_set_*", test_libconfig_setting_set);
//void (*setting_copy_simple) (struct config_setting_t *parent, const struct config_setting_t *src);
//void (*setting_copy_elem) (struct config_setting_t *parent, const struct config_setting_t *src);
//void (*setting_copy_aggregate) (struct config_setting_t *parent, const struct config_setting_t *src);
//int (*setting_copy) (struct config_setting_t *parent, const struct config_setting_t *src);
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\src\test\test_spinlock.c
/**
//herc.ws - http://github.com/HerculesWS/Hercules
//www.gnu.org/licenses/>.
//
// Simple test for the spinlock implementation to see if it works properly..
//
//thread Count
//end: worker()
// Everything fine?
//end: do_init()
//end: do_abort()
//end: set_server_type()
//end: do_final()
//end: parse_console
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\tools\itemcombodbconverter.py
#!/usr/bin/env python3
# -*- coding: utf8 -*-
#
# This file is part of Hercules.
# http://herc.ws - http://github.com/HerculesWS/Hercules
#
# Copyright (C) 2019-2020 Hercules Dev Team
# Copyright (C) 2019 Asheraf
#
# Hercules is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\tools\mobavailconverter.py
#!/usr/bin/env python
# -*- coding: utf8 -*-
#
# This file is part of Hercules.
# http://herc.ws - http://github.com/HerculesWS/Hercules
#
# Copyright (C) 2019-2020 Hercules Dev Team
# Copyright (C) 2019 Asheraf
#
# Hercules is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\tools\mobdbconverter.py
#! /usr/bin/env python
# -*- coding: utf8 -*-
#
# This file is part of Hercules.
# http://herc.ws - http://github.com/HerculesWS/Hercules
#
# Copyright (C) 2015-2020 Hercules Dev Team
# Copyright (C) 2015 Andrei Karas (4144)
#
# Hercules is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
# This Script converts mob_db.txt to mob_db.conf format
# was need for remove wrong characters
#                    itemName = itemName.replace(".", "")
#                    if itemName[0] >= "0" and itemName[0] <= "9":
#                        itemName = "Num" + itemName
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\tools\mobskilldbconverter.py
#!/usr/bin/python
# -*- coding: utf8 -*-
#
# This file is part of Hercules.
# http://herc.ws - http://github.com/HerculesWS/Hercules
#
# Copyright (C) 2018-2020 Hercules Dev Team
# Copyright (C) 2018 Asheraf
#
# Hercules is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\tools\petdbconverter.py
#! /usr/bin/env python
# -*- coding: utf8 -*-
#
# This file is part of Hercules.
# http://herc.ws - http://github.com/HerculesWS/Hercules
#
# Copyright (C) 2018-2020 Hercules Dev Team
# Copyright (C) 2018 Asheraf
# Copyright (C) 2015 Andrei Karas (4144)
#
# Hercules is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
# was need for remove wrong characters
#                    itemName = itemName.replace(".", "")
#                    if itemName[0] >= "0" and itemName[0] <= "9":
#                        itemName = "Num" + itemName
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\tools\petevolutionconverter.py
#!/usr/bin/python
# -*- coding: utf8 -*-
#
# This file is part of Hercules.
# http://herc.ws - http://github.com/HerculesWS/Hercules
#
# Copyright (C) 2018-2020 Hercules Dev Team
# Copyright (C) 2018 Dastgir
#
# Hercules is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
# Usage:
#  python petevolutionconverter.py PetEvolutionCln.lub re ../ > pet_evolve_db.conf
#
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\tools\scconfigconverter.py
#!/usr/bin/env python
# -*- coding: utf8 -*-
#
# This file is part of Hercules.
# http://herc.ws - http://github.com/HerculesWS/Hercules
#
# Copyright (C) 2019-2020 Hercules Dev Team
# Copyright (C) 2019 Asheraf
#
# Hercules is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\tools\validateinterfaces.py
#! /usr/bin/env python
# -*- coding: utf8 -*-
#
# This file is part of Hercules.
# http://herc.ws - http://github.com/HerculesWS/Hercules
#
# Copyright (C) 2014-2020 Hercules Dev Team
# Copyright (C) 2014 Andrei Karas (4144)
#
# Hercules is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#            print "cline1: " + line
# found C file with interface
#                    print "cline2: " + line
#                        print "{2}: add {0}, from: {1}".format(m.group("method"), line, ifname)
#            print "hline: " + line
#                print "{2}: add {0}, from: {1}".format(m.group("method"), line, ifname)
#        for method in cMethods:
#            if method not in hMethods:
#                print "Extra method in file {0}: {1}".format(cFile, method)
#    print "Checking: " + cFile
#        elif file1[-2:] == ".c":
#    print "Checking: " + cFile
#                    print "src  : " + line
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\tools\utils\common.py
#!/usr/bin/python
# -*- coding: utf8 -*-
#
# This file is part of Hercules.
# http://herc.ws - http://github.com/HerculesWS/Hercules
#
# Copyright (C) 2018-2020 Hercules Dev Team
# Copyright (C) 2018 Asheraf
#
# Hercules is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\tools\utils\libconf.py
#!/usr/bin/python
# -*- coding: utf8 -*-
#
# Copyright (C) 2018-2020 Hercules Dev Team
#
# This library is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
# This file originally licensed under the MIT License
#
# Copyright (c) 2016 Christian Aichinger <Greek0@gmx.net>
# https://github.com/Grk0/python-libconf
#
# Permission is hereby granted, free of charge, to any person obtaining a copy of
# this software and associated documentation files (the "Software"), to deal in
# the Software without restriction, including without limitation the rights to
# use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
# of the Software, and to permit persons to whom the Software is furnished to do
# so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in all
# copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
# SOFTWARE.
# Define an isstr() and isint() that work on both Python2 and Python3.
# See http://stackoverflow.com/questions/11301138
# attempt to evaluate basestring
# Bounds to determine when an "L" suffix should be used during dump().
# 2-digit hex escapes
# Single-character escapes
#.*$|//.*$|/\*(.|\n)*?\*/', re.MULTILINE)
# load() logic
##############
# Work around Python2's OrderedDict weirdness.
# Copy seenfiles, don't alter it.
# This list is ordered so that more common tokens are checked first.
# This is disabled to enable the last member in a list to have a comma at the end
#   self.tokens.error("expected value after ','")
# dump() logic
##############
# main(): small example of how to use libconf
#############################################
________________________________________________________________________________________
E:/AllLangDS/ds/cpp/Hercules-stable\Hercules-stable\tools\utils\__init__.py
