                    GNU GENERAL PUBLIC LICENSE
                       Version 2, June 1991

 Copyright (C) 1989, 1991 Free Software Foundation, Inc.,
 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
 Everyone is permitted to copy and distribute verbatim copies
 of this license document, but changing it is not allowed.

                            Preamble

  The licenses for most software are designed to take away your
freedom to share and change it.  By contrast, the GNU General Public
License is intended to guarantee your freedom to share and change free
software--to make sure the software is free for all its users.  This
General Public License applies to most of the Free Software
Foundation's software and to any other program whose authors commit to
using it.  (Some other Free Software Foundation software is covered by
the GNU Lesser General Public License instead.)  You can apply it to
your programs, too.

  When we speak of free software, we are referring to freedom, not
price.  Our General Public Licenses are designed to make sure that you
have the freedom to distribute copies of free software (and charge for
this service if you wish), that you receive source code or can get it
if you want it, that you can change the software or use pieces of it
in new free programs; and that you know you can do these things.

  To protect your rights, we need to make restrictions that forbid
anyone to deny you these rights or to ask you to surrender the rights.
These restrictions translate to certain responsibilities for you if you
distribute copies of the software, or if you modify it.

  For example, if you distribute copies of such a program, whether
gratis or for a fee, you must give the recipients all the rights that
you have.  You must make sure that they, too, receive or can get the
source code.  And you must show them these terms so they know their
rights.

  We protect your rights with two steps: (1) copyright the software, and
(2) offer you this license which gives you legal permission to copy,
distribute and/or modify the software.

  Also, for each author's protection and ours, we want to make certain
that everyone understands that there is no warranty for this free
software.  If the software is modified by someone else and passed on, we
want its recipients to know that what they have is not the original, so
that any problems introduced by others will not reflect on the original
authors' reputations.

  Finally, any free program is threatened constantly by software
patents.  We wish to avoid the danger that redistributors of a free
program will individually obtain patent licenses, in effect making the
program proprietary.  To prevent this, we have made it clear that any
patent must be licensed for everyone's free use or not licensed at all.

  The precise terms and conditions for copying, distribution and
modification follow.

                    GNU GENERAL PUBLIC LICENSE
   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION

  0. This License applies to any program or other work which contains
a notice placed by the copyright holder saying it may be distributed
under the terms of this General Public License.  The "Program", below,
refers to any such program or work, and a "work based on the Program"
means either the Program or any derivative work under copyright law:
that is to say, a work containing the Program or a portion of it,
either verbatim or with modifications and/or translated into another
language.  (Hereinafter, translation is included without limitation in
the term "modification".)  Each licensee is addressed as "you".

Activities other than copying, distribution and modification are not
covered by this License; they are outside its scope.  The act of
running the Program is not restricted, and the output from the Program
is covered only if its contents constitute a work based on the
Program (independent of having been made by running the Program).
Whether that is true depends on what the Program does.

  1. You may copy and distribute verbatim copies of the Program's
source code as you receive it, in any medium, provided that you
conspicuously and appropriately publish on each copy an appropriate
copyright notice and disclaimer of warranty; keep intact all the
notices that refer to this License and to the absence of any warranty;
and give any other recipients of the Program a copy of this License
along with the Program.

You may charge a fee for the physical act of transferring a copy, and
you may at your option offer warranty protection in exchange for a fee.

  2. You may modify your copy or copies of the Program or any portion
of it, thus forming a work based on the Program, and copy and
distribute such modifications or work under the terms of Section 1
above, provided that you also meet all of these conditions:

    a) You must cause the modified files to carry prominent notices
    stating that you changed the files and the date of any change.

    b) You must cause any work that you distribute or publish, that in
    whole or in part contains or is derived from the Program or any
    part thereof, to be licensed as a whole at no charge to all third
    parties under the terms of this License.

    c) If the modified program normally reads commands interactively
    when run, you must cause it, when started running for such
    interactive use in the most ordinary way, to print or display an
    announcement including an appropriate copyright notice and a
    notice that there is no warranty (or else, saying that you provide
    a warranty) and that users may redistribute the program under
    these conditions, and telling the user how to view a copy of this
    License.  (Exception: if the Program itself is interactive but
    does not normally print such an announcement, your work based on
    the Program is not required to print an announcement.)

These requirements apply to the modified work as a whole.  If
identifiable sections of that work are not derived from the Program,
and can be reasonably considered independent and separate works in
themselves, then this License, and its terms, do not apply to those
sections when you distribute them as separate works.  But when you
distribute the same sections as part of a whole which is a work based
on the Program, the distribution of the whole must be on the terms of
this License, whose permissions for other licensees extend to the
entire whole, and thus to each and every part regardless of who wrote it.

Thus, it is not the intent of this section to claim rights or contest
your rights to work written entirely by you; rather, the intent is to
exercise the right to control the distribution of derivative or
collective works based on the Program.

In addition, mere aggregation of another work not based on the Program
with the Program (or with a work based on the Program) on a volume of
a storage or distribution medium does not bring the other work under
the scope of this License.

  3. You may copy and distribute the Program (or a work based on it,
under Section 2) in object code or executable form under the terms of
Sections 1 and 2 above provided that you also do one of the following:

    a) Accompany it with the complete corresponding machine-readable
    source code, which must be distributed under the terms of Sections
    1 and 2 above on a medium customarily used for software interchange; or,

    b) Accompany it with a written offer, valid for at least three
    years, to give any third party, for a charge no more than your
    cost of physically performing source distribution, a complete
    machine-readable copy of the corresponding source code, to be
    distributed under the terms of Sections 1 and 2 above on a medium
    customarily used for software interchange; or,

    c) Accompany it with the information you received as to the offer
    to distribute corresponding source code.  (This alternative is
    allowed only for noncommercial distribution and only if you
    received the program in object code or executable form with such
    an offer, in accord with Subsection b above.)

The source code for a work means the preferred form of the work for
making modifications to it.  For an executable work, complete source
code means all the source code for all modules it contains, plus any
associated interface definition files, plus the scripts used to
control compilation and installation of the executable.  However, as a
special exception, the source code distributed need not include
anything that is normally distributed (in either source or binary
form) with the major components (compiler, kernel, and so on) of the
operating system on which the executable runs, unless that component
itself accompanies the executable.

If distribution of executable or object code is made by offering
access to copy from a designated place, then offering equivalent
access to copy the source code from the same place counts as
distribution of the source code, even though third parties are not
compelled to copy the source along with the object code.

  4. You may not copy, modify, sublicense, or distribute the Program
except as expressly provided under this License.  Any attempt
otherwise to copy, modify, sublicense or distribute the Program is
void, and will automatically terminate your rights under this License.
However, parties who have received copies, or rights, from you under
this License will not have their licenses terminated so long as such
parties remain in full compliance.

  5. You are not required to accept this License, since you have not
signed it.  However, nothing else grants you permission to modify or
distribute the Program or its derivative works.  These actions are
prohibited by law if you do not accept this License.  Therefore, by
modifying or distributing the Program (or any work based on the
Program), you indicate your acceptance of this License to do so, and
all its terms and conditions for copying, distributing or modifying
the Program or works based on it.

  6. Each time you redistribute the Program (or any work based on the
Program), the recipient automatically receives a license from the
original licensor to copy, distribute or modify the Program subject to
these terms and conditions.  You may not impose any further
restrictions on the recipients' exercise of the rights granted herein.
You are not responsible for enforcing compliance by third parties to
this License.

  7. If, as a consequence of a court judgment or allegation of patent
infringement or for any other reason (not limited to patent issues),
conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License.  If you cannot
distribute so as to satisfy simultaneously your obligations under this
License and any other pertinent obligations, then as a consequence you
may not distribute the Program at all.  For example, if a patent
license would not permit royalty-free redistribution of the Program by
all those who receive copies directly or indirectly through you, then
the only way you could satisfy both it and this License would be to
refrain entirely from distribution of the Program.

If any portion of this section is held invalid or unenforceable under
any particular circumstance, the balance of the section is intended to
apply and the section as a whole is intended to apply in other
circumstances.

It is not the purpose of this section to induce you to infringe any
patents or other property right claims or to contest validity of any
such claims; this section has the sole purpose of protecting the
integrity of the free software distribution system, which is
implemented by public license practices.  Many people have made
generous contributions to the wide range of software distributed
through that system in reliance on consistent application of that
system; it is up to the author/donor to decide if he or she is willing
to distribute software through any other system and a licensee cannot
impose that choice.

This section is intended to make thoroughly clear what is believed to
be a consequence of the rest of this License.

  8. If the distribution and/or use of the Program is restricted in
certain countries either by patents or by copyrighted interfaces, the
original copyright holder who places the Program under this License
may add an explicit geographical distribution limitation excluding
those countries, so that distribution is permitted only in or among
countries not thus excluded.  In such case, this License incorporates
the limitation as if written in the body of this License.

  9. The Free Software Foundation may publish revised and/or new versions
of the General Public License from time to time.  Such new versions will
be similar in spirit to the present version, but may differ in detail to
address new problems or concerns.

Each version is given a distinguishing version number.  If the Program
specifies a version number of this License which applies to it and "any
later version", you have the option of following the terms and conditions
either of that version or of any later version published by the Free
Software Foundation.  If the Program does not specify a version number of
this License, you may choose any version ever published by the Free Software
Foundation.

  10. If you wish to incorporate parts of the Program into other free
programs whose distribution conditions are different, write to the author
to ask for permission.  For software which is copyrighted by the Free
Software Foundation, write to the Free Software Foundation; we sometimes
make exceptions for this.  Our decision will be guided by the two goals
of preserving the free status of all derivatives of our free software and
of promoting the sharing and reuse of software generally.

                            NO WARRANTY

  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
REPAIR OR CORRECTION.

  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.

                     END OF TERMS AND CONDITIONS

            How to Apply These Terms to Your New Programs

  If you develop a new program, and you want it to be of the greatest
possible use to the public, the best way to achieve this is to make it
free software which everyone can redistribute and change under these terms.

  To do so, attach the following notices to the program.  It is safest
to attach them to the start of each source file to most effectively
convey the exclusion of warranty; and each file should have at least
the "copyright" line and a pointer to where the full notice is found.

    <one line to give the program's name and a brief idea of what it does.>
    Copyright (C) <year>  <name of author>

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License along
    with this program; if not, write to the Free Software Foundation, Inc.,
    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.

Also add information on how to contact you by electronic and paper mail.

If the program is interactive, make it output a short notice like this
when it starts in an interactive mode:

    Gnomovision version 69, Copyright (C) year name of author
    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
    This is free software, and you are welcome to redistribute it
    under certain conditions; type `show c' for details.

The hypothetical commands `show w' and `show c' should show the appropriate
parts of the General Public License.  Of course, the commands you use may
be called something other than `show w' and `show c'; they could even be
mouse-clicks or menu items--whatever suits your program.

You should also get your employer (if you work as a programmer) or your
school, if any, to sign a "copyright disclaimer" for the program, if
necessary.  Here is a sample; alter the names:

  Yoyodyne, Inc., hereby disclaims all copyright interest in the program
  `Gnomovision' (which makes passes at compilers) written by James Hacker.

  <signature of Ty Coon>, 1 April 1989
  Ty Coon, President of Vice

This General Public License does not permit incorporating your program into
proprietary programs.  If your program is a subroutine library, you may
consider it more useful to permit linking proprietary applications with the
library.  If this is what you want to do, use the GNU Lesser General
Public License instead of this License.
# TEAMMATES Developer Web Site

[![Travis Build Status](https://travis-ci.org/TEAMMATES/teammates.svg?branch=master)](https://travis-ci.org/TEAMMATES/teammates)
[![AppVeyor Build Status](https://ci.appveyor.com/api/projects/status/dvr6t33lqg6hsmxw/branch/master?svg=true)](https://ci.appveyor.com/project/damithc/teammates/branch/master)
[![Codecov Coverage Status](https://codecov.io/gh/TEAMMATES/teammates/branch/master/graph/badge.svg)](https://codecov.io/gh/TEAMMATES/teammates)
[![License](https://img.shields.io/badge/license-GPLv2-blue.svg)](LICENSE)

TEAMMATES is a free online tool for managing peer evaluations and other feedback paths of your students.
It is provided as a cloud-based service for educators/students and is currently used by hundreds of universities across the world.

<img src="src/web/assets/images/overview.png" width="600">

This is the developer web site for TEAMMATES. **Click [here](http://teammatesv4.appspot.com/) to go to the TEAMMATES product website.**

[**Documentation for Developers** :book:](docs/README.md) |
[Version History](https://github.com/TEAMMATES/teammates/milestones?direction=desc&sort=due_date&state=closed) |
[Project Stats](https://www.openhub.net/p/teammatesonline)

## Interested to join TEAMMATES developer team?

We welcome contributions from developers, especially students. Here are some resources:
* [**Contributor Orientation Guide**](docs/CONTRIBUTING.md): This document describes what you need to know/do to become a contributor.
* [**Project ideas page**](https://github.com/TEAMMATES/teammates/wiki): These are for those who would like to do a relatively bigger projects with TEAMMATES (e.g. summer internships).

## Acknowledgements

TEAMMATES team wishes to thank the following invaluable contributions:
* [**School of Computing, National University of Singapore (NUS)**](http://www.comp.nus.edu.sg), for providing us with the infrastructure support to run the project.
* [**Centre for Development of Teaching and Learning (CDTL)**](http://www.cdtl.nus.edu.sg/) of NUS, for supporting us with several *Teaching Enhancement Grants* over the years.
* **Learning Innovation Fund-Technology (LIF-T)** initiative of NUS, for funding us for the 2015-2018 period.
* **Google Summer of Code** Program, for including TEAMMATES as a mentor organization in *GSoC2014*, *GSoC2015*, *GSoC2016*, *GSoC2017* and *GSoC2018* editions.
* **Facebook Open Academy** Program, for including TEAMMATES as a mentor organization in FBOA 2016.
* **Jet Brains**, for the [Intellij IDEA](https://www.jetbrains.com/idea/) licences
* <img src="src/web/assets/images/yklogo.png" width="100"> [**YourKit LLC**](https://www.yourkit.com), for providing us with free licenses for the [YourKit Java Profiler](https://www.yourkit.com/java/profiler) (an industry leading profiler tool for Java applications).
* <img src="src/web/assets/images/saucelabs.png" width="100"> [**SauceLabs**](https://saucelabs.com), for providing us with a free [Open Sauce account](https://saucelabs.com/open-source) for cross-browser testing.

## Contacting us

The best way to contact us is to [post a message in our issue tracker](https://github.com/TEAMMATES/teammates/issues/new). Our issue tracker doubles as a discussion forum. You can use it for things like asking questions about the project or requesting technical help.

Alternatively (less preferred), you can email us at **teammates@comp.nus.edu.sg**.
# Contributor Covenant Code of Conduct

## Our Pledge

In the interest of fostering an open and welcoming environment, we as
contributors and maintainers pledge to making participation in our project and
our community a harassment-free experience for everyone, regardless of age, body
size, disability, ethnicity, gender identity and expression, level of experience,
nationality, personal appearance, race, religion, or sexual identity and
orientation.

## Our Standards

Examples of behavior that contributes to creating a positive environment
include:

* Using welcoming and inclusive language
* Being respectful of differing viewpoints and experiences
* Gracefully accepting constructive criticism
* Focusing on what is best for the community
* Showing empathy towards other community members

Examples of unacceptable behavior by participants include:

* The use of sexualized language or imagery and unwelcome sexual attention or
  advances
* Trolling, insulting/derogatory comments, and personal or political attacks
* Public or private harassment
* Publishing others' private information, such as a physical or electronic
  address, without explicit permission
* Other conduct which could reasonably be considered inappropriate in a
  professional setting

## Our Responsibilities

Project maintainers are responsible for clarifying the standards of acceptable
behavior and are expected to take appropriate and fair corrective action in
response to any instances of unacceptable behavior.

Project maintainers have the right and responsibility to remove, edit, or
reject comments, commits, code, wiki edits, issues, and other contributions
that are not aligned to this Code of Conduct, or to ban temporarily or
permanently any contributor for other behaviors that they deem inappropriate,
threatening, offensive, or harmful.

## Scope

This Code of Conduct applies both within project spaces and in public spaces
when an individual is representing the project or its community. Examples of
representing a project or community include using an official project e-mail
address, posting via an official social media account, or acting as an appointed
representative at an online or offline event. Representation of a project may be
further defined and clarified by project maintainers.

## Enforcement

Instances of abusive, harassing, or otherwise unacceptable behavior may be
reported by contacting the project team at teammates@comp.nus.edu.sg. All
complaints will be reviewed and investigated and will result in a response that
is deemed necessary and appropriate to the circumstances. The project team is
obligated to maintain confidentiality with regard to the reporter of an incident.
Further details of specific enforcement policies may be posted separately.

Project maintainers who do not follow or enforce the Code of Conduct in good
faith may face temporary or permanent repercussions as determined by other
members of the project's leadership.

## Attribution

This Code of Conduct is adapted from the [Contributor Covenant][homepage], version 1.4,
available at https://www.contributor-covenant.org/version/1/4/code-of-conduct.html

[homepage]: https://www.contributor-covenant.org
Before opening a new issue, please check that no existing issue covers the same topic.

Go to the "Preview" tab and click on the relevant issue type to be redirected to the appropriate template.

- [Bug reports](?template=bug-report.md)
- [Feature/enhancement requests, enhancement to build process](?template=feature-request.md)
- [Help requests](?template=help-request.md)
- [Data migration](?template=data-migration.md)

For other tasks (e.g. refactoring, adding tests, fixing typo), there is no template to follow. Simply provide a clear issue title and description of the work to be done.

If you are reporting a security vulnerability, due to the sensitive nature of such a report, you are kindly requested to refrain from opening a new issue.
Instead, submit your report by emailing the team at teammates@comp.nus.edu.sg.
Fixes #

**PR Checklist**

<!-- Remove this portion after you have made the checks. -->

Ensure that you have:
- [ ] Read and understood our PR guideline: https://github.com/TEAMMATES/teammates/blob/master/docs/process.md#step-4-submit-a-pr
  - [ ] Added the issue number to the "Fixes" keyword above
  - [ ] Titled the PR as specified in the abovementioned document
- [ ] Made your changes on a branch other than `master` and `release`
- [ ] Gone through all the changes in this PR and ensured that:
  - [ ] They addressed one (and only one) issue
  - [ ] No unintended changes were made
- [ ] Run and passed static analysis: `./gradlew lint` and `npm run lint`
- [ ] Added/updated tests, if changes in functionality were involved
- [ ] Added/updated documentation to public APIs (classes, methods, variables), if applicable

**Outline of Solution**

<!-- Tell us how you solved the issue. -->
<!-- If there are things you want the reviewers to focus on, include them here as well. -->
<!-- This portion can be skipped if the fix is trivial. -->
# TEAMMATES Support

If you are looking for support for TEAMMATES, check out:

* User Documentation
  * [For students](http://teammatesv4.appspot.com/studentHelp.jsp)
  * [For instructors](http://teammatesv4.appspot.com/instructorHelp.jsp)
* [Developer Documentation](../docs/README.md)
* [FAQs by external contributors](https://github.com/TEAMMATES/teammates/issues?utf8=✓&q=is:issue+label:a-DevHelp). Note that many of the questions asked and/or answers provided may have been outdated now.

If you want to reach out to the project team, the best way is to [post a message in our issue tracker](https://github.com/TEAMMATES/teammates/issues/new). Our issue tracker doubles as a discussion forum.
You can use it for things like asking questions about the project, the workflow, or requesting technical help.

Alternatively (less preferred), you can email us at **teammates@comp.nus.edu.sg**.
---
name: Bug report
about: Report a bug or defect in the application

---

<!-- Issue title: [brief description of bug] -->

- **Environment**: <!-- The environment in which you encountered the bug, e.g. live server at `V6.0.0`, `master` branch at commit 1234567. -->

**Steps to reproduce**



**Expected behaviour**



**Actual behaviour**



**Additional info**
<!-- You can enter any additional relevant info here. -->
<!-- If you know what caused the bug and/or how to resolve the bug, you can include them in this section. -->
---
name: Data migration
about: (for core team) Track the status of a data migration

---

<!-- Issue title: Data Migration: [summary of affected entities and fields] -->

Data migration initiated by PR #<!-- Fill up PR number -->.

- [x] Merged code that work for both the old and new versions of the data schema.
- [ ] Released a version containing the above in V<!-- Fill up version -->.
- [ ] Created a client script to migrate all data following the old schema to the new schema in PR #<!-- Fill up PR number -->.
- [ ] Ran the script against the live site.
- [ ] Removed the code that is specifically tailored for the old data schema in PR #<!-- Fill up PR number -->.
---
name: Feature request
about: Request a new or a change to existing user-facing feature

---

<!-- Issue title: [brief description of feature/enhancement] -->

- **Environment**: <!-- The environment in which the said feature/enhancement is absent, e.g. live server at `V6.0.0`, `master` branch at commit 1234567. -->

**Description of feature/enhancement**



**Justification**
<!-- Explain who will benefit (instructors, students, developers, etc.) and in what way. -->



**Existing similar features and their shortcomings**
<!-- Explain why existing similar features fall short of your expectation. -->
<!-- This section can be skipped if there are no existing similar features. -->
---
name: Help request
about: Request for technical help in development

---

<!-- Issue title: Help Request: [summary of your problem] -->

- **Commit SHA:** <!-- Result of running the command `git rev-parse HEAD` -->
- **Operating System:**
- **JDK Version:**
- **Node.js Version:**
- **Google Cloud SDK Version:**
- **IntelliJ Version (if applicable):**
- **Firefox / Chrome Version (if applicable):**

**What I was trying to do / What I need help with**
<!-- e.g. if you were setting up the project, tell us the step in the setting up guide at which you are stuck. -->
<!-- e.g. if you were resolving test failures, tell us which tests are failing. -->
<!-- Include information such as screenshots, error stack traces, or console messages to help us troubleshoot. -->



**Attempts to resolve the problem**
<!-- Tell us the steps you have taken to try to (unsuccessfully) resolve the problem and the outcomes. -->
---
name: Release
about: (for core team) Schedule and manage a release

---

<!-- Issue title: Release VX.Y.Z -->

Scheduled for <!-- insert date and time here, e.g. Thursday, Sep 20, 2018, 10.00am SGT -->.

Release Lead:

- [ ] Tagged the latest stable release code with the latest version number
- [ ] Released changelogs

PM:

- [ ] Deployed the new version
- [ ] Released the new version for end users
# Setting up CAPTCHA

TEAMMATES uses [reCAPTCHA](https://developers.google.com/recaptcha/) on the `Recover Session Links` page as a security check. It helps protect the website by blocking spam bots and abusive traffic, and only allows valid human users to pass through.
By default, the CAPTCHA widget is not shown on the page since no keys are specified in the config files.
 
However, this should be changed for production environments:

1. Register for CAPTCHA [here](https://www.google.com/recaptcha/admin). You may be prompted to sign in with your Google account.
1. Include `localhost` and/or `127.0.0.1` in the CAPTCHA domains setting if you are using this for development as well.
1. After obtaining the CAPTCHA keys:
    - Copy the site key to `captchaSiteKey` in the `config.ts` file.
    - Copy the secret key to `app.captcha.secretkey` in the `build.properties` file.
# Contributing to TEAMMATES

Thanks for taking your time to contribute to TEAMMATES!

We welcome contributions from anyone, in particular, students (see [here](https://teammatesv4.appspot.com/about.jsp) for the list of our contributors). One of the main objectives of TEAMMATES is to help students get experience in a OSS production environment. Here are some information that might be useful to would-be contributors.

* [Getting started](#getting-started)
  * [Know the product/project](#know-the-productproject)
  * [Code of Conduct](#code-of-conduct)
* [How can I contribute?](#how-can-i-contribute)
  * [Submitting an issue](#submitting-an-issue)
  * [Manual testing](#manual-testing)
  * [Submitting a pull request](#submitting-a-pull-request)
* [Contributor orientation guide](#contributor-orientation-guide)
  * [Knowledge required](#knowledge-required)
  * [Orientation task list](#orientation-task-list)
* [Other resources](#other-resources)

## Getting started

### Know the product/project

Understand what TEAMMATES is about, both as a product (users' point of view) and a project (developers' point of view).

* [Product intro page](https://teammatesv4.appspot.com) shown to potential users
* [Features overview](https://teammatesv4.appspot.com/features.jsp)
* [Project vision, challenges, and principles](overview.md)

### Code of Conduct

By participating in this project, you agree to uphold the [TEAMMATES Code of Conduct](../.github/CODE_OF_CONDUCT.md), which is adopted from [Contributor Covenant Code of Conduct](https://www.contributor-covenant.org/).

## How can I contribute?

### Submitting an issue

We use the [issue tracker](https://github.com/TEAMMATES/teammates/issues) to contain bug reports and feature/enhancement requests.
Before submitting a new issue, search the issue tracker to ensure that there is no similar open issue.

If you are certain that you are reporting a new issue, [open a new issue](https://github.com/TEAMMATES/teammates/issues/new) using the templates provided.

### Manual testing

We welcome anyone manually testing our product and reporting bugs or suggestions for enhancements in the issue tracker.

If you want to undertake such a role without actually contributing code, [get an instructor account from TEAMMATES](https://teammatesv4.appspot.com/request.jsp).
Remember to mention the purpose of your request under "Any other comments/queries". 

### Submitting a pull request

We accept patches/fixes in form of pull requests (PRs). Make sure that the pull request addresses an open issue in the issue tracker.
Remember to follow the [TEAMMATES Development Process](process.md).

By submitting a PR, you agree to allow the project team to license your work under the terms of the [GNU GPL v2 License](../LICENSE).

If this is your first time contributing to TEAMMATES, you may want to read up the contributor orientation guide lined out in the next section.

## Contributor orientation guide

Contributing to an OSS project requires you to figure out things on your own when you can, and seek help from the right resource (Google, StackOverflow, troubleshooting guides, issue tracker, etc.) when you cannot. To become a TEAMMATES contributor, you need to start honing those skills. To help you with that, we have created a sequence of tasks you can try to complete. Try to complete as many of them as you can, in the order they are listed.

Of course we are happy to guide you if you encounter any difficulties when doing these tasks; we have provided a [troubleshooting guide](troubleshooting-guide.md) for some commonly faced problems. Failing that, you may post a help request in our [issue tracker](https://github.com/TEAMMATES/teammates/issues).

> - The task descriptions are brief by intention. We want you to try to figure out how to do those things by yourself.
> - While the dev team members will be glad to answer your questions, you will not make a good impression if you ask questions which are already answered in the mentioned resources.

### Knowledge required

Although TEAMMATES uses many tools and technologies, you need not know all of them before you can contribute. The diagram below shows which technologies you need to learn to contribute in different roles.

![RolesAndTechnologies.png](images/RolesAndTechnologies.png)

Note that these roles are not fixed or formally assigned; it is simply for guidance only.

Roles:

* **Web page developer**: Works on static web pages, such as those used in the TEAMMATES product web site.
* **Front-end developer**: Works on the front-end of the app, i.e. the dynamically-generated user interface.
* **Test developer**: Works on automating system tests.
* **Back-end developer**: Works on the back-end logic of the app, including data storage.
* **DevOps developer**: Works on automations (CI, static analysis, scripting) and operations (logging, monitoring, troubleshooting).

### Orientation task list

#### Phase A: Set up locally

1. [Set up TEAMMATES development environment on your computer.](setting-up.md)<br>
   **Important: Follow instructions to the letter. Install the specified versions of the tool stack, not the latest versions.**
1. Get *dev green* (more info in [_Development Guidelines_ document](development.md)).
   It is OK to proceed to the next phase if you have fewer than 5 failing test cases.

#### Phase B: Learn

In order to contribute effectively, you are advised to learn how to do the various development routines lined out in [the _Development Guidelines_ document](development.md).
Try your best to be familiar with at least building and testing the application in your local development environment.

#### Phase C: Start contributing

When you are ready for a real contribution, you are advised to start with an issue labelled [d.FirstTimers](https://github.com/TEAMMATES/teammates/issues?q=is:issue+is:open+label:d.FirstTimers) (but do not do more than one of those), then move on to other issues labelled [d.Contributors](https://github.com/TEAMMATES/teammates/issues?q=is:issue+is:open+label:d.Contributors).
Steps for fixing an issue are lined out in the [process document](process.md).

> In the event that you cannot find a `d.FirstTimers`-labelled issue, you can start with a `d.Contributors`-labelled issue.
> You can consult the `e.*` label, if it is present, to estimate the difficulty. Lower number generally means less amount of work required.

#### Important

Fixing an issue quickly is not the important thing. In fact, issues given to new contributors are the ones we already know how to fix.
We are more interested to see how you go about fixing the issue. We want to know whether you are systematic and detail-oriented.

Take your time to learn and follow the workflow to the letter. Do not skip any steps because you think that step is "not important". We are more impressed when you finish an issue in fewer attempts than when you finish it in a shorter time but take many attempts because you were not meticulous enough along the way.

## Other resources

* [Support request](../.github/SUPPORT.md)
* [Comprehensive directory of resources, including style guides](../docs/README.md)
# Design

- [Architecture](#architecture)
- [UI Component](#ui-component)
- [Logic Component](#logic-component)
- [Storage Component](#storage-component)
- [Common Component](#common-component)
- [Test Driver Component](#test-driver-component)
- [E2E Component](#e2e-component)
- [Client Component](#client-component)

## Architecture

![High Level Architecture](images/highlevelArchitecture.png)

TEAMMATES is a Web application that runs on Google App Engine (GAE). Given above is an overview of the main components.
- **UI (Browser)**: The UI seen by users consists of Web pages containing HTML, CSS (for styling) and JavaScript (for client-side interactions such as sorting, input validation, etc.). This UI is a single HTML page generated by Angular framework. The initial page request is sent to the server over HTTP, and requests for data are sent asynchronously with AJAX.
- **UI (Server)**: The entry point for the application back end logic is designed as a REST-ful controller.
- **Logic**: The main logic of the application is in POJOs (Plain Old Java Objects).
- **Storage**: The storage layer of the application uses the persistence framework provided by **GAE Datastore**, a NoSQL database.
- **Test Driver**: TEAMMATES makes heavy use of automated regression testing. Test data is transmitted using JSON format.
  - `TestNG` is used for Java testing (all levels) and `Jest` for JavaScript unit-testing.
  - `HttpUnit` is used to set up a simulated web server in servlet-level tests, where an actual web server is not required.
- **E2E**: The E2E (end-to-end) component is used to interact with the application as a whole with Web browsers. Its primary function is for E2E tests.
  - `Selenium (Java)` is used to automate E2E testing with actual Web browsers.
- **Client**: The Client component can connect to the back end directly without using a Web browser. It is used for administrative purposes, e.g. migrating data to a new schema.
- **Common**: The Common component contains utility code (data transfer objects, helper classes, etc.) used across the application.

The diagram below shows how the code in each component is organized into packages and the dependencies between them.

![Package Diagram](images/packageDiagram.png)

Notes:
- `[logic] - [ui::website] - [ui::controller]` represent an application of `Model-View-Controller` pattern.
  - `ui::website` is not a real package; it is a conceptual package representing the front-end of the application.

## UI Component

The diagram below shows the object structure of the UI component.

![UI Component](images/UiComponent.png)

Notes:
- `ui::website` is not a Java package. It is written in Angular framework and consists of HTML, SCSS, and TypeScript files. The framework will build those files into HTML, CSS and JavaScript files ready to be used by standard Web browsers.

The UI component is the first stop for 99% of all requests that are received by the application.
Such a request will go through the following steps:

1. Request received by the GAE server.
1. Custom filters are applied according to the order specified in `web.xml`, e.g. `OriginCheckFilter`.
1. Request forwarded to a `*Servlet` object as specified in `web.xml` for further processing, depending on the type of request.

There are two general types of requests: user-invoked requests and automated (GAE server-invoked) requests, which are processed differently.

### User-invoked requests

User-invoked requests are all requests made by the users of the application, typically from the Web browser (i.e. by navigating to a particular URL of the application).
The request will be processed as follows:

![UI Workflow](images/UiWorkflow.png)

The initial request for the web page will be processed as follows:

1. Request forwarded to `WebPageServlet`.
1. `WebPageServlet` returns the built single web page (`index.html`).
1. The browser will render the page and execute the page scripts, most of the time requiring AJAX requests to the server.

Subsequent AJAX requests sent to the server will be processed as follows:

1. Request forwarded to the `WebApiServlet`.
1. `WebApiServlet` uses the `ActionFactory` to generate the matching `Action` object, e.g. `InstructorHomePageAction`.
1. `WebApiServlet` executes the action.
   1. The `Action` object checks the access rights of the user. If the action is allowed, it will be performed, interacting with the `Logic` component as necessary.
   1. The `Action` packages and processes the result into an `ActionResult` object. The most common format is `JsonResult` (requests for obtaining data or processing existing data), and other formats are defined as necessary, e.g. `FileDownloadResult` (e.g. downloading feedback session report) and `ImageResult` (e.g. profile pictures).
1. `WebApiServlet` sends the result back to the browser which will then process it on the front-end.

Requests for static asset files (e.g. CSS, JS files, images) are served directly without going through `web.xml` configuration at all.

The Web API is protected by two layers of access control check:
- Origin check: This mitigates [CSRF attack](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)).
- Authentication and authorization check: This checks if the logged in user (or lack thereof) has sufficient privileges to trigger the API's actions.

Special keys (`csrf key` and `backdoor key`) can be used to bypass each of the checks, typically for testing purpose. Those keys are strings known only to the person who deployed the application (typically, the administrator).

### Automated requests

Automated requests are all requests sent automatically by the GAE server during specific periods of time.
This type of request will be processed as follows:

1. The source of the request will be checked for administrator privilege. If this privilege is absent (e.g. non-administrator users trying to invoke the automated actions), the request will be dropped and a `403 Forbidden` status will be returned.
   - Requests generated by the GAE server are equipped with this privilege.
   - Administrators can manually invoke these requests; this is particularly useful in testing the actions associated with those requests.
1. Request forwarded to the `AutomatedServlet`.
1. `AutomatedServlet` uses the `AutomatedActionFactory` to generate the matching `AutomatedAction` object, e.g. `CompileLogsAction`.
1. `AutomatedServlet` executes the action.
1. The corresponding `AutomatedAction` will be performed, interacting with the `Logic` component as necessary.

GAE server sends such automated requests through two different configurations:
- Cron jobs: These are jobs that are automatically scheduled for a specified period of time, e.g. scheduling feedback session opening reminders. It is configured in `cron.xml`.
- Task queue workers: These are hybrids of user-invoked and GAE-invoked in that they are queued by users (i.e. users request for the tasks to be added to queue), but executed by GAE (i.e. GAE determines when and which tasks in the queue are executed at any point of time). This is typically used for tasks that may take a long time to finish and can exceed the 1 minute standard request processing limit imposed by GAE. It is configured in `queue.xml` as well as the `TaskQueue` nested class of the [Const](../src/main/java/teammates/common/util/Const.java) class.

### Template Method pattern

- Since the high-level workflow of processing a request is same for any request (differing by the two request types only), we use the [Template Method pattern](http://en.wikipedia.org/wiki/Template_method_pattern) to abstract the process flow into the `Action` and `AutomatedAction` classes.

## Logic Component

The `Logic` component handles the business logic of TEAMMATES. In particular, it is responsible for:
- Managing relationships between entities, e.g. cascade logic for create/update/delete.
- Managing transactions, e.g. ensuring atomicity of a transaction.
- Sanitizing input values received from the UI component.
- Providing a mechanism for checking access control rights.
- Connecting to GAE-provided or third-party APIs, e.g. for adding tasks to the task queue and for sending emails with third-party providers.

![Logic Component](images/LogicComponent.png)

Package overview:
- **`logic.api`**: Provides the API of the component to be accessed by the UI.
- **`logic.core`**: Contains the core logic of the system.

### Logic API

Represented by these classes:
- `Logic`: A [Facade class](http://en.wikipedia.org/wiki/Facade_pattern) which connects to the several `*Logic` classes to handle the logic related to various types of data and to access data from the `Storage` component.
- `GateKeeper`: Checks access rights of a user for a given action.
- `EmailGenerator`: Generates emails to be sent.
- `EmailSender`: Sends email with the provider chosen based on the build configuration. It connects to the email provider by using the appropriate `*Service` class.
- `TaskQueuer`: Adds tasks to the task queue. It connects to GAE's task queue API.

### Policies

Access control:
+ Although this component provides methods to perform access control, the API itself is not access controlled. The UI is expected to check access control (using `GateKeeper` class) before calling a method in the `Logic`.

API for creating entities:
+ Null parameters: Causes an assertion failure.
+ Invalid parameters: Throws `InvalidParametersException`.
+ Entity already exists: Throws `EntityAlreadyExistsException` (escalated from Storage level).

API for retrieving entities:
+ Attempting to retrieve objects using `null` parameters: Causes an assertion failure.
+ Entity not found:
  - Returns `null` if the target entity not found. This way, read operations can be used easily for checking the existence of an entity.

API for updating entities:
+ Update is done using `*UpdateOptions` inside every `*Attributes`. The `UpdateOptions` will specify what is used to identify the entity to update and what will be updated.
+ Entity not found: Throws `EntityDoesNotExistException`.
+ Invalid parameters: Throws `InvalidParametersException`.

API for deleting entities:
+ FailDeleteSilentlyPolicy: In general, delete operation do not throw exceptions if the target entity does not exist. This is because if it does not exist, it is as good as deleted.
+ Cascade policy:   When a parent entity is deleted, entities that have referential integrity with the deleted entity should also be deleted.
  Refer to the API for the cascade logic.

## Storage Component

The `Storage` component performs CRUD (Create, Read, Update, Delete) operations on data entities individually.
It contains minimal logic beyond what is directly relevant to CRUD operations.
In particular, it is reponsible for:
- Validating data inside entities before creating/updating them, to ensure they are in a valid state.
- Hiding the complexities of datastore from the `Logic` component. All GQL queries are to be contained inside the `Storage` component.
- Hiding the persistable objects: Classes in the `storage::entity` package are not visible outside this component to hide information specific to data persistence.
  - Instead, a corresponding non-persistent [data transfer object](http://en.wikipedia.org/wiki/Data_transfer_object) named `*Attributes` (e.g., `CourseAttributes` is the data transfer object for `Course` entities) object is returned. These datatransfer classes are in `common::datatransfer` package, to be explained later.

The `Storage` component does not perform any cascade delete/create operations. Cascade logic is handled by the `Logic` component.

![Storage Component](images/StorageComponent.png)

Package overview:
- **`storage.api`**: Provides the API of the component to be accessed by the logic component.
- **`storage.entity`**: Classes that represent persistable entities.
- **`storage.search`**: Classes for dealing with searching and indexing.

![Storage ER Diagram](images/StorageClassDiagram.png)

Note that the navigability of the association links between entity objects appear to be in the reverse direction of what we see in a normal OOP design.
This is because we want to keep the data schema flexible so that new entity types can be added later with minimal modifications to existing elements.

### Storage API

Represented by the `*Db` classes. These classes act as the bridge to the GAE Datastore.

### Policies

Add and Delete operations try to wait until data is persisted in the datastore before returning. This is not enough to compensate for eventual consistency involving multiple servers in the GAE production enviornment. However, it is expected to avoid test failures caused by eventual consistency in dev server and reduce such problems in the live server.
Note: 'Eventual consistency' here means it takes some time for a database operation to propagate across all serves of the Google's distributed datastore. As a result, the data may be in an inconsistent states for short periods of time although things should become consistent 'eventually'. For example, an object we deleted may appear to still exist for a short while.

Implementation of Transaction Control has been minimized due to limitations of GAE environment and the nature of our data schema.

API for creating:
+ Attempt to create an entity that already exists: Throws `EntityAlreadyExistsException`.
+ Attempt to create an entity with invalid data: Throws `InvalidParametersException`.

API for retrieving:
+ Attempt to retrieve an entity that does not exist: Returns `null`.

API for updating:
+ Attempt to update an entity that does not exist: Throws `EntityDoesNotExistException`.
+ Attempt to update an entity with invalid data: Throws `InvalidParametersException`.

API for deleting:
+ Attempt to delete an entity that does not exist: Fails silently.

## Common Component

The Common component contains common utilities used across TEAMMATES.

![Common Component](images/CommonComponent.png)

Package overview:
- **`common.util`**: Contains utility classes.
- **`common.exceptions`**: Contains custom exceptions.
- **`common.datatransfer`**: Contains data transfer objects.

`common.datatransfer` package contains lightweight "data transfer object" classes for transferring data among components. They can be combined in various ways to transfer structured data between components. Given below are three examples.

![Data Transfer Classes](images/dataTransferClasses.png)

1. `Test Driver` can use the `DataBundle` in this manner to send an arbitrary number of objects to be persisted in the database.
1. This structure can be used to transfer data of a course (e.g., when constructing the home page for an instructor).
1. This structure can be used to send results of a feedback session (e.g., when showing a feedback session report to an instructor).

Some of these classes are methodless (and thus more of a data structure rather than a class); these classes use public variables for data for easy access.

## Test Driver Component

This component automates the testing of TEAMMATES.

![Test Driver Component](images/TestDriverComponent.png)

Package overview:
- **`test.driver`**: Contains infrastructure and helpers needed for running the tests.
- **`test.cases`**: Contains test cases.
  Sub-packages:
  - **`.testdriver`**: Component test cases for testing the test driver infrastructure and helpers.
  - **`.datatransfer`**: Component test cases for testing the datatransfer objects from the `Common` component.
  - **`.util`**: Component test cases for testing the utility classes from the `Common` component.
  - **`.logic`**: Component test cases for testing the `Logic` component.
  - **`.storage`**: Component test cases for testing the `Storage` component.
  - **`.search`**: Component test cases for testing the search functions.
  - **`.webapi`**: System test cases for testing the user-invoked actions.
  - **`.automated`**: System test cases for testing the system-automated actions (manually invoked during testing).

Notes:
- Component tests: Some of these are pure unit tests (i.e. testing one component in isolation) while others are integration tests that test units as well as integration of units with each other.
- Front-end files (particularly TypeScript) are tested separately with `Jest`. The test cases are found in `*.spec.ts` files.

This is how TEAMMATES testing maps to standard types of testing.

```
Normal
|-----acceptance tests-----|-------------------system tests-------------------|-----integration tests-----|-----unit tests-----|
|--------manual testing--------|------automated E2E tests------|-------------------automated component tests-------------------|
TEAMMATES
```

## E2E Component

The E2E component has no knowledge of the internal workings of the application and can only interact either with Web browser (as a whole application) or REST API calls (for the back-end logic). Its primary function is for E2E tests and L&P (Load & Performance) tests.

![E2E Component](images/E2EComponent.png)

Package overview:

- **`e2e.util`**: Contains helpers needed for running E2E tests.
- **`e2e.pageobjects`**: Contains abstractions of the pages as they appear on a Browser (i.e. SUTs).
- **`e2e.cases`**: Contains test cases.
  - **`.util`**: Component test cases for testing the test helpers.
  - **`.e2e`**: System test cases for testing the application as a whole.
  - **`.lnp`**: Load and performance tests (experimental).

## Client Component

The Client component contains scripts that can connect directly to the application back-end for administrative purposes, such as migrating data to a new schema and calculating statistics.

![Client Component](images/ClientComponent.png)

Package overview:

- **`client.util`**: Contains helpers needed for client scripts.
- **`client.remoteapi`**: Classes needed to connect to the back end directly.
- **`client.scripts`**: Scripts that deal with the back end data for administrative purposes.
# Development Guidelines

These are the common tasks involved when working on features, enhancements, bug fixes, etc. for TEAMMATES.

* [Managing the dev server: front-end](#managing-the-dev-server-front-end)
* [Managing the dev server: back-end](#managing-the-dev-server-back-end)
* [Building front-end files](#building-front-end-files)
* [Logging in to a TEAMMATES instance](#logging-in-to-a-teammates-instance)
* [Testing](#testing)
* [Deploying to a staging server](#deploying-to-a-staging-server)
* [Running client scripts](#running-client-scripts)
* [Config points](#config-points)

The instructions in all parts of this document work for Linux, OS X, and Windows, with the following pointers:
- Replace `./gradlew` to `gradlew.bat` if you are using Windows.
- All the commands are assumed to be run from the root project folder, unless otherwise specified.
- It is assumed that the development environment has been correctly set up. If this step has not been completed, refer to [this document](setting-up.md).

> If you encounter any problems during the any of the processes, please refer to our [troubleshooting guide](troubleshooting-guide.md) before posting a help request on our [issue tracker](https://github.com/TEAMMATES/teammates/issues).

## Managing the dev server: front-end

> `Dev server` is the server run in your local machine.

Front-end dev server is the Angular-based server handling the user interface.

First, you need to compile some type definitions from the back-end to be used in this dev server. Run the following command:
```sh
./gradlew generateTypes
```

To start the dev server, run the following command until you see something like `｢wdm｣: Compiled successfully.`:
```sh
npm run start
```

The dev server URL will be given at the console output, e.g. `http://localhost:4200`.

To stop the dev server, press `Ctrl + C`.

- The dev server is run in _watch mode_ by default, i.e. any saved change to the front-end code will be propagated to the server immediately.
- The dev server is also run in _live reload mode_ by default, i.e. any saved change to the front-end code will automatically load all dev server web pages currently being opened.
  To disable this behaviour, run the dev server as follows instead:

  ```sh
  npm run start -- --live-reload=false
  ```

## Managing the dev server: back-end

Back-end dev server is the Google App Engine-based server handling all the business logic, including data storage.

### Starting the dev server

To start the server in the background, run the following command
and wait until the task exits with a `BUILD SUCCESSFUL`:
```sh
./gradlew appengineStart
```

To start the server in the foreground (e.g. if you want the console output to be visible),
run the following command instead:
```sh
./gradlew appengineRun
```

The dev server URL will be `http://localhost:8080` as specified in `build.gradle`.

### Stopping the dev server

If you started the server in the background, run the following command to stop it:
```sh
./gradlew appengineStop
```

If the server is running in the foreground, press `Ctrl + C` (or equivalent in your OS) to stop it or run the above command in a new console.

## Building front-end files

In order for the dev server to be able to serve both the front-end and the back-end of the application, the front-end files need to be *bundled and transpiled* (afterwards `built`).

Run the following commands to build the front-end files for the application's use in production mode:
```sh
# Generate type definition file from back-end
./gradlew generateTypes

# Bundle, transpile, and minify front-end files
npm run build
```

After this, the back-end dev server will also be able to serve the front-end.

## Logging in to a TEAMMATES instance

This instruction set applies for both dev server and production server, with slight differences explained where applicable.
- The local dev server is assumed to be accessible at `http://localhost:8080`.
  - This instruction also works when the local front-end dev server and back-end dev server are separate. In that case, the dev server address will be the front-end's, e.g. `http://localhost:4200`. However, a back-end server needs to be running in order for the authentication logic to work.
- If a URL is given as relative, prepend the server URL to access the page, e.g `/web/page/somePage` is accessible in dev server at `http://localhost:8080/web/page/somePage`.

### As administrator

1. Go to any administrator page, e.g `/web/admin/home`.
1. On the dev server, log in using any username, but remember to check the `Log in as administrator` check box. You will have the required access.
1. On the production server, you will be granted the access only if your account has administrator permission to the application.
1. When logged in as administrator, ***masquerade mode*** can also be used to impersonate instructors and students by adding `user=username` to the URL
 e.g `http://localhost:8080/web/student/home?user=johnKent`.

### As instructor

You need an instructor account which can be created by administrators.

1. Log in to `/web/admin/home` as an administrator.
1. Enter credentials for an instructor, e.g<br>
   Name: `John Dorian`<br>
   Email: `teammates.instructor@university.edu`<br>
   Institution: `National University of Singapore`<br>
1. The system will send an email containing the join link to the added instructor.<br>
   On the dev server, this email will not be sent. Instead, you can use the join link given after adding an instructor to complete the joining process.

Alternatively, an instructor can create other instructors for a course if s/he has sufficient privileges. A course co-owner, for example, will have such a privilege.

1. Ensure that there is a course to add instructors to and an instructor in that course with the privilege to add instructors.
1. Log in as that instructor.
1. Add the instructors for the course (`Instructors` → `View/Edit`).
1. The system will send an email containing the join link to each added instructor. Again, this will not happen on the dev server, so additional steps are required.
1. Log out and log in to `http://localhost:8080/web/admin/search` as administrator.
1. Search for the instructor you added in. From the search results, click anywhere on the desired row to get the course join link for that instructor.
1. Log out and use that join link to log in as the new instructor.

### As student

You need a student account which can be created by instructors (with sufficient privileges).

The steps for adding a student is almost identical to the steps for adding instructors by another instructor:
- Where appropriate, change the reference to "instructor" to "student".
- `Students` → `Enroll` to add students for the course.

**Alternative**: Run the test cases, they create several student and instructor accounts in the datastore. Use one of them to log in.

### Logging in without UI

In dev server, it is also possible to "log in" without UI (e.g. when only testing API endpoints). In order to do that, you need to submit the following API call:

```sh
POST http://localhost:8080/_ah/login?action=Log+In&email=test@example.com&isAdmin=on
```

where `email=test@example.com` and `isAdmin=on` can be replaced as appropriate.

The back-end server will return cookies which will subsequently be used to authenticate your requests.

To "log out", submit the following API call:

```sh
POST http://localhost:8080/_ah/login?action=Log+Out
```

## Testing

There are two big categories of testing in TEAMMATES:
- **Component tests**: white-box unit and integration tests, i.e. they test the application components with full knowledge of the components' internal workings. This is configured in `src/test/resources/testng-component.xml` (back-end) and `src/web/jest.config.js` (front-end).
- **E2E (end-to-end) tests**: black-box tests, i.e. they test the application as a whole without knowing any internal working. This is configured in `src/e2e/resources/testng-e2e.xml`.

### Configuring browsers for E2E Testing

TEAMMATES E2E testing requires Firefox or Chrome.

Before running tests, modify `src/e2e/resources/test.properties` if necessary, e.g. to configure which browser and test accounts to use.

#### Using Firefox

* You need to use geckodriver for testing with Firefox.
  * Download the latest stable geckodriver from [here](https://github.com/mozilla/geckodriver/releases).
    The site will also inform the versions of Firefox that can be used with the driver.
  * Specify the path to the geckodriver executable in `test.geckodriver.path` value in `test.properties`.

* If you want to use a Firefox version other than your computer's default, specify the custom path in `test.firefox.path` value in `test.properties`.

* If you are planning to test changes to JavaScript code, disable JavaScript caching for Firefox:
  * Enter `about:config` into the Firefox address bar and set `network.http.use-cache` (or `browser.cache.disk.enable` in newer versions of Firefox) to `false`.

#### Using Chrome

* You need to use chromedriver for testing with Chrome.
  * Download the latest stable chromedriver from [here](https://sites.google.com/a/chromium.org/chromedriver/downloads).
    The site will also inform the versions of Chrome that can be used with the driver.
  * Specify the path to the chromedriver executable in `test.chromedriver.path` value in `test.properties`.

* If you are planning to test changes to JavaScript code, disable JavaScript caching for Chrome:
  * Press Ctrl+Shift+J to bring up the Web Console.
  * Click on the settings button at the bottom right corner.
  * Under the General tab, check "Disable Cache".

* The chromedriver process started by the test suite will not automatically get killed after the tests have finished executing.<br>
  You will need to manually kill these processes after the tests are done.
  * On Windows, use the Task Manager or `taskkill /f /im chromedriver.exe` command.
  * On OS X, use the Activity Monitor or `sudo killall chromedriver` command.

### Running the tests

- When running the test cases, a few cases may fail (this can happen due to timing issues). They can be re-run until they pass without affecting the accuracy of the tests.

#### Running the tests with command line

To run all front-end component tests in watch mode (i.e. any change to source code will automatically reload the tests), run the following command:
```sh
npm run test
```

To run all front-end component tests once and generate coverage data afterwards, run the following command:
```sh
npm run coverage
```

To run an individual test in a test file, change `it` in the `*.spec.ts` file to `fit`.

To run all tests in a test file (or all test files matching a pattern), you can use Jest's watch mode and filter by filename pattern.

Back-end component tests and E2E tests follow this configuration:

Test suite | Command | Results can be viewed in
---|---|---
`Component tests` | `./gradlew componentTests` | `{project folder}/build/reports/component-test-try-{n}/index.html`, where `{n}` is the sequence number of the test run
`E2E tests` | `./gradlew e2eTests` | `{project folder}/build/reports/e2e-test-try-{n}/index.html`, where `{n}` is the sequence number of the test run
`Failed tests` | `./gradlew failedTests` | `{project folder}/build/reports/test-failed/index.html`
Any individual test | `./gradlew test --tests TestClassName` | `{project folder}/build/reports/tests/index.html`

- `Component tests` and `E2E tests` will be run in their entirety once and the failed tests will be re-run a few times. All other test suites will be run once and only once.
- Before running `E2E tests`, it is important to have the both front-end and back-end dev servers running locally first if you are testing against them.

You can generate the coverage data with `jacocoReport` task after running tests, e.g.:
```sh
./gradlew appengineRun componentTests jacocoReport
```
The report can be found in the `build/reports/jacoco/jacocoReport/` directory.

### Testing against production server

If you are testing against a production server (staging server or live server), some additional tasks need to be done.

1. You need to setup a `Gmail API`<sup>1</sup> as follows:
   * [Obtain a Gmail API credentials](https://github.com/TEAMMATES/teammates-ops/blob/master/platform-guide.md) and download it.
   * Copy the file to `src/e2e/resources/gmail-api` (create the `gmail-api` folder) of your project and rename it to `client_secret.json`.
   * It is also possible to use the Gmail API credentials from any other Google Cloud Platform project for this purpose.

1. Edit `src/e2e/resources/test.properties` as instructed is in its comments.
   * In particular, you will need legitimate Google accounts to be used for testing.

1. Run the full test suite or any subset of it as how you would have done it in dev server.
   * You may want to run `InstructorCourseDetailsPageUiTest` standalone first because you would need to login to test accounts for the first time.
   * Do note that the GAE daily quota is usually not enough to run the full test suite, in particular for accounts with no billing enabled.

<sup>1</sup> This setup is necessary because our test suite uses the Gmail API to access Gmail accounts used for testing (these accounts are specified in `test.properties`) to confirm that those accounts receive the expected emails from TEAMMATES.
This is needed only when testing against a production server because no actual emails are sent by the dev server and therefore delivery of emails is not tested when testing against the dev server.

## Deploying to a staging server

> `Staging server` is the server instance you set up on Google App Engine for hosting the app for testing purposes.

For most cases, you do not need a staging server as the dev server has covered almost all of the application's functionality.
If you need to deploy your application to a staging server, refer to [this guide](https://github.com/TEAMMATES/teammates-ops/blob/master/platform-guide.md#deploying-to-a-staging-server).

## Running client scripts

> Client scripts are scripts that remotely manipulate data on GAE via its Remote API. They are run as standard Java applications.

Most of developers may not need to write and/or run client scripts but if you are to do so, take note of the following:

* If you are to run a script in a production environment, there are additional steps to follow. Refer to [this guide](https://github.com/TEAMMATES/teammates-ops/blob/master/platform-guide.md#running-client-scripts).
* It is not encouraged to compile and run any script via command line; use any of the supported IDEs to significantly ease this task.

## Config points

There are several files used to configure various aspects of the system.

**Main**: These vary from developer to developer and are subjected to frequent changes.
* `build.properties`: Contains the general purpose configuration values to be used by the web API.
* `config.ts`: Contains the general purpose configuration values to be used by the web application.
* `test.properties`: Contains the configuration values for the test driver.
  * There are two separate `test.properties`; one for component tests and one for E2E tests.
* `client.properties`: Contains some configuration values used in client scripts.
* `appengine-web.xml`: Contains the configuration for deploying the application on GAE.

**Tasks**: These do not concern the application directly, but rather the development process.
* `build.gradle`: Contains the back-end third-party dependencies specification, as well as configurations for automated tasks/routines to be run via Gradle.
* `gradle.properties`, `gradle-wrapper.properties`: Contains the Gradle and Gradle wrapper configuration.
* `package.json`: Contains the front-end third-party dependencies specification, as well as configurations for automated tasks/routines to be run via NPM.
* `angular.json`: Contains the Angular application configuration.
* `.travis.yml`: Contains the Travis CI job configuration.
* `appveyor.yml`: Contains the AppVeyor CI job configuration.

**Static Analysis**: These are used to maintain code quality and measure code coverage. See [Static Analysis](static-analysis.md).
* `static-analysis/*`: Contains most of the configuration files for all the different static analysis tools.

**Other**: These are rarely, if ever will be, subjected to changes.
* `logging.properties`: Contains the java.util.logging configuration.
* `web.xml`: Contains the web server configuration, e.g servlets to run, mapping from URLs to servlets, security constraints, etc.
* `cron.xml`: Contains the cron jobs specification.
* `queue.xml`: Contains the task queues configuration.
* `datastore-indexes.xml`: Contains the Datastore indexes configuration.

# Using alternative email providers

Google App Engine provides JavaMail (reference: https://cloud.google.com/appengine/docs/java/mail/) as a default email service, but the service is limited to 100 emails per day which is insufficient for TEAMMATES usage.
We need to resort to third-party email service to fulfill this need.

This document will outline the alternative email services configured for use in TEAMMATES.

- [SendGrid](#sendgrid)
- [Mailgun](#mailgun)
- [Mailjet](#mailjet)

In many cases, you have to register your domain name with the email service and configure your DNS provider so that the service can start sending email for you.
The details for this can be seen on the documentation of each service.

## SendGrid

- Website: https://sendgrid.com
- Google App Engine reference: https://cloud.google.com/appengine/docs/flexible/java/sending-emails-with-sendgrid

To use SendGrid in TEAMMATES, create a free SendGrid account, create an API key, and update the relevant values in `build.properties`.

## Mailgun

- Website: https://www.mailgun.com
- Google App Engine reference: https://cloud.google.com/appengine/docs/java/mail/mailgun

To use Mailgun in TEAMMATES, create a free Mailgun account, get a domain name and find its API Key, and update the relevant values in `build.properties`.

## Mailjet

- Website: https://www.mailjet.com
- Google App Engine reference: https://cloud.google.com/appengine/docs/java/mail/mailjet

To use Mailjet in TEAMMATES, create a free Mailjet account, find your API key and secret key, and update the relevant values in `build.properties`.
# Glossary

This document lines out the common terms used in the project.

## Product-related

+ **Course**: We use "course" to mean "module", "class". A course here means an offering of a course in a particular semester/term. If the course is offered twice in two semesters (i.e. with different students and teaching team), they are considered two courses. There is, however, no time limit on how long a course may run.
+ **Contribution scale**:
```
    [equal share]+100%

    [equal share]+90%

    ...

    [equal share]

    [NOT SURE]

    [equal share]-10%

     ...

    [equal share]-90%

    [0%] (did nothing at all)
```
+ **Enrollment, Enroll** (NOT enrolment, enrol).
+ **Feedback Session**: A collection of questions for students and/or instructors alike to answer; synonymous to a questionnaire, a survey.<br>
  Sometimes, this is referred to as simply "Session"; developers must take extra care so as not to confuse it with HTTP sessions.

## Development-related

+ [**Main repo**](https://github.com/TEAMMATES/teammates): The repository containing the latest stable code.
+ [**Ops repo**](https://github.com/TEAMMATES/teammates-ops): The repository containing maintenance and operations-specific information.
+ **Specs**: System Specification.

`* server`:

+ **Dev server**: The development server running on your computer.
+ **CI server**: Continuous Integration server used for building/testing patches. Can be Travis or AppVeyor.
+ **Production server**: A server on Google App Engine. Can be a staging server or the live server.
+ **Staging server**: The server instance you created on Google App Engine for testing purpose.
+ **Live server**: The server running the released public version of the app (i.e. http://teammatesv4.appspot.com).

`* tests`:

+ **All tests**: The full test suite.
+ **Component tests**: Unit and integration tests, i.e. white-box tests. There are separate component test suites for front-end and back-end.
+ **E2E tests**: End-to-end system tests, i.e. black-box tests. Also used for product acceptance.
+ **CI tests**: Tests to be run on the CI server. Consists of components tests and E2E tests.

`* green`:

+ **Dev green**: **All** tests are passing on the dev server.
+ **CI green**: **CI** tests are passing on the CI server.
+ **Staging green**: **All** tests are passing against your own staging server.
+ **Live green**: **All** tests are passing against the app running on the live server.
# Set up an IDE

- [IntelliJ IDEA](#intellij-idea)

## IntelliJ IDEA

> - Replace all references of `IntelliJ IDEA → Preferences` to `File → Settings` if you are using Windows or Linux.

Supported IntelliJ versions: IntelliJ IDEA Ultimate Edition (required to work with Google App Engine).
You can sign up for the free [JetBrains student license](https://www.jetbrains.com/student/) if you are a student registered in an educational institution.

### Prerequisites

1. You need a Java 8 SDK defined in IntelliJ IDEA as follows:

   * Click `Configure → Project Defaults → Project Structure` (or `File → Project Structure` if a project is open).
     Select `SDKs` under` Platform Settings` and check if there is an SDK with JDK home path pointing to a JDK 8 path.
     If there is none, add a new SDK which uses JDK 8.
     ![intellijsetupguide-1.png](images/intellijsetupguide-1.png)

1. You need the [Google Cloud Code](https://cloud.google.com/code/docs/intellij/quickstart-IDEA) plugin installed and configured:

   ![intellijsetupguide-2.png](images/intellijsetupguide-2.png)
   * During installation, you may encounter a prompt to disable the obsolete `Google App Engine Integration` plugin. Answer `Yes`.
   * After installation, restart IntelliJ IDEA.
   * (Optional) To configure the plugin to use a specific Cloud SDK installation,
     click `Configure → Settings/Preferences` (or `IntelliJ IDEA → Preferences` if a project is open),
     go to `Other Settings → Cloud Code → Cloud SDK`, choose `Use a custom local installation`, and select your Google Cloud SDK directory.

### Project Setup

1. Import the project as a Gradle project as follows:
   1. Click `Import Project` (or `File → New → Project from Existing Sources...` if a project is open).
   1. Select the local repository folder and click `Open`.
   1. Select `Import project from external model` and then `Gradle`.
   1. Click `Next`.
   1. Check `Use auto-import` and uncheck `Create separate module per source set`.
   1. Ensure `Create directories for empty content root automatically` is unchecked.
   1. Ensure `Use default gradle wrapper` is selected.
   1. Ensure for `Gradle JVM:` that a JDK 8 is selected.
   1. Click `Finish`. Wait for the indexing process to complete.
   1. You should see a dialog box with the message:\
      `Frameworks detected: Google App Engine Standard, Angular CLI frameworks are detected.`.\
      **OR**\
      `Frameworks detected: Web, Google App Engine Standard, Angular CLI frameworks are detected`.\
      Click on `Configure` and ensure that only `Google App Engine Standard` and `Angular CLI` frameworks are shown, then click `OK`.
      If there are other frameworks shown, click `Cancel` and wait until indexing is completed, then try again.
      > If you closed or missed the dialog box, go to `View → Tool Windows → Event Log`.
        You should see the same message as the message in the dialog box. Click `Configure` and then `OK`.

1. Configure the following project-specific settings (all can be found in `IntelliJ IDEA → Preferences → ...`):

   * Indentation: 2 spaces are used in place of tabs for indentations. For Java and XML, 4 spaces are used instead.
     Configure for all the languages used in TEAMMATES:
     1. Go to `Editor → Code Style`.
     1. Select `Project` for `Scheme` if you do not wish to make the settings the default for your IDE.
     1. For `TypeScript`, `JSON`, `CSS`, and `HTML`:
        * Ensure that `Use tab character` is unchecked, and `Tab size:`, `Indent:`, and `Continuation indent:` are `2`, `2`, and `4` respectively.
     1. Repeat the previous step for `Java` and `XML` using the numbers `4`, `4`, and `8` respectively.

   * Text encoding: `UTF-8` is used for text encoding.
     Go to `Editor → File Encodings` and ensure that `Project Encoding` and `Default Encoding for properties files` is set to `UTF-8`.

1. Click `OK`.

1. To move on to the development phase, refer to [this document](development.md).
# Issue tracker

This document describes how the issue tracker is used by the TEAMMATES project.

* [Issue lifecycle](#issue-lifecycle)
* [Issue labels](#issue-labels)

## Issue lifecycle

<img src="images/IssueLifecycle.png" width="600">

Given above is an illustration of the issue lifecycle.
Colors indicate which roles are involved in which states/transitions.

## Issue labels

This portion will only describe the purpose of each *label group* briefly.
The full description of each individual label can be viewed under the [labels page](https://github.com/TEAMMATES/teammates/labels).

* **Status (`s.*`)**: Classifies issues and PRs based on **status**
  * No `s.*` label and no other labels in issue: issue is yet to be triaged
  * No `s.*` label and other labels present in issue: issue is accepted
* **Category (`c.*`)**: Classifies issues and PRs based on **type of work done**
* **Priority (`p.*`)**: Classifies issues based on **importance**, as determined by the project maintainers
* **Difficulty Level (`d.*`)**: Classifies issues based on **difficulty level**
  * No `d.*` label: variable difficulty level, typically between `d.Contributors` and `d.Committers` level
* **Aspect (`a-*`)**: Classifies issues based on the **non-functional aspect**
  * No `a-*` label: no specific aspect tackled, usually the case for enhancements or new features
* **Feature (`f-*`)**: Classifies issues based on the **functional aspect**
  * No `f-*` label: no specific feature tackled, usually the case for refactoring
* **Technology (`t-*`)**: Classifies issues based on the **technology/tool stack** involved
  * No `t-*` label: usually documentation update, or mixture of many languages
* **Effort Estimate (`e.*`)**: Indicates the **estimated number of hours** needed to work on the issue
  * `e.n`: `n` hours estimated effort, e.g. `e.1` is 1 hour, `e.2` is 2 hours, etc.
# Overview

## Vision

1. To become **the biggest student project in the world**.<br>
   Biggest = many contributors, many users, relatively large code base (150k-200k LoC), evolving over a long period.<br>
   "Biggest" above also implies an exceptionally high quality standard because high quality is a necessity for the long-term survival of a big student project.

1. To become **a model and a training ground for Software Engineering students** who want to learn SE skills in the context of a non-trivial real software product.

## Challenges

The project differs from typical student projects in the following areas, which makes it more challenging and the experience more enriching.
+ **Developers**: All developers are novices and their involvement with the project is short term and part time.
+ **Code**: Working with legacy code written by past developers is harder than writing from scratch.
+ **Data**: The data in the live system are confidential and developers are not allowed to see them. This makes troubleshooting harder.
+ **Releases**: Frequent releases to an active user database requires us to maintain "production quality" constantly.
+ **Platform**: TEAMMATES is running on Google App Engine cloud platform, which adds the following challenges.
  - It is an emerging platform evolving rapidly. We have to keep up.
  - It imposes various restrictions on the application, e.g. each request to the app has to be served within 60 seconds.
  - It charges us based on usage. We have to optimize usage.
+ **Software Engineering**: As TEAMMATES serves as a model system for training students, it should also focus on applying good SE techniques.

## Principles

We apply these principles to meet the challenges stated above.
+ **We keep moving forward, always**: We release frequently, in weekly [time-boxed iterations](http://en.wikipedia.org/wiki/Timeboxing). Every week, our product becomes better than the previous week. This means "go back and rewrite from scratch" is only a last resort.
+ **We are agile**: We are able to change the system quickly and easily to match emerging requirements. We aim for **minimal yet sufficient documentation**.
+ **We defend our code with tests, fiercely**: Since we practice [collective code ownership](http://www.extremeprogramming.org/rules/collective.html), we have to make sure the code is not accidentally broken by others. We use fully automated regression testing. The testing automation level of this project is probably higher than 99% of the projects out there.
+ **We are "Gods" of the few tools we use**: We stick to a minimal toolset. Adding third-party tools and libraries to the project is done only if there is a STRONG justification. Only mature, stable, and well-supported tools are considered. Once selected, we should know the tool very well to get the best out of it.
+ **We value quality more than functionality**: Our job is not to "anyhow get it to work". The system should be good enough to be considered a "model" software. Our code should be of "exceptionally" high quality: all code is reviewed before accepting.
+ **We know what we are doing**: For us, it is not enough to know something is broken, we should also know why it is broken. It is not enough to get something working, we should know how we got it to work.
+ **We seek the best, not stop at the first**: We do not settle for the first workable method to solve a problem. We study other ways of solving it and decide what is the best way for us.
+ **We take pains to save the team from pain**: Whenever we had to spend effort in figuring out something, we refine code/documents so that others don't have to go through the same pain. Whenever we figured out a less painful way of doing something, we make sure everyone in the team learn it too.
# Performance Testing

TEAMMATES makes use of [JMeter](https://jmeter.apache.org/) for load and performance (L&P) testing, and uses the [JMeter Java API](https://jmeter.apache.org/api/index.html) and TestNG to automate the process of running performance tests.
The performance test cases are located in the `teammates.e2e.cases.lnp` package.

## Creating Performance Tests

Each new test case must inherit the base L&P test class, and implement the methods required for generating the test data and the JMeter L&P test plan. 
The L&P test plans are created in Java using the JMeter API.

When running the L&P test, an equivalent `.jmx` file can be generated from this test plan.
To help with debugging, you can open this `.jmx` file in the JMeter GUI and add Listeners.

To see a sample implementation of a test case, you can refer to `StudentProfileLNPTest`. It is a _simple_ test case which load tests a GET endpoint (`/webapi/student/profile`).

## Running Performance Tests

If you want to use your own copy of [JMeter](https://jmeter.apache.org/download_jmeter.cgi), update the `test.jmeter.*` properties in `src/e2e/resources/test.properties` accordingly.  
Start the backend server, i.e. `localhost:8080`, before running the performance tests.

### Using Gradle

To run the performance tests, execute this command from the main project directory:
```sh
./gradlew lnpTests
```

- The JMeter test results are stored as JTL files with the same name as the test file in `src/e2e/lnp/results/TEST_NAME.jmx.jtl`. 
- A log file is generated as `jmeter.log`.

If the build fails:
- Check the console log messages and the `jmeter.log` file to see if there were any errors or exceptions thrown. If so, take the necessary steps to fix them.
- Check the generated `.jtl` result files to see whether the `success` value of any row is `false`. If so, investigate the cause (possibly by making use of the JMeter GUI and Listeners) and fix it.

### Using the Command Line

If you have JMeter installed, you can use `jmeter` in the command line to run tests and generate reports.

Execute this command after replacing the parameters with the relevant paths:
```sh
jmeter -n -t PATH_TO_TEST_FILE.jmx -l PATH_TO_RESULT_FILE.jtl -j PATH_TO_LOG_FILE.log
```

Also, you can use this command to generate a HTML **summary report** from the results file (`.jtl`) that was generated earlier:
```sh
jmeter -g PATH_TO_RESULT_FILE.jtl -o REPORT_OUTPUT_FOLDER -j PATH_TO_LOG_FILE.log
```

If you want to do both together (i.e. execute the test and generate the report), use:
```sh
jmeter -n -t PATH_TO_TEST_FILE.jmx -l PATH_TO_RESULT_FILE.jtl -e -o REPORT_OUTPUT_FOLDER -j PATH_TO_LOG_FILE.log
```

### Using JMeter GUI

You can also install JMeter and use its GUI to run performance tests. This is particularly useful when debugging or validating that the test works as expected.
However, you should not use the GUI to run large scale tests as it is very resource intensive.

> Remember to **disable or remove all `Listeners`** in the `.jmx` file, unless you are debugging. Having them enabled can have a negative impact on the test performance.
# Development Workflow

This is the project-wide development workflow for TEAMMATES.

* [Overview](#overview)
* [Fixing issues](#fixing-issues)
* [Reviewing a PR](#reviewing-a-pr)
* [Merging a PR](#merging-a-pr)

## Overview

<img src="images/workflow.png" width="600">

* This workflow is an adaptation of the [GitHub flow](https://guides.github.com/introduction/flow/).
* If you need any help regarding the workflow, please [post a new issue in our issue tracker](https://github.com/TEAMMATES/teammates/issues/new).
* It is assumed that the development environment has been correctly set up. If this step has not been completed, refer to [this document](setting-up.md).<br>
  You are also encouraged to be reasonably familiar with how to [work with your own local copy of TEAMMATES](development.md).

The following are the roles involved:
* **Dev**: fixing issues
* **Reviewer**: reviewing pull requests (PRs); usually a core team member
* **Code quality reviewer**: approving PRs; usually the Project Manager

> *Roles* are related to the development process and they are different from *Positions*, which relate to the organization structure of the TEAMMATES developer community.

## Fixing issues

**Role: Dev**

This instruction set will use the issue `Remove unnecessary System.out.printlns from Java files #3942` as an example.

### Step 1: Pick an issue to fix

Our issue tracker contains bug reports, feature requests, as well as suggestions for enhancements.
You are free to work on any of the issues listed there.

* If you are a contributor, there is no need to get the issue assigned to you.
* If you are a core team member, assign the issue to yourself and assign it a milestone.
  You are expected to open a PR for this issue within a week; inactivity for a longer time may result in the issue being un-assigned so that someone else can work on it.
* While not required, the following gestures are appreciated:
  * Indicating your interest in working on any particular issue by commenting on the issue thread itself.
  * Refraining from working on issues that are assigned to someone else or have open PRs.
* (Optional) You can discuss, via the issue tracker, the alternative solutions before choosing one to implement.
  Such a discussion reduces the chance of a rejected fix or a misunderstood issue.

The [issue labels](issues.md#issue-labels) may help you in choosing which issue to fix.

### Step 2: Start clean from a new branch

In most cases, you will start the PR from the `master` branch. There are scenarios where you are required to start from another branch instead:
* You are creating a hot patch: start from the `release` branch.
* You are working on a *long-lived feature branch* (a branch which contains multiple commits from possibly multiple authors, used for major feature development/refactoring): start from that branch.

For brevity, this instruction set will use `master` branch as the base branch. Any reference to the `master` branch should be replaced with the base branch that applies to your case.

1. Start off from your `master` branch and make sure it is up-to-date with the latest version of the main repo's `master` branch.
   ```sh
   git checkout master
   git pull
   ```

1. Create a new branch to push your commits into. If you have commit access and need to push into the main repo for some reason, name it `{IssueNumber}-{some-keywords}`,
   where `some-keywords` are representative keywords taken from the issue title.
   ```sh
   git checkout -b 3942-remove-unnecessary-println
   ```

Notes:

1. **Do not** combine fixes for multiple issues in one branch, unless they are tightly related.
1. Your `master` branch must never be ahead of the main repo's `master` branch at all times.

### Step 3: Fix the issue

> If this is your first issue, you may want to look at our coding and testing best practices as well as coding conventions (links given [here](README.md)).

Make the changes to the code, tests, and documentations as needed by the issue.

1. Commit the changes to your branch.
   ```sh
   git add -A
   git commit
   ```
   * You may commit as many times as you wish while you are making the changes.
     It is, however, a good idea to commit at meaningful points to keep your branch reasonably clean.
   * Use meaningful commit messages (e.g. `Add tests for the truncate method`).
     [Here](http://chris.beams.io/posts/git-commit/) is a good reference.
   * If you introduce changes that are incompatible with the prevailing data storage schema (afterwards "breaking changes"), a *data migration* is necessary to be done by the core team. If a data migration is necessary to take the issue forward:
     * Make sure that the core team (or at least your reviewer) is aware of this.
     * Follow [data migration best practices](https://github.com/TEAMMATES/teammates-ops/blob/master/best-practices.md#data-migration).
     * Your changes should initially work for both the old and new versions of the data schema. It is fine if an unclean hack is necessary for the new code to work under the *old* data schema.
     * Mark clearly in the code which parts are tailored specifically for the old data schema, *especially if an unclean hack is used*.
     * Concurrently or immediately after the breaking changes are merged, you need to create a [client script](development.md#running-client-scripts) to migrate all data following the old schema to the new schema.

1. Sync with the main repo frequently. While you were fixing the issue, others might have pushed new code to the main repo.
   * Update your repo's `master` branch with any new changes from main repo, then switch back to your work branch.

     ```sh
     git checkout master
     git pull
     git checkout 3942-remove-unnecessary-println
     ```
   * Option 1: merge those updates to the branch you are working on.

     ```sh
     git merge master
     ```
   * Option 2: if you are confident with rebasing, rebase your changes over the latest `master` branch.

     ```sh
     git rebase master
     ```
   * If there are updates to the dependencies on the build configuration, you should update your local copies accordingly.

1. <a name="things-to-check"></a>Before submitting your work for review, here are some things to check (non-exhaustive):
   * The code is **properly formatted for readability**.
   * The code base passes **static analysis** (i.e. code quality check):

     ```sh
     ./gradlew lint
     npm run lint
     ```
   * **All affected tests are passing** on your dev server.<br>
     You are more than welcome to also ensure *dev green*, i.e. all tests are passing on your dev server.
   * **Staging-tested (if need be)**: If your new code might behave differently on a remote server than how it behaves on the dev server,
     ensure that the affected tests are passing against the updated app running on your own GAE staging server.
   * **No unrelated changes** are introduced in the branch. This includes unnecessary formatting changes.
   * All changes or additions to functional code are **accompanied by changes or additions in tests**, even if they are absent before.
   * All new public APIs (methods, classes) are **documented with header comments**.
   * **Documentations are updated** when necessary, particularly when there are changes or additions to software design as well as user-facing features.

1. Push your branch to your fork, or to the main repo only if necessary.
   ```sh
   git push {remote-name} 3942-remove-unnecessary-println
   ```
   If the above command does not work e.g. because of rebasing, do a forced-push:
   ```sh
   git push -f {remote-name} 3942-remove-unnecessary-println
   ```

   > Anyone working on an issue, including core team members, should use branches in his/her own fork instead unless the branch needs to be in the main repo.
   > Such cases include:
   >
   > * The branch is being worked on by multiple people.
   > * The branch contains changes that need to be trialled by other core team member.

### Step 4: Submit a PR

[Create a PR](https://help.github.com/articles/creating-a-pull-request/) with the following configuration:
* The base branch is the main repo's `master` branch.
* PR name: copy-and-paste the relevant issue name and include the issue number in front in square brackets,
  e.g. `[#3942] Remove unnecessary System.out.printlns from Java files`.
* PR description: mention the issue number in this format: `Fixes #3942`.
  Doing so will [automatically close the related issue once the PR is merged](https://github.com/blog/1506-closing-issues-via-pull-requests).
* Ensure that "Allow edits from maintainers" is ticked.
* You are encouraged to describe the changes you have made in your branch and how they resolve the issue.

It is not required that you submit a PR only when your work is ready for review;
make it clear in the PR (e.g. in the description, in a comment, or as an `s.*` label) whether it is still a work-in-progress or is ready for review.

**Note**: if the PR does not fix an issue completely, observe the following:
* Use an appropriate PR name (at your discretion) instead of copying-and-pasting the relevant issue name.
* Use `Part of #3942` as the PR description. Do NOT use any of the special keywords.

### Step 5: Following up

Once a PR is opened, try and complete it within 2 weeks, or at least stay actively working on it.
Inactivity for a long period may necessitate a closure of the PR.

Labels `s.*` (status labels) are used to indicate status of PRs.
Their full descriptions can be viewed under the [labels page](https://github.com/TEAMMATES/teammates/labels).

#### Code review

Your code will be reviewed, in this sequence, by:
* Travis CI: by running static analysis.<br>
  If there are problems found, the build will terminate without proceeding to testing.<br>
  Most of the tools will display the cause of the failures in the console;
  if this is not the case, you can run any of the static analysis tools and obtain the reports locally.<br>
  Ensure that the static analysis passes before triggering another build.
* Travis CI: by building and running tests.<br>
  If there are failed tests, the build will be marked as a failure.
  You can consult the CI log to find which tests.<br>
  Ensure that all tests pass before triggering another build.
  * The CI log will also contain the command that will enable running the failed tests locally.
* Reviewer: a core team member will be assigned to the PR as its reviewer, who will approve your PR (`s.FinalReview`) or suggest changes (`s.Ongoing`).
  Feel free to add a comment if:
  * a reviewer is not assigned within 24 hours.
  * the PR does not get any review within 48 hours of review request.
  * you want to clarify or discuss about the suggestions given by your reviewer.
* Code quality reviewer: final review for maintainability and style.

#### Updating the PR

If you are tasked to update your PR either by Travis CI or by your reviewer, **do not** close the PR and open a new one.
You should make and push the updates to the same branch used in the PR, essentially repeating [step 3](#step-3-fix-the-issue).

Remember to add a comment to indicate the PR is ready for review again, e.g. `Ready for review` or `Changes made`.
If you have permission to change labels, you may additionally change the `s.*` PR label as appropriate.

The cycle of "code review" - "updating the PR" will be repeated until your PR is approved by all the parties involved (`s.ToMerge`).

### Step 6: Prepare for merging

The core team member responsible for merging your PR might contact you for reasons such as resolving merge conflicts.
Depending on the situation, this may necessitate more changes to be made in your PR (e.g. if your PR is functionally conflicting with a recent change), however this rarely happens.

Your work on the issue is done when your PR is successfully merged to the main repo's `master` branch.

## Reviewing a PR

**Role: Reviewer**

> - The reviewer of a PR is the assignee of it.
> - To remove whitespace-only changes from being shown, append `?w=1` to url of the `/files` page of the PR (the "Files changed" tab).

[GitHub's review feature](https://github.com/blog/2256-a-whole-new-github-universe-announcing-new-tools-forums-and-features#code-better-with-reviews) is to be used in this task.

* Ensure that the Travis CI build is successful and the developer has local dev green.
* Ensure the following:
  * Naming conventions for PR and branch are followed, and `Fixes #....` or similar keyword is present in the PR description.
  * The items in [this list](#things-to-check) are all satisfied.
  * The solution is the best possible solution to the problem under the circumstances.
  * The code is up-to-date with the latest `master` branch (or whichever base branch applies), or at least no conflict.
    If this is not the case, ask the dev to sync it.
* If any of the above are not OK:
  * Add comments in the diff to suggest changes.
    Bundle the review comments with the "Start a review" and "Add review comment" features, and finish it with "Request changes", preferably with the review summary.
  * Change the status of the PR to `s.Ongoing`.
* If the code is OK in all aspects, change the PR status to `s.FinalReview` and "Approve" the PR.

**Role: Code quality reviewer**

* Review the code for maintainability and style.
* The follow-up action is the same as that of reviewers, with the only difference being the label to be applied is `s.ToMerge`.

## Merging a PR

**Role: dev (with push permission), or reviewer**

This instruction set will use the issue `Remove unnecessary System.out.printlns from Java files #3942`, resolved by PR `#3944`, with `master` branch as the base branch, as an example.

* Merging can be done anytime as long as the `s.ToMerge` label is present and GitHub gives a green light for merging.
  There are a few scenarios where GitHub can prevent merging from proceeding:
  * **Merge conflict**: the PR is conflicting with the current `master` branch; the author will need to resolve the conflicts before proceeding.
  * **Outdated branch**: the PR is not in sync with the current `master` branch. If the PR allows edits from maintainers, simply update the branch using the "Update branch" option; otherwise, the author will need to sync it themselves before proceeding.

  It is up to the dev/reviewer's discretion on whether the merge conflict or outdated branch necessitates another review.<br>
  In general, unless the changeset is functionally conflicting, there is no need for another review.
* When ready for merging,
  * Merge with ["Squash and merge"](https://help.github.com/articles/about-pull-request-merges/#squash-and-merge-your-pull-request-commits) option. Format of the commit message:

    ```
    [#Issue number] Issue title as given in the original issue (#PR number)
    ```
    e.g. `[#3942] Remove unnecessary System.out.printlns from Java files (#3944)`.
  * Where appropriate (e.g. merging a long-lived feature branch), the ["Rebase and merge"](https://help.github.com/articles/about-pull-request-merges/#rebase-and-merge-your-pull-request-commits) option can be used instead.
  * Apply a `c.*` label to the PR to indicate the type of the PR, if it has not been done before.
* If the PR necessitates a data migration, [create a data migration issue](https://github.com/TEAMMATES/teammates/issues/new?template=data-migration.md) after merging.
# Documentation For Developers

Here are some documents important for TEAMMATES developers.

## Main documents

* The project [**vision, challenges, and principles**](overview.md) from a developer's perspective.
* The [**glossary**](glossary.md) of terms used in the project.
* Software [**Design**](design.md) - Architecture, APIs, etc.
* How to [**set up the developer environment**](setting-up.md).
* [**Development guideline**](development.md) - how to work with your own copy of TEAMMATES.
* The [**workflow/process to follow**](process.md) when contributing to TEAMMATES.
* [**Developer Troubleshooting Guide**](troubleshooting-guide.md)
* How the [**issue tracker**](issues.md) is used - issue lifecycle, issue labels, etc.

## Supplementary documents

* **Coding standards** for:
  [Java](https://oss-generic.github.io/process/codingStandards/CodingStandard-Java.html),
  [CSS](https://oss-generic.github.io/process/codingStandards/CodingStandard-Css.html),
  [HTML](https://oss-generic.github.io/process/codingStandards/CodingStandard-Html.html)

* **Best practices** for:
  * [UI design](best-practices/ui-design.md)
  * [Coding](best-practices/coding.md)
  * [Testing](best-practices/testing.md)
  * [Data migration](best-practices/data-migration.md)

* How to [**set up IDEs for development**](ide-setup.md). _(not actively supported/maintained; use at your own risk)_

## How-to documents

* [Static analysis](static-analysis.md): Performing code quality check.
* [Setting up third-party email providers](emails.md).
* [Setting up CAPTCHA](captcha.md).
* [Snapshot testing](snapshot-testing.md)
# Setting up a development environment

This is a step-by-step guide for setting up a development environment on your local machine.
Using this environment, you can contribute to the project by working on features, enhancements, bug fixes, etc.

All the instructions in this document work for Linux, OS X, and Windows, with the following pointers:
- Replace `./gradlew` to `gradlew.bat` if you are using Windows.
- All the commands are assumed to be run from the root project folder, unless specified otherwise.
- When a version is specified for any tool, install that version instead of the latest version available.

> If you encounter any problems during the setup process, please refer to our [troubleshooting guide](troubleshooting-guide.md) before posting a help request in our [issue tracker](https://github.com/TEAMMATES/teammates/issues).

## Step 1: Obtain your own copy of the repository

1. Install Git.
   1. (Optional but recommended) Install Sourcetree or other similar Git client.

1. Fork our repo at https://github.com/TEAMMATES/teammates. Clone the fork to your hard disk.

1. Add a remote name (e.g `upstream`) for your copy of the main repo. Fetch the remote-tracking branches from the main repo to keep it in sync with your copy.
   ```sh
   git remote add upstream https://github.com/TEAMMATES/teammates.git
   git fetch upstream
   ```
   **Verification:** Use the command `git branch -r` and the following lines should be part of the output:
   ```
    upstream/master
    upstream/release
    ```

1. Set your `master` branch to track the main repo's `master` branch.
   ```sh
   git checkout master
   git branch -u upstream/master
   ```

More information can be found at [this documentation](https://help.github.com/articles/fork-a-repo/).

## Step 2: Install necessary tools and languages

These tools are necessary regardless of whether you are developing front-end or back-end:

1. Install JDK 1.8.
1. Install Python 2.7.
1. Install Google Cloud SDK (minimum version 222.0.0). Follow the directions given [here](https://cloud.google.com/sdk/downloads).
   Note that you *do not* need to [initialize the SDK](https://cloud.google.com/sdk/docs/initializing).
   ```sh
   # Run the following command at the Google Cloud SDK directory

   # Linux/OS X
   ./install.sh --path-update true

   # Windows
   install.bat --path-update true
   ```
   If you are installing in Red Hat, CentOS, Fedora, Debian or Ubuntu, refer to the quick start of Google Cloud SDK for [Debian/Ubuntu](https://cloud.google.com/sdk/docs/quickstart-debian-ubuntu) or [Red Hat/CentOS/Fedora](https://cloud.google.com/sdk/docs/quickstart-redhat-centos) respectively.

   **Verification**: Run a `gcloud` command (e.g. `gcloud version`) in order to verify that you can access the SDK from the command line.

1. Run the following command to install App Engine Java SDK bundled with the Cloud SDK:
   ```sh
   # Linux/OS X/Windows
   gcloud -q components install app-engine-java
   
   # Red Hat/CentOS/Fedora
   sudo yum install google-cloud-sdk-app-engine-java
   
   # Debian/Ubuntu
   sudo apt-get install google-cloud-sdk-app-engine-java
   ```
   **Verification:** Run `gcloud version` and there should be an entry on `app-engine-java`.

If you want to develop front-end, you need to install the following:

1. Install Node.js (minimum version 8.9.4).
1. (Optional but highly recommended) Install Angular CLI version 7 globally.
   ```sh
   npm install -g @angular/cli@7
   ```
   **Verification:** Run `ng` and you should see a list of available Angular CLI commands.

## Step 3: Set up project-specific settings and dependencies

1. Run this command to create the main config files (these are not under revision control because their contents vary from developer to developer):
   ```sh
   ./gradlew createConfigs
   ```
   **Verification:** The file named `gradle.properties` should be added to the project root directory.

1. Modify the following config file:
   * `gradle.properties`<br>
      If you want to use a JDK other than the one specified in your PATH variable, add the value to the variable `org.gradle.java.home`.

1. Run this command to download the necessary tools for front-end development (if you are going to be involved):
   ```sh
   npm install
   ```
   **Verification:** A folder named `node_modules` should be added to the project root directory.

**Q:** Can I set up the project in IDEs, e.g. Eclipse, IntelliJ?<br>
**A:** You are welcome to; the core team have been using IntelliJ to a varying degree of success, but IDE-based development (even with IntelliJ) is not actively supported/maintained by the team.

## Step 4: Start developing

If you have followed every step correctly, your development environment should be set up successfully.

Proceed to the development routine as outlined in [this document](development.md).
# Snapshot Testing

## What is Snapshot Testing?

Snapshot testing is an extension of usual expected-vs-actual assertion where the following conditions apply:

1. The expected object ("snapshot" afterwards) is too large to be contained in a few lines of code (e.g. a web page HTML content)
1. The snapshot should be tolerant to some degree of data variation (e.g. date and time of test execution)
1. (Optional) There is an automated way to update the snapshot based on the state of the actual object at any point of time

In the case of TEAMMATES, snapshot testing is useful for the following comparisons:

1. Expected web page content/DOM structure vs actual rendered web page
1. Expected email content vs actual email generated by the system
1. Expected CSV content vs actual CSV generated by the system

## How does Snapshot Testing work?

Snapshots testing can run in two modes, namely, verification mode (default) and auto-update mode.

In verification mode, snapshot testing is essentially the same as a normal expected-vs-actual assertions, where the actual object is compared against the snapshot.

Auto-update mode is the flagship feature of snapshot testing. Essentially, this _reverses_ the process of testing, i.e. using the _actual_ generated object to overwrite the snapshot provided in the test.
To remove redundancy, even if auto-update mode is enabled, this overwriting procedure only happens when a test fails during the test run.

For such testing method to be effective, before the changes are committed, a *manual* (by the developer) verification to ensure only the intended changes have occurred is mandatory.

## How do we use Snapshot Testing?

For the web page comparison, the tests are done in the front-end using Jest. [Jest has native support for snapshot testing (in fact, that is where the name is obtained from!)](https://jestjs.io/docs/en/snapshot-testing). Auto-update mode is activated by pressing `u` when running Jest under watch mode.

For email and CSV content generation, the tests are done in the back-end. Auto-update mode is activated by setting the value of `test.snapshot.update` to `true` in `test.properties`.

## When do we use Snapshot Testing?

Snapshot testing is typically used in the following two situations:

1. To create a new source file for a (new) HTML comparison test, email content test, or CSV file content test.
1. To update existing source files to reflect intended changes to the UI of the web pages, the email content, or the CSV file content.

The following example describes the behaviour of snapshot testing and how it can be used in practice. Let us consider the case where the following line of test code is executed:

```ts
expect(fixture).toMatchSnapshot();
```

Here are three possible situations and the corresponding behaviours of snapshot testing when the test is executed with auto-update mode enabled:

1. If the snapshot exists and has the correct content, no updates to the source file will be observed.

1. If the snapshot exists but has the wrong content, it will be updated with the correct content. Subsequently, the test case will pass subsequent test runs with/without auto-update mode enabled.

1. If the snapshot does not exist, it will be created with the given name (in Jest it is auto-generated) AND with the correct content. Subsequently, the test case will pass subsequent test runs with/without auto-update mode enabled.

The same idea applies to email content test:

```java
EmailChecker.verifyEmailContent(email, recipient, subject, "/studentCourseJoinEmail.html");
```

And to CSV content test:

```java
CsvChecker.verifyCsvContent(csvContent, "/feedbackSessionResults.csv");
```

## When do we NOT use Snapshot Testing?

Snapshot testing is useful for regression testing, e.g. if a change to front-end logic caused the rendered HTML to change, snapshot testing will reflect those changes and it can be checked whether those changes are intended or not.

However, snapshot testing should NOT be used to check how a rendered HTML looks like before/during/after interactions, e.g.:

1. Take one snapshot at the initial phase
1. Perform a 'click' on a selected component of the page
1. Take another snapshot afterwards

Such (mis-)usage of snapshot testing will erode the value of test as the difference between the two snapshots cannot be traced.

In such a case, normal assertions should be used, e.g. by checking the component's internal data before and after the 'click'.

## Best Practices

1. Snapshot testing complements but does NOT replace unit tests.
1. Remember to disable the auto-update mode once the necessary changes have been made, before committing the changes.
1. Confirm that all the changes are EXPECTED.
1. After all the necessary changes have been made, run the test suites once without auto-update mode enabled to ensure that the tests pass.

## Final Notes

Do NOT create or modify the snapshot objects manually. Use auto-update mode even for seemingly trivial changes. The generated snapshot may not reflect the actual object identically. Some modifications have been made to achieve cross-compatibility (e.g. white space standardization).

Running any snapshot test with auto-update mode enabled can lead to false positive results since comparison failures, if any, are suppressed. This further underscores the need to run the test suite WITHOUT auto-update mode enabled to truly test the system.

In general, only the lines that are modified should be changed. However, since there are some forms of standardization such as white spacing, sometimes multiple (seemingly unrelated) lines may be affected due to changes in the indentation, and as such it is not a cause for concern. An example of this is shown below:

```html
<div>
  <span>
    <img>
  </span>
</div>
```

being changed to

```html
<div>
  <div>
    <span>
      <img>
    </span>
  </div>
</div>
```

Happy Testing!
# Static Analysis

TEAMMATES uses a number of static analysis tools in order to maintain code quality.
This document will cover an overview of these tools and how to run them in local environment.

- [Version numbers](#version-numbers)
- [Tool stack](#tool-stack)
- [Suppressing rules](#suppressing-rules)
- [Running static analysis](#running-static-analysis)

## Version numbers

The version number of all the tool stacks are declared in `build.gradle` or `package.json`.

## Tool stack

| Tool name | Ruleset |
| --- | --- |
| [CheckStyle](http://checkstyle.sourceforge.net/) | [`teammates-checkstyle.xml`]((../static-analysis/teammates-checkstyle.xml)) |
| [PMD](https://pmd.github.io/) | [`teammates-pmd.xml`](../static-analysis/teammates-pmd.xml), [`teammates-pmdMain.xml`](../static-analysis/teammates-pmdMain.xml) |
| [SpotBugs](https://spotbugs.github.io/) | [`teammates-spotbugs.xml`](../static-analysis/teammates-spotbugs.xml) |
| [ArchUnit](https://github.com/TNG/ArchUnit) | - |
| [TSLint](https://palantir.github.io/tslint/) | [`teammates-tslint.yml`](../static-analysis/teammates-tslint.yml) |
| [JSONlint](https://github.com/marionebl/jsonlint-cli) | - |
| [stylelint](http://stylelint.io) | [`teammates-stylelint.yml`](../static-analysis/teammates-stylelint.yml) |
| [lintspaces](https://github.com/evanshortiss/lintspaces-cli) | - |

## Suppressing rules

Not all rules from all static analysis tools need to be followed 100% of the time; there are times where some rules need to be broken for various reasons.
Most of the static analysis tools we use allow for such leeway through various means.

General rule of thumb when suppressing rules:
- The suppression should be as specific as possible, e.g. specific rule, specific scope (lines/methods/classes)
- The rule must be re-enabled after the suppression is no longer necessary
- The reason for violating the rule should be explained

## Running static analysis

> Note the following:
> - Change `./gradlew` to `gradlew.bat` in Windows.
> - All the commands are assumed to be run from the root project folder, unless otherwise specified.

| Tool name | Command |
| --- | --- |
| CheckStyle | `./gradlew checkstyleMain`, `./gradlew checkstyleTest` |
| PMD | `./gradlew pmdMain`, `./gradlew pmdTest` |
| SpotBugs | `./gradlew spotbugsMain`, `./gradlew spotbugsTest` |
| ArchUnit | `./gradlew architectureTest` |
| TSLint | `npm run lint:ts` |
| JSONlint | `npm run lint:json` |
| stylelint | `npm run lint:css` |
| lintspaces | `npm run lint:spaces` |

To run all static analysis tasks in one sitting, run the following two commands:
```sh
./gradlew lint --continue
npm run lint
```
# Developer Troubleshooting Guide

This document can help you to fix the common problems encountered while contributing to TEAMMATES.
Note that some of the screenshots might be outdated, but the instructions will remain the same and all necessary modifications will be explained.

* [Troubleshooting project setup](#troubleshooting-project-setup)
    * [Common setup errors and solutions](#common-setup-errors-and-solutions)
* [Troubleshooting test failures](#troubleshooting-test-failures)
    * [Common test errors and solutions](#common-test-errors-and-solutions)
* [Submitting help request](#submitting-help-request)

## Troubleshooting project setup

### Common setup errors and solutions

* **ERROR**: After downloading and installing Google Cloud SDK, running any `gcloud` command results in `gcloud: command not found` or alike.

  **REASON**: You did not choose to update the `PATH` variable when installing the SDK.

  **SOLUTION**: You can re-run the install command again without any side effect. Make sure to choose to update the `PATH` variable this time. Alternatively, you can use other appropriate methods to update your `PATH` variable to include the `/bin` sub-folder of the SDK folder.<br>
  To verify this, try running any `gcloud` command and it should now give you access to the SDK.

## Troubleshooting test failures

### Common test errors and solutions

* **ERROR**: Encountered `java.net.ConnectException: Connection refused` when running some tests.

  **SOLUTION**: Ensure that your dev server is started prior to running those tests.

* **ERROR**: Encountered `org.openqa.selenium.WebDriverException: Unable to bind to locking port 7054 within 45000 ms` when running tests with Browser.

  **SOLUTION**: Ensure compatible version of Firefox is installed as specified under [Development process document](development.md#testing).

* **ERROR**: Test failure message encountered when running full test suite: "Selenium cannot find Firefox binary in PATH".

  **REASON 1**: Path to Firefox executable on local machine is incorrect.

  **SOLUTION 1 (on Windows)**: Specify the correct folder in system PATH variable.

  Open Windows Explorer → Right-click on Computer → Advanced System Settings → "Advanced" tab → Environment Variables… → Select "PATH" from the list → Add directory of "Mozilla Firefox" folder to "Variable value" field.

  **REASON 2**: Incorrect custom path in `test.firefox.path`.

  **SOLUTION 2**: Make sure that the path is set correctly following the example from `test.template.properties`.

* **ERROR**: A handful of failed test cases (< 10).

  **SOLUTION**: Re-run the failed tests with TestNG, all test cases should pass eventually (it may take a few runs). If there are tests that persistently fail and not addressed in other parts of this guide, you may [request for help in the issue tracker](https://github.com/TEAMMATES/teammates/issues/new?template=help-request.md).

* **ERROR**: Tests fail due to accented characters.

  **SOLUTION**: Ensure that the text file encoding for your workspace has been set to `UTF-8` as specified under [Setting up guide](setting-up.md).

* **ERROR**: `InstructorCourseDetailsPageUiTest` fails in production server due to Gmail's access restriction (e.g `javax.mail.AuthenticationFailedException`)

  **SOLUTION**: ["Allow access for less secure apps"](https://support.google.com/accounts/answer/6010255?hl=en) for the accounts used in that particular test. As doing so will leave the accounts more vulnerable to security issues, it is strongly recommended that the access is revoked after the test passes.

* **ERROR (on Linux)**: `java.io.IOException: Directory "/tmpfiles" could not be created`.

   **SOLUTION**: Add `-Djava.io.tmpdir=/path/to/teammates/tmp` for the tests' run configurations. The "tmp" folder in the specified directory needs to be created before running the tests.

## Submitting help request

If none of the items in this guide helps with the problem you face, you can [post in the issue tracker](https://github.com/TEAMMATES/teammates/issues/new?template=help-request.md) to request for help. Remember to supply as much relevant information as possible when requesting for help.
# Coding Best Practices

## Quality

Maintainability is our top priority. Less is more. Prefer simple over complex.

## Style

The goal is to make the code as if it was written by one person.

* Prefer standard way of doing something over creating special cases.
* Try to be consistent with the existing code in naming, layout etc.
* Follow coding style guides as much as possible. Most of the static analysis tools will enforce those styles, but not all.

## Refactoring

* Follow the [boy scout rule](https://medium.com/@biratkirat/step-8-the-boy-scout-rule-robert-c-martin-uncle-bob-9ac839778385) (i.e. always leave the campground cleaner than you found it). Whenever you touch some code, e.g. to fix a bug, try to do some clean up of that code as well.
  But do the extra refactoring as a separate issue. One issue should fix only one thing.

## Code Comments

* Use comments ONLY when the code is not-self explanatory. Avoid redundant comments. Even comment elements such as `@return` and `@param` can be omitted if they do not add value.
* Comments should be well-written. They should not be written as 'note to self' of the developer, but as explanations to help the reader.
* Write header comments for all classes.
* Write header comments for all non-trivial public methods.

## User-visible text

Make sure the terminology used is understandable to users.

## Issue tracking

* Everything you do for the project, even non-coding tasks, should be recorded in the issue tracker.
* Use a descriptive issue name with a well-defined scope. `Improve DevMan` is not good because the scope is not clear (improve in what way?). `Add issue name convention to the DevMan` is a better name.
* All ongoing work should be reflected in the tracker correctly. The issue tracker should clearly show which issues are being handled at the moment, which are ready for review, etc. Use status labels (`s.*`) appropriately.
* Resist the urge to do more than one task under one issue/PR unless they are tightly coupled and one cannot be done without the other. Specifically, do not do refactorings unrelated to the fix. Instead, create a new issue and do as a separate PR.

  Reason: Occasionally we have to 'undo' fixes done previously, e.g. when we discover latent regressions introduced by that fix. Therefore, we should be able to undo any specific fix by reverting the merge commit of the relevant branch. If one branch merge brings in multiple fixes, we cannot undo one without the other.
* Small issues are better than big ones. Big issues take longer to finish and have a higher risk of merge conflicts.

## Revision control

Go through your change set before pushing it. Ensure all changes are as intended.

## Security

* When coding the UI (web pages), any user-entered value (e.g. course name) should be sanitized before displaying it back. This is to minimize cross-site scripting.
# Data Migration Best Practices

Data migration is necessary when a new, possibly backwards-incompatible, schema is introduced in the code base.

* [Making code work for both schemas](#making-code-work-for-both-schemas)
* [Interchangeability between consecutive versions](#interchangeability-between-consecutive-versions)

## Making code work for both schemas

Initially, the breaking change should be written such that it works for both the old data schema and the new data schema. This can be done in two ways:

* Using [Objectify lifecycle annotation `@OnLoad`](https://github.com/objectify/objectify/wiki/LifecycleCallbacks)
  * In this lifecycle call, one could convert data in the old schema to the new schema.
  * However, it would be difficult to write client script to migrate the old schema to the new schema as all entities loaded by Objectify in the client script will be in new data schema because of the lifecycle call. Therefore, it is hard to differentiate the data in old schema and the data in new schema.

* Using Getter and Setter
  * This is the **recommended** way to convert data from the old schema to the new schema. It allows you to storage data in the new schema without knowing the underlying data schema.
  * In doing this, data migration script can use Java Reflection to determine whether it is old data or not and convert it accordingly.

## Interchangeability between consecutive versions

It is undeniable that the version using old data schema should be interchangeable with the immediate next version using the new data schema. This is why it is important to write code that works for both schemas.

In addition, it is also important to make sure the code work for both the version tailored for the old data schema and the **immediate** next version without hacks of the old schema.

For example, a field `isInNewDataSchema` is introduced to take care of the old schema. It will be imprudent to remove the field in the immediate next version after the client script is run as all data generated by the new version will have this field missing and be *wrongly* treated as data in old schema in the old version.
In the immediate next version, the field should be marked to `true` although it has no usage. In the version after the immediate next version, the field can be safely removed. That is, we should make any two consecutive versions interchangeable at **ALL** times.
# Testing Best Practices

The goal is to make the system as fully covered by automated tests as possible.

## General guidelines

* **Try TDD**: Try to follow Test Driven Development (TDD). In particular, when fixing a bug, write the test case first before fixing it.
* **Write independent tests**: A test should have minimal to zero impact to global state/other tests that are running (possibly in parallel).
* **Write short tests**: It is better to have many `@Test`/`it` methods than to group all testing into one `@Test`/`it` method. This helps in debugging and rerunning failed tests.
* **Avoid redundant tests**: Be mindful of the cost of running a test. Do not add redundant tests.
* **Strive for 100% coverage**: Try to write tests to cover 100% of the functional code you wrote. We have configured JaCoCo for Java and Istanbul for TypeScript for your usage.
* **Coverage is not enough**: Be mindful of missing test cases (e.g., boundary values). Just because you have 100% coverage does not mean the code is error free. You could have missed execution paths in the test and in the SUT at the same time.
* **Test at different levels**: Test units at unit level. Do not attempt to test lower level components from higher level functionality.
* **Testing private methods**: It is OK to omit testing private methods if they are fully covered by tests written against public methods of the same class. If the private method is complex enough to warrant its own test method, you can use reflection to access the private method from the test class.
# UI Design Best Practices

The goal is to make the user guide unnecessary.

## Be forgiving in processing input

* Forgive extra blank lines and extra white space.
* Auto-correct if possible.
* Allow 'cancel' at any step where it makes sense.

## Be descriptive

* Errors should be explained in as much details as possible. Also explain how to correct it.
* After an action, give a description of what happened, e.g. after a mass enroll operation, you can explain which students were added, which were modified, and how many remained the same.
* Keep user informed of what is happening, e.g. inform user about sending emails to users.
* Disable (rather than hide) unavailable functions so that users know they exist.

## Minimize work (to be done by the user)

User convenience is **far** more important than developer convenience, e.g.

* Submitting a page should take the user to the next logical page while showing feedback about the previous action at the same time.
* When possible, give an 'undo' instead of asking to confirm every action.
* Use defaults so that users are not forced to enter values for each field. This applies to sorting as well (i.e. sort by default using the most likely sorting order).
* If only one option is available, choose it by default.

## Take user point of view

* Use terms from user domain.
* Use terms that show 'user intent' rather than mechanism, e.g. 'leave this course' instead of 'delete'.

## Be consistent

Use consistent naming guidelines for link, page name, page title.
This is not a picture! Btw dont waste your time reading this... (~.~)User-agent: *
Disallow: /page/
Sitemap: http://teammatesv4.appspot.com/sitemap.xml